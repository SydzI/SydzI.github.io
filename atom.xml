<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>SydzI&#39;s Blog</title>
  
  <subtitle>路漫漫其修远兮，吾将上下而求索</subtitle>
  <link href="https://sydzi.github.io/atom.xml" rel="self"/>
  
  <link href="https://sydzi.github.io/"/>
  <updated>2026-02-15T15:23:13.908Z</updated>
  <id>https://sydzi.github.io/</id>
  
  <author>
    <name>SydzI</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>一个将博客和个人知识库结合的思路</title>
    <link href="https://sydzi.github.io/2026/02/13/%E4%B8%80%E4%B8%AA%E5%B0%86%E5%8D%9A%E5%AE%A2%E5%92%8C%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93%E7%BB%93%E5%90%88%E7%9A%84%E6%80%9D%E8%B7%AF/"/>
    <id>https://sydzi.github.io/2026/02/13/%E4%B8%80%E4%B8%AA%E5%B0%86%E5%8D%9A%E5%AE%A2%E5%92%8C%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93%E7%BB%93%E5%90%88%E7%9A%84%E6%80%9D%E8%B7%AF/</id>
    <published>2026-02-12T16:00:00.000Z</published>
    <updated>2026-02-15T15:23:13.908Z</updated>
    
    <content type="html"><![CDATA[<p>基于hexo+icarus博客，利用Obsidian和自写脚本实现博客和个人知识库的结合</p><span id="more"></span><h2 id="灵机一动"><a href="#灵机一动" class="headerlink" title="灵机一动"></a>灵机一动</h2><p> 笔者久仰Obsidian大名，但是此前都是用typora写的博客文章。这两天心血来潮想试试Obsidian（听闻有内部链接什么的新奇功能），加上想搞个个人知识库放一些杂七杂八的笔记什么的（没必要发布的），所以开始了本次折腾</p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>主要的问题实际上是博客文章和知识库文章的管理，这首先就牵扯到文章图片附件的问题（笔者博客图片一并部署到github了），知识库的图片不好公开，所以要和博客的图片分开存储，好在Obsidian有丰富的插件，利用插件”Attachment Management“可以为不同文件夹设置不同的附件存放路径，结合hexo的exclude配置可以实现博客与知识库的分离（即知识库不部署不公开）。<br>接下来的问题是知识库文章和博客文章的转化，笔者将博客文章视作知识库文章的一部分，因此准确来说是知识库文章部署到博客的问题。目前考虑到的部署中的问题是内部链接的去除和图片路径的转换，需要写脚本解决。</p><h2 id="开始动手"><a href="#开始动手" class="headerlink" title="开始动手"></a>开始动手</h2><h3 id="附件设置"><a href="#附件设置" class="headerlink" title="附件设置"></a>附件设置</h3><ol><li>安装并启用插件。这一步网上有很多教程了，属于Obsidian的使用，就不废话了。贴上一个链接：<a href="https://zhuanlan.zhihu.com/p/403001135">如何安装插件？玩转Obsidian的保姆级教程</a></li><li>安装启用完“Attachment Management”后，点击Obsian左侧工具栏右下角的设置图标展开设置，进行附件默认路径的设置。笔者直接用Obsidian打开的hexo下的source文件夹，所以附件默认路径设置中，根文件夹留空，附件路径填images（即博客图片目录。填知识库图片目录也行，此处只是保证Obsidian不会胡乱建文件夹来放图片而已，图片目录的设置主要在下一步）<br> <img src="/../images/IMG-20260213142540152.png" alt="展开设置"><br> <img src="/../images/IMG-20260213142638111.png" alt="设置默认路径"></li><li>Attachment Management的介绍中提到了可以为文件夹单独重载附件路径：<br> <img src="/../images/IMG-20260213143200206.png" alt="重载附件路径的特性"><br> 所以，笔者在source目录下新建了两个文件夹“myknowledge”和“private_images”作为知识库文件夹及其附件文件夹。选中“myknowledge”文件夹，右键可以看到“覆盖附件设置”的选项，在这里可以为文件夹单独设置附件路径<br> <img src="/../images/IMG-20260213143524173.png" alt="覆盖附件设置的选项"><br> 此处的设置和默认路径设置很相似，根文件夹也是留空，附件路径设为private_images<br> <img src="/../images/IMG-20260213144412039.png" alt="覆盖知识库附件设置"><br> 然后再对post文件夹如法炮制即可（根文件夹留空，附件路径设为images）</li><li>这时候还没结束，因为除了draft文件夹，hexo默认会把source下的所有文件都生成到public（即部署的文件夹）中，此时就需要借助hexo的exclude配置来排除知识库文件夹及其附件文件夹<br> <img src="/../images/IMG-20260213144609097.png" alt="exclude配置的官方描述"><br> 打开config.yml，找到如下位置，将知识库文件夹及其附件文件夹填入（此处保险起见exclude和ignore全填了，需要注意的是exclude和ignore的相对根目录不同，前者以source为根目录，后者以hexo根目录为根目录。** 表示所有文件）<br> <img src="/../images/IMG-20260213145113340.png" alt="config.yml的配置"><br> 到此，博客和知识库的附件存储路径就分开了</li></ol><h3 id="知识库文章发布到博客的脚本"><a href="#知识库文章发布到博客的脚本" class="headerlink" title="知识库文章发布到博客的脚本"></a>知识库文章发布到博客的脚本</h3><p>hexo为用户提供了使用自定义脚本来管理博客的途径：<br><img src="/../images/IMG-20260213151516207.png" alt="hexo对脚本的支持"><br>所以，自定义脚本只需要放到hexo根目录的scripts文件夹里即可生效。当然，自定义脚本肯定需要用到hexo的API，此处主要是使用了hexo的过滤器，一个hexo.extend.filter.register()函数即可<br><img src="/../images/IMG-20260213152113967.png" alt="hexo.extend.filter.register的官方描述"><br>脚本总体思路：设置一个FrontMatter字段published，ture表示需要部署，false表示不需要部署，通过遍历myknowledge的md文件，挨个查看published字段来判断是否进行发布操作。对于标记为需要发布的文章，先去掉内部链接，同时转换图片路径，然后检查文章是否已经存在，是否需要更新。</p><ol><li>函数依赖。脚本涉及文件操作，路径操作，还有FrontMatter解析操作，所以需要使用到fs-extra、path、js-yaml这三个模块。在hexo根目录下打开命令行，运行如下命令安装这三个模块</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install fs-extra path js-yaml --save<br></code></pre></td></tr></table></figure><ol start="2"><li>编写解析文章的函数，分离出FrontMatter和正文。使用参数article传入文章内容，通过js字符串的正则匹配方法match来获得FrontMatter的内容，然后分离article的FrontMatter和正文，返回一个拆分出来的对象</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 解析文章，分离Front Matter和正文，用于获取published来判断是否需要发布</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">parseArticle</span>(<span class="hljs-params">article</span>)&#123;<br>    <span class="hljs-keyword">const</span> match = article.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/^---\n([\s\S]*?)\n---/</span>);<br>    <span class="hljs-keyword">if</span> (match) &#123;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-keyword">const</span> frontMatter = yaml.<span class="hljs-title function_">load</span>(match[<span class="hljs-number">1</span>]);<br>            <span class="hljs-keyword">const</span> body = article.<span class="hljs-title function_">slice</span>(match[<span class="hljs-number">0</span>].<span class="hljs-property">length</span>).<span class="hljs-title function_">trim</span>();<br>            <span class="hljs-keyword">return</span> &#123;frontMatter,body&#125;<br>        &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&#x27;Front Matter parse failed&#x27;</span>)<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">frontMatter</span>: &#123;&#125;, <span class="hljs-attr">body</span>: article &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="3"><li>编写去除内部链接和修改图片路径的函数。使用三个参数content、filePath、knowledgeDir，分别传入文章内容、文章路径、知识库路径。首先通过正则匹配去除掉文章内容里的内部链接，然后根据传入的文件路径和知识库路径计算出相对路径，修改图片的路径（此处只是先修改路径，后续会有复制操作），返回处理完的文本</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs Javascript"><span class="hljs-comment">// 去除文章内部链接和改变图片路径</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">convertContent</span>(<span class="hljs-params">content, filePath, knowledgeDir</span>)&#123;<br>    <span class="hljs-keyword">let</span> result = content;<br><br>    <span class="hljs-comment">// 去除内部链接，wiki格式</span><br>    result = result.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\[\[.*?\]\]/g</span>, <span class="hljs-string">&#x27;&#x27;</span>);<br>    <span class="hljs-comment">// 去除内部链接，md超链接格式</span><br>     result = result.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\[.*?\]\(.*?\.md\)/g</span>, <span class="hljs-string">&#x27;&#x27;</span>);<br>  <br>    <span class="hljs-comment">// 计算相对路径</span><br>    <span class="hljs-keyword">const</span> relativePath = path.<span class="hljs-title function_">relative</span>(knowledgeDir, path.<span class="hljs-title function_">dirname</span>(filePath));<br>    <span class="hljs-keyword">const</span> depth = relativePath.<span class="hljs-title function_">split</span>(path.<span class="hljs-property">sep</span>).<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Boolean</span>).<span class="hljs-property">length</span>;<br>    <span class="hljs-keyword">const</span> upDir = depth &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">&#x27;../&#x27;</span>.<span class="hljs-title function_">repeat</span>(depth) + <span class="hljs-string">&#x27;../&#x27;</span> : <span class="hljs-string">&#x27;../&#x27;</span>;<br>    <br>    <span class="hljs-comment">// 转换图片路径：../myknowledge/images/xxx.png → ../images/xxx.png</span><br>    result = result.<span class="hljs-title function_">replace</span>(<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">`!\\[(.*?)\\]\\(<span class="hljs-subst">$&#123;upDir&#125;</span>private_images/(.*?)\\)`</span>, <span class="hljs-string">&#x27;g&#x27;</span>),<br>        <span class="hljs-string">&#x27;![$1](../images/$2)&#x27;</span><br>    );<br>  <br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="4"><li>编写提取图片文件名的函数。使用参数content传入文章正文内容，通过正则表达式匹配出图片链接，提取出所有图片的名字，返回图片名数组</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 提取图片文件名</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">extractImageName</span>(<span class="hljs-params">content</span>)&#123;<br>    <span class="hljs-keyword">const</span> matches = [];<br>    <span class="hljs-keyword">const</span> regex = <span class="hljs-regexp">/!\[.*?\]\(\.\.\/images\/(.*?)\)/g</span>;<br>    <span class="hljs-keyword">let</span> match;<br><br>    <span class="hljs-keyword">while</span>((match = regex.<span class="hljs-title function_">exec</span>(content)) !== <span class="hljs-literal">null</span>)&#123;<br>        matches.<span class="hljs-title function_">push</span>(match[<span class="hljs-number">1</span>]);<br>    &#125;<br>    <span class="hljs-keyword">return</span> [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(matches)];<span class="hljs-comment">// 去重</span><br>&#125;<br></code></pre></td></tr></table></figure><ol start="5"><li>整合上述函数，编写处理单个文章的函数。使用五个参数filePath、knowledgeDir、postDir、knowledgeImagesDir、blogImagesDir，传入文章路径、知识库路径、博客路径、知识库附件路径、博客附件路径。先用fs模块读取文件所有内容，然后使用parseArticle()解析出文章的FrontMatter和正文，检查published字段判断是否需要进行发布操作，若不需要，返回false；若需要发布，则接着去除内部链接，修改图片路径，重新构建出文本。然后由filePath和postDir构建出文章在post下的路径，判断文章是否已经存在，是否需要更新。若文章不存在或者需要更新，则接着进行图片的复制操作：先提取图片文件名，然后将图片从private_images复制到images（此处设置了overwrite: ture来防止同一图片累积）。最后就是写入重新构建的文本。本函数返回布尔值，记录文章是否更新，以便计数</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 处理单个文章</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ProcessSingleArticle</span>(<span class="hljs-params">filePath, knowledgeDir, postsDir, knowledgeImagesDir, blogImagesDir</span>)&#123;<br>  <span class="hljs-comment">// 读取文章</span><br>  <span class="hljs-comment">//console.log(`processing $&#123;filePath&#125;`);</span><br>  <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(filePath, <span class="hljs-string">&#x27;utf8&#x27;</span>);<br>  <span class="hljs-keyword">const</span> &#123; frontMatter, body &#125; = <span class="hljs-title function_">parseArticle</span>(content);<br>  <span class="hljs-comment">//console.log(&#x27;ispublished:&#x27;+frontMatter.published);</span><br>  <br>  <span class="hljs-comment">// 检查是否需要发布</span><br>  <span class="hljs-keyword">if</span> (frontMatter.<span class="hljs-property">published</span> !== <span class="hljs-literal">true</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// 转换内容（去掉内部链接，转换图片路径）</span><br>  <span class="hljs-keyword">let</span> processed = <span class="hljs-title function_">convertContent</span>(body, filePath, knowledgeDir);<br><br>  <span class="hljs-comment">// 构建完整内容</span><br>  <span class="hljs-keyword">const</span> finalContent = <span class="hljs-string">`---\n<span class="hljs-subst">$&#123;yaml.dump(frontMatter)&#125;</span>---\n\n<span class="hljs-subst">$&#123;processed&#125;</span>`</span>;<br><br>  <span class="hljs-comment">// 目标文件路径（保留原文件名）</span><br>  <span class="hljs-keyword">const</span> fileName = path.<span class="hljs-title function_">basename</span>(filePath);<br>  <span class="hljs-keyword">const</span> targetPath = path.<span class="hljs-title function_">join</span>(postsDir, fileName);<br><br>  <span class="hljs-comment">// 检查是否需要更新（比较内容）</span><br>  <span class="hljs-keyword">let</span> needsUpdate = <span class="hljs-literal">true</span>;<br>  <br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">pathExists</span>(targetPath)) &#123;<br>    <span class="hljs-keyword">const</span> existing = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(targetPath, <span class="hljs-string">&#x27;utf8&#x27;</span>);<br>    <span class="hljs-keyword">if</span> (existing === finalContent) &#123;<br>      needsUpdate = <span class="hljs-literal">false</span>;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">// 如果需要更新</span><br>  <span class="hljs-comment">//console.log(&quot;needUpdate:&quot;+needsUpdate);</span><br>  <span class="hljs-keyword">if</span> (needsUpdate) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[+] updating: <span class="hljs-subst">$&#123;fileName&#125;</span>`</span>);<br><br>    <span class="hljs-comment">// 复制文章引用的图片</span><br>    <span class="hljs-keyword">const</span> usedImages = <span class="hljs-title function_">extractImageName</span>(processed);<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> imgName <span class="hljs-keyword">of</span> usedImages) &#123;<br>      <span class="hljs-keyword">const</span> sourceImg = path.<span class="hljs-title function_">join</span>(knowledgeImagesDir, imgName);<br>      <span class="hljs-keyword">const</span> targetImg = path.<span class="hljs-title function_">join</span>(blogImagesDir, imgName);<br>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">pathExists</span>(sourceImg)) &#123;<br>        <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">copy</span>(sourceImg, targetImg, &#123; <span class="hljs-attr">overwrite</span>: <span class="hljs-literal">true</span> &#125;);<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[+] copied picture: <span class="hljs-subst">$&#123;imgName&#125;</span>`</span>);<br>      &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 写入文章</span><br>    <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">writeFile</span>(targetPath, finalContent);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[+] updated <span class="hljs-subst">$&#123;fileName&#125;</span> successfully`</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> needsUpdate;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="6"><li>编写遍历md文件的函数。使用参数dir用来传入知识库所在路径，递归读取路径下所有的md文件，写入数组fileList，最后返回fileList</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 获取所有md文件</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getAllMdFiles</span>(<span class="hljs-params">dir</span>)&#123;<br><span class="hljs-keyword">let</span> fileList = [];<br>    <span class="hljs-keyword">const</span> items = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readdir</span>(dir, &#123; <span class="hljs-attr">withFileTypes</span>: <span class="hljs-literal">true</span> &#125;);<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> items) &#123;<br>        <span class="hljs-keyword">const</span> fullPath = path.<span class="hljs-title function_">join</span>(dir, item.<span class="hljs-property">name</span>);<br><br>        <span class="hljs-keyword">if</span> (item.<span class="hljs-title function_">isDirectory</span>() &amp;&amp; item.<span class="hljs-property">name</span> !== <span class="hljs-string">&#x27;images&#x27;</span>) &#123;<br>            <span class="hljs-keyword">await</span> <span class="hljs-title function_">getAllMdFiles</span>(fullPath, fileList);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.<span class="hljs-title function_">isFile</span>() &amp;&amp; item.<span class="hljs-property">name</span>.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">&#x27;.md&#x27;</span>)) &#123;<br>            fileList.<span class="hljs-title function_">push</span>(fullPath);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> fileList;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="7"><li>整合上述内容，使用API注册自定义过滤规则。第一个参数type表示过滤器执行的时机，此处使用“after_init”，即在博客初始化之后，开始执行内部过滤器之前；第二个参数使用一个匿名函数，将获取所有md文件以及处理单个文章整合起来；第三个参数是优先级，此处不用设置，因为第一个参数已经保证此处自写的过滤器可以先于内置过滤器生效了（实际上笔者测试发现第一个参数为“before_generate”时，设置优先级似乎不能让自写的过滤器先于内置过滤器生效，需要两次hexo g才能让知识库文章真正生成到public文件夹内，所以在DS的建议下将第一个参数设为“after_init”，舍弃优先级的使用）</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">// 总函数，注册回调函数自实现过滤规则</span><br>hexo.<span class="hljs-property">extend</span>.<span class="hljs-property">filter</span>.<span class="hljs-title function_">register</span>(<span class="hljs-string">&#x27;after_init&#x27;</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">const</span> sourceDir = hexo.<span class="hljs-property">source_dir</span>;<br>    <span class="hljs-keyword">const</span> knowledgeDir = path.<span class="hljs-title function_">join</span>(sourceDir, <span class="hljs-string">&#x27;myknowledge&#x27;</span>);<br>    <span class="hljs-keyword">const</span> postsDir = path.<span class="hljs-title function_">join</span>(sourceDir, <span class="hljs-string">&#x27;_posts&#x27;</span>);<br>    <span class="hljs-keyword">const</span> knowledgeImagesDir = path.<span class="hljs-title function_">join</span>(sourceDir, <span class="hljs-string">&#x27;private_images&#x27;</span>);<br>    <span class="hljs-keyword">const</span> blogImagesDir = path.<span class="hljs-title function_">join</span>(sourceDir, <span class="hljs-string">&#x27;images&#x27;</span>);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;[+] syncing articles in myknowledge...&#x27;</span>);<br><br>    <span class="hljs-comment">// 确保目录存在</span><br>    <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">ensureDir</span>(postsDir);<br>    <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">ensureDir</span>(blogImagesDir);<br><br>    <span class="hljs-comment">// 遍历知识库目录</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[+] getting all mdfiles&quot;</span>);<br>    <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getAllMdFiles</span>(knowledgeDir);<br>    <span class="hljs-keyword">let</span> updatedCount = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[+] try to process articles&quot;</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> files)&#123;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-keyword">const</span> updated = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProcessSingleArticle</span>(<br>                file,<br>                knowledgeDir,<br>                postsDir,<br>                knowledgeImagesDir,<br>                blogImagesDir<br>            );<br><br>            <span class="hljs-keyword">if</span>(updated)&#123;<br>                updatedCount++;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span>(error)&#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`process failed <span class="hljs-subst">$&#123;file&#125;</span>:`</span>,error.<span class="hljs-property">message</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[+] sync successfully&quot;</span>)<br>    <span class="hljs-keyword">if</span>(updatedCount &gt; <span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[+] updated <span class="hljs-subst">$&#123;updatedCount&#125;</span> articles`</span>)<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>最终脚本：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-keyword">const</span> fs=<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs-extra&#x27;</span>)<br><span class="hljs-keyword">const</span> path=<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>)<br><span class="hljs-keyword">const</span> yaml=<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;js-yaml&#x27;</span>)<br><br><span class="hljs-comment">// 解析文章，分离Front Matter和正文，用于获取published来判断是否需要发布</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">parseArticle</span>(<span class="hljs-params">article</span>)&#123;<br>    <span class="hljs-keyword">const</span> match = article.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/^---\n([\s\S]*?)\n---/</span>);<br>    <span class="hljs-keyword">if</span> (match) &#123;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-keyword">const</span> frontMatter = yaml.<span class="hljs-title function_">load</span>(match[<span class="hljs-number">1</span>]);<br>            <span class="hljs-keyword">const</span> body = article.<span class="hljs-title function_">slice</span>(match[<span class="hljs-number">0</span>].<span class="hljs-property">length</span>).<span class="hljs-title function_">trim</span>();<br>            <span class="hljs-keyword">return</span> &#123;frontMatter,body&#125;<br>        &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&#x27;Front Matter parse failed&#x27;</span>)<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">frontMatter</span>: &#123;&#125;, <span class="hljs-attr">body</span>: article &#125;<br>&#125;<br><br><span class="hljs-comment">// 去除文章内部链接和改变图片路径</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">convertContent</span>(<span class="hljs-params">content, filePath, knowledgeDir</span>)&#123;<br>    <span class="hljs-keyword">let</span> result = content;<br><br>    <span class="hljs-comment">// 去除内部链接，wiki格式</span><br>    result = result.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\[\[.*?\]\]/g</span>, <span class="hljs-string">&#x27;&#x27;</span>);<br>    <span class="hljs-comment">// 去除内部链接，md超链接格式</span><br>     result = result.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\[.*?\]\(.*?\.md\)/g</span>, <span class="hljs-string">&#x27;&#x27;</span>);<br>  <br>    <span class="hljs-comment">// 计算相对路径</span><br>    <span class="hljs-keyword">const</span> relativePath = path.<span class="hljs-title function_">relative</span>(knowledgeDir, path.<span class="hljs-title function_">dirname</span>(filePath));<br>    <span class="hljs-keyword">const</span> depth = relativePath.<span class="hljs-title function_">split</span>(path.<span class="hljs-property">sep</span>).<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Boolean</span>).<span class="hljs-property">length</span>;<br>    <span class="hljs-keyword">const</span> upDir = depth &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">&#x27;../&#x27;</span>.<span class="hljs-title function_">repeat</span>(depth) + <span class="hljs-string">&#x27;../&#x27;</span> : <span class="hljs-string">&#x27;../&#x27;</span>;<br>    <br>    <span class="hljs-comment">// 转换图片路径：../myknowledge/images/xxx.png → ../images/xxx.png</span><br>    result = result.<span class="hljs-title function_">replace</span>(<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">`!\\[(.*?)\\]\\(<span class="hljs-subst">$&#123;upDir&#125;</span>private_images/(.*?)\\)`</span>, <span class="hljs-string">&#x27;g&#x27;</span>),<br>        <span class="hljs-string">&#x27;![$1](../images/$2)&#x27;</span><br>    );<br>  <br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-comment">// 提取图片文件名</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">extractImageName</span>(<span class="hljs-params">content</span>)&#123;<br>    <span class="hljs-keyword">const</span> matches = [];<br>    <span class="hljs-keyword">const</span> regex = <span class="hljs-regexp">/!\[.*?\]\(\.\.\/images\/(.*?)\)/g</span>;<br>    <span class="hljs-keyword">let</span> match;<br><br>    <span class="hljs-keyword">while</span>((match = regex.<span class="hljs-title function_">exec</span>(content)) !== <span class="hljs-literal">null</span>)&#123;<br>        matches.<span class="hljs-title function_">push</span>(match[<span class="hljs-number">1</span>]);<br>    &#125;<br>    <span class="hljs-keyword">return</span> [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(matches)];<span class="hljs-comment">// 去重</span><br>&#125;<br><br><span class="hljs-comment">// 处理单个文章</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ProcessSingleArticle</span>(<span class="hljs-params">filePath, knowledgeDir, postsDir, knowledgeImagesDir, blogImagesDir</span>)&#123;<br>  <span class="hljs-comment">// 读取文章</span><br>  <span class="hljs-comment">//console.log(`processing $&#123;filePath&#125;`);</span><br>  <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(filePath, <span class="hljs-string">&#x27;utf8&#x27;</span>);<br>  <span class="hljs-keyword">const</span> &#123; frontMatter, body &#125; = <span class="hljs-title function_">parseArticle</span>(content);<br>  <span class="hljs-comment">//console.log(&#x27;ispublished:&#x27;+frontMatter.published);</span><br>  <br>  <span class="hljs-comment">// 检查是否需要发布</span><br>  <span class="hljs-keyword">if</span> (frontMatter.<span class="hljs-property">published</span> !== <span class="hljs-literal">true</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// 转换内容（去掉内部链接，转换图片路径）</span><br>  <span class="hljs-keyword">let</span> processed = <span class="hljs-title function_">convertContent</span>(body, filePath, knowledgeDir);<br><br>  <span class="hljs-comment">// 构建完整内容</span><br>  <span class="hljs-keyword">const</span> finalContent = <span class="hljs-string">`---\n<span class="hljs-subst">$&#123;yaml.dump(frontMatter)&#125;</span>---\n<span class="hljs-subst">$&#123;processed&#125;</span>`</span>;<br><br>  <span class="hljs-comment">// 目标文件路径（保留原文件名）</span><br>  <span class="hljs-keyword">const</span> fileName = path.<span class="hljs-title function_">basename</span>(filePath);<br>  <span class="hljs-keyword">const</span> targetPath = path.<span class="hljs-title function_">join</span>(postsDir, fileName);<br><br>  <span class="hljs-comment">// 检查是否需要更新（比较内容）</span><br>  <span class="hljs-keyword">let</span> needsUpdate = <span class="hljs-literal">true</span>;<br>  <br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">pathExists</span>(targetPath)) &#123;<br>    <span class="hljs-keyword">const</span> existing = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(targetPath, <span class="hljs-string">&#x27;utf8&#x27;</span>);<br>    <span class="hljs-keyword">if</span> (existing === finalContent) &#123;<br>      needsUpdate = <span class="hljs-literal">false</span>;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">// 如果需要更新</span><br>  <span class="hljs-comment">//console.log(&quot;needUpdate:&quot;+needsUpdate);</span><br>  <span class="hljs-keyword">if</span> (needsUpdate) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[+] updating: <span class="hljs-subst">$&#123;fileName&#125;</span>`</span>);<br><br>    <span class="hljs-comment">// 复制文章引用的图片</span><br>    <span class="hljs-keyword">const</span> usedImages = <span class="hljs-title function_">extractImageName</span>(processed);<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> imgName <span class="hljs-keyword">of</span> usedImages) &#123;<br>      <span class="hljs-keyword">const</span> sourceImg = path.<span class="hljs-title function_">join</span>(knowledgeImagesDir, imgName);<br>      <span class="hljs-keyword">const</span> targetImg = path.<span class="hljs-title function_">join</span>(blogImagesDir, imgName);<br>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">pathExists</span>(sourceImg)) &#123;<br>        <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">copy</span>(sourceImg, targetImg, &#123; <span class="hljs-attr">overwrite</span>: <span class="hljs-literal">true</span> &#125;);<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[+] copied picture: <span class="hljs-subst">$&#123;imgName&#125;</span>`</span>);<br>      &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// 写入文章</span><br>    <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">writeFile</span>(targetPath, finalContent);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[+] updated <span class="hljs-subst">$&#123;fileName&#125;</span> successfully`</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> needsUpdate;<br>&#125;<br><br><span class="hljs-comment">// 获取所有md文件</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getAllMdFiles</span>(<span class="hljs-params">dir</span>)&#123;<br><span class="hljs-keyword">let</span> fileList = [];<br>    <span class="hljs-keyword">const</span> items = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readdir</span>(dir, &#123; <span class="hljs-attr">withFileTypes</span>: <span class="hljs-literal">true</span> &#125;);<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> items) &#123;<br>        <span class="hljs-keyword">const</span> fullPath = path.<span class="hljs-title function_">join</span>(dir, item.<span class="hljs-property">name</span>);<br><br>        <span class="hljs-keyword">if</span> (item.<span class="hljs-title function_">isDirectory</span>() &amp;&amp; item.<span class="hljs-property">name</span> !== <span class="hljs-string">&#x27;images&#x27;</span>) &#123;<br>            <span class="hljs-keyword">await</span> <span class="hljs-title function_">getAllMdFiles</span>(fullPath, fileList);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.<span class="hljs-title function_">isFile</span>() &amp;&amp; item.<span class="hljs-property">name</span>.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">&#x27;.md&#x27;</span>)) &#123;<br>            fileList.<span class="hljs-title function_">push</span>(fullPath);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> fileList;<br>&#125;<br><br><span class="hljs-comment">// 总函数，注册回调函数自实现过滤规则</span><br>hexo.<span class="hljs-property">extend</span>.<span class="hljs-property">filter</span>.<span class="hljs-title function_">register</span>(<span class="hljs-string">&#x27;after_init&#x27;</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">const</span> sourceDir = hexo.<span class="hljs-property">source_dir</span>;<br>    <span class="hljs-keyword">const</span> knowledgeDir = path.<span class="hljs-title function_">join</span>(sourceDir, <span class="hljs-string">&#x27;myknowledge&#x27;</span>);<br>    <span class="hljs-keyword">const</span> postsDir = path.<span class="hljs-title function_">join</span>(sourceDir, <span class="hljs-string">&#x27;_posts&#x27;</span>);<br>    <span class="hljs-keyword">const</span> knowledgeImagesDir = path.<span class="hljs-title function_">join</span>(sourceDir, <span class="hljs-string">&#x27;private_images&#x27;</span>);<br>    <span class="hljs-keyword">const</span> blogImagesDir = path.<span class="hljs-title function_">join</span>(sourceDir, <span class="hljs-string">&#x27;images&#x27;</span>);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;[+] syncing articles in myknowledge...&#x27;</span>);<br><br>    <span class="hljs-comment">// 确保目录存在</span><br>    <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">ensureDir</span>(postsDir);<br>    <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">ensureDir</span>(blogImagesDir);<br><br>    <span class="hljs-comment">// 遍历知识库目录</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[+] getting all mdfiles&quot;</span>);<br>    <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getAllMdFiles</span>(knowledgeDir);<br>    <span class="hljs-keyword">let</span> updatedCount = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[+] try to process articles&quot;</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> files)&#123;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-keyword">const</span> updated = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProcessSingleArticle</span>(<br>                file,<br>                knowledgeDir,<br>                postsDir,<br>                knowledgeImagesDir,<br>                blogImagesDir<br>            );<br><br>            <span class="hljs-keyword">if</span>(updated)&#123;<br>                updatedCount++;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span>(error)&#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`process failed <span class="hljs-subst">$&#123;file&#125;</span>:`</span>,error.<span class="hljs-property">message</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;[+] sync successfully&quot;</span>)<br>    <span class="hljs-keyword">if</span>(updatedCount &gt; <span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[+] updated <span class="hljs-subst">$&#123;updatedCount&#125;</span> articles`</span>)<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h2><p>以本文和另一篇测试文章为例，本文设置published为true，测试文章设置为false。还未进行generate之前，两篇文章中的图片链接如下：<br><img src="/../images/IMG-20260213220752342.png" alt="本文图片链接"><br><img src="/../images/IMG-20260213220847002.png" alt="测试文章图片链接"><br>本文中设置一个内部链接：<br><img src="/../images/IMG-20260213220918405.png" alt="内部链接"><br>然后执行hexo cl &amp;&amp; hexo g：<br><img src="/../images/IMG-20260213221128009.png" alt="命令行输出"><br>查看发布到post的文章中内部链接是否删除，图片链接是否修改：<br><img src="/../images/IMG-20260213221509504.png" alt="发布到post的文章中的内部链接"><br><img src="/../images/IMG-20260213221332152.png" alt="发布到post的文章中的图片链接"><br>可以看到，脚本成功生效</p>]]></content>
    
    
    <summary type="html">在hexo博客基础上，利用Obsidian和自写脚本实现博客和个人知识库的结合</summary>
    
    
    
    <category term="杂记" scheme="https://sydzi.github.io/categories/%E6%9D%82%E8%AE%B0/"/>
    
    
    <category term="杂记" scheme="https://sydzi.github.io/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>week49-week52</title>
    <link href="https://sydzi.github.io/2026/02/08/week49-week52/"/>
    <id>https://sydzi.github.io/2026/02/08/week49-week52/</id>
    <published>2026-02-08T15:26:28.000Z</published>
    <updated>2026-02-15T15:23:13.874Z</updated>
    
    <content type="html"><![CDATA[<p>2026年2月篇</p><span id="more"></span><h2 id="week49-2026-2-2-2026-2-8"><a href="#week49-2026-2-2-2026-2-8" class="headerlink" title="week49 (2026.2.2-2026.2.8)"></a>week49 (2026.2.2-2026.2.8)</h2><ul><li>这周，折腾了一点爬虫(～￣▽￣)～有点小摆(～￣▽￣)～</li></ul>]]></content>
    
    
    <summary type="html">2026年2月4篇周记</summary>
    
    
    
    <category term="周记" scheme="https://sydzi.github.io/categories/%E5%91%A8%E8%AE%B0/"/>
    
    
    <category term="周记" scheme="https://sydzi.github.io/tags/%E5%91%A8%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>week45-week48</title>
    <link href="https://sydzi.github.io/2026/01/11/week45-week48/"/>
    <id>https://sydzi.github.io/2026/01/11/week45-week48/</id>
    <published>2026-01-11T14:28:26.000Z</published>
    <updated>2026-02-15T15:23:13.873Z</updated>
    
    <content type="html"><![CDATA[<p>2026年1月篇</p><span id="more"></span><h2 id="week45-2026-1-5-2025-1-11"><a href="#week45-2026-1-5-2025-1-11" class="headerlink" title="week45 (2026.1.5-2025.1.11)"></a>week45 (2026.1.5-2025.1.11)</h2><ul><li>期末周，复习到要似力X﹏X</li></ul><h2 id="week46-2026-1-12-2026-1-18"><a href="#week46-2026-1-12-2026-1-18" class="headerlink" title="week46 (2026.1.12-2026.1.18)"></a>week46 (2026.1.12-2026.1.18)</h2><ul><li>期末周断更…</li></ul><h2 id="week47-2026-1-19-2026-1-25"><a href="#week47-2026-1-19-2026-1-25" class="headerlink" title="week47 (2026.1.19-2026.1.25)"></a>week47 (2026.1.19-2026.1.25)</h2><ul><li>考完试回家力，偷懒两天:p</li></ul><h2 id="week48-2026-1-26-2026-2-1"><a href="#week48-2026-1-26-2026-2-1" class="headerlink" title="week48 (2026.1.26-2026.2.1)"></a>week48 (2026.1.26-2026.2.1)</h2><ul><li>周末两天打阿里CTF，爆零了😭😭</li></ul>]]></content>
    
    
    <summary type="html">2026年1月4篇周记</summary>
    
    
    
    <category term="周记" scheme="https://sydzi.github.io/categories/%E5%91%A8%E8%AE%B0/"/>
    
    
    <category term="周记" scheme="https://sydzi.github.io/tags/%E5%91%A8%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>19thCISCN初赛WriteUp</title>
    <link href="https://sydzi.github.io/2025/12/28/19thCISCN%E5%88%9D%E8%B5%9BWriteUp&amp;%E5%A4%8D%E7%8E%B0/"/>
    <id>https://sydzi.github.io/2025/12/28/19thCISCN%E5%88%9D%E8%B5%9BWriteUp&amp;%E5%A4%8D%E7%8E%B0/</id>
    <published>2025-12-28T14:29:34.000Z</published>
    <updated>2026-02-15T15:23:13.819Z</updated>
    
    <content type="html"><![CDATA[<p>第一次参加国赛，难哭了😭😭</p><span id="more"></span><h2 id="WriteUp"><a href="#WriteUp" class="headerlink" title="WriteUp"></a>WriteUp</h2><h3 id="babygame"><a href="#babygame" class="headerlink" title="babygame"></a>babygame</h3><blockquote><p>godot逆向,AES算法</p></blockquote><p>附件程序是个小游戏。拖入x64dbg分析，一路F9，在入口点附近可以看到Godot Engine字样</p><p><img src="/../images/1766932387724-2.png" alt="入口点附近找到godot engine字样"></p><p>上网查找一下可以知道godot是一种游戏引擎，类似unity，可以解包</p><p>使用<a href="https://github.com/GDRETools/gdsdecomp">GDRETools&#x2F;gdsdecomp</a>解析exe可以得到一个babygame文件夹，文件夹下的scripts目录打开如下</p><p><img src="/../images/1766932387724-1.png" alt="scripts目录"></p><p>010editor可以打开gd文件直接查看，如下是flag.gd，出现了主要的检验逻辑，加密使用了AES_ECB</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">extends</span> <span class="hljs-title class_">CenterContainer</span><br><br><span class="hljs-meta">@onready</span> <span class="hljs-keyword">var</span> flagTextEdit: Node = $PanelContainer / VBoxContainer / FlagTextEdit<br><span class="hljs-meta">@onready</span> <span class="hljs-keyword">var</span> label2: Node = $PanelContainer / VBoxContainer / Label2<br><br><span class="hljs-keyword">static</span> <span class="hljs-type">var</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;FanAglFanAglOoO!&quot;</span><br><span class="hljs-type">var</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span><br><br>func <span class="hljs-title function_">_on_ready</span><span class="hljs-params">()</span> -&gt; <span class="hljs-keyword">void</span> :<br>    Flag.hide()<br><br>func <span class="hljs-title function_">get_key</span><span class="hljs-params">()</span> -&gt; String:<br>    <span class="hljs-keyword">return</span> key<br><br>func <span class="hljs-title function_">submit</span><span class="hljs-params">()</span> -&gt; <span class="hljs-keyword">void</span> :<br>    data = flagTextEdit.text<br><br>    <span class="hljs-type">var</span> <span class="hljs-variable">aes</span> <span class="hljs-operator">=</span> AESContext.new()<br>    aes.start(AESContext.MODE_ECB_ENCRYPT, key.to_utf8_buffer())<br>    <span class="hljs-type">var</span> <span class="hljs-variable">encrypted</span> <span class="hljs-operator">=</span> aes.update(data.to_utf8_buffer())<br>    aes.finish()<br><br>    <span class="hljs-keyword">if</span> encrypted.hex_encode() == <span class="hljs-string">&quot;d458af702a680ae4d089ce32fc39945d&quot;</span>:<br>        label2.show()<br>    <span class="hljs-keyword">else</span>:<br>        label2.hide()<br><br>func <span class="hljs-title function_">back</span><span class="hljs-params">()</span> -&gt; <span class="hljs-keyword">void</span> :<br>    get_tree().change_scene_to_file(<span class="hljs-string">&quot;res://scenes/menu.tscn&quot;</span>)<br><br><span class="hljs-keyword">extends</span> <span class="hljs-title class_">Node</span><br></code></pre></td></tr></table></figure><p>题目提示需要收集金币（得分），在game_manager.gd里可以发现得分会修改key，A会被替换成B</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@onready</span> <span class="hljs-type">var</span> <span class="hljs-variable">fan</span> <span class="hljs-operator">=</span> $<span class="hljs-string">&quot;../Fan&quot;</span><br><br><span class="hljs-type">var</span> <span class="hljs-variable">score</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span><br><br>func <span class="hljs-title function_">add_point</span><span class="hljs-params">()</span>:<br>    score += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> score == <span class="hljs-number">1</span>:<br>        Flag.key = Flag.key.replace(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>)<br>        fan.visible = <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>所以把key改一下，然后使用Crypto库解密即可</p><p>Exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">import</span> binascii<br>enc=<span class="hljs-string">&quot;d458af702a680ae4d089ce32fc39945d&quot;</span><br>enc_bytes=binascii.unhexlify(enc)<br>key=<span class="hljs-string">b&quot;FanBglFanBglOoO!&quot;</span><br>cipher = AES.new(key, AES.MODE_ECB)<br>decrypted = cipher.decrypt(enc_bytes)<br><span class="hljs-built_in">print</span>(decrypted)    <br><span class="hljs-comment">#flag&#123;wOW~youAregrEaT!&#125;</span><br></code></pre></td></tr></table></figure><h2 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h2><h3 id="wasm-login"><a href="#wasm-login" class="headerlink" title="wasm-login"></a>wasm-login</h3><blockquote><p>js+wasm逆向(没学过jsweb逆向╥﹏╥…</p></blockquote><p>附件是个网页登录校验项目</p><p><img src="/../images/image-20260102143806427.png" alt="附件文件列表"></p><p>题目描述：</p><p><img src="/../images/image-20260102145448548.png" alt="题目描述"></p><p>在项目根目录下执行python -m http.server 4000可以把项目跑起来（当然直接看代码也行，但是当时没思路，于是就找了个办法把项目跑起来看看）</p><p><img src="/../images/image-20260102144454944.png" alt="运行项目"></p><p>index.html的script部分如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><code class="hljs javascript">  &lt;script src=<span class="hljs-string">&quot;crypto-js.js&quot;</span>&gt;&lt;/script&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;build/release.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;module&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml">     <span class="hljs-keyword">import</span> &#123; authenticate &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./build/release.js&quot;</span>;</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-comment">// 初始化 WASM 模块</span></span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initWasm</span>(<span class="hljs-params"></span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-keyword">const</span> wasmStatus = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;wasm-status&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-keyword">const</span> loginForm = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;login-form&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-keyword">const</span> loginBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;login-btn&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-keyword">const</span> loginSpinner = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;login-spinner&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-keyword">const</span> statusMessage = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;status-message&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-keyword">const</span> errorMessage = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;error-message&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-keyword">const</span> passwordInput = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;password&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-keyword">const</span> togglePasswordBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;toggle-password&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">      </span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-keyword">try</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml">        <span class="hljs-comment">// 初始化完成</span></span></span><br><span class="language-javascript"><span class="language-xml">        wasmStatus.<span class="hljs-property">textContent</span> = <span class="hljs-string">&#x27;WASM 已加载&#x27;</span>;</span></span><br><span class="language-javascript"><span class="language-xml">        wasmStatus.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;text-success&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">        </span></span><br><span class="language-javascript"><span class="language-xml">        <span class="hljs-comment">// 切换密码可见性</span></span></span><br><span class="language-javascript"><span class="language-xml">        togglePasswordBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">          <span class="hljs-keyword">const</span> type = passwordInput.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&#x27;type&#x27;</span>) === <span class="hljs-string">&#x27;password&#x27;</span> ? <span class="hljs-string">&#x27;text&#x27;</span> : <span class="hljs-string">&#x27;password&#x27;</span>;</span></span><br><span class="language-javascript"><span class="language-xml">          passwordInput.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;type&#x27;</span>, type);</span></span><br><span class="language-javascript"><span class="language-xml">          </span></span><br><span class="language-javascript"><span class="language-xml">          <span class="hljs-keyword">const</span> icon = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;i&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">          <span class="hljs-keyword">const</span> text = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;span&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">          </span></span><br><span class="language-javascript"><span class="language-xml">          <span class="hljs-keyword">if</span> (type === <span class="hljs-string">&#x27;text&#x27;</span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">            icon.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;fa-eye-slash&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">            icon.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;fa-eye&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">            text.<span class="hljs-property">textContent</span> = <span class="hljs-string">&#x27;隐藏&#x27;</span>;</span></span><br><span class="language-javascript"><span class="language-xml">          &#125; <span class="hljs-keyword">else</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">            icon.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;fa-eye&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">            icon.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;fa-eye-slash&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">            text.<span class="hljs-property">textContent</span> = <span class="hljs-string">&#x27;显示&#x27;</span>;</span></span><br><span class="language-javascript"><span class="language-xml">          &#125;</span></span><br><span class="language-javascript"><span class="language-xml">        &#125;);</span></span><br><span class="language-javascript"><span class="language-xml">        </span></span><br><span class="language-javascript"><span class="language-xml">        <span class="hljs-comment">// 登录表单提交处理</span></span></span><br><span class="language-javascript"><span class="language-xml">        loginForm.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;submit&#x27;</span>, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">          e.<span class="hljs-title function_">preventDefault</span>();</span></span><br><span class="language-javascript"><span class="language-xml">          </span></span><br><span class="language-javascript"><span class="language-xml">          <span class="hljs-comment">// 显示加载状态</span></span></span><br><span class="language-javascript"><span class="language-xml">          loginBtn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;</span></span><br><span class="language-javascript"><span class="language-xml">          loginSpinner.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;hidden&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">          statusMessage.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;hidden&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">          </span></span><br><span class="language-javascript"><span class="language-xml">          <span class="hljs-keyword">try</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-keyword">const</span> username = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;username&#x27;</span>).<span class="hljs-property">value</span>;</span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-keyword">const</span> password = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;password&#x27;</span>).<span class="hljs-property">value</span>;</span></span><br><span class="language-javascript"><span class="language-xml">            </span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-comment">// 调用 WASM 中的 authenticate 函数</span></span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-keyword">const</span> authResult = <span class="hljs-title function_">authenticate</span>(username, password);</span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-keyword">const</span> authData = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(authResult);</span></span><br><span class="language-javascript"><span class="language-xml">            </span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-comment">// 模拟发送到服务器</span></span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;发送到服务器的数据:&#x27;</span>, authData);</span></span><br><span class="language-javascript"><span class="language-xml">            </span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-comment">// 模拟服务器响应</span></span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-title function_">simulateServerRequest</span>(authData)</span></span><br><span class="language-javascript"><span class="language-xml">              .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">                <span class="hljs-keyword">if</span> (response.<span class="hljs-property">success</span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">                  <span class="hljs-comment">// 登录成功</span></span></span><br><span class="language-javascript"><span class="language-xml">                  <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;登录成功！&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">                &#125; <span class="hljs-keyword">else</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">                  <span class="hljs-comment">// 登录失败</span></span></span><br><span class="language-javascript"><span class="language-xml">                  <span class="hljs-title function_">showError</span>(response.<span class="hljs-property">message</span> || <span class="hljs-string">&#x27;登录失败，请重试&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">                &#125;</span></span><br><span class="language-javascript"><span class="language-xml">              &#125;)</span></span><br><span class="language-javascript"><span class="language-xml">              .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;登录错误:&#x27;</span>, error);</span></span><br><span class="language-javascript"><span class="language-xml">                <span class="hljs-title function_">showError</span>(<span class="hljs-string">&#x27;网络错误，请稍后重试&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">              &#125;)</span></span><br><span class="language-javascript"><span class="language-xml">              .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">                <span class="hljs-comment">// 恢复按钮状态</span></span></span><br><span class="language-javascript"><span class="language-xml">                loginBtn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;</span></span><br><span class="language-javascript"><span class="language-xml">                loginSpinner.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;hidden&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">              &#125;);</span></span><br><span class="language-javascript"><span class="language-xml">            </span></span><br><span class="language-javascript"><span class="language-xml">          &#125; <span class="hljs-keyword">catch</span> (error) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;WASM 处理错误:&#x27;</span>, error);</span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-title function_">showError</span>(<span class="hljs-string">&#x27;内部错误，请联系管理员&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">            </span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-comment">// 恢复按钮状态</span></span></span><br><span class="language-javascript"><span class="language-xml">            loginBtn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>;</span></span><br><span class="language-javascript"><span class="language-xml">            loginSpinner.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;hidden&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">          &#125;</span></span><br><span class="language-javascript"><span class="language-xml">        &#125;);</span></span><br><span class="language-javascript"><span class="language-xml">        </span></span><br><span class="language-javascript"><span class="language-xml">        <span class="hljs-comment">// 显示错误消息</span></span></span><br><span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">function</span> <span class="hljs-title function_">showError</span>(<span class="hljs-params">message</span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">          errorMessage.<span class="hljs-property">textContent</span> = message;</span></span><br><span class="language-javascript"><span class="language-xml">          statusMessage.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;hidden&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">          </span></span><br><span class="language-javascript"><span class="language-xml">          <span class="hljs-comment">// 添加动画效果</span></span></span><br><span class="language-javascript"><span class="language-xml">          <span class="hljs-keyword">const</span> errorBox = statusMessage.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;div&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">          errorBox.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;animate-shake&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">          <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">            errorBox.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;animate-shake&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">          &#125;, <span class="hljs-number">500</span>);</span></span><br><span class="language-javascript"><span class="language-xml">        &#125;</span></span><br><span class="language-javascript"><span class="language-xml">        </span></span><br><span class="language-javascript"><span class="language-xml">        <span class="hljs-comment">// 模拟服务器请求</span></span></span><br><span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">function</span> <span class="hljs-title function_">simulateServerRequest</span>(<span class="hljs-params">data</span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">          <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-comment">// 模拟网络延迟</span></span></span><br><span class="language-javascript"><span class="language-xml">            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">              <span class="hljs-comment">// 实际应用中这里应该是真实的 API 请求</span></span></span><br><span class="language-javascript"><span class="language-xml">              <span class="hljs-comment">// 这里仅作演示，使用本地判断</span></span></span><br><span class="language-javascript"><span class="language-xml">              <span class="hljs-keyword">const</span> check = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-title class_">MD5</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)).<span class="hljs-title function_">toString</span>(<span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Hex</span>);</span></span><br><span class="language-javascript"><span class="language-xml">              <span class="hljs-keyword">if</span> (check.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&quot;ccaf33e3512e31f3&quot;</span>))&#123;</span></span><br><span class="language-javascript"><span class="language-xml">                <span class="hljs-title function_">resolve</span>(&#123; <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span> &#125;);</span></span><br><span class="language-javascript"><span class="language-xml">              &#125;<span class="hljs-keyword">else</span>&#123;</span></span><br><span class="language-javascript"><span class="language-xml">                <span class="hljs-title function_">resolve</span>(&#123; <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span> &#125;);</span></span><br><span class="language-javascript"><span class="language-xml">              &#125;</span></span><br><span class="language-javascript"><span class="language-xml">            &#125;, <span class="hljs-number">1000</span>);</span></span><br><span class="language-javascript"><span class="language-xml">          &#125;);</span></span><br><span class="language-javascript"><span class="language-xml">        &#125;</span></span><br><span class="language-javascript"><span class="language-xml">        </span></span><br><span class="language-javascript"><span class="language-xml">      &#125; <span class="hljs-keyword">catch</span> (error) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;WASM 加载失败:&#x27;</span>, error);</span></span><br><span class="language-javascript"><span class="language-xml">        wasmStatus.<span class="hljs-property">textContent</span> = <span class="hljs-string">&#x27;WASM 加载失败&#x27;</span>;</span></span><br><span class="language-javascript"><span class="language-xml">        wasmStatus.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;text-danger&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">        </span></span><br><span class="language-javascript"><span class="language-xml">        <span class="hljs-comment">// 禁用登录按钮</span></span></span><br><span class="language-javascript"><span class="language-xml">        loginBtn.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>;</span></span><br><span class="language-javascript"><span class="language-xml">        loginBtn.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&#x27;bg-neutral-400&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">        loginBtn.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&#x27;bg-primary&#x27;</span>, <span class="hljs-string">&#x27;hover:bg-primary/90&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">      &#125;</span></span><br><span class="language-javascript"><span class="language-xml">    &#125;</span></span><br><span class="language-javascript"><span class="language-xml">    </span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-comment">// 页面加载完成后初始化 WASM</span></span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;load&#x27;</span>, initWasm);</span></span><br><span class="language-javascript"><span class="language-xml">  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br>&lt;/body&gt;<br>&lt;/html&gt;    <br><br>&lt;!-- 测试账号 admin 测试密码 admin--&gt;<br></code></pre></td></tr></table></figure><p>审阅代码可知，校验逻辑在simulateServerRequest()里，主要是如下几行</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> check = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-title class_">MD5</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)).<span class="hljs-title function_">toString</span>(<span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Hex</span>);<br><span class="hljs-keyword">if</span> (check.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&quot;ccaf33e3512e31f3&quot;</span>))&#123;<br>    <span class="hljs-title function_">resolve</span>(&#123; <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span> &#125;);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_">resolve</span>(&#123; <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span> &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p>data是传入的参数，实际参数应该是authData：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 调用 WASM 中的 authenticate 函数</span><br><span class="hljs-keyword">const</span> authResult = <span class="hljs-title function_">authenticate</span>(username, password);<br><span class="hljs-keyword">const</span> authData = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(authResult);<br><br><span class="hljs-comment">// 模拟服务器响应</span><br><span class="hljs-title function_">simulateServerRequest</span>(authData).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> &#123;<br><span class="hljs-keyword">if</span> (response.<span class="hljs-property">success</span>) &#123;<br><span class="hljs-comment">// 登录成功</span><br><span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;登录成功！&#x27;</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-comment">// 登录失败</span><br><span class="hljs-title function_">showError</span>(response.<span class="hljs-property">message</span> || <span class="hljs-string">&#x27;登录失败，请重试&#x27;</span>);<br>&#125;<br>&#125;)<br></code></pre></td></tr></table></figure><p>所以校验逻辑为：调用wasm的authenticate函数，返回值求md5后与给定的哈希值头”ccaf33e3512e31f3”进行比较。结合题目描述，authenticate函数除了用到index.html末尾的测试账密，还可能用到了时间戳，意味着需要求出这个时间戳进而求出完整哈希值。可以选择爆破时间戳，但是在此之前还得了解一下时间戳怎么来的</p><p>release.js用来连接wasm和js，在release.js里可以看到一些wasm的环境配置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> adaptedImports = &#123;<br>    <span class="hljs-attr">env</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(&#123;<br>      <span class="hljs-title function_">abort</span>(<span class="hljs-params">message, fileName, lineNumber, columnNumber</span>) &#123;<br>        <span class="hljs-comment">// ~lib/builtins/abort(~lib/string/String | null?, ~lib/string/String | null?, u32?, u32?) =&gt; void</span><br>        message = <span class="hljs-title function_">__liftString</span>(message &gt;&gt;&gt; <span class="hljs-number">0</span>);<br>        fileName = <span class="hljs-title function_">__liftString</span>(fileName &gt;&gt;&gt; <span class="hljs-number">0</span>);<br>        lineNumber = lineNumber &gt;&gt;&gt; <span class="hljs-number">0</span>;<br>        columnNumber = columnNumber &gt;&gt;&gt; <span class="hljs-number">0</span>;<br>        (<span class="hljs-function">() =&gt;</span> &#123;<br>          <span class="hljs-comment">// @external.js</span><br>          <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;message&#125;</span> in <span class="hljs-subst">$&#123;fileName&#125;</span>:<span class="hljs-subst">$&#123;lineNumber&#125;</span>:<span class="hljs-subst">$&#123;columnNumber&#125;</span>`</span>);<br>        &#125;)();<br>      &#125;,<br>      <span class="hljs-string">&quot;console.log&quot;</span>(text) &#123;<br>        <span class="hljs-comment">// ~lib/bindings/dom/console.log(~lib/string/String) =&gt; void</span><br>        text = <span class="hljs-title function_">__liftString</span>(text &gt;&gt;&gt; <span class="hljs-number">0</span>);<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(text);<br>      &#125;,<br>      <span class="hljs-string">&quot;Date.now&quot;</span>() &#123;<br>        <span class="hljs-comment">// ~lib/bindings/dom/Date.now() =&gt; f64</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();<br>      &#125;,<br>    &#125;, <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(globalThis), imports.<span class="hljs-property">env</span> || &#123;&#125;)),<br>  &#125;;<br></code></pre></td></tr></table></figure><p>此处设置了环境量(环境函数？)Date.now()，通过工具<a href="https://github.com/WebAssembly/wabt/tree/main">wabt</a>下的wasm2c转化出wasm的c代码，也可以发现相关内容</p><p><img src="/../images/image-20260102161051236.png" alt="c代码中的date.now"></p><p>接下来，要想爆破时间戳，需要能够设置authenticate函数使用的时间戳。在wasm里难以修改相关逻辑，只好在release.js中修改Date.now()的定义，使其在被authenticate函数调用的时候返回我们想要的数。这里可以创建一个全局变量globalThis.mytime，然后修改Date.now()的返回值为这个全局变量，这样就可以设置不同的时间戳来让authenticate函数使用了。</p><p><img src="/../images/image-20260102162920935.png" alt="修改release.js"></p><p>最后抄一下index.html里检验逻辑的js代码就可以写出hook脚本：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; authenticate &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./build/release.js&quot;</span>;<span class="hljs-comment">// 模仿index.html导入authenticate函数，后续直接调用</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">CryptoJS</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;crypto-js&quot;</span>;<span class="hljs-comment">// index.html的检验逻辑用到了这个文件，需要导入，否则照抄会报错</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">var</span> startTime=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&quot;2025-12-21T22:40:00+08:00&quot;</span>).<span class="hljs-title function_">getTime</span>();<br>    <span class="hljs-keyword">var</span> endTime=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&quot;2025-12-22T01:10:00+08:00&quot;</span>).<span class="hljs-title function_">getTime</span>();<br>    <span class="hljs-comment">// 这里的时间范围是通过文件修改时间推测出来的（看其他师傅的wp才get到这点，太细了）</span><br>    <span class="hljs-keyword">const</span> username = <span class="hljs-string">&quot;admin&quot;</span>;<br>    <span class="hljs-keyword">const</span> password = <span class="hljs-string">&quot;admin&quot;</span>;<br><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Start brute forcing...&quot;</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i=startTime;i&lt;=endTime;i+=<span class="hljs-number">1</span>)&#123;<br>        globalThis.<span class="hljs-property">mytime</span> = i;<br>        <span class="hljs-comment">// 下面几行直接抄原代码即可</span><br>        <span class="hljs-comment">// 调用 WASM 中的 authenticate 函数</span><br>        <span class="hljs-keyword">const</span> authResult = <span class="hljs-title function_">authenticate</span>(username, password);<br>        <span class="hljs-keyword">const</span> authData = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(authResult);<br>        <span class="hljs-keyword">var</span> check = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-title class_">MD5</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(authData)).<span class="hljs-title function_">toString</span>(<span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Hex</span>);<br>        <span class="hljs-keyword">if</span>(check.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&quot;ccaf33e3512e31f3&quot;</span>))&#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;found hash:&quot;</span>,check);<span class="hljs-comment">// 返回操作改成输出hash</span><br>        &#125;<br>    &#125;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Brute forcing completed.&quot;</span>);<br>&#125;<br><br><span class="hljs-title function_">hook</span>();<br><span class="hljs-comment">// Start brute forcing...</span><br><span class="hljs-comment">// found hash: ccaf33e3512e31f36228f0b97ccbc8f1</span><br><span class="hljs-comment">// Brute forcing completed.</span><br></code></pre></td></tr></table></figure><h3 id="eternum"><a href="#eternum" class="headerlink" title="eternum"></a>eternum</h3><blockquote><p>go逆向，待更新…</p></blockquote><h3 id="vvvmmm"><a href="#vvvmmm" class="headerlink" title="vvvmmm"></a>vvvmmm</h3><blockquote><p>vm逆向，待更新…</p></blockquote>]]></content>
    
    
    <summary type="html">第十九届CISCN初赛Re方向WriteUp、复现</summary>
    
    
    
    <category term="WriteUp&amp;复现" scheme="https://sydzi.github.io/categories/WriteUp-%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="CTF" scheme="https://sydzi.github.io/tags/CTF/"/>
    
    <category term="WriteUp" scheme="https://sydzi.github.io/tags/WriteUp/"/>
    
    <category term="Reverse" scheme="https://sydzi.github.io/tags/Reverse/"/>
    
    <category term="复现" scheme="https://sydzi.github.io/tags/%E5%A4%8D%E7%8E%B0/"/>
    
  </entry>
  
  <entry>
    <title>week40-week44</title>
    <link href="https://sydzi.github.io/2025/12/07/week40-week44/"/>
    <id>https://sydzi.github.io/2025/12/07/week40-week44/</id>
    <published>2025-12-07T13:20:29.000Z</published>
    <updated>2026-02-15T15:23:13.872Z</updated>
    
    <content type="html"><![CDATA[<p>2025年12月篇</p><span id="more"></span><h2 id="week40-2025-12-1-2025-12-7"><a href="#week40-2025-12-1-2025-12-7" class="headerlink" title="week40 (2025.12.1-2025.12.7)"></a>week40 (2025.12.1-2025.12.7)</h2><ul><li>这周摆烂力&#x2F;_ \</li></ul><h2 id="week41-2025-12-8-2025-12-14"><a href="#week41-2025-12-8-2025-12-14" class="headerlink" title="week41 (2025.12.8-2025.12.14)"></a>week41 (2025.12.8-2025.12.14)</h2><ul><li><p>周末打了鹏城杯，一道题耗掉一整天(T_T)。又是过于依赖AI，导致大半时间都在等AI和调教AI（一道花指令+VM的题，一开始看出是VM没看出花指令在哪里，丢给AI分析，一早上3h没出结果，中午自己琢磨了下汇编代码才看出花指令的规律。值得高兴的是今天没靠AI自己写了IDApython脚本去花(。但是后面写VM解释器又丢给AI了，AI分析一下午没分析出一根毛，又是比赛结束后自己琢磨出了下一步（悲）。复制原代码插个桩几十分钟可以跑的反汇编非要让AI来，这么多的时间闹着玩呢属于是😡</p></li><li><p>叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI叫你用AI😡</p><p>下下周CISCN不能用AI看你怎么办😡</p></li></ul><h2 id="week42-2025-12-15-2025-12-21"><a href="#week42-2025-12-15-2025-12-21" class="headerlink" title="week42 (2025.12.15-2025.12.21)"></a>week42 (2025.12.15-2025.12.21)</h2><ul><li>考试周断更(</li></ul><h2 id="week43-2025-12-22-2025-12-28"><a href="#week43-2025-12-22-2025-12-28" class="headerlink" title="week43 (2025.12.22-2025.12.28)"></a>week43 (2025.12.22-2025.12.28)</h2><ul><li>这周末CISCN，还是太菜了。复杂程序的逆向能力一点没有。。。</li></ul><h2 id="week44-2025-12-29-2026-1-4"><a href="#week44-2025-12-29-2026-1-4" class="headerlink" title="week44 (2025.12.29-2026.1.4)"></a>week44 (2025.12.29-2026.1.4)</h2><ul><li>元旦期间无聊复现了CISCN的wasm-login，这题不会写脚本败北了😭</li><li>此外还折腾了一下WSL2，想体验体验Arch生态（其实主要是是平铺式桌面管理器），然而WSL2貌似不支持直接图形化桌面，后面又去折腾VNC连接WSL2搞桌面，没搞出来。虽然但是，折腾使我快乐○( ＾皿＾)っ</li></ul>]]></content>
    
    
    <summary type="html">2025年十二月4篇周记</summary>
    
    
    
    <category term="周记" scheme="https://sydzi.github.io/categories/%E5%91%A8%E8%AE%B0/"/>
    
    
    <category term="周记" scheme="https://sydzi.github.io/tags/%E5%91%A8%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>0xGame2025Week4WriteUp</title>
    <link href="https://sydzi.github.io/2025/11/16/0xGame2025Week4ReverseWriteUp/"/>
    <id>https://sydzi.github.io/2025/11/16/0xGame2025Week4ReverseWriteUp/</id>
    <published>2025-11-16T12:59:56.000Z</published>
    <updated>2026-02-15T15:23:13.816Z</updated>
    
    <content type="html"><![CDATA[<p>0xGame2025 Week4 Reverse方向全解&amp;详解</p><span id="more"></span><h2 id="镜渊折枝"><a href="#镜渊折枝" class="headerlink" title="镜渊折枝"></a>镜渊折枝</h2><blockquote><p>考点：native层逆向，AES</p></blockquote><ul><li><p>附件apk运行起来是这样：</p><p><img src="/../images/image-20251029221337039.png" alt="运行附件apk"></p></li><li><p>JEB打开，可以得到下面这些MainActivity和相关函数的内容：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.easynative;<br><br><span class="hljs-keyword">import</span> android.content.Context;<br><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> android.view.View;<br><span class="hljs-keyword">import</span> android.widget.Button;<br><span class="hljs-keyword">import</span> android.widget.EditText;<br><span class="hljs-keyword">import</span> android.widget.Toast;<br><span class="hljs-keyword">import</span> androidx.activity.ComponentActivity;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> kotlin.Metadata;<br><span class="hljs-keyword">import</span> kotlin.io.ByteStreamsKt;<br><span class="hljs-keyword">import</span> kotlin.jvm.internal.Intrinsics;<br><br><span class="hljs-meta">@Metadata(d1 = &#123;&quot;\u0000\u0018\n\u0002\u0018\u0002\n\u0002\u0018\u0002\n\u0002\b\u0002\n\u0002\u0010\u0002\n\u0000\n\u0002\u0018\u0002\n\u0000\b\u0007\u0018\u00002\u00020\u0001B\u0005¢\u0006\u0002\u0010\u0002J\u0012\u0010\u0003\u001A\u00020\u00042\b\u0010\u0005\u001A\u0004\u0018\u00010\u0006H\u0014¨\u0006\u0007&quot;&#125;, d2 = &#123;&quot;Lcom/example/easynative/MainActivity;&quot;, &quot;Landroidx/activity/ComponentActivity;&quot;, &quot;()V&quot;, &quot;onCreate&quot;, &quot;&quot;, &quot;savedInstanceState&quot;, &quot;Landroid/os/Bundle;&quot;, &quot;app_release&quot;&#125;, k = 1, mv = &#123;1, 9, 0&#125;, xi = 0x30)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ComponentActivity</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> $stable;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span>  <span class="hljs-comment">// androidx.activity.ComponentActivity</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle arg3)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(arg3);<br>        <span class="hljs-built_in">this</span>.setContentView(layout.activity_main);<br>        <span class="hljs-type">EditText</span> <span class="hljs-variable">v3</span> <span class="hljs-operator">=</span> (EditText)<span class="hljs-built_in">this</span>.findViewById(id.flagInput);<br>        ((Button)<span class="hljs-built_in">this</span>.findViewById(id.button)).setOnClickListener((View arg2) -&gt; MainActivity.onCreate$lambda$<span class="hljs-number">0</span>(v3, <span class="hljs-built_in">this</span>, arg2));<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> onCreate$lambda$<span class="hljs-number">0</span>(EditText arg2, MainActivity arg3, View arg4) &#123;<br>        Intrinsics.checkNotNullParameter(arg3, <span class="hljs-string">&quot;this$0&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">v2</span> <span class="hljs-operator">=</span> arg2.getText().toString();<br>        <span class="hljs-type">InputStream</span> <span class="hljs-variable">v4</span> <span class="hljs-operator">=</span> arg3.getAssets().open(<span class="hljs-string">&quot;secret.bin&quot;</span>);<br>        Intrinsics.checkNotNullExpressionValue(v4, <span class="hljs-string">&quot;open(...)&quot;</span>);<br>        <span class="hljs-type">byte</span>[] v4_1 = ByteStreamsKt.readBytes(v4);<br>        <span class="hljs-keyword">if</span>(((CharSequence)v2).length() &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-type">Context</span> <span class="hljs-variable">v1</span> <span class="hljs-operator">=</span> (Context)arg3;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FlagChecker</span>(v1, v2).check(v4_1)) &#123;  <span class="hljs-comment">// v4从secret.bin中被读取出来，读取的内容给了v4_1作为check的参数，输入的内容作为FlagChecker的第二个参数</span><br>                Toast.makeText(v1, ((CharSequence)arg3.getString(string.correct)), <span class="hljs-number">0</span>).show();<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br><br>            Toast.makeText(v1, ((CharSequence)arg3.getString(string.wrong)), <span class="hljs-number">0</span>).show();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">package</span> com.example.easynative;<br><br><span class="hljs-keyword">import</span> android.content.Context;<br><span class="hljs-keyword">import</span> java.security.Key;<br><span class="hljs-keyword">import</span> java.security.spec.AlgorithmParameterSpec;<br><span class="hljs-keyword">import</span> javax.crypto.Cipher;<br><span class="hljs-keyword">import</span> javax.crypto.spec.IvParameterSpec;<br><span class="hljs-keyword">import</span> javax.crypto.spec.SecretKeySpec;<br><span class="hljs-keyword">import</span> kotlin.Metadata;<br><span class="hljs-keyword">import</span> kotlin.jvm.internal.DefaultConstructorMarker;<br><span class="hljs-keyword">import</span> kotlin.jvm.internal.Intrinsics;<br><span class="hljs-keyword">import</span> kotlin.text.Charsets;<br><br><span class="hljs-meta">@Metadata(d1 = &#123;&quot;\u0000.\n\u0002\u0018\u0002\n\u0002\u0010\u0000\n\u0000\n\u0002\u0018\u0002\n\u0000\n\u0002\u0010\u000E\n\u0002\b\u0002\n\u0002\u0010\u000B\n\u0000\n\u0002\u0010\u0012\n\u0002\b\u0002\n\u0002\u0010\b\n\u0002\b\u0005\b\u0007\u0018\u0000 \u00112\u00020\u0001:\u0001\u0011B\u0015\u0012\u0006\u0010\u0002\u001A\u00020\u0003\u0012\u0006\u0010\u0004\u001A\u00020\u0005¢\u0006\u0002\u0010\u0006J\u000E\u0010\u0007\u001A\u00020\b2\u0006\u0010\t\u001A\u00020\nJ\u0019\u0010\u000B\u001A\u00020\b2\u0006\u0010\f\u001A\u00020\r2\u0006\u0010\u000E\u001A\u00020\nH\u0086 J\u001E\u0010\u000F\u001A\u00020\n2\u0006\u0010\u0004\u001A\u00020\u00052\u0006\u0010\u0010\u001A\u00020\n2\u0006\u0010\t\u001A\u00020\nR\u000E\u0010\u0002\u001A\u00020\u0003X\u0082\u0004¢\u0006\u0002\n\u0000R\u000E\u0010\u0004\u001A\u00020\u0005X\u0082\u0004¢\u0006\u0002\n\u0000¨\u0006\u0012&quot;&#125;, d2 = &#123;&quot;Lcom/example/easynative/FlagChecker;&quot;, &quot;&quot;, &quot;context&quot;, &quot;Landroid/content/Context;&quot;, &quot;plainText&quot;, &quot;&quot;, &quot;(Landroid/content/Context;Ljava/lang/String;)V&quot;, &quot;check&quot;, &quot;&quot;, &quot;iv&quot;, &quot;&quot;, &quot;compare&quot;, &quot;length&quot;, &quot;&quot;, &quot;data&quot;, &quot;encrypt&quot;, &quot;key&quot;, &quot;Companion&quot;, &quot;app_release&quot;&#125;, k = 1, mv = &#123;1, 9, 0&#125;, xi = 0x30)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlagChecker</span> &#123;<br>    <span class="hljs-meta">@Metadata(d1 = &#123;&quot;\u0000\f\n\u0002\u0018\u0002\n\u0002\u0010\u0000\n\u0002\b\u0002\b\u0086\u0003\u0018\u00002\u00020\u0001B\u0007\b\u0002¢\u0006\u0002\u0010\u0002¨\u0006\u0003&quot;&#125;, d2 = &#123;&quot;Lcom/example/easynative/FlagChecker$Companion;&quot;, &quot;&quot;, &quot;()V&quot;, &quot;app_release&quot;&#125;, k = 1, mv = &#123;1, 9, 0&#125;, xi = 0x30)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Companion</span> &#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-title function_">Companion</span><span class="hljs-params">()</span> &#123;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">Companion</span><span class="hljs-params">(DefaultConstructorMarker arg1)</span> &#123;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> $stable;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Companion Companion;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Context context;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String plainText;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        FlagChecker.Companion = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Companion</span>(<span class="hljs-literal">null</span>);<br>        FlagChecker.$stable = <span class="hljs-number">8</span>;<br>        System.loadLibrary(<span class="hljs-string">&quot;easynative&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">FlagChecker</span><span class="hljs-params">(Context arg2, String arg3)</span> &#123;<br>        Intrinsics.checkNotNullParameter(arg2, <span class="hljs-string">&quot;context&quot;</span>);<br>        Intrinsics.checkNotNullParameter(arg3, <span class="hljs-string">&quot;plainText&quot;</span>);<br>        <span class="hljs-built_in">super</span>();<br>        <span class="hljs-built_in">this</span>.context = arg2;<br>        <span class="hljs-built_in">this</span>.plainText = arg3;  <span class="hljs-comment">// 输入的内容被赋值给plaintext</span><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">check</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] arg4)</span> &#123;  <span class="hljs-comment">// 参数是从secret.bin读取的内容</span><br>        Intrinsics.checkNotNullParameter(((Object)arg4), <span class="hljs-string">&quot;iv&quot;</span>);  <span class="hljs-comment">// arg4即从secret.bin读取的内容被标识为iv</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">v0</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.context.getString(string.key);  <span class="hljs-comment">// v0为string.key</span><br>        Intrinsics.checkNotNullExpressionValue(v0, <span class="hljs-string">&quot;getString(...)&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">v1</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.plainText;  <span class="hljs-comment">// v1是输入的内容plaintext</span><br>        <span class="hljs-type">byte</span>[] v0_1 = v0.getBytes(Charsets.UTF_8);  <span class="hljs-comment">// v0读取为bytes</span><br>        Intrinsics.checkNotNullExpressionValue(((Object)v0_1), <span class="hljs-string">&quot;this as java.lang.String).getBytes(charset)&quot;</span>);<br>        <span class="hljs-type">byte</span>[] v4 = <span class="hljs-built_in">this</span>.encrypt(v1, v0_1, arg4);  <span class="hljs-comment">// 三个参数分别为：输入的plaintext，string.key，从secret.bin读取的iv</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.compare(v4.length, v4);  <span class="hljs-comment">// compare从native层easynative.so导入</span><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">native</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(<span class="hljs-type">int</span> arg1, <span class="hljs-type">byte</span>[] arg2)</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">byte</span>[] encrypt(String arg3, <span class="hljs-type">byte</span>[] arg4, <span class="hljs-type">byte</span>[] arg5) &#123;<br>        Intrinsics.checkNotNullParameter(arg3, <span class="hljs-string">&quot;plainText&quot;</span>);  <span class="hljs-comment">// 此处再次对参数进行了标识</span><br>        Intrinsics.checkNotNullParameter(((Object)arg4), <span class="hljs-string">&quot;key&quot;</span>);<br>        Intrinsics.checkNotNullParameter(((Object)arg5), <span class="hljs-string">&quot;iv&quot;</span>);<br>        <span class="hljs-type">SecretKeySpec</span> <span class="hljs-variable">v0</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(arg4, <span class="hljs-string">&quot;AES&quot;</span>);  <span class="hljs-comment">// 加密算法AES，CTR模式</span><br>        <span class="hljs-type">Cipher</span> <span class="hljs-variable">v4</span> <span class="hljs-operator">=</span> Cipher.getInstance(<span class="hljs-string">&quot;AES/CTR/NoPadding&quot;</span>);<br>        v4.init(<span class="hljs-number">1</span>, ((Key)v0), ((AlgorithmParameterSpec)<span class="hljs-keyword">new</span> <span class="hljs-title class_">IvParameterSpec</span>(arg5)));<br>        <span class="hljs-type">byte</span>[] v3 = arg3.getBytes(Charsets.UTF_8);<br>        Intrinsics.checkNotNullExpressionValue(((Object)v3), <span class="hljs-string">&quot;this as java.lang.String).getBytes(charset)&quot;</span>);<br>        <span class="hljs-type">byte</span>[] v3_1 = v4.doFinal(v3);<br>        Intrinsics.checkNotNull(((Object)v3_1));<br>        <span class="hljs-keyword">return</span> v3_1;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到Mainactivity使用了FlagChecker来校验，而FlagChecker对输入的内容进行了AES加密，然后用native层的compare函数来检验加密结果。下面是native层compare函数的内容(IDA中显示的函数名是check而非compare)：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">check</span><span class="hljs-params">(JNIEnv *a1, __int64 a2, <span class="hljs-type">int</span> a3, <span class="hljs-type">void</span> *a4)</span></span><br><span class="hljs-function"></span>&#123;<br>  __int64 v5; <span class="hljs-comment">// x0</span><br>  __int64 i; <span class="hljs-comment">// x9</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// w11</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// w10</span><br><br>  v5 = (__int64)(*a1)-&gt;<span class="hljs-built_in">GetByteArrayElements</span>(a1, a4, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-keyword">if</span> ( a3 != <span class="hljs-number">48</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0LL</span>; i != <span class="hljs-number">48</span>; ++i )<br>  &#123;<br>    v7 = (<span class="hljs-type">unsigned</span> __int8)byte_5A2[i];<br>    v8 = *(<span class="hljs-type">unsigned</span> __int8 *)(v5 + i) ^ (<span class="hljs-type">unsigned</span> __int8)i;<br>    <span class="hljs-keyword">if</span> ( v8 != v7 )<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到compare函数是先拿AES加密结果异或索引后才进行校验的，所以解密应该拿compare中的密文和索引异或得到AES加密的数据，然后找出key和iv进行AES解密。</p><p>脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><br>enc=[<span class="hljs-number">0x38</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0xF7</span>]<br><span class="hljs-comment">#先对数据进行异或还原</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    enc[i]=enc[i]^i<br><span class="hljs-comment">#提取AES相关参数</span><br>key=<span class="hljs-string">b&quot;0xgame-SecretKey&quot;</span><br>iv=<span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&quot;8A A5 61 0C 74 41 1B 11 A3 53 68 DE 56 BF 6A B3&quot;</span>)<br><span class="hljs-comment">#AES解密</span><br>cipher=AES.new(key, AES.MODE_CTR, nonce=<span class="hljs-string">b&#x27;&#x27;</span>, initial_value=iv)<br>flag=cipher.decrypt(<span class="hljs-built_in">bytes</span>(enc))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;flag: &quot;</span>,flag.decode())<br></code></pre></td></tr></table></figure></li></ul><blockquote><p>flag：0xGame{Native_1s_also_1nt3r3st1ng_ef492d80a257c}</p></blockquote><h2 id="夜雀之歌"><a href="#夜雀之歌" class="headerlink" title="夜雀之歌"></a>夜雀之歌</h2><blockquote><p>考点：迷宫题，动态调试，反调试</p></blockquote><ul><li><p>附件程序运行起来是这样的：</p><p><img src="/../images/image-20251105204720304.png" alt="运行"></p><p>用IDA打开，通过Shift+F12字符串窗口可以找到一些信息定位main函数的位置</p><p><img src="/../images/image-20251105205201725.png" alt="字符串窗口的信息"></p><p>main函数有一大串的循环语句，结合上图终端输出的WASD可以推测这是一道迷宫逆向题。#是迷宫的墙，终端显示的是迷宫的一小部分，在终端按下WASD可以控制P移动。所以第一步要提取迷宫</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//main函数</span><br>__int64 <span class="hljs-title function_">sub_7FF6645A1D2B</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">int</span> v0; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v1; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v2; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// [rsp+2Ch] [rbp-4h]</span><br><br>  sub_7FF7EC581FC0();<br>  sub_7FF7EC581B30();<br>  sub_7FF7EC5815B6();<br>  v6 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">do</span><br>  &#123;<br>    sub_7FF7EC581C5F();<br>    sub_7FF7EC5815B6();<br>    <span class="hljs-built_in">puts</span>(&amp;aWasdEsc);<br>    v5 = getch();<br>    sub_7FF7EC583060(<span class="hljs-string">&quot;%c\n&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v5);<br><br>    <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">119</span> )<br>    &#123;<br>LABEL_19:<br>      sub_7FF7EC581BB7(<span class="hljs-number">0LL</span>, <span class="hljs-number">0xFFFFFFFFL</span>L);<br>      v0 = v6++;<br>      byte_7FF7EC58E0E0[v0] = <span class="hljs-number">119</span>;<br>      <span class="hljs-keyword">continue</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v5 &lt;= <span class="hljs-number">119</span> )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">115</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_22;<br>      <span class="hljs-keyword">if</span> ( v5 &lt;= <span class="hljs-number">115</span> )<br>      &#123;<br>        <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">100</span> )<br>          <span class="hljs-keyword">goto</span> LABEL_21;<br>        <span class="hljs-keyword">if</span> ( v5 &lt;= <span class="hljs-number">100</span> )<br>        &#123;<br>          <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">97</span> )<br>            <span class="hljs-keyword">goto</span> LABEL_20;<br>          <span class="hljs-keyword">if</span> ( v5 &lt;= <span class="hljs-number">97</span> )<br>          &#123;<br>            <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">87</span> )<br>              <span class="hljs-keyword">goto</span> LABEL_19;<br>            <span class="hljs-keyword">if</span> ( v5 &lt;= <span class="hljs-number">87</span> )<br>            &#123;<br>              <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">83</span> )<br>              &#123;<br>LABEL_22:<br>                sub_7FF7EC581BB7(<span class="hljs-number">0LL</span>, <span class="hljs-number">1LL</span>);<br>                v3 = v6++;<br>                byte_7FF7EC58E0E0[v3] = <span class="hljs-number">115</span>;<br>                <span class="hljs-keyword">continue</span>;<br>              &#125;<br>              <span class="hljs-keyword">if</span> ( v5 &lt;= <span class="hljs-number">83</span> )<br>              &#123;<br>                <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">68</span> )<br>                &#123;<br>LABEL_21:<br>                  sub_7FF7EC581BB7(<span class="hljs-number">1LL</span>, <span class="hljs-number">0LL</span>);<br>                  v2 = v6++;<br>                  byte_7FF7EC58E0E0[v2] = <span class="hljs-number">100</span>;<br>                  <span class="hljs-keyword">continue</span>;<br>                &#125;<br>                <span class="hljs-keyword">if</span> ( v5 &lt;= <span class="hljs-number">68</span> )<br>                &#123;<br>                  <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">27</span> )<br>                    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>                  <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">65</span> )<br>                  &#123;<br>LABEL_20:<br>                    sub_7FF7EC581BB7(<span class="hljs-number">0xFFFFFFFFL</span>L, <span class="hljs-number">0LL</span>);<br>                    v1 = v6++;<br>                    byte_7FF7EC58E0E0[v1] = <span class="hljs-number">97</span>;<br>                  &#125;<br>                &#125;<br>              &#125;<br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">while</span> ( dword_7FF7EC58E0C4 != dword_7FF7EC58E0D4 || dword_7FF7EC58E0C8 != dword_7FF7EC58E0D8 );<br>  sub_7FF7EC583060(<span class="hljs-string">&quot;Congratulations your flag is: 0xGame&#123;md5(your_path)&#125; (lowercase)&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>点进LABEL_19下的第一个函数可以看到一个比较逻辑</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">sub_7FF7EC581BB7</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2)</span><br>&#123;<br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// [rsp+24h] [rbp-Ch]</span><br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// [rsp+2Ch] [rbp-4h]</span><br><br>  v5 = dword_7FF7EC58E0C4 + a1;<br>  v4 = dword_7FF7EC58E0C8 + a2;<br>  v3 = dword_7FF7EC58E0C4 + a1 + <span class="hljs-number">101</span> * (dword_7FF7EC58E0C8 + a2);<br>  <span class="hljs-keyword">if</span> ( byte_7FF7EC589040[v3] == <span class="hljs-number">35</span> )<span class="hljs-comment">//比较逻辑</span><br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;不能移动到墙壁&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    byte_7FF7EC589040[<span class="hljs-number">101</span> * dword_7FF7EC58E0C8 + dword_7FF7EC58E0C4] = <span class="hljs-number">32</span>;<br>    dword_7FF7EC58E0C4 = v5;<br>    dword_7FF7EC58E0C8 = v4;<br>    byte_7FF7EC589040[v3] = <span class="hljs-number">80</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>在Hex View跟随比较逻辑中的这个数组的地址(7FF7EC589040)可以看到迷宫：</p><p><img src="/../images/image-20251105210910030.png" alt="迷宫"></p><p>但是提取出迷宫会发现，这个迷宫和直接运行程序时终端显示的迷宫不一样</p><p>推测程序加了反调试。最直接的绕过方法就是用xdbg调试，用插件ScyllaHide直接绕过反调试检测。在转储找到相同的地址可以得到真正的迷宫</p><p><img src="/../images/image-20251105212443210.png" alt="真正的迷宫"></p><p>选中迷宫地图数据右键二进制保存到文件，把文件格式改为txt</p><p><img src="/../images/image-20251105213100678.png" alt="保存迷宫地图"></p><p>然后就可以让AI写个解迷宫脚本解出路径，按照程序的提示把路径进行MD5加密就可以得到flag了</p></li><li><p>解迷宫脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve_maze</span>(<span class="hljs-params">maze, start, end, wall=<span class="hljs-string">&#x27;#&#x27;</span>, free=<span class="hljs-string">&#x27; &#x27;</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Maze solver using BFS&quot;&quot;&quot;</span><br>    directions = &#123;<br>        (-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>): <span class="hljs-string">&#x27;w&#x27;</span>,  <span class="hljs-comment"># up</span><br>        (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>): <span class="hljs-string">&#x27;s&#x27;</span>,   <span class="hljs-comment"># down  </span><br>        (<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>): <span class="hljs-string">&#x27;a&#x27;</span>,  <span class="hljs-comment"># left</span><br>        (<span class="hljs-number">0</span>, <span class="hljs-number">1</span>): <span class="hljs-string">&#x27;d&#x27;</span>    <span class="hljs-comment"># right</span><br>    &#125;<br>    <br>    rows, cols = <span class="hljs-built_in">len</span>(maze), <span class="hljs-built_in">len</span>(maze[<span class="hljs-number">0</span>])<br>    visited = [[<span class="hljs-literal">False</span>] * cols <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(rows)]<br>    <br>    <span class="hljs-comment"># BFS</span><br>    queue = deque([(start[<span class="hljs-number">0</span>], start[<span class="hljs-number">1</span>], <span class="hljs-string">&quot;&quot;</span>)])<br>    visited[start[<span class="hljs-number">0</span>]][start[<span class="hljs-number">1</span>]] = <span class="hljs-literal">True</span><br>    <br>    <span class="hljs-keyword">while</span> queue:<br>        row, col, path = queue.popleft()<br>        <br>        <span class="hljs-keyword">if</span> (row, col) == end:<br>            <span class="hljs-keyword">return</span> path<br>        <br>        <span class="hljs-keyword">for</span> dr, dc <span class="hljs-keyword">in</span> directions.keys():<br>            new_row, new_col = row + dr, col + dc<br>            <br>            <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt;= new_row &lt; rows <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> &lt;= new_col &lt; cols <span class="hljs-keyword">and</span> <br>                <span class="hljs-keyword">not</span> visited[new_row][new_col] <span class="hljs-keyword">and</span> <br>                maze[new_row][new_col] != wall):<br>                <br>                visited[new_row][new_col] = <span class="hljs-literal">True</span><br>                new_path = path + directions[(dr, dc)]<br>                queue.append((new_row, new_col, new_path))<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><span class="hljs-comment"># Load maze and solve</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;final_maze.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    maze = [<span class="hljs-built_in">list</span>(line.strip()) <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f]<br><br>start = (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>end = (<span class="hljs-number">99</span>, <span class="hljs-number">99</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Maze size: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(maze)&#125;</span> x <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(maze[<span class="hljs-number">0</span>])&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Start: <span class="hljs-subst">&#123;start&#125;</span>, End: <span class="hljs-subst">&#123;end&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># Solve the maze</span><br>solution = solve_maze(maze, start, end, wall=<span class="hljs-string">&#x27;#&#x27;</span>, free=<span class="hljs-string">&#x27; &#x27;</span>)<br><br><span class="hljs-keyword">if</span> solution:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Solution found!&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Path length: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(solution)&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-comment"># Print FULL path</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nFULL PATH:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(solution)<br>    <br>    <span class="hljs-comment"># Save full path</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;maze_solution.txt&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(solution)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nFull path saved to maze_solution.txt&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;No solution found!&quot;</span>)<br></code></pre></td></tr></table></figure></li></ul><blockquote><p>flag：0xGame{44fc4bc18c87b3992af1d7726185ed36}</p></blockquote><h2 id="绯想天则"><a href="#绯想天则" class="headerlink" title="绯想天则"></a>绯想天则</h2><blockquote><p>考点：unity逆向改游戏机制</p></blockquote><ul><li><p>附件是个unity游戏</p><p><img src="/../images/image-20251105213705664.png" alt="unity游戏"></p><p>boss血条很厚，怎么打都打不过，角色很容易死。所以考虑改游戏机制</p></li><li><p>参考<a href="https://blog.csdn.net/xianyu_yuan/article/details/140899803">从出题到做题——浅探Unity游戏逆向</a>，找到IWANNATENSHIFUMOのINESBATTLE\I WANNA TENSHI FUMOのFIGHT WITH INES_Data\Managed\Assembly-CSharp.dll，用dnspy打开进行修改。修改思路是给角色加上锁血和一击毙命buff，修改的类是CharacterStats，至于怎么修改可以把整个类的代码发给AI问怎么改锁血和一击毙命，因为附件程序工程比较大，没有上下文的话不好描述，此处省略修改方案了。修改方法是在类代码页右键选择编辑类</p><p><img src="/../images/image-20251105220015560.png" alt="右键编辑类"></p><p>修改完点击右下角的编译即可。此外，笔者在编译的时候遇到了一些报错：random’is anbiguous reference between ‘unityengine.random’and ‘system.random，此时把代码中所有的Random.Range都改成UnityEngine.Random.Range即可。</p><p>修改完成后，重新运行游戏就可以速通得到flag了</p><p><img src="/../images/image-20251105220511591.png" alt="速通"></p></li></ul><blockquote><p>flag：0xGame{TenshiSamaSaiko_IWANNATENSHIFUMO_INESBATTLE}</p></blockquote><h2 id="幻视调律"><a href="#幻视调律" class="headerlink" title="幻视调律"></a>幻视调律</h2><blockquote><p>考点：函数重写，RC4，TEA</p></blockquote><ul><li><p>附件程序运行起来是很常规的输入flag提示：</p><p><img src="/../images/image-20251106193030935.png" alt="常规"></p><p>用IDA打开，Shift+F12可以看到可疑字符串</p><p><img src="/../images/image-20251106193216226.png" alt="可疑字符串"></p><p>跟踪可疑字符串可以找到main函数</p><p><img src="/../images/image-20251106193251339.png" alt="main函数"></p><p>简单优化一下</p><p><img src="/../images/image-20251106193416659.png" alt="优化后的main函数"></p><p>可以看到函数对输入的内容进行了RC4加密后才校验。但是作为第四周的题目，这样子显然还是太直白了。动调一下可以发现，strcmp函数被重写了</p><p><img src="/../images/image-20251106195811100.png" alt="跟踪strcmp1"></p><p><img src="/../images/image-20251106195827424.png" alt="跟踪strcmp2"></p><p><img src="/../images/image-20251106195843505.png" alt="跟踪strcmp3"></p><p>可以看到，strcmp最后被导向了sub_140003000，函数反编译如下（经过优化），是个TEA加密</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs C">_BOOL8 __fastcall <span class="hljs-title function_">sub_140003000</span><span class="hljs-params">(<span class="hljs-type">void</span> *a1, _DWORD *a2)</span><br>&#123;<br>  _DWORD Buf2[<span class="hljs-number">14</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-60h] BYREF</span><br>  _DWORD *key; <span class="hljs-comment">// [rsp+58h] [rbp-28h]</span><br>  <span class="hljs-type">void</span> *Buf1; <span class="hljs-comment">// [rsp+60h] [rbp-20h]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+6Ch] [rbp-14h]</span><br>  <span class="hljs-type">int</span> sum; <span class="hljs-comment">// [rsp+70h] [rbp-10h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> p2; <span class="hljs-comment">// [rsp+74h] [rbp-Ch]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> p1; <span class="hljs-comment">// [rsp+78h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+7Ch] [rbp-4h]</span><br><br>  Buf1 = a1;<br>  key = a2;<br>  Buf2[<span class="hljs-number">0</span>] = <span class="hljs-number">1111022553</span>;<br>  Buf2[<span class="hljs-number">1</span>] = <span class="hljs-number">987309029</span>;<br>  Buf2[<span class="hljs-number">2</span>] = <span class="hljs-number">-1041056711</span>;<br>  Buf2[<span class="hljs-number">3</span>] = <span class="hljs-number">979189025</span>;<br>  Buf2[<span class="hljs-number">4</span>] = <span class="hljs-number">189565873</span>;<br>  Buf2[<span class="hljs-number">5</span>] = <span class="hljs-number">173973774</span>;<br>  Buf2[<span class="hljs-number">6</span>] = <span class="hljs-number">1090109393</span>;<br>  Buf2[<span class="hljs-number">7</span>] = <span class="hljs-number">-591836169</span>;<br>  Buf2[<span class="hljs-number">8</span>] = <span class="hljs-number">-394857933</span>;<br>  Buf2[<span class="hljs-number">9</span>] = <span class="hljs-number">668605093</span>;<br>  Buf2[<span class="hljs-number">10</span>] = <span class="hljs-number">0xB952BACB</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">9</span>; ++i )<br>  &#123;<br>    sum = <span class="hljs-number">0</span>;<br>    p1 = *((_DWORD *)Buf1 + i);<br>    p2 = *((_DWORD *)Buf1 + i + <span class="hljs-number">1</span>);<br>    sum = <span class="hljs-number">0x9E3779B9</span>;<br>    <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">31</span>; ++j )<br>    &#123;<br>      p1 += (sum + p2) ^ (*key + <span class="hljs-number">16</span> * p2) ^ ((p2 &gt;&gt; <span class="hljs-number">5</span>) + key[<span class="hljs-number">1</span>]);<br>      sum -= <span class="hljs-number">0x61C88647</span>;<br>      p2 += (sum + p1) ^ (key[<span class="hljs-number">2</span>] + <span class="hljs-number">16</span> * p1) ^ ((p1 &gt;&gt; <span class="hljs-number">5</span>) + key[<span class="hljs-number">3</span>]);<br>    &#125;<br>    *((_DWORD *)Buf1 + i) = p1;<br>    *((_DWORD *)Buf1 + i + <span class="hljs-number">1</span>) = p2;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">memcmp</span>(Buf1, Buf2, <span class="hljs-number">0x2Cu</span>LL) != <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>所以，完整的加密流程是先RC4再TEA，TEA的key是main函数中strcmp的参数str2，密文是TEA最后面出现的Buf2。</p><p>还有一些需要关注的点：程序事实上进行了两次RC4加密，第一次是为了输出”input your flag:”，第二次才是加密输入的内容。所以，动调时在函数进行输出后、第二次RC4加密前才能提取出真的S盒</p><p>在反编译出来的函数的基础上可以写出解密脚本：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">RC4_decrypt</span><span class="hljs-params">(<span class="hljs-type">char</span> *a1, <span class="hljs-type">int</span> a2)</span> &#123;<br>    <span class="hljs-comment">//直接提取S盒</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> byte_140008060[<span class="hljs-number">256</span>] = &#123;<br>    <span class="hljs-number">0x99</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0x87</span>, <br>    <span class="hljs-number">0x2C</span>, <span class="hljs-number">0xB5</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0xC7</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x4E</span>, <br>    <span class="hljs-number">0x3E</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0xF3</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0xD3</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0x2D</span>, <br>    <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0xFA</span>, <span class="hljs-number">0xD0</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0xDF</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0xB4</span>, <br>    <span class="hljs-number">0x8C</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0xAD</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x77</span>, <br>    <span class="hljs-number">0x4B</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0xE1</span>, <br>    <span class="hljs-number">0xCD</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0xCA</span>, <br>    <span class="hljs-number">0x89</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0xEF</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0xC6</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0xA3</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0xEB</span>, <br>    <span class="hljs-number">0x3A</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0xC0</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0xE9</span>, <br>    <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0xDB</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x51</span>, <br>    <span class="hljs-number">0xFB</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0x7D</span>, <br>    <span class="hljs-number">0x7C</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0xAE</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x7A</span>, <br>    <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0xAC</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0xB1</span>, <br>    <span class="hljs-number">0xE6</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0xBA</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0x3B</span>, <br>    <span class="hljs-number">0x35</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x2B</span>, <br>    <span class="hljs-number">0xCC</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x9E</span><br>&#125;;<br>    <span class="hljs-type">unsigned</span> __int8 v3; <span class="hljs-comment">// [rsp+0h] [rbp-10h]</span><br>    <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+4h] [rbp-Ch]</span><br>    <span class="hljs-type">int</span> v5; <span class="hljs-comment">// [rsp+8h] [rbp-8h]</span><br>    <span class="hljs-type">int</span> v6; <span class="hljs-comment">// [rsp+Ch] [rbp-4h]</span><br><br>    v6 = <span class="hljs-number">0</span>;<br>    v5 = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; a2; ++i )<br>    &#123;<br>        v6 = (v6 + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>;<br>        v5 = (byte_140008060[v6] + v5) % <span class="hljs-number">256</span>;<br>        v3 = byte_140008060[v6];<br>        byte_140008060[v6] = byte_140008060[v5];<br>        byte_140008060[v5] = v3;<br>        *(<span class="hljs-type">char</span> *)(i + a1) = byte_140008060[(<span class="hljs-type">unsigned</span> __int8)(byte_140008060[v6] + byte_140008060[v5])] ^ *(<span class="hljs-type">char</span> *)(a1 + i);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>  <span class="hljs-comment">//用作key的str2</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> Str2[<span class="hljs-number">44</span>] = &#123;<br>    <span class="hljs-number">0x9F</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0xC0</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x55</span>, <br>    <span class="hljs-number">0x80</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x25</span>, <br>    <span class="hljs-number">0x7B</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0xE9</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0xC7</span><br>    &#125;;<br>    <br>    <span class="hljs-comment">//下面是在反编译TEA的基础上改的，直接解密Buf2</span><br>    <span class="hljs-type">uint32_t</span> Buf2[<span class="hljs-number">14</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-60h] BYREF</span><br>    <span class="hljs-type">uint32_t</span> *key; <span class="hljs-comment">// [rsp+58h] [rbp-28h]</span><br>    <span class="hljs-comment">//void *Buf1; // [rsp+60h] [rbp-20h]</span><br>    <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+6Ch] [rbp-14h]</span><br>    <span class="hljs-type">int</span> sum; <span class="hljs-comment">// [rsp+70h] [rbp-10h]</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> p2; <span class="hljs-comment">// [rsp+74h] [rbp-Ch]</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> p1; <span class="hljs-comment">// [rsp+78h] [rbp-8h]</span><br>    <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+7Ch] [rbp-4h]</span><br><br>    <span class="hljs-comment">//Buf1 = a1;</span><br>    key = (<span class="hljs-type">uint32_t</span> *)Str2;<br>    Buf2[<span class="hljs-number">0</span>] = <span class="hljs-number">1111022553</span>;<br>    Buf2[<span class="hljs-number">1</span>] = <span class="hljs-number">987309029</span>;<br>    Buf2[<span class="hljs-number">2</span>] = <span class="hljs-number">-1041056711</span>;<br>    Buf2[<span class="hljs-number">3</span>] = <span class="hljs-number">979189025</span>;<br>    Buf2[<span class="hljs-number">4</span>] = <span class="hljs-number">189565873</span>;<br>    Buf2[<span class="hljs-number">5</span>] = <span class="hljs-number">173973774</span>;<br>    Buf2[<span class="hljs-number">6</span>] = <span class="hljs-number">1090109393</span>;<br>    Buf2[<span class="hljs-number">7</span>] = <span class="hljs-number">-591836169</span>;<br>    Buf2[<span class="hljs-number">8</span>] = <span class="hljs-number">-394857933</span>;<br>    Buf2[<span class="hljs-number">9</span>] = <span class="hljs-number">668605093</span>;<br>    Buf2[<span class="hljs-number">10</span>] = <span class="hljs-number">0xB952BACB</span>;<br>    <span class="hljs-comment">//这里原来是从&lt;Buf[0],Buf[1]&gt;到&lt;Buf[9],Buf[10]&gt;一对一对加密，现在反过来从&lt;Buf[9],Buf[10]&gt;开始到&lt;Buf[0],Buf[1]&gt;</span><br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">9</span>; i &gt;= <span class="hljs-number">0</span>; --i )<br>    &#123;<br>        sum = <span class="hljs-number">0</span>;<br>        p1 = *((<span class="hljs-type">uint32_t</span>*)Buf2 + i);<br>        p2 = *((<span class="hljs-type">uint32_t</span>*)Buf2 + i + <span class="hljs-number">1</span>);<br>        sum = <span class="hljs-number">0x9E3779B9</span>;<br>        <span class="hljs-comment">//模拟正向加密得到最后的sum值</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++)&#123;<br>            sum-=<span class="hljs-number">0x61C88647</span>;<br>        &#125;<br>        <span class="hljs-comment">//p1，p2的处理顺序调换，加减调换，sum加减调换</span><br>        <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">31</span>; ++j )<br>        &#123;<br>        p2 -= (sum + p1) ^ (key[<span class="hljs-number">2</span>] + <span class="hljs-number">16</span> * p1) ^ ((p1 &gt;&gt; <span class="hljs-number">5</span>) + key[<span class="hljs-number">3</span>]);<br>        sum += <span class="hljs-number">0x61C88647</span>;<br>        p1 -= (sum + p2) ^ (*key + <span class="hljs-number">16</span> * p2) ^ ((p2 &gt;&gt; <span class="hljs-number">5</span>) + key[<span class="hljs-number">1</span>]);<br>        &#125;<br>        *((<span class="hljs-type">uint32_t</span>*)Buf2 + i) = p1;<br>        *((<span class="hljs-type">uint32_t</span>*)Buf2 + i + <span class="hljs-number">1</span>) = p2;<br>    &#125;<br>    RC4_decrypt((<span class="hljs-type">char</span> *)Buf2,<span class="hljs-number">44</span>);<br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">44</span>;i++)<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>,((<span class="hljs-type">char</span> *)Buf2)[i]);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><blockquote><p>flag：0xGame{20994d4d-30ab-4918-b00a-5ca6ae138613}</p></blockquote><h2 id="花鸟风月"><a href="#花鸟风月" class="headerlink" title="花鸟风月"></a>花鸟风月</h2><blockquote><p>考点：花指令，魔改base64，异或，动态调试</p></blockquote><ul><li><p>附件程序运行起来是这样的：</p><p><img src="/../images/image-20251107170326209.png" alt="运行程序"></p><p>用IDA打开，Shift+F12在字符串窗口可以找到类似base64编码表的可疑字符串</p><p><img src="/../images/image-20251107171007199.png" alt="可疑的字符串"></p><p>随后可以跟踪到这样一个貌似base64编码的函数</p><p><img src="/../images/image-20251107171139700.png" alt="跟踪到一个类似base64编码的函数"></p><p>选中函数名按X回溯上层函数，会发现无法反编译了，栈帧报错</p><p><img src="/../images/image-20251107171338976.png" alt="栈帧报错"></p><p>在报错的附近可以看到反汇编失败的一堆数字，以及一个典型的jnz+jz花指令</p><p>选中上图中的loc_4012F2按U可以得到下图</p><p><img src="/../images/image-20251107172247039.png" alt="undefine"></p><p>此时只需要把jnz和jz以及后面的0E8h给nop掉即可，再选中unk_4012F3按C即可得到修正后的汇编代码</p><p><img src="/../images/image-20251107172437327.png" alt="修正后的汇编代码"></p><p>同样的花指令大概有3个，去除后可以在上文找到另一个报错</p><p><img src="/../images/image-20251107173258987.png" alt="另一个报错"></p><p>这里可以发现报错处的上一句是retn，所以把下面的loc_4012C0右键create function</p><p><img src="/../images/image-20251107173428095.png" alt="create function"></p><p>然后再回过头看这个报错，前面不远有一个很可疑的call $+5，显然是人为修改的</p><p><img src="/../images/image-20251112220409411.png" alt="可疑的call $+5"></p><p>仔细分析这段汇编代码会发现，这也是一个花指令</p><p><img src="/../images/image-20251112220643619.png" alt="分析汇编代码"></p><p>实际上程序在jz处不跳直接retn后，会回到xor eax,1这一行，原因是：call $+5即call 0x0040122D，又即push rip(0x0040122D)  jmp 0x0040122D，所以retn后程序回到栈上的rip(0x0040122D)处，即xor eax,1。IDA反编译会被这个retn给欺骗，误以为函数到此结束，其实后面还有一些内容。所以直接吧loc_401223这一整段nop掉，就可以得到完整的反编译代码</p><p><img src="/../images/image-20251113211300972.png" alt="完整的反编译代码"></p><p>优化一下这个函数和上文的类似base编码的函数的命名，可以得到。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">int</span> <span class="hljs-title function_">sub_4012C0</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">char</span> *v0; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v1; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v2; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v5; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v6; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v7; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v8; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [esp-4h] [ebp-ECh]</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [esp+10h] [ebp-D8h] BYREF</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// [esp+14h] [ebp-D4h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+18h] [ebp-D0h]</span><br>  _BYTE v13[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+1Ch] [ebp-CCh] BYREF</span><br>  _BYTE v14[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+80h] [ebp-68h] BYREF</span><br><br>  v11 = <span class="hljs-number">0x81428113</span>;<br>  v0 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_422054);<br>  sub_401670(v0);<br>  v1 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_422068);<br>  sub_4016B0(v1, (<span class="hljs-type">char</span>)&amp;v10);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i )<br>  &#123;<br>    v11 = <span class="hljs-number">21106755</span> * v11 + <span class="hljs-number">1126795285</span>;<br>    v11 ^= __ROL4__(<br>             v10,<br>             i * (byte_422007 + byte_422004)<br>           % (byte_422008<br>            + byte_422004<br>            + byte_422005 * byte_422008<br>            + byte_422AA0 * (byte_422002 + byte_422006 + byte_422003)<br>            - byte_422005 * byte_422005));<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v11 == <span class="hljs-number">0xA745DA5D</span> )<br>  &#123;<br>    v2 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_42206C);<br>    sub_401670(v2);<br>    v5 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_422094);<br>    sub_401670(v5);<br>    v6 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_4220A4);<br>    sub_4016B0(v6, (<span class="hljs-type">char</span>)v14);<br>    XORencrypt(v14, v10, byte_422004 + byte_422002 + byte_422008 * byte_422003);<br>    baseEncode((<span class="hljs-type">int</span>)v14, (<span class="hljs-type">int</span>)v13, byte_422005 + byte_422001 + byte_422008 * byte_422003);<br>    v9 = byte_422004 * byte_422003 * byte_422002;<br>    v7 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_4220A8);<br>    <span class="hljs-keyword">if</span> ( sub_40B460(v13, v7, v9) )<br>      v8 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_4220FC);<br>    <span class="hljs-keyword">else</span><br>      v8 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_4220E8);<br>    sub_401670(v8);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v3 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_422080);<br>    sub_401670(v3);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>其中byte_42200x的值都是x+1，所以可以进一步优化</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">int</span> <span class="hljs-title function_">sub_4012C0</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">char</span> *v0; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v1; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v2; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v5; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v6; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v7; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v8; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [esp-4h] [ebp-ECh]</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [esp+10h] [ebp-D8h] BYREF</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// [esp+14h] [ebp-D4h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+18h] [ebp-D0h]</span><br>  _BYTE v13[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+1Ch] [ebp-CCh] BYREF</span><br>  _BYTE v14[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+80h] [ebp-68h] BYREF</span><br><br>  v11 = <span class="hljs-number">0x81428113</span>;<br>  v0 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_422054);<br>  sub_401670(v0);<br>  v1 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_422068);<br>  sub_4016B0(v1, (<span class="hljs-type">char</span>)&amp;v10);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i )<br>  &#123;<br>    v11 = <span class="hljs-number">0x1421043</span> * v11 + <span class="hljs-number">0x43298815</span>;<br>    v11 ^= __ROL4__(v10, i * (<span class="hljs-number">8</span> + <span class="hljs-number">5</span>) % (<span class="hljs-number">9</span> + <span class="hljs-number">5</span> + <span class="hljs-number">6</span> * <span class="hljs-number">9</span> + <span class="hljs-number">0</span> * (<span class="hljs-number">3</span> + <span class="hljs-number">7</span> + <span class="hljs-number">4</span>) - <span class="hljs-number">6</span> * <span class="hljs-number">6</span>));<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v11 == <span class="hljs-number">0xA745DA5D</span> )<br>  &#123;<br>    v2 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_42206C);<br>    sub_401670(v2);<br>    v5 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_422094);<br>    sub_401670(v5);<br>    v6 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_4220A4);<br>    sub_4016B0(v6, (<span class="hljs-type">char</span>)v14);<br>    XORencrypt(v14, v10, <span class="hljs-number">5</span> + <span class="hljs-number">3</span> + <span class="hljs-number">9</span> * <span class="hljs-number">4</span>);<br>    baseEncode((<span class="hljs-type">int</span>)v14, (<span class="hljs-type">int</span>)v13, <span class="hljs-number">6</span> + <span class="hljs-number">2</span> + <span class="hljs-number">9</span> * <span class="hljs-number">4</span>);<br>    v9 = <span class="hljs-number">5</span> * <span class="hljs-number">4</span> * <span class="hljs-number">3</span>;<br>    v7 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_4220A8);<br>    <span class="hljs-keyword">if</span> ( sub_40B460(v13, v7, v9) )<br>      v8 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_4220FC);<br>    <span class="hljs-keyword">else</span><br>      v8 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_4220E8);<br>    sub_401670(v8);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v3 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_422080);<br>    sub_401670(v3);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>动调可以发现程序的提示词是实时解密的，sub_401000是解密函数，sub_401670是输出函数，sub_4016B0是输入函数。下面是具体过程：</p><p>在函数的开头下断点，开始调试。程序停在了下图这个地方，可以看到随后有一些奇怪的数据，直接nop掉</p><p><img src="/../images/image-20251107211205450.png" alt="奇怪的数据"></p><p><img src="/../images/image-20251107211234103.png" alt="nop掉"></p><p>继续运行程序会发现执行过sub_7C1670（对应静态分析时的sub_401670，动态调试换基址了所以地址前两位有些不同）后程序会有提示输出，因此推断sub_7C1670是print</p><p><img src="/../images/image-20251107212238679.png" alt="提示输出"></p><p>而观察静态分析时的代码可以发现，sub_401000几乎和sub_401670是同时出现的，动态调试对应的sub_7C1000函数反编译如下</p><p><img src="/../images/image-20251107212753102.png" alt="sub_7C1000反编译"></p><p>同时可以发现byte_7E3440此时存储的正好是Input key (Hex) （此时已经步过这个函数了，所以byte_7E3440已经被处理过了）:</p><p><img src="/../images/image-20251107212917688.png" alt="byte_7E3440"></p><p>所以可以推测提示词是实时解密的，sub_401000是解密函数</p><p>接下来还有个sub_7C16B0，推测是scanf</p><p><img src="/../images/image-20251107215116511.png" alt="sub_7C16B0"></p><p>在动态调试随后的代码里，会发现还有花指令（有两处，不知道是不是静态分析时的去混淆没有保存）</p><p><img src="/../images/image-20251107215446744.png" alt="花指令"></p><p>同样的操作nop掉后，反编译得到</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">void</span> <span class="hljs-title function_">sub_7C12C0</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">char</span> *v0; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v1; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v2; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v4; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v5; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v6; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v7; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [esp-4h] [ebp-ECh]</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [esp+10h] [ebp-D8h] BYREF</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [esp+14h] [ebp-D4h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+18h] [ebp-D0h]</span><br>  _BYTE v12[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+1Ch] [ebp-CCh] BYREF</span><br>  _BYTE v13[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+80h] [ebp-68h] BYREF</span><br><br>  v10 = <span class="hljs-number">0x81428113</span>;<br>  v0 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E2054);<br>  print(v0);<br>  v1 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E2068);<br>  <span class="hljs-built_in">scanf</span>(v1, (<span class="hljs-type">char</span>)&amp;v9);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i )<br>  &#123;<br>    v10 = <span class="hljs-number">0x1421043</span> * v10 + <span class="hljs-number">0x43298815</span>;<br>    v10 ^= __ROL4__(v9, i * (<span class="hljs-number">8</span> + <span class="hljs-number">5</span>) % (<span class="hljs-number">9</span> + <span class="hljs-number">5</span> + <span class="hljs-number">6</span> * <span class="hljs-number">9</span> + <span class="hljs-number">0</span> * (<span class="hljs-number">3</span> + <span class="hljs-number">7</span> + <span class="hljs-number">4</span>) - <span class="hljs-number">6</span> * <span class="hljs-number">6</span>));<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v10 == <span class="hljs-number">0xA745DA5D</span> )<br>  &#123;<br>    v2 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E206C);<br>    print(v2);<br>    v4 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E2094);<br>    print(v4);<br>    v5 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E20A4);<br>    <span class="hljs-built_in">scanf</span>(v5, (<span class="hljs-type">char</span>)v13);<br>    XORencrypt((<span class="hljs-type">int</span>)v13, v9, <span class="hljs-number">5</span> + <span class="hljs-number">3</span> + <span class="hljs-number">9</span> * <span class="hljs-number">4</span>);<br>    baseEncode((<span class="hljs-type">int</span>)v13, (<span class="hljs-type">int</span>)v12, <span class="hljs-number">6</span> + <span class="hljs-number">2</span> + <span class="hljs-number">9</span> * <span class="hljs-number">4</span>);<br>    v8 = <span class="hljs-number">5</span> * <span class="hljs-number">4</span> * <span class="hljs-number">3</span>;<br>    v6 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E20A8);<br>    <span class="hljs-keyword">if</span> ( sub_7CB460(v12, v6, v8) )<br>      v7 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E20FC);<br>    <span class="hljs-keyword">else</span><br>      v7 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E20E8);<br>    print(v7);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v3 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E2080);<br>    print(v3);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>此时得到更加清晰的代码了，同时可以发现程序首先对输入的key进行了校验。</p><p>为了继续了解程序逻辑，这里选择修改if语句条件的判断结果来绕过key检验，只需要在cmp后修改ZF标志位，让jnz不成立即可</p><p><img src="/../images/image-20251107220443790.png" alt="绕过key检验"></p><p><img src="/../images/image-20251107220708346.png" alt="成功绕过key检验"></p><p>继续运行程序会有输入flag的提示</p><p><img src="/../images/image-20251107220805016.png" alt="输入flag的提示"></p><p>至此，可以猜出程序的大致逻辑：接收一个key并进行检验，检验成功则继续检验flag，同时需要注意key会作为flag检验的一个参数。下面是优化后的最终代码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">void</span> <span class="hljs-title function_">sub_7C12C0</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">char</span> *v0; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v1; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v2; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v4; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v5; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *targetResult; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v7; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [esp-4h] [ebp-ECh]</span><br>  <span class="hljs-type">int</span> key; <span class="hljs-comment">// [esp+10h] [ebp-D8h] BYREF</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [esp+14h] [ebp-D4h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+18h] [ebp-D0h]</span><br>  _BYTE encodedInput[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+1Ch] [ebp-CCh] BYREF</span><br>  _BYTE input[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+80h] [ebp-68h] BYREF</span><br><br>  v10 = <span class="hljs-number">0x81428113</span>;<br>  v0 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E2054);          <span class="hljs-comment">// input key</span><br>  print(v0);<br>  v1 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E2068);<br>  <span class="hljs-built_in">scanf</span>(v1, (<span class="hljs-type">char</span>)&amp;key);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i )<br>  &#123;<br>    v10 = <span class="hljs-number">0x1421043</span> * v10 + <span class="hljs-number">0x43298815</span>;<br>    v10 ^= __ROL4__(key, i * (<span class="hljs-number">8</span> + <span class="hljs-number">5</span>) % (<span class="hljs-number">9</span> + <span class="hljs-number">5</span> + <span class="hljs-number">6</span> * <span class="hljs-number">9</span> + <span class="hljs-number">0</span> * (<span class="hljs-number">3</span> + <span class="hljs-number">7</span> + <span class="hljs-number">4</span>) - <span class="hljs-number">6</span> * <span class="hljs-number">6</span>));<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v10 == <span class="hljs-number">0xA745DA5D</span> )<br>  &#123;<br>    v2 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E206C);        <span class="hljs-comment">// key is correct</span><br>    print(v2);<br>    v4 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E2094);        <span class="hljs-comment">// input flag</span><br>    print(v4);<br>    v5 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E20A4);<br>    <span class="hljs-built_in">scanf</span>(v5, (<span class="hljs-type">char</span>)input);<br>    XORencrypt((<span class="hljs-type">int</span>)input, key, <span class="hljs-number">5</span> + <span class="hljs-number">3</span> + <span class="hljs-number">9</span> * <span class="hljs-number">4</span>);<br>    baseEncode((<span class="hljs-type">int</span>)input, (<span class="hljs-type">int</span>)encodedInput, <span class="hljs-number">6</span> + <span class="hljs-number">2</span> + <span class="hljs-number">9</span> * <span class="hljs-number">4</span>);<br>    v8 = <span class="hljs-number">5</span> * <span class="hljs-number">4</span> * <span class="hljs-number">3</span>;<br>    targetResult = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E20A8);<span class="hljs-comment">// 此处解密的值被用来和输入值的加密结果进行比较了，所以推测是真正的flag密文</span><br>    <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strcmp</span>(encodedInput, targetResult, v8) )<br>      v7 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E20FC);<br>    <span class="hljs-keyword">else</span><br>      v7 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E20E8);<br>    print(v7);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v3 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E2080);<br>    print(v3);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>targetResult也是实时解密的结果，所以可以动调提取</p><p>程序的加密流程是先XORencrypt再baseEncode，所以解密要先baseDecode再XORenc。baseEncode优化后如下，可以发现不是标准的base64编码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">baseEncode</span><span class="hljs-params">(<span class="hljs-type">int</span> input, <span class="hljs-type">int</span> output, <span class="hljs-type">int</span> length)</span><br>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> code2; <span class="hljs-comment">// [esp+Ah] [ebp-56h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+Ch] [ebp-54h]</span><br>  <span class="hljs-type">char</span> code4; <span class="hljs-comment">// [esp+12h] [ebp-4Eh]</span><br>  <span class="hljs-type">char</span> code3; <span class="hljs-comment">// [esp+13h] [ebp-4Dh]</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [esp+14h] [ebp-4Ch]</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [esp+14h] [ebp-4Ch]</span><br>  <span class="hljs-type">char</span> baseTable[<span class="hljs-number">68</span>]; <span class="hljs-comment">// [esp+18h] [ebp-48h] BYREF</span><br><br>  v8 = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">strcpy</span>(baseTable, <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; length; i += <span class="hljs-number">3</span> )<br>  &#123;<br>    code3 = baseTable[((*(i + input + <span class="hljs-number">1</span>) &gt;&gt; <span class="hljs-number">4</span>) | (<span class="hljs-number">16</span> * *(i + input))) &amp; <span class="hljs-number">63</span>];<span class="hljs-comment">// baseTable[((input[i+1]&gt;&gt;4)|(input[i]&lt;&lt;4))&amp;63]</span><br>    <span class="hljs-keyword">if</span> ( i + <span class="hljs-number">1</span> &gt;= length )<br>      code3 = <span class="hljs-string">&#x27;=&#x27;</span>;<br>    <span class="hljs-keyword">else</span><br>      code2 = baseTable[((*(i + input + <span class="hljs-number">2</span>) &gt;&gt; <span class="hljs-number">6</span>) | (<span class="hljs-number">4</span> * *(i + input + <span class="hljs-number">1</span>))) &amp; <span class="hljs-number">63</span>];<span class="hljs-comment">// baseTable[((input[i+2]&gt;&gt;6)|(input[i+1]&lt;&lt;2))&amp;63]</span><br>    <span class="hljs-keyword">if</span> ( i + <span class="hljs-number">2</span> &gt;= length )<br>      code4 = <span class="hljs-string">&#x27;=&#x27;</span>;<br>    <span class="hljs-keyword">else</span><br>      code4 = baseTable[*(i + input + <span class="hljs-number">2</span>) &amp; <span class="hljs-number">63</span>]; <span class="hljs-comment">// baseTable[input[i+2]&amp;63]</span><br>    *(v8 + output) = baseTable[(*(i + input) &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">63</span>];<span class="hljs-comment">// baseTable[(input[i]&gt;&gt;2)&amp;63]</span><br>    v9 = v8 + <span class="hljs-number">1</span>;<br>    *(v9 + output) = code2;<br>    *(++v9 + output) = code3;<br>    *(++v9 + output) = code4;<br>    v8 = v9 + <span class="hljs-number">1</span>;<br>    result = i + <span class="hljs-number">3</span>;<br>  &#125;<br>  *(v8 + output) = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>标准base64编码是按照字符顺序，把3个8bit的char转成4个6bit，即</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs C">code1=baseTable[input[i]&gt;&gt;<span class="hljs-number">2</span>];<br>code2=baseTable[(input[i]&lt;&lt;<span class="hljs-number">6</span>)|(input[i+<span class="hljs-number">1</span>]&gt;&gt;<span class="hljs-number">4</span>)];<br>code3=baseTable[(input[i+<span class="hljs-number">1</span>]&lt;&lt;<span class="hljs-number">4</span>)|(input[i+<span class="hljs-number">2</span>]&gt;&gt;<span class="hljs-number">6</span>)];<br>code4=baseTable[input[i+<span class="hljs-number">2</span>]&lt;&lt;<span class="hljs-number">2</span>];<br></code></pre></td></tr></table></figure><p>而程序里code2和code3顺序反了</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs C">code1=baseTable[(input[i]&gt;&gt;<span class="hljs-number">2</span>)&amp;<span class="hljs-number">63</span>];<br>code2=baseTable[((input[i+<span class="hljs-number">1</span>]&lt;&lt;<span class="hljs-number">2</span>)|(input[i+<span class="hljs-number">2</span>]&gt;&gt;<span class="hljs-number">6</span>))&amp;<span class="hljs-number">63</span>];<br>code3=baseTable[((input[i]&lt;&lt;<span class="hljs-number">4</span>)|(input[i+<span class="hljs-number">1</span>]&gt;&gt;<span class="hljs-number">4</span>))&amp;<span class="hljs-number">63</span>];<br>code4=baseTable[input[i+<span class="hljs-number">2</span>]&amp;<span class="hljs-number">63</span>];<br><span class="hljs-comment">//PS：这里因为&amp;了63，所以拼成8位的code被截掉了高2位，剩下6位</span><br></code></pre></td></tr></table></figure><p>也就是说，程序的魔改base64编码和标准base64编码的不同点在于，编码时置换了第2、3个字符。因此我们此处的解密就是把每4个字符的第2、3个字符互换位置，然后使用标准base64解码即可。下面是basedecode的脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><br>enc=[<span class="hljs-number">0x4D</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x3D</span>]<br>basedecoded=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(enc),<span class="hljs-number">4</span>):<br>    basedecoded+=<span class="hljs-built_in">chr</span>(enc[i])<br>    basedecoded+=<span class="hljs-built_in">chr</span>(enc[i+<span class="hljs-number">2</span>])<br>    basedecoded+=<span class="hljs-built_in">chr</span>(enc[i+<span class="hljs-number">1</span>])<br>    basedecoded+=<span class="hljs-built_in">chr</span>(enc[i+<span class="hljs-number">3</span>])<br><span class="hljs-built_in">print</span>(basedecoded)<br><span class="hljs-comment">#MPADcG3tP3Q4v3MpNbB1PGWxcHctvHx1NaV9JTPtaSc57iIlNu5xJWS5Imw=</span><br>xorencoded=base64.b64decode(basedecoded)<br></code></pre></td></tr></table></figure><p>接下来是XORdecrypt。首先需要得到密钥，既然程序给了密钥的检验算法，可以复现这个算法来爆破密钥。下面是爆破脚本：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> __ROL4__(x, y)   ((((x) <span class="hljs-string">&lt;&lt; (y)) | ((x) &gt;</span>&gt; (32 - (y))))&amp;0xFFFFFFFF)</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v9,key;<br>    <span class="hljs-keyword">for</span>(key=<span class="hljs-number">0</span>;key&lt;=<span class="hljs-number">0xFFFFFFFF</span>;key++)&#123;<br>        v9 = <span class="hljs-number">0x81428113</span>;<br>        <span class="hljs-keyword">for</span> ( <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i )<br>        &#123;<br>            v9 = <span class="hljs-number">0x1421043</span> * v9 + <span class="hljs-number">0x43298815</span>;<br>            v9 ^= __ROL4__(key, i * (<span class="hljs-number">8</span> + <span class="hljs-number">5</span>) % (<span class="hljs-number">9</span> + <span class="hljs-number">5</span> + <span class="hljs-number">6</span> * <span class="hljs-number">9</span> + <span class="hljs-number">0</span> * (<span class="hljs-number">3</span> + <span class="hljs-number">7</span> + <span class="hljs-number">4</span>) - <span class="hljs-number">6</span> * <span class="hljs-number">6</span>));<br>        &#125;<br>        <span class="hljs-keyword">if</span> ( v9 == <span class="hljs-number">0xA745DA5D</span> )<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;key: 0x%08x\n&quot;</span>,key);<br>        &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-comment">//key: 0x98bf3b77</span><br></code></pre></td></tr></table></figure><p>然后是XOR解密，由于异或过程中不涉及密文前后位，只是单纯使用key，所以只需要复现异或过程就行了。但是照抄也不是很对，XORencrypt使用key的时候是进行了取位操作，把key分成了四个部分的，所以这部分要单独拿出来处理。脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">XORdecrypt</span>(<span class="hljs-params">data, key</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">44</span>):<br>        key_byte=(key &gt;&gt; (<span class="hljs-number">8</span> * (i % <span class="hljs-number">4</span>)))&amp;<span class="hljs-number">0xff</span><span class="hljs-comment">#单独处理每次使用的key，每次只取四分之一，直接抄原代码没有&amp;0xff的话会解密失败。</span><br>        data[i]^=key_byte<br>        data[i]=data[i]&amp;<span class="hljs-number">0xff</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">44</span>):<br>        key_byte=(key &gt;&gt; (<span class="hljs-number">8</span> * (j % <span class="hljs-number">4</span>)))&amp;<span class="hljs-number">0xff</span><br>        data[j]^=((key_byte &gt;&gt; <span class="hljs-number">4</span>) | (<span class="hljs-number">16</span> * key_byte))<br>        data[j]=data[j]&amp;<span class="hljs-number">0xff</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(data)<br></code></pre></td></tr></table></figure><p>完整脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">XORdecrypt</span>(<span class="hljs-params">data, key</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">44</span>):<br>        key_byte=(key &gt;&gt; (<span class="hljs-number">8</span> * (i % <span class="hljs-number">4</span>)))&amp;<span class="hljs-number">0xff</span><br>        data[i]^=key_byte<br>        data[i]=data[i]&amp;<span class="hljs-number">0xff</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">44</span>):<br>        key_byte=(key &gt;&gt; (<span class="hljs-number">8</span> * (j % <span class="hljs-number">4</span>)))&amp;<span class="hljs-number">0xff</span><br>        data[j]^=((key_byte &gt;&gt; <span class="hljs-number">4</span>) | (<span class="hljs-number">16</span> * key_byte))<br>        data[j]=data[j]&amp;<span class="hljs-number">0xff</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(data)<br><br>enc=[<span class="hljs-number">0x4D</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x3D</span>]<br>basedecoded=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(enc),<span class="hljs-number">4</span>):<br>    basedecoded+=<span class="hljs-built_in">chr</span>(enc[i])<br>    basedecoded+=<span class="hljs-built_in">chr</span>(enc[i+<span class="hljs-number">2</span>])<br>    basedecoded+=<span class="hljs-built_in">chr</span>(enc[i+<span class="hljs-number">1</span>])<br>    basedecoded+=<span class="hljs-built_in">chr</span>(enc[i+<span class="hljs-number">3</span>])<br><span class="hljs-comment">#print(basedecoded)</span><br>xorencoded=base64.b64decode(basedecoded)<br><span class="hljs-comment">#print(len(xorencoded))</span><br>flag=XORdecrypt(<span class="hljs-built_in">list</span>(xorencoded),<span class="hljs-number">0x98bf3b77</span>)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure></li></ul><blockquote><p>flag：0xGame{e8778581-e94f-48d5-943e-69ff46f54d1f}</p></blockquote><h2 id="云消雾散"><a href="#云消雾散" class="headerlink" title="云消雾散"></a>云消雾散</h2><blockquote><p>考点：复杂程序分析，魔改RC4</p><p>难点在于复杂，没有其他套路</p></blockquote><ul><li><p>附件给了一个img.exe和enc.bmp。bmp是一种图片格式，推测img.exe是bmp图片加密程序，enc.bmp是加密的图片，要求逆向加密程序进而解密图片</p></li><li><p>img.exe用IDA打开，shift+F12可以找到”enc.bmp”</p><p><img src="/../images/image-20251115195827438.png" alt="字符串表的enc.bmp"></p><p>跟踪可以到这样一个函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs C">__int64 __fastcall <span class="hljs-title function_">sub_140001936</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2)</span><br>&#123;<br>  <span class="hljs-type">int</span> v2; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v13; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v15; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v16; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v17; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v18; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v19; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v20; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v21; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v22; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v23; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v24; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v25; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v26; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v27; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v28; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v29; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v30; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v31; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v32; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v33; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v34; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v35; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v36; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v37; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v38; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v39; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v40; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v41; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v42; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v43; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v44; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v45; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v46; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v47; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v48; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v49; <span class="hljs-comment">// r9d</span><br>  __int64 v51; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v52; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v53; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v54; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v55; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v56; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v57; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v58; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v59; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v60; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v61; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v62; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v63; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v64; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v65; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v66; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v67; <span class="hljs-comment">// [rsp+10h] [rbp-70h]</span><br>  _BYTE v68[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-60h] BYREF</span><br>  _BYTE v69[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-40h] BYREF</span><br>  _BYTE v70[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+60h] [rbp-20h] BYREF</span><br>  _BYTE v71[<span class="hljs-number">44</span>]; <span class="hljs-comment">// [rsp+80h] [rbp+0h] BYREF</span><br>  <span class="hljs-type">char</span> v72; <span class="hljs-comment">// [rsp+ACh] [rbp+2Ch] BYREF</span><br>  <span class="hljs-type">char</span> v73; <span class="hljs-comment">// [rsp+ADh] [rbp+2Dh] BYREF</span><br>  <span class="hljs-type">char</span> v74; <span class="hljs-comment">// [rsp+AEh] [rbp+2Eh] BYREF</span><br>  <span class="hljs-type">char</span> v75; <span class="hljs-comment">// [rsp+AFh] [rbp+2Fh] BYREF</span><br>  _BYTE v76[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+B0h] [rbp+30h] BYREF</span><br>  _BYTE v77[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+D0h] [rbp+50h] BYREF</span><br>  _BYTE v78[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+F0h] [rbp+70h] BYREF</span><br>  _BYTE v79[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+110h] [rbp+90h] BYREF</span><br>  <span class="hljs-type">char</span> *v80; <span class="hljs-comment">// [rsp+130h] [rbp+B0h]</span><br>  <span class="hljs-type">char</span> *v81; <span class="hljs-comment">// [rsp+138h] [rbp+B8h]</span><br>  <span class="hljs-type">char</span> *v82; <span class="hljs-comment">// [rsp+140h] [rbp+C0h]</span><br>  <span class="hljs-type">char</span> *v83; <span class="hljs-comment">// [rsp+148h] [rbp+C8h]</span><br><br>  sub_140001D70();<br>  v83 = &amp;v72;<br>  sub_140004130(a1, a2, <span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025&quot;</span>, v71, &amp;v72, v2);<br>  sub_140003580(a1, a2, v3, &amp;v72, v4, v5);<br>  v82 = &amp;v73;<br>  sub_140004130(a1, a2, <span class="hljs-string">&quot;flag.bmp&quot;</span>, v70, &amp;v73, v6);<br>  sub_140003580(a1, a2, v7, &amp;v73, v8, v9);<br>  v81 = &amp;v74;<br>  sub_140004130(a1, a2, <span class="hljs-string">&quot;enc.bmp&quot;</span>, v69, &amp;v74, v10);<br>  sub_140003580(a1, a2, v11, &amp;v74, v12, v13);<br>  v80 = &amp;v75;<br>  sub_140004130(a1, a2, <span class="hljs-string">&quot;114514puiqneravcixpbhqn;afnv-92piwgspdifjv&quot;</span>, v68, &amp;v75, v14);<br>  sub_140003580(a1, a2, v15, &amp;v75, v16, v17);<br>  sub_140004670(a1, a2, v71, v77, <span class="hljs-string">&quot;\\&quot;</span>, v18, v51);<br>  sub_140004620(a1, a2, v77, v76, v70, v19, v52);<br>  sub_140004210(a1, a2, v76, v70, v20, v21, v53);<br>  sub_1400041E0(a1, a2, v22, v76, v23, v24, v54);<br>  sub_1400041E0(a1, a2, v25, v77, v26, v27, v55);<br>  sub_140004670(a1, a2, v71, v79, <span class="hljs-string">&quot;\\&quot;</span>, v28, v56);<br>  sub_140004620(a1, a2, v79, v78, v69, v29, v57);<br>  sub_140004210(a1, a2, v78, v69, v30, v31, v58);<br>  sub_1400041E0(a1, a2, v32, v78, v33, v34, v59);<br>  sub_1400041E0(a1, a2, v35, v79, v36, v37, v60);<br>  sub_14000164D(a1, a2, v69, v70, v68, <span class="hljs-number">1</span>, v61, v66, v67);<br>  sub_1400041E0(a1, a2, v38, v68, v39, v40, v62);<br>  sub_1400041E0(a1, a2, v41, v69, v42, v43, v63);<br>  sub_1400041E0(a1, a2, v44, v70, v45, v46, v64);<br>  sub_1400041E0(a1, a2, v47, v71, v48, v49, v65);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>借助AI可以优化得到：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs C">__int64 __fastcall <span class="hljs-title function_">sub_140001936</span><span class="hljs-params">(<span class="hljs-type">char</span> *input, <span class="hljs-type">char</span> *output)</span><br>&#123;<br>  <span class="hljs-type">int</span> v2; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v13; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v15; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v16; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v17; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v18; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v19; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v20; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v21; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v22; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v23; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v24; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v25; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v26; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v27; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v28; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v29; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v30; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v31; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v32; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v33; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v34; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v35; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v36; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v37; <span class="hljs-comment">// r9d</span><br>  _BYTE v39[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-60h] BYREF</span><br>  _BYTE outputFilename[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-40h] BYREF</span><br>  _BYTE v41[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+60h] [rbp-20h] BYREF</span><br>  _BYTE v42[<span class="hljs-number">44</span>]; <span class="hljs-comment">// [rsp+80h] [rbp+0h] BYREF</span><br>  <span class="hljs-type">char</span> v43; <span class="hljs-comment">// [rsp+ACh] [rbp+2Ch] BYREF</span><br>  <span class="hljs-type">char</span> v44; <span class="hljs-comment">// [rsp+ADh] [rbp+2Dh] BYREF</span><br>  <span class="hljs-type">char</span> v45; <span class="hljs-comment">// [rsp+AEh] [rbp+2Eh] BYREF</span><br>  <span class="hljs-type">char</span> v46; <span class="hljs-comment">// [rsp+AFh] [rbp+2Fh] BYREF</span><br>  _BYTE v47[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+B0h] [rbp+30h] BYREF</span><br>  _BYTE v48[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+D0h] [rbp+50h] BYREF</span><br>  _BYTE v49[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+F0h] [rbp+70h] BYREF</span><br>  _BYTE v50[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+110h] [rbp+90h] BYREF</span><br>  <span class="hljs-type">char</span> *v51; <span class="hljs-comment">// [rsp+130h] [rbp+B0h]</span><br>  <span class="hljs-type">char</span> *v52; <span class="hljs-comment">// [rsp+138h] [rbp+B8h]</span><br>  <span class="hljs-type">char</span> *v53; <span class="hljs-comment">// [rsp+140h] [rbp+C0h]</span><br>  <span class="hljs-type">char</span> *v54; <span class="hljs-comment">// [rsp+148h] [rbp+C8h]</span><br><br>  sub_140001D70();<br>  v54 = &amp;v43;<br>  constructString(input, output, <span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025&quot;</span>, v42, &amp;v43, v2);<br>  nothing();                                    <span class="hljs-comment">// 什么也没有的一个函数</span><br>  v53 = &amp;v44;<br>  constructString(input, output, <span class="hljs-string">&quot;flag.bmp&quot;</span>, v41, &amp;v44, v3);<br>  nothing();<br>  v52 = &amp;v45;<br>  constructString(input, output, <span class="hljs-string">&quot;enc.bmp&quot;</span>, outputFilename, &amp;v45, v4);<br>  nothing();<br>  v51 = &amp;v46;<br>  constructString(input, output, <span class="hljs-string">&quot;114514puiqneravcixpbhqn;afnv-92piwgspdifjv&quot;</span>, v39, &amp;v46, v5);<br>  nothing();<br>  makePath1(input, output, v42, v48, <span class="hljs-string">&quot;\\&quot;</span>, v6);<br>  makePath2(input, output, v48, v47, v41, v7);<br>  makePath3(input, output, v47, v41, v8, v9);<br>  clearup(input, output, v10, v47, v11, v12);<br>  clearup(input, output, v13, v48, v14, v15);<br>  makePath1(input, output, v42, v50, <span class="hljs-string">&quot;\\&quot;</span>, v16);<br>  makePath2(input, output, v50, v49, outputFilename, v17);<br>  makePath3(input, output, v49, outputFilename, v18, v19);<br>  clearup(input, output, v20, v49, v21, v22);<br>  clearup(input, output, v23, v50, v24, v25);<br>  encrypt(input, output, outputFilename, v41, v39, <span class="hljs-number">1</span>);<br>  clearup(input, output, v26, v39, v27, v28);<br>  clearup(input, output, v29, outputFilename, v30, v31);<br>  clearup(input, output, v32, v41, v33, v34);<br>  clearup(input, output, v35, v42, v36, v37);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>这里实际上是在初始化文件相关的信息，程序应该是从E:\WorkSpace\Lab\0xGame 2025下获取flag.bmp，加密后输出为enc.bmp。那一串字符串应该是encrypt函数使用的密钥。encpyt函数优化后是这样的：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs C">__int64 __fastcall <span class="hljs-title function_">encrypt</span><span class="hljs-params">(</span><br><span class="hljs-params">        <span class="hljs-built_in">std</span>::istream *input,</span><br><span class="hljs-params">        <span class="hljs-type">char</span> *output,</span><br><span class="hljs-params">        __int64 outputFilename,</span><br><span class="hljs-params">        __int64 inputfilename,</span><br><span class="hljs-params">        __int64 a5,</span><br><span class="hljs-params">        <span class="hljs-type">char</span> a6)</span><br>&#123;<br>  __int64 v6; <span class="hljs-comment">// rdx</span><br>  __int64 v7; <span class="hljs-comment">// rdx</span><br>  __int64 v9; <span class="hljs-comment">// rax</span><br>  __int64 v10; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v11; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// eax</span><br>  __int64 v13; <span class="hljs-comment">// rdx</span><br>  __int64 v14; <span class="hljs-comment">// rdx</span><br>  __int64 v15; <span class="hljs-comment">// rdx</span><br>  __int64 v17; <span class="hljs-comment">// [rsp+20h] [rbp-60h] BYREF</span><br>  <span class="hljs-type">int</span> v18; <span class="hljs-comment">// [rsp+28h] [rbp-58h]</span><br>  <span class="hljs-type">unsigned</span> __int16 v19; <span class="hljs-comment">// [rsp+2Eh] [rbp-52h]</span><br>  __int64 v20; <span class="hljs-comment">// [rsp+52h] [rbp-2Eh] BYREF</span><br>  _BYTE output_file_buffer[<span class="hljs-number">224</span>]; <span class="hljs-comment">// [rsp+60h] [rbp-20h] BYREF</span><br>  __int64 v22; <span class="hljs-comment">// [rsp+140h] [rbp+C0h] BYREF</span><br>  _BYTE input_file_buffer[<span class="hljs-number">232</span>]; <span class="hljs-comment">// [rsp+250h] [rbp+1D0h] BYREF</span><br>  __int64 v24; <span class="hljs-comment">// [rsp+338h] [rbp+2B8h] BYREF</span><br>  __int64 outputBuffer; <span class="hljs-comment">// [rsp+448h] [rbp+3C8h]</span><br>  __int64 v26; <span class="hljs-comment">// [rsp+450h] [rbp+3D0h]</span><br>  <span class="hljs-type">int</span> v27; <span class="hljs-comment">// [rsp+45Ch] [rbp+3DCh]</span><br>  __int64 header_buffer; <span class="hljs-comment">// [rsp+460h] [rbp+3E0h]</span><br>  __int64 header_buffer_size; <span class="hljs-comment">// [rsp+468h] [rbp+3E8h]</span><br><br>  <span class="hljs-built_in">std</span>::ifstream::basic_ifstream(input, output, inputfilename, input_file_buffer, <span class="hljs-number">4LL</span>);<br>  <span class="hljs-built_in">std</span>::ofstream::basic_ofstream(input, output, outputFilename, output_file_buffer, <span class="hljs-number">4LL</span>);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">std</span>::ios::operator!(input, output, v6, &amp;v24) || <span class="hljs-built_in">std</span>::ios::operator!(input, output, v7, &amp;v22) )<br>  &#123;                                             <span class="hljs-comment">// 错误处理</span><br>    v9 = <span class="hljs-built_in">std</span>::operator&lt;&lt;&lt;<span class="hljs-built_in">std</span>::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(input, output, &amp;unk_7FF770D06000, &amp;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span>);<br>    <span class="hljs-built_in">std</span>::ostream::operator&lt;&lt;(input, output, &amp;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>&lt;<span class="hljs-type">char</span>,<span class="hljs-built_in">std</span>::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;, v9);<br>    v11 = <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    header_buffer_size = <span class="hljs-number">1024LL</span>;<br>    header_buffer = operator new[](input);<br>    <span class="hljs-built_in">std</span>::istream::read(input, output, &amp;v20);    <span class="hljs-comment">// 获取bitmap_file_header</span><br>    <span class="hljs-built_in">std</span>::istream::read(input, output, &amp;v17);    <span class="hljs-comment">// 获取bitmap_info_header</span><br>    <span class="hljs-built_in">std</span>::istream::read(input, output, header_buffer);<br>    <span class="hljs-built_in">std</span>::ostream::write(input, output, &amp;v20);<br>    <span class="hljs-built_in">std</span>::ostream::write(input, output, &amp;v17);<br>    <span class="hljs-built_in">std</span>::ostream::write(input, output, header_buffer);<br>    <span class="hljs-keyword">if</span> ( header_buffer )<br>      operator delete[](input);<br>    v12 = HIDWORD(v17) * v19 + <span class="hljs-number">31</span>;<br>    <span class="hljs-keyword">if</span> ( v12 &lt; <span class="hljs-number">0</span> )<br>      v12 = HIDWORD(v17) * v19 + <span class="hljs-number">62</span>;<br>    v27 = <span class="hljs-number">4</span> * (v12 &gt;&gt; <span class="hljs-number">5</span>);<br>    v26 = (v27 * abs32(v18));<br>    outputBuffer = operator new[](input);<br>    <span class="hljs-built_in">std</span>::istream::read(input, output, outputBuffer);<br>    <span class="hljs-built_in">std</span>::ifstream::close(input, output, v13, input_file_buffer);<br>    <span class="hljs-keyword">if</span> ( a6 )<br>      modifiedRC4(input, output, v26, outputBuffer, a5);<br>    <span class="hljs-built_in">std</span>::ostream::write(input, output, outputBuffer);<br>    <span class="hljs-built_in">std</span>::ofstream::close(input, output, v14, output_file_buffer);<br>    <span class="hljs-keyword">if</span> ( outputBuffer )<br>      operator delete[](input);<br>    v11 = <span class="hljs-number">1</span>;<br>  &#125;<br>  <span class="hljs-built_in">std</span>::ofstream::~ofstream(input, output, v10, output_file_buffer);<br>  <span class="hljs-built_in">std</span>::ifstream::~ifstream(input, output, v15, input_file_buffer);<br>  <span class="hljs-keyword">return</span> v11;<br>&#125;<br><br><span class="hljs-comment">//modifiedRC4</span><br>__int64 __fastcall <span class="hljs-title function_">modifiedRC4</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *a1, __int64 a2, <span class="hljs-type">int</span> numOfDataBytes, __int64 outputBuffer, __int64 a5)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> __int64 v5; <span class="hljs-comment">// rax</span><br>  _BYTE *v6; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v7; <span class="hljs-comment">// dl</span><br>  __int64 result; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+24h] [rbp-Ch]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+24h] [rbp-Ch]</span><br>  <span class="hljs-type">int</span> k; <span class="hljs-comment">// [rsp+24h] [rbp-Ch]</span><br>  <span class="hljs-type">int</span> j_sbox; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> j_; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> i_sbox; <span class="hljs-comment">// [rsp+2Ch] [rbp-4h]</span><br>  <span class="hljs-type">int</span> i_; <span class="hljs-comment">// [rsp+2Ch] [rbp-4h]</span><br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">255</span>; ++i )<br>    S[i] = i;<br>  i_sbox = <span class="hljs-number">0</span>;<br>  j_sbox = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">255</span>; ++j )<br>  &#123;<br>    i_sbox = (i_sbox + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>;<br>    a2 = S[i_sbox] + j_sbox;<br>    v5 = sub_7FF770D032B0(a1, a2, j_sbox, a5);<br>    v6 = sub_7FF770D033D0(a1, a2, i_sbox % v5, a5);<br>    v7 = a2 + *v6;<br>    LODWORD(v6) = ((a2 + *v6) &gt;&gt; <span class="hljs-number">31</span>) &gt;&gt; <span class="hljs-number">24</span>;<br>    j_sbox = (v6 + v7) - v6;<br>    swapbytes(a1, a2, &amp;S[j_sbox], &amp;S[i_sbox]);<br>  &#125;<br>  i_ = <span class="hljs-number">0</span>;<br>  j_ = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; ; ++k )<br>  &#123;<br>    result = ((numOfDataBytes / <span class="hljs-number">256</span>) &lt;&lt; <span class="hljs-number">8</span>);<br>    <span class="hljs-keyword">if</span> ( k &gt;= result )<br>      <span class="hljs-keyword">break</span>;<br>    i_ = (i_ + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>;<br>    j_ = (S[i_] + j_) % <span class="hljs-number">256</span>;<br>    swapbytes(a1, a2, &amp;S[j_], &amp;S[i_]);<br>    swapBytes(<br>      a1,<br>      a2,<br>      (((k / <span class="hljs-number">256</span>) &lt;&lt; <span class="hljs-number">8</span>) + j_ + outputBuffer),   <span class="hljs-comment">// outputBuffer[((k/256)&lt;&lt;8)+j_]</span><br>      (outputBuffer + ((k / <span class="hljs-number">256</span>) &lt;&lt; <span class="hljs-number">8</span>) + i_));  <span class="hljs-comment">// outputBuffer[((k/256)&lt;&lt;8)+i_]</span><br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>从IDA的反编译结果里可以得到一些大致的印象：encrypt函数刚开始对文件进行了三次读与写，采用的加密方式是类似RC4的算法，但是相较于标准RC4，此处只是单纯的置换，没有异或操作。为了进一步理解程序，接下来先研究读写文件的操作逻辑。</p><p>简单了解一下bmp文件格式，可以知道文件开头前0x36h是文件头，这一部分肯定是不会怎么变的，否则就会改变文件的格式了。在电脑里复刻一个一摸一样的路径，自己创建一个flag.bmp运行img.exe可以得到enc.bmp，此时用十六进制编辑器打开两个文件可以发现它们之间差了1024bytes，更准确的说，是加密后的文件比加密前多了1024bytes。</p><p>下面转用xdbg。对照IDA可以找到读写文件的位置，分析结果如下：</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><code class="hljs X86asm">00007FF6077B164D | <span class="hljs-number">55</span>                  | <span class="hljs-keyword">PUSH</span> <span class="hljs-built_in">RBP</span>                                                 | encrypt<br>00007FF6077B164E | <span class="hljs-number">53</span>                  | <span class="hljs-keyword">PUSH</span> <span class="hljs-built_in">RBX</span>                                                 |<br>00007FF6077B164F | <span class="hljs-number">48</span>:81EC <span class="hljs-number">78040000</span>    | <span class="hljs-keyword">SUB</span> <span class="hljs-built_in">RSP</span>,<span class="hljs-number">478</span>                                              |<br>00007FF6077B1656 | <span class="hljs-number">48</span>:8DAC24 <span class="hljs-number">80000000</span>  | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RBP</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RSP</span>+<span class="hljs-number">80</span>]                            | [<span class="hljs-built_in">rsp</span>+<span class="hljs-number">80</span>]:_register_onexit_function+<span class="hljs-number">210</span><br>00007FF6077B165E | <span class="hljs-number">48</span>:<span class="hljs-number">898D</span> <span class="hljs-number">10040000</span>    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+<span class="hljs-number">410</span>],<span class="hljs-built_in">RCX</span>                           |<br>00007FF6077B1665 | <span class="hljs-number">48</span>:<span class="hljs-number">8995</span> <span class="hljs-number">18040000</span>    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+<span class="hljs-number">418</span>],<span class="hljs-built_in">RDX</span>                           |<br>00007FF6077B166C | 4C:<span class="hljs-number">8985</span> <span class="hljs-number">20040000</span>    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+<span class="hljs-number">420</span>],<span class="hljs-built_in">R8</span>                            |<br>00007FF6077B1673 | <span class="hljs-number">44</span>:89C8             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">R9D</span>                                              |<br>00007FF6077B1676 | <span class="hljs-number">8885</span> <span class="hljs-number">28040000</span>       | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">BYTE</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+<span class="hljs-number">428</span>],<span class="hljs-built_in">AL</span>                             |<br>00007FF6077B167C | <span class="hljs-number">48</span>:8B95 <span class="hljs-number">10040000</span>    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RDX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+<span class="hljs-number">410</span>]                           |<br>00007FF6077B1683 | <span class="hljs-number">48</span>:8D85 D0010000    | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+1D0]                           |<br>00007FF6077B168A | <span class="hljs-number">41</span>:B8 <span class="hljs-number">04000000</span>      | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">R8D</span>,<span class="hljs-number">4</span>                                                |<br>00007FF6077B1690 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B1693 | E8 E0050000         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;<span class="hljs-keyword">std</span>::basic_ifstream&lt;char, <span class="hljs-keyword">std</span>::char_traits&lt;<span class="hljs-number">ch</span> | 错误处理<br>00007FF6077B1698 | <span class="hljs-number">48</span>:8B95 <span class="hljs-number">18040000</span>    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RDX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+<span class="hljs-number">418</span>]                           |<br>00007FF6077B169F | <span class="hljs-number">48</span>:8D45 E0          | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>-<span class="hljs-number">20</span>]                            | [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">20</span>]:<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B16A3 | 41:B8 04000000      | MOV R8D,4                                                |</span><br><span class="hljs-string">00007FF6077B16A9 | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B16AC | E8 AF050000         | CALL &lt;JMP.&amp;std::basic_ofstream&lt;char, std::char_traits&lt;ch |</span><br><span class="hljs-string">00007FF6077B16B1 | 48:8D85 D0010000    | LEA RAX,QWORD PTR SS:[RBP+1D0]                           |</span><br><span class="hljs-string">00007FF6077B16B8 | 48:05 E8000000      | ADD RAX,E8                                               | rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B16BE | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B16C1 | E8 DA050000         | CALL &lt;JMP.&amp;std::basic_ios&lt;char, std::char_traits&lt;char&gt; &gt; |</span><br><span class="hljs-string">00007FF6077B16C6 | 84C0                | TEST AL,AL                                               |</span><br><span class="hljs-string">00007FF6077B16C8 | 75 16               | JNE img.7FF6077B16E0                                     |</span><br><span class="hljs-string">00007FF6077B16CA | 48:8D45 E0          | LEA RAX,QWORD PTR SS:[RBP-20]                            | [rbp-20]:&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;&quot;</span><br>00007FF6077B16CE | <span class="hljs-number">48</span>:<span class="hljs-number">05</span> E0000000      | <span class="hljs-keyword">ADD</span> <span class="hljs-built_in">RAX</span>,E0                                               | <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B16D4 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B16D7 | E8 C4050000         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;<span class="hljs-keyword">std</span>::basic_ios&lt;char, <span class="hljs-keyword">std</span>::char_traits&lt;char&gt; &gt; |<br>00007FF6077B16DC | 84C0                | <span class="hljs-keyword">TEST</span> <span class="hljs-built_in">AL</span>,<span class="hljs-built_in">AL</span>                                               |<br>00007FF6077B16DE | <span class="hljs-number">74</span> <span class="hljs-number">07</span>               | <span class="hljs-keyword">JE</span> img<span class="hljs-number">.</span>7FF6077B16E7                                      |<br>00007FF6077B16E0 | B8 <span class="hljs-number">01000000</span>         | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-number">1</span>                                                |<br>00007FF6077B16E5 | EB <span class="hljs-number">05</span>               | <span class="hljs-keyword">JMP</span> img<span class="hljs-number">.</span>7FF6077B16EC                                     |<br>00007FF6077B16E7 | B8 <span class="hljs-number">00000000</span>         | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-number">0</span>                                                |<br>00007FF6077B16EC | 84C0                | <span class="hljs-keyword">TEST</span> <span class="hljs-built_in">AL</span>,<span class="hljs-built_in">AL</span>                                               |<br>00007FF6077B16EE | <span class="hljs-number">74</span> <span class="hljs-number">32</span>               | <span class="hljs-keyword">JE</span> img<span class="hljs-number">.</span>7FF6077B1722                                      |<br>00007FF6077B16F0 | <span class="hljs-number">48</span>:8D15 <span class="hljs-number">09490000</span>    | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RDX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">DS</span>:[7FF6077B6000]                      | <span class="hljs-built_in">rdx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\enc.bmp&quot;</span>, 00007FF6077B6000:u8<span class="hljs-string">&quot;无法打开文件！&quot;</span>ame <span class="hljs-number">2025</span>\\enc<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B16F7 | 48:8B05 024F0000    | MOV RAX,QWORD PTR DS:[&lt;&amp;std::cerr&gt;]                      | rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B16FE | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1701 | E8 22050000         | CALL &lt;JMP.&amp;std::basic_ostream&lt;char, std::char_traits&lt;cha |</span><br><span class="hljs-string">00007FF6077B1706 | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1709 | 48:8B05 004F0000    | MOV RAX,QWORD PTR DS:[&lt;&amp;JMP.&amp;std::basic_ostream&lt;char, st | rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1710 | 48:89C2             | MOV RDX,RAX                                              | rdx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\enc<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1713 | E8 70050000         | CALL &lt;JMP.&amp;std::ostream::operator&lt;&lt;(std::ostream&amp; (*)(st |</span><br><span class="hljs-string">00007FF6077B1718 | BB 00000000         | MOV EBX,0                                                |</span><br><span class="hljs-string">00007FF6077B171D | E9 BD010000         | JMP img.7FF6077B18DF                                     |</span><br><span class="hljs-string">00007FF6077B1722 | 48:C785 E8030000 00 | MOV QWORD PTR SS:[RBP+3E8],400                           |</span><br><span class="hljs-string">00007FF6077B172D | B9 00040000         | MOV ECX,400                                              |</span><br><span class="hljs-string">00007FF6077B1732 | E8 D9040000         | CALL &lt;JMP.&amp;operator new[](unsigned long long)&gt;           |</span><br><span class="hljs-string">00007FF6077B1737 | 48:8985 E0030000    | MOV QWORD PTR SS:[RBP+3E0],RAX                           |</span><br><span class="hljs-string">00007FF6077B173E | 48:8D55 D2          | LEA RDX,QWORD PTR SS:[RBP-2E]                            | RBP-2E：输入流缓冲区1（存放header）</span><br><span class="hljs-string">00007FF6077B1742 | 48:8D85 D0010000    | LEA RAX,QWORD PTR SS:[RBP+1D0]                           |</span><br><span class="hljs-string">00007FF6077B1749 | 41:B8 0E000000      | MOV R8D,E                                                | 读取长度：Eh</span><br><span class="hljs-string">00007FF6077B174F | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1752 | E8 41050000         | CALL &lt;JMP.&amp;std::istream::read(char*, long long)&gt;         | 读入header</span><br><span class="hljs-string">00007FF6077B1757 | 48:8D55 A0          | LEA RDX,QWORD PTR SS:[RBP-60]                            | RBP-60：输入流缓冲区2（存放header info）</span><br><span class="hljs-string">00007FF6077B175B | 48:8D85 D0010000    | LEA RAX,QWORD PTR SS:[RBP+1D0]                           |</span><br><span class="hljs-string">00007FF6077B1762 | 41:B8 28000000      | MOV R8D,28                                               | 读取长度：28h</span><br><span class="hljs-string">00007FF6077B1768 | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B176B | E8 28050000         | CALL &lt;JMP.&amp;std::istream::read(char*, long long)&gt;         | 读入header info</span><br><span class="hljs-string">00007FF6077B1770 | 48:8B95 E0030000    | MOV RDX,QWORD PTR SS:[RBP+3E0]                           | [rbp-3E0]：输入流缓冲区3（存放文件头后的1024bytes)</span><br><span class="hljs-string">00007FF6077B1777 | 48:8D85 D0010000    | LEA RAX,QWORD PTR SS:[RBP+1D0]                           |</span><br><span class="hljs-string">00007FF6077B177E | 41:B8 00040000      | MOV R8D,400                                              | 读取长度：400h</span><br><span class="hljs-string">00007FF6077B1784 | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1787 | E8 0C050000         | CALL &lt;JMP.&amp;std::istream::read(char*, long long)&gt;         | 读入文件头后的1024bytes</span><br><span class="hljs-string">00007FF6077B178C | 48:8D55 D2          | LEA RDX,QWORD PTR SS:[RBP-2E]                            | [rbp-2E]：write参数（header）</span><br><span class="hljs-string">00007FF6077B1790 | 48:8D45 E0          | LEA RAX,QWORD PTR SS:[RBP-20]                            | [rbp-20]:&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;&quot;</span><br>00007FF6077B1794 | <span class="hljs-number">41</span>:B8 0E000000      | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">R8D</span>,E                                                |<br>00007FF6077B179A | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B179D | E8 EE040000         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;<span class="hljs-keyword">std</span>::ostream::write(char const*, long long)&gt;  | <br>00007FF6077B17A2 | <span class="hljs-number">48</span>:8D55 A0          | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RDX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>-<span class="hljs-number">60</span>]                            | [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">60</span>]:<span class="hljs-string">&quot;114514puiqneravcixpbhqn;afnv-92piwgspdifjv&quot;</span><br>00007FF6077B17A6 | <span class="hljs-number">48</span>:8D45 E0          | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>-<span class="hljs-number">20</span>]                            | [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">20</span>]:<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B17AA | 41:B8 28000000      | MOV R8D,28                                               | 28:&#x27;(&#x27;</span><br><span class="hljs-string">00007FF6077B17B0 | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B17B3 | E8 D8040000         | CALL &lt;JMP.&amp;std::ostream::write(char const*, long long)&gt;  |</span><br><span class="hljs-string">00007FF6077B17B8 | 48:8B95 E0030000    | MOV RDX,QWORD PTR SS:[RBP+3E0]                           |</span><br><span class="hljs-string">00007FF6077B17BF | 48:8D45 E0          | LEA RAX,QWORD PTR SS:[RBP-20]                            | [rbp-20]:&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;&quot;</span><br>00007FF6077B17C3 | <span class="hljs-number">41</span>:B8 <span class="hljs-number">00040000</span>      | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">R8D</span>,<span class="hljs-number">400</span>                                              |<br>00007FF6077B17C9 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B17CC | E8 BF040000         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;<span class="hljs-keyword">std</span>::ostream::write(char const*, long long)&gt;  |<br>00007FF6077B17D1 | <span class="hljs-number">48</span>:83BD E0030000 <span class="hljs-number">00</span> | <span class="hljs-keyword">CMP</span> <span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3E0],<span class="hljs-number">0</span>                             |<br>00007FF6077B17D9 | <span class="hljs-number">74</span> 0F               | <span class="hljs-keyword">JE</span> img<span class="hljs-number">.</span>7FF6077B17EA                                      |<br>00007FF6077B17DB | <span class="hljs-number">48</span>:8B85 E0030000    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3E0]                           |<br>00007FF6077B17E2 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B17E5 | E8 <span class="hljs-number">36040000</span>         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;operator delete[](void*)&gt;                     |<br>00007FF6077B17EA | 8B55 A4             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">EDX</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>-5C]                            |<br>00007FF6077B17ED | 0FB745 AE           | <span class="hljs-keyword">MOVZX</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">WORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>-<span class="hljs-number">52</span>]                           |<br>00007FF6077B17F1 | 0FB7C0              | <span class="hljs-keyword">MOVZX</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">AX</span>                                             |<br>00007FF6077B17F4 | 0FAFC2              | <span class="hljs-keyword">IMUL</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">EDX</span>                                             |<br>00007FF6077B17F7 | 83C0 1F             | <span class="hljs-keyword">ADD</span> <span class="hljs-built_in">EAX</span>,1F                                               |<br>00007FF6077B17FA | 8D50 1F             | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">EDX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">DS</span>:[<span class="hljs-built_in">RAX</span>+1F]                            |<br>00007FF6077B17FD | 85C0                | <span class="hljs-keyword">TEST</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">EAX</span>                                             |<br>00007FF6077B17FF | 0F48C2              | <span class="hljs-keyword">CMOVS</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">EDX</span>                                            |<br>00007FF6077B1802 | C1F8 <span class="hljs-number">05</span>             | <span class="hljs-keyword">SAR</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-number">5</span>                                                |<br>00007FF6077B1805 | C1E0 <span class="hljs-number">02</span>             | <span class="hljs-keyword">SHL</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-number">2</span>                                                |<br>00007FF6077B1808 | <span class="hljs-number">8985</span> DC030000       | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3DC],<span class="hljs-built_in">EAX</span>                           |<br>00007FF6077B180E | 8B45 A8             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>-<span class="hljs-number">58</span>]                            |<br>00007FF6077B1811 | <span class="hljs-number">99</span>                  | <span class="hljs-keyword">CDQ</span>                                                      |<br>00007FF6077B1812 | 31D0                | <span class="hljs-keyword">XOR</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">EDX</span>                                              |<br>00007FF6077B1814 | 29D0                | <span class="hljs-keyword">SUB</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">EDX</span>                                              |<br>00007FF6077B1816 | 0FAF85 DC030000     | <span class="hljs-keyword">IMUL</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3DC]                          |<br>00007FF6077B181D | <span class="hljs-number">48</span>:<span class="hljs-number">98</span>               | <span class="hljs-keyword">CDQE</span>                                                     |<br>00007FF6077B181F | <span class="hljs-number">48</span>:<span class="hljs-number">8985</span> D0030000    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3D0],<span class="hljs-built_in">RAX</span>                           |<br>00007FF6077B1826 | <span class="hljs-number">48</span>:8B85 D0030000    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3D0]                           |<br>00007FF6077B182D | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B1830 | E8 DB030000         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;operator new[](unsigned long long)&gt;           |<br>00007FF6077B1835 | <span class="hljs-number">48</span>:<span class="hljs-number">8985</span> C8030000    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3C8],<span class="hljs-built_in">RAX</span>                           | <span class="hljs-number">111</span><br>00007FF6077B183C | <span class="hljs-number">48</span>:8B8D D0030000    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3D0]                           |<br>00007FF6077B1843 | <span class="hljs-number">48</span>:8B95 C8030000    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RDX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3C8]                           | <span class="hljs-number">111</span><br>00007FF6077B184A | <span class="hljs-number">48</span>:8D85 D0010000    | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+1D0]                           |<br>00007FF6077B1851 | <span class="hljs-number">49</span>:89C8             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">R8</span>,<span class="hljs-built_in">RCX</span>                                               | <span class="hljs-built_in">r8</span>:&amp;<span class="hljs-string">&quot;114514puiqneravcixpbhqn;afnv-92piwgspdifjv&quot;</span>, <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1854 | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1857 | E8 3C040000         | CALL &lt;JMP.&amp;std::istream::read(char*, long long)&gt;         |</span><br><span class="hljs-string">00007FF6077B185C | 48:8D85 D0010000    | LEA RAX,QWORD PTR SS:[RBP+1D0]                           |</span><br><span class="hljs-string">00007FF6077B1863 | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1866 | E8 15040000         | CALL &lt;JMP.&amp;std::basic_ifstream&lt;char, std::char_traits&lt;ch |</span><br><span class="hljs-string">00007FF6077B186B | 80BD 28040000 00    | CMP BYTE PTR SS:[RBP+428],0                              |</span><br><span class="hljs-string">00007FF6077B1872 | 74 24               | JE img.7FF6077B1898                                      |</span><br><span class="hljs-string">00007FF6077B1874 | 48:8B85 D0030000    | MOV RAX,QWORD PTR SS:[RBP+3D0]                           |</span><br><span class="hljs-string">00007FF6077B187B | 89C1                | MOV ECX,EAX                                              |</span><br><span class="hljs-string">00007FF6077B187D | 48:8B95 20040000    | MOV RDX,QWORD PTR SS:[RBP+420]                           |</span><br><span class="hljs-string">00007FF6077B1884 | 48:8B85 C8030000    | MOV RAX,QWORD PTR SS:[RBP+3C8]                           | 关注此处[rbp+3C8]，疑似存放处理后的数据的缓冲区</span><br><span class="hljs-string">00007FF6077B188B | 49:89D0             | MOV R8,RDX                                               | r8:&amp;&quot;</span>114514puiqneravcixpbhqn<span class="hljs-comment">;afnv-92piwgspdifjv&quot;, rdx:&amp;&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\enc.bmp&quot;v&quot;</span><br>00007FF6077B188E | 89CA                | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">EDX</span>,<span class="hljs-built_in">ECX</span>                                              |<br>00007FF6077B1890 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B1893 | E8 A8FBFFFF         | <span class="hljs-keyword">CALL</span> img<span class="hljs-number">.</span>7FF6077B1440                                    | modifiedRC4<br>00007FF6077B1898 | <span class="hljs-number">48</span>:8B8D D0030000    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3D0]                           |<br>00007FF6077B189F | <span class="hljs-number">48</span>:8B95 C8030000    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RDX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3C8]                           | [<span class="hljs-built_in">rbp</span>+3C8]：输出的图像数据<br>00007FF6077B18A6 | <span class="hljs-number">48</span>:8D45 E0          | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>-<span class="hljs-number">20</span>]                            | [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">20</span>]:<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B18AA | 49:89C8             | MOV R8,RCX                                               | R8：数据长度</span><br><span class="hljs-string">00007FF6077B18AD | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B18B0 | E8 DB030000         | CALL &lt;JMP.&amp;std::ostream::write(char const*, long long)&gt;  | 写入加密后的数据</span><br><span class="hljs-string">00007FF6077B18B5 | 48:8D45 E0          | LEA RAX,QWORD PTR SS:[RBP-20]                            | [rbp-20]:&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;&quot;</span><br>00007FF6077B18B9 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B18BC | E8 A7030000         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;<span class="hljs-keyword">std</span>::basic_ofstream&lt;char, <span class="hljs-keyword">std</span>::char_traits&lt;<span class="hljs-number">ch</span> |<br>00007FF6077B18C1 | <span class="hljs-number">48</span>:83BD C8030000 <span class="hljs-number">00</span> | <span class="hljs-keyword">CMP</span> <span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3C8],<span class="hljs-number">0</span>                             |<br>00007FF6077B18C9 | <span class="hljs-number">74</span> 0F               | <span class="hljs-keyword">JE</span> img<span class="hljs-number">.</span>7FF6077B18DA                                      |<br>00007FF6077B18CB | <span class="hljs-number">48</span>:8B85 C8030000    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3C8]                           |<br>00007FF6077B18D2 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B18D5 | E8 <span class="hljs-number">46030000</span>         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;operator delete[](void*)&gt;                     | <br>00007FF6077B18DA | BB <span class="hljs-number">01000000</span>         | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">EBX</span>,<span class="hljs-number">1</span>                                                |<br>00007FF6077B18DF | <span class="hljs-number">48</span>:8D45 E0          | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>-<span class="hljs-number">20</span>]                            | [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">20</span>]:<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B18E3 | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B18E6 | E8 6D030000         | CALL &lt;JMP.&amp;std::basic_ofstream&lt;char, std::char_traits&lt;ch |</span><br><span class="hljs-string">00007FF6077B18EB | 48:8D85 D0010000    | LEA RAX,QWORD PTR SS:[RBP+1D0]                           |</span><br><span class="hljs-string">00007FF6077B18F2 | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B18F5 | E8 76030000         | CALL &lt;JMP.&amp;std::basic_ifstream&lt;char, std::char_traits&lt;ch |</span><br><span class="hljs-string">00007FF6077B18FA | 89D8                | MOV EAX,EBX                                              |</span><br><span class="hljs-string">00007FF6077B18FC | EB 2E               | JMP img.7FF6077B192C                                     |</span><br><span class="hljs-string">00007FF6077B18FE | 48:89C3             | MOV RBX,RAX                                              | rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1901 | 48:8D45 E0          | LEA RAX,QWORD PTR SS:[RBP-20]                            | [rbp-20]:&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;&quot;</span><br>00007FF6077B1905 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B1908 | E8 4B030000         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;<span class="hljs-keyword">std</span>::basic_ofstream&lt;char, <span class="hljs-keyword">std</span>::char_traits&lt;<span class="hljs-number">ch</span> |<br>00007FF6077B190D | EB <span class="hljs-number">03</span>               | <span class="hljs-keyword">JMP</span> img<span class="hljs-number">.</span>7FF6077B1912                                     |<br>00007FF6077B190F | <span class="hljs-number">48</span>:89C3             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RBX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B1912 | <span class="hljs-number">48</span>:8D85 D0010000    | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+1D0]                           |<br>00007FF6077B1919 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B191C | E8 4F030000         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;<span class="hljs-keyword">std</span>::basic_ifstream&lt;char, <span class="hljs-keyword">std</span>::char_traits&lt;<span class="hljs-number">ch</span> |<br>00007FF6077B1921 | <span class="hljs-number">48</span>:89D8             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">RBX</span>                                              | <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B1924 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B1927 | E8 <span class="hljs-number">74140000</span>         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;_Unwind_Resume&gt;                               |<br>00007FF6077B192C | <span class="hljs-number">48</span>:81C4 <span class="hljs-number">78040000</span>    | <span class="hljs-keyword">ADD</span> <span class="hljs-built_in">RSP</span>,<span class="hljs-number">478</span>                                              |<br>00007FF6077B1933 | 5B                  | <span class="hljs-keyword">POP</span> <span class="hljs-built_in">RBX</span>                                                  |<br>00007FF6077B1934 | <span class="hljs-number">5D</span>                  | <span class="hljs-keyword">POP</span> <span class="hljs-built_in">RBP</span>                                                  |<br>00007FF6077B1935 | C3                  | <span class="hljs-keyword">RET</span>                                                      |<br></code></pre></td></tr></table></figure><p>通过跟踪三次read的参数（查看读入内存的数据）可以发现，程序除了读取文件头之外还读取了随后的1024bytes。这刚开始其实只是一个猜想，但是通过修改自己创建的flag.bmp文件头后的部分数据可以验证猜想</p><p><img src="/../images/image-20251118205855685.png" alt="修改文件数据"></p><p><img src="/../images/image-20251118205930373.png" alt="输入流缓冲区3读取的正是文件头后的1024bytes"></p><p>继续运行程序，可以发现生成的enc.bmp中保留了这一部分修改后的数据，于是猜想程序在加密结果中保留了输入流缓冲区3的1024bytes，可以通过扩大修改的数据范围来验证猜想（这里选择进一步修改flag.bmp里1024bytes的结尾，这样开头结尾都有被修改的特征了）</p><p><img src="/../images/image-20251118211132659.png" alt="进一步修改原文件文件头后1024bytes的结尾"></p><p><img src="/../images/image-20251119154953693.png" alt="加密结果文件头后1024bytes的开头"></p><p><img src="/../images/image-20251118211217057.png" alt="加密结果文件头后1024bytes的结尾"></p><p>于是加密结果中多出来的1024bytes来源就显而易见了。至此，程序读写文件的逻辑基本可以明确了：先保留文件头（0-0x36h）和文件头后的1024bytes，然后读取文件头之外的数据（0x36h-0x3589A9h）进行加密，加密完成后先向enc.bmp写入事先保留的文件头和1024bytes，再拼接上加密后的数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">flag.bmp:文件头(大小0x36h)+图片数据(大小0x358974h)<br>enc.bmp:文件头(大小0x36h)+图片数据前1024bytes(大小0x400h)+加密后的图片数据(大小0x358974h)<br></code></pre></td></tr></table></figure><p>解决完文件读写逻辑分析后，接下来着手解决算法逆向。下面是modefiedRC4的详细分析</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs C">__int64 __fastcall <span class="hljs-title function_">modifiedRC4</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *input, __int64 a2, <span class="hljs-type">int</span> numOfDataBytes, __int64 outputBuffer, __int64 key)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> __int64 v5; <span class="hljs-comment">// rax</span><br>  _BYTE *v6; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v7; <span class="hljs-comment">// dl</span><br>  __int64 numOfEncBytes; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+24h] [rbp-Ch]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+24h] [rbp-Ch]</span><br>  <span class="hljs-type">int</span> k; <span class="hljs-comment">// [rsp+24h] [rbp-Ch]</span><br>  <span class="hljs-type">int</span> j_sbox; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> j_; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> i_sbox; <span class="hljs-comment">// [rsp+2Ch] [rbp-4h]</span><br>  <span class="hljs-type">int</span> i_; <span class="hljs-comment">// [rsp+2Ch] [rbp-4h]</span><br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">255</span>; ++i )<br>    S[i] = i;<br>  i_sbox = <span class="hljs-number">0</span>;<br>  j_sbox = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">255</span>; ++j )<br>  &#123;<br>    i_sbox = (i_sbox + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>;<br>    a2 = S[i_sbox] + j_sbox;<br>    v5 = sub_7FF7688232B0(input, a2, j_sbox, key);<span class="hljs-comment">// 实际上return key[8]，调试可以发现v5即key[8]是0x2A，对应密钥长度</span><br>    v6 = sub_7FF7688233D0(input, a2, i_sbox % v5, key);<span class="hljs-comment">// if(key_len &gt;= i_sbox%key_len ) return key[i_sbox%key_len]</span><br>    v7 = a2 + *v6;                              <span class="hljs-comment">// v7=S[i_sbox] + j_sbox + key[i_sbox%key_len]</span><br>    LODWORD(v6) = ((a2 + *v6) &gt;&gt; <span class="hljs-number">31</span>) &gt;&gt; <span class="hljs-number">24</span>;<br>    j_sbox = (v6 + v7) - v6;                    <span class="hljs-comment">// 这两步实际上等价为j_sbox = j_sboxv7%256</span><br>    swapbytes(input, a2, &amp;S[j_sbox], &amp;S[i_sbox]);<span class="hljs-comment">// 实际上是swapbytes(&amp;S[j_sbox],&amp;S[i_sbox])，前两个参数没有使用</span><br>  &#125;<br>  i_ = <span class="hljs-number">0</span>;<br>  j_ = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; ; ++k )<br>  &#123;<br>    numOfEncBytes = ((numOfDataBytes / <span class="hljs-number">256</span>) &lt;&lt; <span class="hljs-number">8</span>);<span class="hljs-comment">// 总数据量对256向下取整，保证加密数据量为256倍数</span><br>    <span class="hljs-keyword">if</span> ( k &gt;= numOfEncBytes )                   <span class="hljs-comment">// k从0开始直到最大加密数据量</span><br>      <span class="hljs-keyword">break</span>;<br>    i_ = (i_ + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>;<br>    j_ = (S[i_] + j_) % <span class="hljs-number">256</span>;<br>    swapbytes(input, a2, &amp;S[j_], &amp;S[i_]);<br>    swapBytes(<br>      input,<br>      a2,<br>      (((k / <span class="hljs-number">256</span>) &lt;&lt; <span class="hljs-number">8</span>) + j_ + outputBuffer),   <span class="hljs-comment">// outputBuffer[((k/256)&lt;&lt;8)+j_]，此处(k/256)&lt;&lt;8即取每块256bytes的基址，因此交换范围是当前所在的256bytes块</span><br>      (outputBuffer + ((k / <span class="hljs-number">256</span>) &lt;&lt; <span class="hljs-number">8</span>) + i_));  <span class="hljs-comment">// outputBuffer[((k/256)&lt;&lt;8)+i_]</span><br>  &#125;<br>  <span class="hljs-keyword">return</span> numOfEncBytes;<br>&#125;<br></code></pre></td></tr></table></figure><p>算法中第一、二个循环在初始化S盒，没有对输出数据outputBuffer进行处理，第三个循环才利用S盒的数据来加密outputBuffer。加密outputBuffer的时候，记录了加密的数据量，加密轮数和加密数据量一致。每轮加密同步交换了 i_ 和 j_ 处的S盒数据以及outputBuffer数据，需要注意的是outputBuffer在交换的时候被分成了若干个256bytes块，交换在每个256bytes块内进行。最直观的解密算法是记录下每轮加密使用的 i_ 和 j_ ，然后逆序使用这些索引对交换数据。解密脚本如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params"><span class="hljs-built_in">input</span>,output</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-built_in">input</span>,<span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        enc=f.read()<br><br>    bmp_header=enc[:<span class="hljs-number">0x36</span>]<span class="hljs-comment">#保留文件头</span><br>    enc_data=<span class="hljs-built_in">bytearray</span>(enc[<span class="hljs-number">0x436</span>:])<span class="hljs-comment">#加密数据为文件头+1024bytes后的数据，起始偏移即为0x436</span><br>    data_len=<span class="hljs-built_in">len</span>(enc_data)<br>    aligned_len=(data_len//<span class="hljs-number">256</span>)*<span class="hljs-number">256</span><span class="hljs-comment">#总数据量向下对256取整，即保证数据量为256的倍数</span><br><br>    key=<span class="hljs-string">&quot;114514puiqneravcixpbhqn;afnv-92piwgspdifjv&quot;</span><br>    key_len=<span class="hljs-built_in">len</span>(key)<br><br>    <span class="hljs-comment">#初始化S盒</span><br>    S=<span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>    j_sbox=<span class="hljs-number">0</span><br>    i_sbox=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        i_sbox=(i_sbox+<span class="hljs-number">1</span>)%<span class="hljs-number">256</span><br>        j_sbox=(j_sbox+S[i_sbox]+<span class="hljs-built_in">ord</span>(key[i_sbox%key_len]))%<span class="hljs-number">256</span><br>        S[i_sbox],S[j_sbox]=S[j_sbox],S[i_sbox]<br><br>    <span class="hljs-comment">#解密</span><br>    <span class="hljs-comment">#生成交换对</span><br>    i_=<span class="hljs-number">0</span><br>    j_=<span class="hljs-number">0</span><br>    swap_couples=[]<br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(aligned_len):<br>        i_=(i_+<span class="hljs-number">1</span>)%<span class="hljs-number">256</span><br>        j_=(j_+S[i_])%<span class="hljs-number">256</span><br>        S[i_],S[j_]=S[j_],S[i_]<br><br>        base=(k//<span class="hljs-number">256</span>)*<span class="hljs-number">256</span><span class="hljs-comment">#取每块256bytes的基址</span><br>        pos1=base+i_<br>        pos2=base+j_<br>        <span class="hljs-keyword">if</span> pos1&lt;aligned_len <span class="hljs-keyword">and</span> pos2&lt;aligned_len:<br>            swap_couples.append((pos1,pos2))<br><br>    <span class="hljs-comment">#逆序使用交换对，解密数据</span><br>    <span class="hljs-keyword">for</span> pos1,pos2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">reversed</span>(swap_couples):<br>        enc_data[pos1],enc_data[pos2]=enc_data[pos2],enc_data[pos1]<br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output,<span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(bmp_header)<br>        f.write(enc_data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]decrypt done!&quot;</span>)<br><br>decrypt(<span class="hljs-string">&quot;enc.bmp&quot;</span>,<span class="hljs-string">&quot;flag.bmp&quot;</span>)<br><br></code></pre></td></tr></table></figure><p>解密可以得到下图（没有完全解密成功，但是不影响拿到flag）</p><p><img src="/../images/flag.bmp" alt="flag.bmp"></p></li></ul><blockquote><p>flag：0xGame{5d0e6f18-ebc0-4231-b0e6-a5821327aefd}</p></blockquote><h2 id="蔷薇地狱"><a href="#蔷薇地狱" class="headerlink" title="蔷薇地狱"></a>蔷薇地狱</h2><blockquote><p>考点：复杂程序分析，RSA解密</p><p>难点还是在于复杂</p></blockquote><ul><li><p>附件是一个Int.exe，一个流量包，还有两个enc文件。运行程序会显示connect failed然后打印一些数据后闪退，同时同一目录下的文件会被加密生成加密文件</p><p><img src="/../images/image-20251119160128685.png" alt="附件"></p><p><img src="/../images/image-20251119160014085.png" alt="运行程序显示"></p></li><li><p>用IDA打开程序，shift+F12可以在字符串窗口找到运行程序时显示的”connect failed”（以及其他一些看起来和网络通信有关的字符串，如”127.0.0.1”，”socket failed”）</p><p><img src="/../images/image-20251119160735550.png" alt="字符串窗口"></p><p>然后可以跟踪到下面这样一个很像网络通信的函数</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">sub_140003D46</span><span class="hljs-params">(__int64 a1, __int64 a2, u_short a3, <span class="hljs-type">int</span> a4)</span></span><br><span class="hljs-function"></span>&#123;<br>  __int64 v4; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> Error; <span class="hljs-comment">// eax</span><br>  __int64 v6; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v7; <span class="hljs-comment">// ebx</span><br>  __int64 v8; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v9; <span class="hljs-comment">// eax</span><br>  __int64 v10; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// r9d</span><br>  __int64 v13; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v14; <span class="hljs-comment">// eax</span><br>  __int64 v15; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v16; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v17; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v18; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v19; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-type">int</span> v20; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v21; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v22; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v23; <span class="hljs-comment">// rax</span><br>  __int64 v24; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v25; <span class="hljs-comment">// eax</span><br>  __int64 v26; <span class="hljs-comment">// rax</span><br>  __int64 v27; <span class="hljs-comment">// rax</span><br>  __int64 v28; <span class="hljs-comment">// rax</span><br>  __int64 v29; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v30; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v31; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v32; <span class="hljs-comment">// r9d</span><br>  __int64 v34[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-80h] BYREF</span><br>  _BYTE v35[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-60h] BYREF</span><br>  sockaddr name; <span class="hljs-comment">// [rsp+40h] [rbp-40h] BYREF</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v37; <span class="hljs-comment">// [rsp+1F4h] [rbp+174h]</span><br>  SOCKET s; <span class="hljs-comment">// [rsp+1F8h] [rbp+178h]</span><br><br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">WSAStartup</span>(<span class="hljs-number">0x202u</span>, (LPWSADATA)&amp;v34[<span class="hljs-number">10</span>]) )<br>  &#123;<br>    v4 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot;WSAStartup failed: &quot;</span>, &amp;std::cerr);<br>    Error = <span class="hljs-built_in">WSAGetLastError</span>();<br>    v6 = std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, a2, Error, v4);<br>    std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot;\n&quot;</span>, v6);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    s = <span class="hljs-built_in">socket</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> ( s == <span class="hljs-number">-1LL</span> )<br>    &#123;<br>      v8 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot;socket failed: &quot;</span>, &amp;std::cerr);<br>      v9 = <span class="hljs-built_in">WSAGetLastError</span>();<br>      v10 = std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, a2, v9, v8);<br>      std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot;\n&quot;</span>, v10);<br>      <span class="hljs-built_in">WSACleanup</span>();<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      name.sa_family = <span class="hljs-number">2</span>;<br>      *(_WORD *)name.sa_data = <span class="hljs-built_in">htons</span>(a3);<br>      *(_DWORD *)&amp;name.sa_data[<span class="hljs-number">2</span>] = <span class="hljs-built_in">inet_addr</span>(<span class="hljs-string">&quot;127.0.0.1&quot;</span>);<br>      <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">connect</span>(s, &amp;name, <span class="hljs-number">16</span>) == <span class="hljs-number">-1</span> )<br>      &#123;<br>        v13 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot;connect failed: &quot;</span>, &amp;std::cerr);<br>        v14 = <span class="hljs-built_in">WSAGetLastError</span>();<br>        v15 = std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, a2, v14, v13);<br>        std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot;\n&quot;</span>, v15);<br>        <span class="hljs-built_in">closesocket</span>(s);<br>        <span class="hljs-built_in">WSACleanup</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        <span class="hljs-built_in">sub_140001760</span>(a1, a2, a4, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v35, v11, v12, v34[<span class="hljs-number">0</span>], v34[<span class="hljs-number">1</span>]);<br>        v19 = <span class="hljs-built_in">sub_1400087B0</span>(a1, a2, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v35, v17, v18, v34[<span class="hljs-number">0</span>]);<br>        v23 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)<span class="hljs-built_in">sub_1400087F0</span>(a1, a2, v20, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v35, v21, v22, v34[<span class="hljs-number">0</span>]);<br>        v37 = <span class="hljs-built_in">send</span>(s, v23, v19, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span> ( v37 == <span class="hljs-number">-1</span> )<br>        &#123;<br>          v24 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot;send failed: &quot;</span>, &amp;std::cerr);<br>          v25 = <span class="hljs-built_in">WSAGetLastError</span>();<br>          v26 = std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, a2, v25, v24);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          v27 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot;Sent &quot;</span>, &amp;std::cout);<br>          v28 = std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, a2, v37, v27);<br>          v29 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot; bytes: &quot;</span>, v28);<br>          v26 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">char</span>&gt;(a1, a2, v35, v29);<br>        &#125;<br>        std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot;\n&quot;</span>, v26);<br>        <span class="hljs-built_in">closesocket</span>(s);<br>        <span class="hljs-built_in">WSACleanup</span>();<br>        v7 = <span class="hljs-number">0</span>;<br>        <span class="hljs-built_in">sub_14000B400</span>(a1, a2, v30, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v35, v31, v32, v34[<span class="hljs-number">0</span>]);<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> v7;<br>&#125;<br></code></pre></td></tr></table></figure><p>回溯到上级函数，可以得到一个快700行代码的函数。代码量太大，人工分析很有难度，于是借助AI来分析大致逻辑。在关键地方加上注释后的函数如下</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">sub_140005769</span><span class="hljs-params">(__int64 a1, __int64 a2, _QWORD *a3, <span class="hljs-type">int</span> a4)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">char</span> v5; <span class="hljs-comment">// bl</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">char</span> v10; <span class="hljs-comment">// bl</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v13; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">char</span> v15; <span class="hljs-comment">// bl</span><br>  __int64 v16; <span class="hljs-comment">// rsi</span><br>  <span class="hljs-type">int</span> v17; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v18; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v19; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v20; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v21; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v22; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v23; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-type">int</span> v24; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v25; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v26; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v27; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v28; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v29; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v30; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v31; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v32; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v33; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v34; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v35; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v36; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v37; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v38; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v39; <span class="hljs-comment">// r9d</span><br>  __int64 v40; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v41; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v42; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v43; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v44; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v45; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v46; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v47; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v48; <span class="hljs-comment">// r9d</span><br>  __int64 v49; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v50; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v51; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v52; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v53; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v54; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v55; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v56; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v57; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v58; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v59; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v60; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v61; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v62; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v63; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v64; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v65; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v66; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v67; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v68; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v69; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v70; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v71; <span class="hljs-comment">// r9d</span><br>  __int64 v72; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">int</span> v73; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v74; <span class="hljs-comment">// r9d</span><br>  __int64 v75; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v76; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v77; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v78; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v79; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v80; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v81; <span class="hljs-comment">// r9d</span><br>  __int64 v82; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">int</span> v83; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v84; <span class="hljs-comment">// r9d</span><br>  __int64 v85; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v86; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v87; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v88; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v89; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v90; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v91; <span class="hljs-comment">// r9d</span><br>  __int64 v92; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">int</span> v93; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v94; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v95; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v96; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v97; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v98; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v99; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v100; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v101; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v102; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v103; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v104; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v105; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v106; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v107; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v108; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v109; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v110; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v111; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v112; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v113; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v114; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v115; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v116; <span class="hljs-comment">// r9d</span><br>  __int64 v117; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">int</span> v118; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v119; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v120; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v121; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v122; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">char</span> v123; <span class="hljs-comment">// r12</span><br>  <span class="hljs-type">char</span> v124; <span class="hljs-comment">// r13</span><br>  <span class="hljs-type">char</span> v125; <span class="hljs-comment">// r14</span><br>  <span class="hljs-type">char</span> v126; <span class="hljs-comment">// r15</span><br>  <span class="hljs-type">int</span> v127; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v128; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v129; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v130; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v131; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v132; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v133; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v134; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v135; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v136; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v137; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v138; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v139; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v140; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v141; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v142; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v143; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v144; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v145; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v146; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v147; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v148; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v149; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v150; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v151; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v152; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v153; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v154; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v155; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v156; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v157; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">char</span> v158; <span class="hljs-comment">// bl</span><br>  <span class="hljs-type">int</span> v159; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v160; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v161; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v162; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v163; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v164; <span class="hljs-comment">// r9d</span><br>  __int64 v165; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">int</span> v166; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v167; <span class="hljs-comment">// r9d</span><br>  __int64 v168; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v169; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v170; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v171; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v172; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v173; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v174; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v175; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v176; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v177; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v178; <span class="hljs-comment">// r9d</span><br>  __int64 v179; <span class="hljs-comment">// rdx</span><br>  __int64 v180; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">int</span> v181; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v182; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v183; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v184; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v185; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v186; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v187; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">char</span> v188; <span class="hljs-comment">// bl</span><br>  <span class="hljs-type">int</span> v189; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v190; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v191; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v192; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v193; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v194; <span class="hljs-comment">// r9d</span><br>  __int64 v195; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">int</span> v196; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v197; <span class="hljs-comment">// r9d</span><br>  __int64 v198; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v199; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v200; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v201; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v202; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v203; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v204; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v205; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v206; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v207; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v208; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v209; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v210; <span class="hljs-comment">// r9d</span><br>  __int64 v211; <span class="hljs-comment">// rdx</span><br>  __int64 v212; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">int</span> v213; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v214; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v215; <span class="hljs-comment">// r9d</span><br>  __int64 v216; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">int</span> v217; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v218; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v219; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v220; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v221; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v222; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v223; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v224; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v225; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v226; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v227; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v228; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v229; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v230; <span class="hljs-comment">// r9d</span><br>  __int64 v232; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v233; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v234; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v235; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v236; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v237; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v238; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v239; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v240; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v241; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v242; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v243; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v244; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v245; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v246; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v247; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v248; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v249; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v250; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v251; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v252; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v253; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v254; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v255; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v256; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v257; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v258; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v259; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v260; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v261; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v262; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v263; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v264; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v265; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v266; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v267; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v268; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v269; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v270; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v271; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v272; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v273; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v274; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v275; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v276; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v277; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v278; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v279; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v280; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v281; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v282; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v283; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  HCRYPTKEY v284; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v285; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v286; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v287; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v288; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v289; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v290; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v291; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v292; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v293; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v294; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v295; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  HCRYPTKEY v296; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v297; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v298; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v299; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v300; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v301; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v302; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v303; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v304; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v305; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v306; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v307; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v308; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v309; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v310; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v311; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v312; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v313; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v314; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v315; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v316; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v317; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v318; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v319; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v320; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v321; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v322; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v323; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v324; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v325; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v326; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v327; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v328; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v329; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v330; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v331; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v332; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v333; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v334; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v335; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v336; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v337; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v338; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v339; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  <span class="hljs-type">int</span> v340; <span class="hljs-comment">// [rsp+10h] [rbp-70h]</span><br>  <span class="hljs-type">int</span> v341; <span class="hljs-comment">// [rsp+10h] [rbp-70h]</span><br>  __int64 v342; <span class="hljs-comment">// [rsp+10h] [rbp-70h]</span><br>  <span class="hljs-type">int</span> v343; <span class="hljs-comment">// [rsp+10h] [rbp-70h]</span><br>  <span class="hljs-type">int</span> v344; <span class="hljs-comment">// [rsp+10h] [rbp-70h]</span><br>  __int64 v345; <span class="hljs-comment">// [rsp+10h] [rbp-70h]</span><br>  <span class="hljs-type">char</span> v346; <span class="hljs-comment">// [rsp+30h] [rbp-50h]</span><br>  <span class="hljs-type">char</span> v347; <span class="hljs-comment">// [rsp+38h] [rbp-48h]</span><br>  _BYTE v348[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-40h] BYREF</span><br>  _BYTE v349[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+70h] [rbp-10h] BYREF</span><br>  <span class="hljs-type">int</span> v350[<span class="hljs-number">124</span>]; <span class="hljs-comment">// [rsp+A0h] [rbp+20h] BYREF</span><br>  <span class="hljs-type">int</span> v351[<span class="hljs-number">124</span>]; <span class="hljs-comment">// [rsp+290h] [rbp+210h] BYREF</span><br>  _BYTE v352[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+480h] [rbp+400h] BYREF</span><br>  _BYTE v353[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+490h] [rbp+410h] BYREF</span><br>  BYTE v354[<span class="hljs-number">28</span>]; <span class="hljs-comment">// [rsp+4A0h] [rbp+420h] BYREF</span><br>  BYTE v355[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+4BCh] [rbp+43Ch] BYREF</span><br>  BYTE pbData[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+4C0h] [rbp+440h] BYREF</span><br>  __int16 v357; <span class="hljs-comment">// [rsp+4C2h] [rbp+442h]</span><br>  <span class="hljs-type">int</span> v358; <span class="hljs-comment">// [rsp+4C4h] [rbp+444h]</span><br>  <span class="hljs-type">int</span> v359; <span class="hljs-comment">// [rsp+4C8h] [rbp+448h]</span><br>  __int64 v360; <span class="hljs-comment">// [rsp+4CCh] [rbp+44Ch]</span><br>  __int64 v361; <span class="hljs-comment">// [rsp+4D4h] [rbp+454h]</span><br>  __int64 v362; <span class="hljs-comment">// [rsp+4DCh] [rbp+45Ch]</span><br>  __int64 v363; <span class="hljs-comment">// [rsp+4E4h] [rbp+464h]</span><br>  _BYTE IV[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+4F0h] [rbp+470h] BYREF IV</span><br>  _BYTE key[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+510h] [rbp+490h] BYREF 密钥</span><br>  BYTE MODE[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+530h] [rbp+4B0h] BYREF 模式参数</span><br>  BYTE v367[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+550h] [rbp+4D0h] BYREF</span><br>  BYTE pbBuffer[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+560h] [rbp+4E0h] BYREF</span><br>  __int64 v369; <span class="hljs-comment">// [rsp+568h] [rbp+4E8h]</span><br>  __int64 v370; <span class="hljs-comment">// [rsp+570h] [rbp+4F0h]</span><br>  __int64 v371; <span class="hljs-comment">// [rsp+578h] [rbp+4F8h]</span><br>  HCRYPTKEY hKey; <span class="hljs-comment">// [rsp+588h] [rbp+508h] BYREF</span><br>  HCRYPTPROV phProv; <span class="hljs-comment">// [rsp+590h] [rbp+510h] BYREF</span><br>  <span class="hljs-type">char</span> v374; <span class="hljs-comment">// [rsp+59Ah] [rbp+51Ah] BYREF</span><br>  <span class="hljs-type">char</span> v375; <span class="hljs-comment">// [rsp+59Bh] [rbp+51Bh] BYREF</span><br>  <span class="hljs-type">char</span> v376; <span class="hljs-comment">// [rsp+59Ch] [rbp+51Ch] BYREF</span><br>  <span class="hljs-type">char</span> v377; <span class="hljs-comment">// [rsp+59Dh] [rbp+51Dh] BYREF</span><br>  <span class="hljs-type">char</span> v378; <span class="hljs-comment">// [rsp+59Eh] [rbp+51Eh] BYREF</span><br>  <span class="hljs-type">char</span> v379; <span class="hljs-comment">// [rsp+59Fh] [rbp+51Fh] BYREF</span><br>  _BYTE v380[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+5A0h] [rbp+520h] BYREF</span><br>  _BYTE v381[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+5C0h] [rbp+540h] BYREF</span><br>  _BYTE v382[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+5E0h] [rbp+560h] BYREF</span><br>  _BYTE v383[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+600h] [rbp+580h] BYREF</span><br>  _BYTE v384[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+610h] [rbp+590h] BYREF</span><br>  _BYTE v385[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+630h] [rbp+5B0h] BYREF</span><br>  _BYTE v386[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+640h] [rbp+5C0h] BYREF</span><br>  _BYTE v387[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+650h] [rbp+5D0h] BYREF</span><br>  _BYTE v388[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+660h] [rbp+5E0h] BYREF</span><br>  _BYTE v389[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+670h] [rbp+5F0h] BYREF</span><br>  _BYTE v390[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+680h] [rbp+600h] BYREF</span><br>  _BYTE v391[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+6A0h] [rbp+620h] BYREF</span><br>  _BYTE v392[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+6B0h] [rbp+630h] BYREF</span><br>  _BYTE v393[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+6D0h] [rbp+650h] BYREF</span><br>  _BYTE v394[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+6E0h] [rbp+660h] BYREF</span><br>  _BYTE v395[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+710h] [rbp+690h] BYREF</span><br>  _BYTE v396[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+720h] [rbp+6A0h] BYREF</span><br>  _BYTE v397[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+730h] [rbp+6B0h] BYREF</span><br>  _BYTE v398[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+750h] [rbp+6D0h] BYREF</span><br>  _BYTE v399[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+780h] [rbp+700h] BYREF</span><br>  _BYTE v400[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+7A0h] [rbp+720h] BYREF</span><br>  _BYTE v401[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+7D0h] [rbp+750h] BYREF</span><br>  _BYTE v402[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+7F0h] [rbp+770h] BYREF</span><br>  _BYTE v403[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+820h] [rbp+7A0h] BYREF</span><br>  _BYTE v404[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+840h] [rbp+7C0h] BYREF</span><br>  _BYTE v405[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+870h] [rbp+7F0h] BYREF</span><br>  _BYTE v406[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+890h] [rbp+810h] BYREF</span><br>  _BYTE v407[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+8C0h] [rbp+840h] BYREF</span><br>  _BYTE v408[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+8E0h] [rbp+860h] BYREF</span><br>  _BYTE v409[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+900h] [rbp+880h] BYREF</span><br>  _BYTE v410[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+930h] [rbp+8B0h] BYREF</span><br>  _BYTE v411[<span class="hljs-number">40</span>]; <span class="hljs-comment">// [rsp+950h] [rbp+8D0h] BYREF</span><br>  <span class="hljs-type">char</span> *v412; <span class="hljs-comment">// [rsp+978h] [rbp+8F8h]</span><br>  <span class="hljs-type">char</span> *v413; <span class="hljs-comment">// [rsp+980h] [rbp+900h]</span><br>  <span class="hljs-type">char</span> *v414; <span class="hljs-comment">// [rsp+988h] [rbp+908h]</span><br>  <span class="hljs-type">char</span> *v415; <span class="hljs-comment">// [rsp+990h] [rbp+910h]</span><br>  <span class="hljs-type">char</span> *v416; <span class="hljs-comment">// [rsp+998h] [rbp+918h]</span><br>  <span class="hljs-type">char</span> *v417; <span class="hljs-comment">// [rsp+9A0h] [rbp+920h]</span><br>  __int64 v418; <span class="hljs-comment">// [rsp+9A8h] [rbp+928h]</span><br>  BYTE *v419; <span class="hljs-comment">// [rsp+9B0h] [rbp+930h]</span><br>  <span class="hljs-type">char</span> v420; <span class="hljs-comment">// [rsp+9BFh] [rbp+93Fh]</span><br><br>  <span class="hljs-built_in">sub_140006CC0</span>();<br>  v420 = <span class="hljs-number">0</span>;<br>  v5 = <span class="hljs-number">0</span>;<br>  v6 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> ( a4 &lt;= <span class="hljs-number">1</span> )                                <span class="hljs-comment">// 此处开始解析命令行参数，这是第一个参数的处理</span><br>  &#123;<br>    v416 = &amp;v375;<br>    v6 = <span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">sub_14000B350</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;unk_<span class="hljs-number">14000E1</span>D0, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)MODE, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v375, v4);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v417 = &amp;v374;<br>    v5 = <span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">sub_14000B350</span>(a1, <span class="hljs-number">0</span>, a3[<span class="hljs-number">1</span>], (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)MODE, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v374, v4);<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( (_BYTE)v6 )<br>    <span class="hljs-built_in">sub_140009C30</span>(a1, v6, v7, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v375, v8, v9);<br>  <span class="hljs-keyword">if</span> ( v5 )<br>    <span class="hljs-built_in">sub_140009C30</span>(a1, v6, v7, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v374, v8, v9);<br>  v10 = <span class="hljs-number">0</span>;<br>  v11 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> ( a4 &lt;= <span class="hljs-number">2</span> )                                <span class="hljs-comment">// 这是第二个参数的处理</span><br>  &#123;<br>    v414 = &amp;v377;<br>    v11 = <span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">sub_14000B350</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;unk_<span class="hljs-number">14000E1</span>D0, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)key, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v377, v9);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v415 = &amp;v376;<br>    v10 = <span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">sub_14000B350</span>(a1, <span class="hljs-number">0</span>, a3[<span class="hljs-number">2</span>], (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)key, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v376, v9);<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( (_BYTE)v11 )<br>    <span class="hljs-built_in">sub_140009C30</span>(a1, v11, v12, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v377, v13, v14);<br>  <span class="hljs-keyword">if</span> ( v10 )<br>    <span class="hljs-built_in">sub_140009C30</span>(a1, v11, v12, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v376, v13, v14);<br>  v15 = <span class="hljs-number">0</span>;<br>  v16 = <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( a4 &lt;= <span class="hljs-number">3</span> )                                <span class="hljs-comment">// 这是第三个参数的处理</span><br>  &#123;<br>    v412 = &amp;v379;<br>    v16 = <span class="hljs-number">1LL</span>;<br>    <span class="hljs-built_in">sub_14000B350</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;unk_<span class="hljs-number">14000E1</span>D0, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)IV, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v379, v14);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v413 = &amp;v378;<br>    v15 = <span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">sub_14000B350</span>(a1, <span class="hljs-number">0</span>, a3[<span class="hljs-number">3</span>], (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)IV, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v378, v14);<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( (_BYTE)v16 )<br>    <span class="hljs-built_in">sub_140009C30</span>(a1, v16, v17, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v379, v18, v19);<br>  <span class="hljs-keyword">if</span> ( v15 )<br>    <span class="hljs-built_in">sub_140009C30</span>(a1, v16, v17, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v378, v18, v19);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">CryptAcquireContextA</span>(&amp;phProv, <span class="hljs-number">0LL</span>, <span class="hljs-number">0LL</span>, <span class="hljs-number">0x18u</span>, <span class="hljs-number">0xF0000000</span>) )<span class="hljs-comment">// 使用Microsoft CryptoAPI，0X18表示PROV_RSA_AES，程序使用RSA加密密钥和IV发送到服务器</span><br>  &#123;<br>    <span class="hljs-keyword">if</span> ( a4 &lt;= <span class="hljs-number">3</span> )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">CryptGenRandom</span>(phProv, <span class="hljs-number">0x20u</span>, pbBuffer) )<span class="hljs-comment">// 生成32字节随机密钥</span><br>      &#123;<br>        v23 = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">goto</span> LABEL_63;<br>      &#125;<br>      <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">CryptGenRandom</span>(phProv, <span class="hljs-number">0x10u</span>, v367) )<span class="hljs-comment">// 生成16字节随机IV</span><br>      &#123;<br>        v23 = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">goto</span> LABEL_63;<br>      &#125;<br>      <span class="hljs-built_in">sub_1400028FE</span>(a1, v16, (__int64)pbBuffer, (__int64)v387, <span class="hljs-number">32</span>);<br>      <span class="hljs-built_in">sub_140005071</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v387, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v386, v56, v57, v232, v308);<span class="hljs-comment">// 疑似加密函数</span><br>      <span class="hljs-built_in">sub_140003D46</span>(a1, v16, <span class="hljs-number">0x1F90u</span>, (<span class="hljs-type">int</span>)v386);<span class="hljs-comment">// 疑似网络通信的函数</span><br>      <span class="hljs-built_in">sub_1400029A2</span>(a1, v16, v58, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v386, v59, v60, v243);<br>      <span class="hljs-built_in">sub_1400029A2</span>(a1, v16, v61, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v387, v62, v63, v244);<br>      <span class="hljs-built_in">sub_1400028FE</span>(a1, v16, (__int64)v367, (__int64)v389, <span class="hljs-number">16</span>);<br>      <span class="hljs-built_in">sub_140005071</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v389, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v388, v64, v65, v245, v309);<br>      <span class="hljs-built_in">sub_140003D46</span>(a1, v16, <span class="hljs-number">0x1F90u</span>, (<span class="hljs-type">int</span>)v388);<br>      <span class="hljs-built_in">sub_1400029A2</span>(a1, v16, v66, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v388, v67, v68, v246);<br>      <span class="hljs-built_in">sub_1400029A2</span>(a1, v16, v69, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v389, v70, v71, v247);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">sub_14000C650</span>(a1, v16, (<span class="hljs-type">int</span>)<span class="hljs-string">&quot;-d&quot;</span>, (<span class="hljs-type">int</span>)MODE, v21, v22) )<br>        v420 = <span class="hljs-number">1</span>;                               <span class="hljs-comment">// 命令行参数包含&quot;-d&quot;的时候，v449被设为1，进入解密模式</span><br>      <span class="hljs-built_in">sub_14000B130</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)key, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v380, v24, v25, v232, v303);<span class="hljs-comment">// 从命令行获取key</span><br>      <span class="hljs-built_in">sub_1400051EC</span>(a1, v16, (__int64)pbBuffer, (<span class="hljs-type">int</span>)v380, v26, v27);<span class="hljs-comment">// 处理key</span><br>      <span class="hljs-built_in">sub_14000B400</span>(a1, v16, v28, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v380, v29, v30, v233);<br>      <span class="hljs-built_in">sub_14000B130</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)IV, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v381, v31, v32, v234, v304);<span class="hljs-comment">// 从命令行获取IV</span><br>      <span class="hljs-built_in">sub_1400051EC</span>(a1, v16, (__int64)v367, (<span class="hljs-type">int</span>)v381, v33, v34);<span class="hljs-comment">// 处理IV</span><br>      <span class="hljs-built_in">sub_14000B400</span>(a1, v16, v35, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v381, v36, v37, v235);<br>      <span class="hljs-built_in">sub_1400028FE</span>(a1, v16, (__int64)pbBuffer, (__int64)v383, <span class="hljs-number">32</span>);<br>      <span class="hljs-built_in">sub_140001534</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v383, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v382, v38, v39, v236, v305);<br>      v40 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">char</span>&gt;(a1, v16, v382, &amp;std::cout);<br>      std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, v16, &amp;std::endl&lt;<span class="hljs-type">char</span>,std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;, v40);<br>      <span class="hljs-built_in">sub_14000B400</span>(a1, v16, v41, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v382, v42, v43, v237);<br>      <span class="hljs-built_in">sub_1400029A2</span>(a1, v16, v44, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v383, v45, v46, v238);<br>      <span class="hljs-built_in">sub_1400028FE</span>(a1, v16, (__int64)v367, (__int64)v385, <span class="hljs-number">16</span>);<br>      <span class="hljs-built_in">sub_140001534</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v385, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v384, v47, v48, v239, v306);<br>      v49 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">char</span>&gt;(a1, v16, v384, &amp;std::cout);<br>      std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, v16, &amp;std::endl&lt;<span class="hljs-type">char</span>,std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;, v49);<br>      <span class="hljs-built_in">sub_14000B400</span>(a1, v16, v50, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v384, v51, v52, v240);<br>      <span class="hljs-built_in">sub_1400029A2</span>(a1, v16, v53, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v385, v54, v55, v241);<br>    &#125;<br>    v72 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, v16, <span class="hljs-string">&quot;Key: &quot;</span>, &amp;std::cout);<br>    <span class="hljs-built_in">sub_1400028FE</span>(a1, v16, (__int64)pbBuffer, (__int64)v391, <span class="hljs-number">32</span>);<br>    <span class="hljs-built_in">sub_140001534</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v391, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v390, v73, v74, v242, v307);<br>    v75 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">char</span>&gt;(a1, v16, v390, v72);<br>    std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, v16, &amp;std::endl&lt;<span class="hljs-type">char</span>,std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;, v75);<br>    <span class="hljs-built_in">sub_14000B400</span>(a1, v16, v76, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v390, v77, v78, v248);<br>    <span class="hljs-built_in">sub_1400029A2</span>(a1, v16, v79, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v391, v80, v81, v249);<br>    v82 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, v16, <span class="hljs-string">&quot;IV: &quot;</span>, &amp;std::cout);<br>    <span class="hljs-built_in">sub_1400028FE</span>(a1, v16, (__int64)v367, (__int64)v393, <span class="hljs-number">16</span>);<br>    <span class="hljs-built_in">sub_140001534</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v393, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v392, v83, v84, v250, v310);<br>    v85 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">char</span>&gt;(a1, v16, v392, v82);<br>    std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, v16, &amp;std::endl&lt;<span class="hljs-type">char</span>,std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;, v85);<br>    <span class="hljs-built_in">sub_14000B400</span>(a1, v16, v86, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v392, v87, v88, v251);<br>    <span class="hljs-built_in">sub_1400029A2</span>(a1, v16, v89, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v393, v90, v91, v252);<br>    pbData[<span class="hljs-number">0</span>] = <span class="hljs-number">8</span>;<br>    pbData[<span class="hljs-number">1</span>] = <span class="hljs-number">2</span>;<br>    v357 = <span class="hljs-number">0</span>;<br>    v358 = <span class="hljs-number">26128</span>;<br>    v359 = <span class="hljs-number">32</span>;<br>    v360 = *(_QWORD *)pbBuffer;<br>    v361 = v369;<br>    v362 = v370;<br>    v363 = v371;<br>    *(_DWORD *)v355 = <span class="hljs-number">2</span>;<br>    <span class="hljs-built_in">CryptImportKey</span>(phProv, pbData, <span class="hljs-number">0x2Cu</span>, <span class="hljs-number">0LL</span>, <span class="hljs-number">0</span>, &amp;hKey);<span class="hljs-comment">// 导入密钥</span><br>    <span class="hljs-built_in">CryptSetKeyParam</span>(hKey, <span class="hljs-number">4u</span>, v355, <span class="hljs-number">0</span>);        <span class="hljs-comment">// 设置密钥参数</span><br>    <span class="hljs-built_in">CryptSetKeyParam</span>(hKey, <span class="hljs-number">1u</span>, v367, <span class="hljs-number">0</span>);        <span class="hljs-comment">// 设置IV</span><br>    std::filesystem::current_path[abi:cxx11](a1, v16, v92, v394);<span class="hljs-comment">// 获取当前路径</span><br>    <span class="hljs-built_in">sub_140008E50</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v394, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v354, v93, v94, v253, v311);<br>    v419 = v354;<br>    <span class="hljs-built_in">sub_1400091B0</span>(a1, v16, v95, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v394, v96, v97, v254);<br>    <span class="hljs-built_in">sub_140008E90</span>(a1, v16, (_DWORD)v419, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v395, v98, v99, v255, v312);<br>    <span class="hljs-built_in">sub_140009230</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v395, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v353, v100, v101, v256, v313);<br>    <span class="hljs-built_in">sub_140008EE0</span>(a1, v16, v102, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v395, v103, v104, v257);<br>    <span class="hljs-built_in">sub_140008E90</span>(a1, v16, (_DWORD)v419, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v396, v105, v106, v258, v314);<br>    <span class="hljs-built_in">sub_140008F00</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v396, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v352, v107, v108, v259, v315);<br>    <span class="hljs-built_in">sub_140008EE0</span>(a1, v16, v109, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v396, v110, v111, v260);<br>    <span class="hljs-keyword">while</span> ( (<span class="hljs-type">unsigned</span> __int8)<span class="hljs-built_in">sub_1400092E0</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v352, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v353, v112, v113, v261, v316) )<span class="hljs-comment">// 遍历当前路径下的所有文件</span><br>    &#123;<br>      v418 = std::filesystem::__cxx11::directory_iterator::<span class="hljs-keyword">operator</span>*(a1, v16, v216, v353);<br>      <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int8)<span class="hljs-built_in">sub_1400082F0</span>(a1, v16, v114, v418, v115, v116, v298) == <span class="hljs-number">1</span> )<br>      &#123;<br>        v120 = <span class="hljs-built_in">sub_140008320</span>(a1, v16, v117, v418, v118, v119, v261);<br>        <span class="hljs-built_in">sub_140009030</span>(a1, v16, v120, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, v121, v122, v262, v316);<br>        a1 = <span class="hljs-number">0LL</span>;<br>        v123 = <span class="hljs-number">0</span>;<br>        v124 = <span class="hljs-number">0</span>;<br>        v125 = <span class="hljs-number">0</span>;<br>        v126 = <span class="hljs-number">0</span>;<br>        v347 = <span class="hljs-number">0</span>;<br>        <span class="hljs-built_in">sub_140008440</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v398, v127, v128, v263, v317);<br>        <span class="hljs-built_in">sub_1400083D0</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v398, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v397, v129, v130, v264, v318);<br>        v16 = <span class="hljs-number">1LL</span>;<br>        <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int8)<span class="hljs-built_in">sub_14000C6D0</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">L&quot;.exe&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v397, v131, v132, v265, v319) )<span class="hljs-comment">// 跳过exe文件</span><br>          <span class="hljs-keyword">goto</span> LABEL_39;<br>        <span class="hljs-built_in">sub_140008440</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v400, v134, v135, v266, v316);<br>        a1 = <span class="hljs-number">1LL</span>;<br>        <span class="hljs-built_in">sub_1400083D0</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v400, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v399, v136, v137, v267, v320);<br>        v123 = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int8)<span class="hljs-built_in">sub_14000C6D0</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">&quot;.&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v399, v138, v139, v268, v321) )<br>          <span class="hljs-keyword">goto</span> LABEL_39;<br>        <span class="hljs-built_in">sub_140008440</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v402, v134, v135, v266, v316);<br>        v124 = <span class="hljs-number">1</span>;<br>        <span class="hljs-built_in">sub_1400083D0</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v402, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v401, v140, v141, v269, v322);<br>        v125 = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int8)<span class="hljs-built_in">sub_14000C6D0</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">L&quot;.dec&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v401, v142, v143, v270, v323)<span class="hljs-comment">// 跳过dec文件</span><br>          || (<span class="hljs-built_in">sub_140008440</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v404, v134, v135, v266, v316),<br>              v126 = <span class="hljs-number">1</span>,<br>              <span class="hljs-built_in">sub_1400083D0</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v404, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v403, v144, v145, v271, v324),<br>              v347 = <span class="hljs-number">1</span>,<br>              (<span class="hljs-type">unsigned</span> __int8)<span class="hljs-built_in">sub_14000C6D0</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">&quot;.&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v403, v146, v147, v272, v325)) )<span class="hljs-comment">// 跳过当前目录的.文件</span><br>        &#123;<br>LABEL_39:<br>          v346 = <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          v346 = <span class="hljs-number">0</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> ( v347 )<br>          <span class="hljs-built_in">sub_14000C290</span>(a1, <span class="hljs-number">1</span>, v133, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v403, v134, v135, v266);<br>        <span class="hljs-keyword">if</span> ( v126 )<br>          <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v133, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v404, v134, v135, v266);<br>        <span class="hljs-keyword">if</span> ( v125 )<br>          <span class="hljs-built_in">sub_14000C290</span>(a1, <span class="hljs-number">1</span>, v133, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v401, v134, v135, v266);<br>        <span class="hljs-keyword">if</span> ( v124 )<br>          <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v133, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v402, v134, v135, v266);<br>        <span class="hljs-keyword">if</span> ( v123 )<br>          <span class="hljs-built_in">sub_14000C290</span>(a1, <span class="hljs-number">1</span>, v133, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v399, v134, v135, v266);<br>        <span class="hljs-keyword">if</span> ( (_BYTE)a1 )<br>          <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v133, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v400, v134, v135, v266);<br>        <span class="hljs-built_in">sub_14000C290</span>(a1, <span class="hljs-number">1</span>, v133, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v397, v134, v135, v266);<br>        <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v148, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v398, v149, v150, v273);<br>        <span class="hljs-keyword">if</span> ( !v346 )<br>        &#123;<br>          <span class="hljs-keyword">if</span> ( v420 != <span class="hljs-number">1</span> )                      <span class="hljs-comment">// 加密模式</span><br>          &#123;<br>            <span class="hljs-built_in">sub_140008440</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v406, v152, v153, v274, v316);<br>            <span class="hljs-built_in">sub_1400083D0</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v406, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v405, v154, v155, v275, v326);<br>            v158 = <span class="hljs-built_in">sub_14000C6D0</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">&quot;.&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v405, v156, v157, v276, v327);<br>            <span class="hljs-built_in">sub_14000C290</span>(a1, <span class="hljs-number">1</span>, v159, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v405, v160, v161, v277);<br>            <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v162, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v406, v163, v164, v278);<br>            <span class="hljs-keyword">if</span> ( !v158 )<br>            &#123;<br>              v165 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">wchar_t</span>,std::char_traits&lt;<span class="hljs-type">wchar_t</span>&gt;&gt;(a1, <span class="hljs-number">1LL</span>, <span class="hljs-string">L&quot;Encrypting file: &quot;</span>, &amp;std::wcout);<br>              <span class="hljs-built_in">sub_1400083D0</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v407, v166, v167, v274, v316);<br>              v168 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">wchar_t</span>&gt;(a1, <span class="hljs-number">1LL</span>, v407, v165);<br>              std::wostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, <span class="hljs-number">1LL</span>, &amp;std::endl&lt;<span class="hljs-type">wchar_t</span>,std::char_traits&lt;<span class="hljs-type">wchar_t</span>&gt;&gt;, v168);<br>              <span class="hljs-built_in">sub_14000C290</span>(a1, <span class="hljs-number">1</span>, v169, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v407, v170, v171, v279);<br>              <span class="hljs-built_in">sub_140009030</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v349, v172, v173, v280, v328);<br>              <span class="hljs-built_in">sub_1400091E0</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">&quot;.&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v349, v174, v175, v281, v329);<br>              <span class="hljs-built_in">sub_140009B20</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v351, <span class="hljs-number">4</span>, v176, v282, v330, v340);<span class="hljs-comment">// 读取输入文件</span><br>              <span class="hljs-built_in">sub_140009B60</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v349, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v350, <span class="hljs-number">4</span>, v177, v283, v331, v341);<span class="hljs-comment">// 准备输出文件</span><br>              <span class="hljs-built_in">sub_1400052D0</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">int</span>)v351, hKey, (<span class="hljs-type">int</span>)v350, v178, v284, v332, v342);<span class="hljs-comment">// 执行加密</span><br>              std::ofstream::~<span class="hljs-built_in">ofstream</span>(a1, <span class="hljs-number">1LL</span>, v179, v350);<br>              std::ifstream::~ifstream(a1, <span class="hljs-number">1LL</span>, v180, v351);<br>              <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v181, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v349, v182, v183, v285);<br>            &#125;<br>          &#125;<br>          <span class="hljs-keyword">else</span>                                  <span class="hljs-comment">// 解密模式</span><br>          &#123;<br>            <span class="hljs-built_in">sub_140008440</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v409, v152, v153, v274, v316);<br>            <span class="hljs-built_in">sub_1400083D0</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v409, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v408, v184, v185, v286, v333);<br>            v188 = <span class="hljs-built_in">sub_14000C750</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">&quot;.&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v408, v186, v187, v287, v334);<br>            <span class="hljs-built_in">sub_14000C290</span>(a1, <span class="hljs-number">1</span>, v189, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v408, v190, v191, v288);<br>            <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v192, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v409, v193, v194, v289);<br>            <span class="hljs-keyword">if</span> ( !v188 )<br>            &#123;<br>              v195 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">wchar_t</span>,std::char_traits&lt;<span class="hljs-type">wchar_t</span>&gt;&gt;(a1, <span class="hljs-number">1LL</span>, <span class="hljs-string">L&quot;Decrypting file: &quot;</span>, &amp;std::wcout);<br>              <span class="hljs-built_in">sub_1400083D0</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v410, v196, v197, v274, v316);<br>              v198 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">wchar_t</span>&gt;(a1, <span class="hljs-number">1LL</span>, v410, v195);<br>              std::wostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, <span class="hljs-number">1LL</span>, &amp;std::endl&lt;<span class="hljs-type">wchar_t</span>,std::char_traits&lt;<span class="hljs-type">wchar_t</span>&gt;&gt;, v198);<br>              <span class="hljs-built_in">sub_14000C290</span>(a1, <span class="hljs-number">1</span>, v199, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v410, v200, v201, v290);<br>              <span class="hljs-built_in">sub_140009030</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v349, v202, v203, v291, v335);<br>              <span class="hljs-built_in">sub_1400090C0</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">L&quot;dec&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v411, <span class="hljs-number">2</span>, v204, v292, v336, v340);<br>              std::filesystem::__cxx11::path::<span class="hljs-built_in">replace_extension</span>(<br>                (std::filesystem::__cxx11::path *)a1,<br>                (<span class="hljs-type">const</span> std::filesystem::__cxx11::path *)<span class="hljs-number">1</span>);<br>              <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v205, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v411, v206, v207, v293);<br>              <span class="hljs-built_in">sub_140009B20</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v351, <span class="hljs-number">4</span>, v208, v294, v337, v343);<span class="hljs-comment">// 读取加密文件</span><br>              <span class="hljs-built_in">sub_140009B60</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v349, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v350, <span class="hljs-number">4</span>, v209, v295, v338, v344);<span class="hljs-comment">// 准备输出文件</span><br>              <span class="hljs-built_in">sub_140005522</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">int</span>)v351, hKey, (<span class="hljs-type">int</span>)v350, v210, v296, v339, v345);<span class="hljs-comment">// 执行解密</span><br>              std::ofstream::~<span class="hljs-built_in">ofstream</span>(a1, <span class="hljs-number">1LL</span>, v211, v350);<br>              std::ifstream::~ifstream(a1, <span class="hljs-number">1LL</span>, v212, v351);<br>              <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v213, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v349, v214, v215, v297);<br>            &#125;<br>          &#125;<br>        &#125;<br>        <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v151, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, v152, v153, v274);<br>      &#125;<br>      std::filesystem::__cxx11::directory_iterator::<span class="hljs-keyword">operator</span>++(a1, v16, v117, v353);<br>    &#125;<br>    <span class="hljs-built_in">sub_140008EE0</span>(a1, v16, v216, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v352, v217, v218, v298);<br>    <span class="hljs-built_in">sub_140008EE0</span>(a1, v16, v219, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v353, v220, v221, v299);<br>    <span class="hljs-built_in">sub_140008EE0</span>(a1, v16, v222, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v354, v223, v224, v300);<br>    <span class="hljs-built_in">CryptDestroyKey</span>(hKey);<br>    <span class="hljs-built_in">CryptReleaseContext</span>(phProv, <span class="hljs-number">0</span>);<br>    v23 = <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v23 = <span class="hljs-number">1</span>;<br>  &#125;<br>LABEL_63:<br>  <span class="hljs-built_in">sub_14000B400</span>(a1, v16, v20, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)IV, v21, v22, v232);<br>  <span class="hljs-built_in">sub_14000B400</span>(a1, v16, v225, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)key, v226, v227, v301);<br>  <span class="hljs-built_in">sub_14000B400</span>(a1, v16, v228, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)MODE, v229, v230, v302);<br>  <span class="hljs-keyword">return</span> v23;<br>&#125;<br></code></pre></td></tr></table></figure><p>下面是疑似的加密函数的内容</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">sub_140005071</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2, <span class="hljs-type">int</span> a3, __int64 a4, __int64 a5, <span class="hljs-type">int</span> a6)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v13; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v15; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v16; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v17; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v18; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v19; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v20; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v21; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v22; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v23; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v24; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v25; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v26; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v27; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v28; <span class="hljs-comment">// r9d</span><br>  __int64 v30; <span class="hljs-comment">// [rsp+0h] [rbp-B0h] BYREF</span><br>  __int64 v31; <span class="hljs-comment">// [rsp+8h] [rbp-A8h]</span><br>  __int64 v32; <span class="hljs-comment">// [rsp+10h] [rbp-A0h]</span><br>  __int64 v33; <span class="hljs-comment">// [rsp+18h] [rbp-98h]</span><br>  _BYTE v34[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-90h] BYREF</span><br>  _BYTE v35[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-80h] BYREF</span><br>  _BYTE v36[<span class="hljs-number">47</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-70h] BYREF</span><br>  <span class="hljs-type">char</span> v37; <span class="hljs-comment">// [rsp+6Fh] [rbp-41h] BYREF</span><br>  _BYTE v38[<span class="hljs-number">47</span>]; <span class="hljs-comment">// [rsp+70h] [rbp-40h] BYREF</span><br>  <span class="hljs-type">char</span> v39; <span class="hljs-comment">// [rsp+9Fh] [rbp-11h] BYREF</span><br>  <span class="hljs-type">char</span> *v40; <span class="hljs-comment">// [rsp+A0h] [rbp-10h]</span><br>  <span class="hljs-type">char</span> *v41; <span class="hljs-comment">// [rsp+A8h] [rbp-8h]</span><br><br>  v41 = (<span class="hljs-type">char</span> *)&amp;v30 + <span class="hljs-number">111</span>;<br>  <span class="hljs-built_in">sub_14000B350</span>(<br>    a1,<br>    a2,<br>    (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">&quot;1294787702630841806287693875819503767329411267154281759595683996937344294354199&quot;</span>,<br>    (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(&amp;v30 - <span class="hljs-number">14</span>) + <span class="hljs-number">176</span>,<br>    (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v30 - <span class="hljs-number">65</span> + <span class="hljs-number">176</span>,<br>    a6);<br>  <span class="hljs-built_in">sub_1400024EE</span>(a1, a2, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v36, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v35, v6, v7, v30, v31);<br>  <span class="hljs-built_in">sub_14000B400</span>(a1, a2, v8, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v36, v9, v10, v30);<br>  <span class="hljs-built_in">sub_140009C30</span>(a1, a2, v11, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v37, v12, v13);<br>  v40 = &amp;v39;<br>  <span class="hljs-built_in">sub_14000B350</span>(a1, a2, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">&quot;65537&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v38, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v39, v14);<span class="hljs-comment">// 65537是典型RSA加密的特征，因此推测此函数为RSA加密</span><br>  <span class="hljs-built_in">sub_1400024EE</span>(a1, a2, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v38, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v34, v15, v16, v30, v31);<br>  <span class="hljs-built_in">sub_14000B400</span>(a1, a2, v17, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v38, v18, v19, v30);<br>  <span class="hljs-built_in">sub_140009C30</span>(a1, a2, v20, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v39, v21, v22);<br>  <span class="hljs-built_in">sub_1400031A0</span>(a1, a2, a3, a4, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v34, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v35, v30, v31, v32, v33);<br>  <span class="hljs-built_in">sub_1400029A2</span>(a1, a2, v23, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v34, v24, v25, v30);<br>  <span class="hljs-built_in">sub_1400029A2</span>(a1, a2, v26, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v35, v27, v28, v30);<br>  <span class="hljs-keyword">return</span> a4;<br>&#125;<br></code></pre></td></tr></table></figure><p>可以得到如下的印象点：</p><ul><li>程序通过参数个数判断使用加密模式还是解密模式；</li><li>程序在加密模式下会遍历同一路径下的文件并进行加密，输出.enc文件，同时程序会将加密使用的key和IV进行RSA加密后发送到服务器（此外由于网络通信函数出现了127.0.0.1，推测是本地服务器）；</li><li>程序在解密模式下只需要使用Int.exe -d key IV就可以解密文件。</li></ul><p>结合附件的形式（附件包含一个流量包），可以推测本题的突破口在于分析流量包提取出RSA加密后的key和IV，然后就可以解密出key和IV，使用程序自带的解密功能解密文件。</p><p>安全起见，第一步先验证猜想。借助AI搭建一个本地服务器来接收程序的通信数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 本地服务器脚本</span><br><span class="hljs-comment"># fake_server.py</span><br><span class="hljs-keyword">import</span> socket<br>sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>sock.bind((<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-number">8080</span>))<br>sock.listen(<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Listening on 127.0.0.1:8080...&quot;</span>)<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    conn, addr = sock.accept()<br>    data = conn.recv(<span class="hljs-number">1024</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Received <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(data)&#125;</span> bytes: <span class="hljs-subst">&#123;data.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br>    conn.close()<br></code></pre></td></tr></table></figure><p>启用服务器后，通过命令行运行Int.exe可以看到本次加密使用的key和IV，以及发送的十进制数据</p><p><img src="/../images/image-20251123115352743.png" alt="运行Int.exe"></p><p>服务器会接收到如下数据（服务器接收的数据是发送的数据的十六进制形式）</p><p><img src="/../images/image-20251123115421535.png" alt="服务器接收到的数据"></p><p><img src="/../images/image-20251123115509065.png" alt="服务器接收的第一个数据hex解码后和发送的第一个数据对应上了"></p><p>然后参考<a href="https://www.freebuf.com/articles/people/166049.html">RSA加密解密原理深度剖析</a>可以写出一个脚本来解密</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-comment">#求解d</span><br>p =gmpy2.mpz(<span class="hljs-number">973424135910675582062565817184635606523</span>)<br>q =gmpy2.mpz( <span class="hljs-number">1330137249390799512563582841814876337813</span>)<br>e =gmpy2.mpz(<span class="hljs-number">65537</span>)<br>phi_n= (p - <span class="hljs-number">1</span>) * (q - <span class="hljs-number">1</span>)<br>d = gmpy2.invert(e, phi_n)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;d is:&quot;</span>)<br><span class="hljs-built_in">print</span> (d)<br><br><span class="hljs-comment">#解密key和IV</span><br>n = gmpy2.mpz(<span class="hljs-number">1294787702630841806287693875819503767329411267154281759595683996937344294354199</span>)<br><span class="hljs-comment">#key_raw是服务器接收的第一个数据，即key加密数据的十六进制数据流</span><br>key_raw=<span class="hljs-string">&quot;31323532333634383535303738343134373534303233363633363831313039303038333936313636303538303434333331323331383735303239343634393636353236373133353939343233363539&quot;</span><br><span class="hljs-comment">#iv_raw是服务器接收的第二个数据，即iv加密数据的十六进制数据流</span><br>iv_raw=<span class="hljs-string">&quot;393235323537333232303933353132333132353838343232323434353732343930303235353236393838363134393132323438313237363234363634333434323034333234353839393230383333&quot;</span><br><span class="hljs-comment">#十六进制解码</span><br>key_hexdec=<span class="hljs-built_in">bytes</span>.fromhex(key_raw)<br>iv_hexdec=<span class="hljs-built_in">bytes</span>.fromhex(iv_raw)<br><br>key_enc = gmpy2.mpz(key_hexdec)<br>IV_enc = gmpy2.mpz(iv_hexdec)<br><br><span class="hljs-comment">#RSA解密</span><br>key_dec = <span class="hljs-built_in">pow</span>(key_enc, d, n)<br>IV_dec = <span class="hljs-built_in">pow</span>(IV_enc, d, n)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;key (hex):&quot;</span>, <span class="hljs-built_in">hex</span>(key_dec))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;IV (hex):&quot;</span>, <span class="hljs-built_in">hex</span>(IV_dec))<br></code></pre></td></tr></table></figure><p>运行解密脚本得到如下，key和iv与Int.exe的输出一致</p><p><img src="/../images/image-20251123120534447.png" alt="运行解密脚本"></p><p>至此，可以确定发送的数据为key和IV的RSA加密结果，服务器接收的数据是加密结果的十六进制编码数据。</p><p>接下来分析流量包提取加密数据流（需要用到WireShark）。由于程序将数据发送到本地8080端口，且数据长度大约为78bytes，根据这个特征可以筛选出key和IV的流量</p><p><img src="/../images/image-20251123121110864.png" alt="key的流量"></p><p><img src="/../images/image-20251123121217193.png" alt="IV的流量"></p><p>将找到的两串数据复制到脚本的key_raw和iv_raw，可以解密出key和IV</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-comment">#求解d</span><br>p =gmpy2.mpz(<span class="hljs-number">973424135910675582062565817184635606523</span>)<br>q =gmpy2.mpz( <span class="hljs-number">1330137249390799512563582841814876337813</span>)<br>e =gmpy2.mpz(<span class="hljs-number">65537</span>)<br>phi_n= (p - <span class="hljs-number">1</span>) * (q - <span class="hljs-number">1</span>)<br>d = gmpy2.invert(e, phi_n)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;d is:&quot;</span>)<br><span class="hljs-built_in">print</span> (d)<br><br><span class="hljs-comment">#解密key和IV</span><br>n = gmpy2.mpz(<span class="hljs-number">1294787702630841806287693875819503767329411267154281759595683996937344294354199</span>)<br><span class="hljs-comment">#key_raw是服务器接收的第一个数据，即key加密数据的十六进制数据流</span><br>key_raw=<span class="hljs-string">&quot;393430353632303933303434363731383332313634363031353936303437303036303837353338373330383137373132363136313931393431323130333436353936333530353534323336333632&quot;</span><br><span class="hljs-comment">#iv_raw是服务器接收的第二个数据，即iv加密数据的十六进制数据流</span><br>iv_raw=<span class="hljs-string">&quot;323636373435303139343936383836343938363534323735373736393036303037343539343139323635373931333033373337353137333038363234343631363938313438363430393939363639&quot;</span><br><span class="hljs-comment">#十六进制解码</span><br>key_hexdec=<span class="hljs-built_in">bytes</span>.fromhex(key_raw)<br>iv_hexdec=<span class="hljs-built_in">bytes</span>.fromhex(iv_raw)<br><br>key_enc = gmpy2.mpz(key_hexdec)<br>IV_enc = gmpy2.mpz(iv_hexdec)<br><br><span class="hljs-comment">#RSA解密</span><br>key_dec = <span class="hljs-built_in">pow</span>(key_enc, d, n)<br>IV_dec = <span class="hljs-built_in">pow</span>(IV_enc, d, n)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;key (hex):&quot;</span>, <span class="hljs-built_in">hex</span>(key_dec))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;IV (hex):&quot;</span>, <span class="hljs-built_in">hex</span>(IV_dec))<br></code></pre></td></tr></table></figure><p><img src="/../images/image-20251123121642123.png" alt="解密结果"></p><p>然后就可以使用Int.exe -d key iv解密文件了（注意key和IV不要带0x）</p><p><img src="/../images/image-20251123121901277.png" alt="使用解密模式"></p><p><img src="/../images/image-20251123121954674.png" alt="解密出来的文件"></p><p>打开txt.dec文件就可以找到flag了</p><p><img src="/../images/image-20251123122045460.png" alt="txt.dec文件"></p></li></ul><blockquote><p>flag：0xGame{I_4m_3o_S1eepy_(´～&#96;)zzZ_zzZ_zzZ_zzZ}</p></blockquote>]]></content>
    
    
    <summary type="html">0xGame2025 Week4 Reverse方向全解&amp;详解</summary>
    
    
    
    <category term="WriteUp&amp;复现" scheme="https://sydzi.github.io/categories/WriteUp-%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="CTF" scheme="https://sydzi.github.io/tags/CTF/"/>
    
    <category term="WriteUp" scheme="https://sydzi.github.io/tags/WriteUp/"/>
    
    <category term="Reverse" scheme="https://sydzi.github.io/tags/Reverse/"/>
    
  </entry>
  
  <entry>
    <title>week35-week39</title>
    <link href="https://sydzi.github.io/2025/11/03/week35-week39/"/>
    <id>https://sydzi.github.io/2025/11/03/week35-week39/</id>
    <published>2025-11-03T04:34:28.000Z</published>
    <updated>2026-02-15T15:23:13.870Z</updated>
    
    <content type="html"><![CDATA[<p>2025年11月篇</p><span id="more"></span><h2 id="week35-2025-10-27-2025-11-2"><a href="#week35-2025-10-27-2025-11-2" class="headerlink" title="week35 (2025.10.27-2025.11.2)"></a>week35 (2025.10.27-2025.11.2)</h2><ul><li>0xGame的最后一周，在AI的帮助下也是全解出来了。这周题目挺好玩的，有Unity逆向改游戏机制和仿真（个人认为）的题目（图像加密程序和网络通信程序）什么的，函数重写也是出现了几次，学习到了😋</li><li>周二比赛结束后摆烂了，week4WriteUp还没写，?CTFweek4也没去看，等复现好了。GeekChallenges晚点再做</li><li>周末闲得无聊在ZLib上找到了几本书，逆向工程实战(Bruce·Dang)还有程序员的自我修养这两本感觉写得挺好的，符合我现在的学习需求😋</li></ul><h2 id="week36-2025-11-3-2025-11-9"><a href="#week36-2025-11-3-2025-11-9" class="headerlink" title="week36 (2025.11.3-2025.11.9)"></a>week36 (2025.11.3-2025.11.9)</h2><ul><li><p>这周有点摆烂了🙈🙈🙈没什么可以写的</p></li><li><p>目前0xGame2025week4WriteUp还有2.5题没有写，争取下周可以结束这件事</p></li><li><p>对了这周还尝试了复现湾区杯，但是发现strangapp的运行环境搭不起来😡😡😡周末也没有处理这事</p></li><li><p>反思反思煮啵的生活，有点太无聊了，以至于总是在短视频里麻痹自己。所以这周末煮啵下血本买了台电钢来丰富丰富生活（</p><p>还有听说最近PCL和HMCL出了联机功能，周末和朋友试着联机了一下，太好了煮啵也是终于有个有点兴趣玩的游戏了😋😋😋</p></li><li><p>这周虽然说没什么技术上的收获，但是煮啵感觉人生又丰富了一点🐱</p></li></ul><h2 id="week37-2025-11-10-2025-11-16"><a href="#week37-2025-11-10-2025-11-16" class="headerlink" title="week37 (2025.11.10-2025.11.16)"></a>week37 (2025.11.10-2025.11.16)</h2><ul><li>好吧这周看起来更摆一点，X2c的升队考核已经开始了，但是煮啵还没有做好准备😶‍🌫️😶‍🌫️😶‍🌫️可以的话，计划下周补充点SMC和fridahook的知识再去参加考核（主要还是脚本这一块🙈）</li><li>0xGame2025week4WriteUp还剩2题，主要是题目还是有点复杂度在的，要描述出一条比较清晰的思路有点难度。但是已经把写完的部分放出来了</li></ul><h2 id="week38-2025-11-17-2025-11-23"><a href="#week38-2025-11-17-2025-11-23" class="headerlink" title="week38 (2025.11.17-2025.11.23)"></a>week38 (2025.11.17-2025.11.23)</h2><ul><li>OK这周也是成功写完了0xGame2025week4WriteUp(～￣▽￣)～</li><li>这周参加了升队考核，成功升队了(～￣▽￣)～</li><li>唉，考核其实并不难，但是参加考核前我一直在犹豫，总是设想自己离通过考核的标准还差太远。这几乎就是我长期以来的问题，在没有真正接触一件事物的时候总爱设想，总是缺乏冲动的勇气😶‍🌫️生活上也是，明明感受到了宿舍不适合学习，但是在一点点的不理想（比如起床晚了、手机玩过头忘了时间了）的影响下还是会打消出去自习的念头😶‍🌫️八月份的入队考核和这周的升队考核都一样，其实都是spreng师傅先来找我了，之后我才去参加的考核😶‍🌫️开学到现在快3个月了，半个学期也过去了，除了参加了几场比赛积攒了些经验，真的是没有其他收获了，真就和之前想的一样确实没有暑假学的多🫥学业上其实也落下了好多，没有一门课记了笔记，写作业前还得先翻书，题写不出来还得搜题🫥还有一些小项目小点子也是迟迟没动手去写🫥上了大学越活越混乱了属于是</li></ul><h2 id="week39-2025-11-24-2025-11-30"><a href="#week39-2025-11-24-2025-11-30" class="headerlink" title="week39 (2025.11.24-2025.11.30)"></a>week39 (2025.11.24-2025.11.30)</h2><ul><li>周六打了古剑山，拉了坨大的(￣_￣|||)，全靠spring和ecx两位师傅带飞了，Damn，还得练啊🫠</li><li>emmm，这周没学什么说是－_－b，纯摆了，状态开始不对劲起来了</li><li>最近筹划着用mkdocs给逆向笔记搭个专门的页面</li></ul>]]></content>
    
    
    <summary type="html">2025年十一月5篇周记</summary>
    
    
    
    <category term="周记" scheme="https://sydzi.github.io/categories/%E5%91%A8%E8%AE%B0/"/>
    
    
    <category term="周记" scheme="https://sydzi.github.io/tags/%E5%91%A8%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>0xGame2025Week3WriteUp</title>
    <link href="https://sydzi.github.io/2025/10/28/0xGame2025Week3ReverseWriteUp/"/>
    <id>https://sydzi.github.io/2025/10/28/0xGame2025Week3ReverseWriteUp/</id>
    <published>2025-10-28T13:44:17.000Z</published>
    <updated>2026-02-15T15:23:13.810Z</updated>
    
    <content type="html"><![CDATA[<p>0xGame2025 Week3 Reverse方向全解&amp;详解</p><span id="more"></span><h2 id="easyApp"><a href="#easyApp" class="headerlink" title="easyApp"></a>easyApp</h2><blockquote><p>考点：apk逆向、工具应用、base64编码解码、z3求解</p></blockquote><ul><li><p>附件程序是个apk，在模拟器中运行如图，推测按钮会触发flag检验逻辑：</p><p><img src="/../images/image-20251028215843640.png" alt="模拟器运行"></p></li><li><p>用JEB打开apk，找到MainActivity并右键解析后，得到JAVA代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.easyapp;<br><br><span class="hljs-keyword">import</span> android.content.Context;<br><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> android.util.Base64;<br><span class="hljs-keyword">import</span> android.view.View;<br><span class="hljs-keyword">import</span> android.widget.Button;<br><span class="hljs-keyword">import</span> android.widget.EditText;<br><span class="hljs-keyword">import</span> android.widget.Toast;<br><span class="hljs-keyword">import</span> androidx.activity.ComponentActivity;<br><span class="hljs-keyword">import</span> dalvik.system.DexClassLoader;<br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> java.io.OutputStream;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> kotlin.Metadata;<br><span class="hljs-keyword">import</span> kotlin.collections.ArraysKt;<br><span class="hljs-keyword">import</span> kotlin.io.ByteStreamsKt;<br><span class="hljs-keyword">import</span> kotlin.jvm.functions.Function1;<br><span class="hljs-keyword">import</span> kotlin.jvm.internal.Intrinsics;<br><span class="hljs-keyword">import</span> kotlin.text.Charsets;<br><span class="hljs-keyword">import</span> kotlin.text.StringsKt;<br><br><span class="hljs-meta">@Metadata(d1 = &#123;&quot;\u0000\&quot;\n\u0002\u0018\u0002\n\u0002\u0018\u0002\n\u0002\b\u0002\n\u0002\u0010\u0002\n\u0000\n\u0002\u0018\u0002\n\u0000\n\u0002\u0010\u000E\n\u0002\u0010\u0012\n\u0000\b\u0007\u0018\u00002\u00020\u0001B\u0005¢\u0006\u0002\u0010\u0002J\u0012\u0010\u0003\u001A\u00020\u00042\b\u0010\u0005\u001A\u0004\u0018\u00010\u0006H\u0014J\f\u0010\u0007\u001A\u00020\b*\u00020\tH\u0002¨\u0006\n&quot;&#125;, d2 = &#123;&quot;Lcom/example/easyapp/MainActivity;&quot;, &quot;Landroidx/activity/ComponentActivity;&quot;, &quot;()V&quot;, &quot;onCreate&quot;, &quot;&quot;, &quot;savedInstanceState&quot;, &quot;Landroid/os/Bundle;&quot;, &quot;toHexString&quot;, &quot;&quot;, &quot;&quot;, &quot;app_release&quot;&#125;, k = 1, mv = &#123;1, 9, 0&#125;, xi = 0x30)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ComponentActivity</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> $stable;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span>  <span class="hljs-comment">// androidx.activity.ComponentActivity</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle arg3)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(arg3);<br>        <span class="hljs-built_in">this</span>.setContentView(layout.activity_main);<br>        <span class="hljs-type">EditText</span> <span class="hljs-variable">v3</span> <span class="hljs-operator">=</span> (EditText)<span class="hljs-built_in">this</span>.findViewById(id.flagInput);<br>        ((Button)<span class="hljs-built_in">this</span>.findViewById(id.button)).setOnClickListener((View arg2) -&gt; MainActivity.onCreate$lambda$<span class="hljs-number">0</span>(v3, <span class="hljs-built_in">this</span>, arg2));  <span class="hljs-comment">// 这里将Click和onCreate$lambda$0绑定起来了</span><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> onCreate$lambda$<span class="hljs-number">0</span>(EditText arg6, MainActivity arg7, View arg8) &#123;<br>        <span class="hljs-type">boolean</span> v6_4;  <span class="hljs-comment">// v8_1的返回值流向v6_4</span><br>        Intrinsics.checkNotNullParameter(arg7, <span class="hljs-string">&quot;this$0&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">v6</span> <span class="hljs-operator">=</span> arg6.getText().toString();  <span class="hljs-comment">// v6存放了输入的flag</span><br>        <span class="hljs-type">File</span> <span class="hljs-variable">v8</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(arg7.getCacheDir(), <span class="hljs-string">&quot;dex.zip&quot;</span>);<br>        <span class="hljs-type">InputStream</span> <span class="hljs-variable">v0</span> <span class="hljs-operator">=</span> arg7.getAssets().open(<span class="hljs-string">&quot;dex.zip&quot;</span>);  <span class="hljs-comment">// 打开了asset/dex.zip</span><br>        Intrinsics.checkNotNullExpressionValue(v0, <span class="hljs-string">&quot;open(...)&quot;</span>);<br>        ByteStreamsKt.copyTo$<span class="hljs-keyword">default</span>(v0, ((OutputStream)<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(v8)), <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-literal">null</span>);<br>        <span class="hljs-keyword">if</span>(v6.length() == <span class="hljs-number">42</span>) &#123;<br>            <span class="hljs-type">Method</span> <span class="hljs-variable">v8_1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DexClassLoader</span>(v8.getAbsolutePath(), arg7.getCacheDir().getAbsolutePath(), <span class="hljs-literal">null</span>, arg7.getClassLoader()).loadClass(<span class="hljs-string">&quot;com.example.easyapp.Secret&quot;</span>).getDeclaredMethod(<span class="hljs-string">&quot;check&quot;</span>, String.class);  <span class="hljs-comment">// v8指向了dex中的com.example.easyapp.Secret的check方法</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">v1</span> <span class="hljs-operator">=</span> v6.substring(<span class="hljs-number">0</span>, <span class="hljs-number">26</span>);  <span class="hljs-comment">// flag被截断，截断的部分流向v1</span><br>            Intrinsics.checkNotNullExpressionValue(v1, <span class="hljs-string">&quot;this as java.lang.String…ing(startIndex, endIndex)&quot;</span>);<br>            <span class="hljs-type">byte</span>[] v1_1 = v1.getBytes(Charsets.UTF_8);  <span class="hljs-comment">// flag截断部分流向v1_1</span><br>            Intrinsics.checkNotNullExpressionValue(((Object)v1_1), <span class="hljs-string">&quot;this as java.lang.String).getBytes(charset)&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">v1_2</span> <span class="hljs-operator">=</span> Base64.encodeToString(v1_1, <span class="hljs-number">0</span>);  <span class="hljs-comment">// flag截断部分被进行了base编码，流向v1_2</span><br>            Intrinsics.checkNotNullExpressionValue(v1_2, <span class="hljs-string">&quot;encodeToString(...)&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">v1_3</span> <span class="hljs-operator">=</span> StringsKt.trim(((CharSequence)v1_2)).toString();  <span class="hljs-comment">// 编码后的flag截断部分流向v1_3</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">v6_1</span> <span class="hljs-operator">=</span> v6.substring(<span class="hljs-number">26</span>);  <span class="hljs-comment">// flag的剩余部分流向了v6_1</span><br>            Intrinsics.checkNotNullExpressionValue(v6_1, <span class="hljs-string">&quot;this as java.lang.String).substring(startIndex)&quot;</span>);<br>            <span class="hljs-type">byte</span>[] v6_2 = v6_1.getBytes(Charsets.UTF_8);  <span class="hljs-comment">// flag的剩余部分从v6_1流向了v6_2</span><br>            Intrinsics.checkNotNullExpressionValue(((Object)v6_2), <span class="hljs-string">&quot;this as java.lang.String).getBytes(charset)&quot;</span>);<br>            <span class="hljs-keyword">if</span>(v1_3.equals(<span class="hljs-string">&quot;MHhHYW1le0RvX3kwdV9sMHYzX2FuZHIwMWQ=&quot;</span>)) &#123;  <span class="hljs-comment">// 此处为v1_3的检验逻辑</span><br>                <span class="hljs-type">Object</span> <span class="hljs-variable">v6_3</span> <span class="hljs-operator">=</span> v8_1.invoke(<span class="hljs-literal">null</span>, arg7.toHexString(v6_2));  <span class="hljs-comment">// v6_2经过toHexString处理后作为v8_1，即dex:com.example.easyapp.Secret.check的参数</span><br>                Intrinsics.checkNotNull(v6_3, <span class="hljs-string">&quot;null cannot be cast to non-null type kotlin.Boolean&quot;</span>);<br>                v6_4 = ((Boolean)v6_3).booleanValue();  <span class="hljs-comment">// v8_1的返回值流向v6_4</span><br>            &#125;<br>            <span class="hljs-keyword">else</span> &#123;<br>                v6_4 = <span class="hljs-literal">false</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">if</span>(v6_4) &#123;  <span class="hljs-comment">// v6_4决定了最后的输出：Right/Oh no no</span><br>                Toast.makeText(((Context)arg7), <span class="hljs-string">&quot;Right!&quot;</span>, <span class="hljs-number">0</span>).show();<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br><br>            Toast.makeText(((Context)arg7), <span class="hljs-string">&quot;Oh no no&quot;</span>, <span class="hljs-number">0</span>).show();<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        Toast.makeText(((Context)arg7), <span class="hljs-string">&quot;Length wrong!&quot;</span>, <span class="hljs-number">0</span>).show();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String <span class="hljs-title function_">toHexString</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] arg11)</span> &#123;<br>        <span class="hljs-keyword">return</span> ArraysKt.joinToString$<span class="hljs-keyword">default</span>(arg11, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">null</span>, ((Function1)MainActivity.toHexString<span class="hljs-number">.1</span>.INSTANCE), <span class="hljs-number">30</span>, <span class="hljs-literal">null</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到，flag被拆分成两部分进行检验，前26个字符经过base64编码后与”MHhHYW1le0RvX3kwdV9sMHYzX2FuZHIwMWQ&#x3D;”比对，剩下部分由dex中的com.example.easyapp.Secret.check方法检验。第一部分可以借助<a href="https://cyberchef.org/">CyberChef</a>解密：</p><p><img src="/../images/image-20251023214651101.png" alt="第一部分flag"></p></li><li><p>现在来分析flag第二部分的检验。在JEB左上角工程浏览器中找到asset&#x2F;dex.zip&#x2F;dex.bin</p><p><img src="/../images/image-20251024093910480.png" alt="找到dex.bin"></p><p>Secret类解析后得到：</p><p><img src="/../images/image-20251023215359432.png" alt="Secret类"></p><p>其中check的逻辑等价为一个三元一次大数方程组，三个元从flag的第二部分截取：</p><p>v0 &#x3D; substring(flagPart2[0:16])<br>v3 &#x3D; substring(flagPart2[8:24])<br>v4 &#x3D; substring(flagPart2:[16:32])</p><p>v3 + 3 * v0 - 27454419028250566601 &#x3D; 0<br>2 * v4 - 5 * v3 + 20616666104378640363 &#x3D; 0<br>v0 + 4 * v4 - 0x1dce62be9f0fa2f6c &#x3D; 0</p><p>可以使用z3求解。解密脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">v0 v3 v4分别存放[0:16],[8:24],[16:32]下标的字符，BigInteger将这些字符转成十六进制数，每个十六进制数4位，所以每个变量是64位</span><br><span class="hljs-string">需要关注两两变量之间有32位的重叠</span><br><span class="hljs-string">所以可以将三个64位变量分成4个32位变量来处理</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-comment"># 定义4个32位变量</span><br>u=BitVec(<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-number">32</span>)  <span class="hljs-comment"># v0的高32位</span><br>v=BitVec(<span class="hljs-string">&#x27;v&#x27;</span>,<span class="hljs-number">32</span>)  <span class="hljs-comment"># v0的低32位，也是v3的高32位</span><br>w=BitVec(<span class="hljs-string">&#x27;w&#x27;</span>,<span class="hljs-number">32</span>)  <span class="hljs-comment"># v3的低32位，也是v4的高32位</span><br>t=BitVec(<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-number">32</span>)  <span class="hljs-comment"># v4的低32位</span><br><br><span class="hljs-comment"># 通过拼接32位变量构造64位变量</span><br>v0=Concat(u,v) <span class="hljs-comment">#v0=u&lt;&lt;32|v</span><br>v3=Concat(v,w) <span class="hljs-comment">#v3=v&lt;&lt;32|w</span><br>v4=Concat(w,t) <span class="hljs-comment">#v4=w&lt;&lt;32|t</span><br><br><span class="hljs-comment">#定义常量</span><br>A=BitVecVal(<span class="hljs-number">27454419028250566601</span>,<span class="hljs-number">64</span>)<br>B=BitVecVal(-<span class="hljs-number">20616666104378640363</span>,<span class="hljs-number">64</span>)<br>C=BitVecVal(<span class="hljs-number">0x1dce62be9f0fa2f6c</span>,<span class="hljs-number">64</span>)<br><br><span class="hljs-comment">#建立约束</span><br>s=Solver()<br>s.add(v3+<span class="hljs-number">3</span>*v0==A)<br>s.add(<span class="hljs-number">2</span>*v4-<span class="hljs-number">5</span>*v3==B)<br>s.add(v0+<span class="hljs-number">4</span>*v4==C)<br><br><span class="hljs-keyword">if</span> s.check()==unsat:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;无解&quot;</span>)<br><span class="hljs-keyword">while</span> s.check()==sat:<br>    model=s.model()<br>    u_val=model[u].as_long()<br>    v_val=model[v].as_long()<br>    w_val=model[w].as_long()<br>    t_val=model[t].as_long()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;found solution:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;u: <span class="hljs-subst">&#123;u_val:08x&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;v: <span class="hljs-subst">&#123;v_val:08x&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;w: <span class="hljs-subst">&#123;w_val:08x&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;t: <span class="hljs-subst">&#123;t_val:08x&#125;</span>&quot;</span>)<br><br>    <span class="hljs-comment"># 将32位变量还原成字符</span><br>    result=(u_val&lt;&lt;<span class="hljs-number">96</span>)|(v_val&lt;&lt;<span class="hljs-number">64</span>)|(w_val&lt;&lt;<span class="hljs-number">32</span>)|t_val<br><br>    hex_str=<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;result:032x&#125;</span>&quot;</span><br>    flag_bytes=<span class="hljs-built_in">bytes</span>.fromhex(hex_str)<br>    flag=flag_bytes.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;flag: <span class="hljs-subst">&#123;flag&#125;</span>&quot;</span>)<br><br>    <span class="hljs-comment">#排除已有的解</span><br>    s.add(Or(u!=u_val,v!=v_val,w!=w_val,t!=t_val))<br>    <br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">found solution:</span><br><span class="hljs-string">u: 5f346e64</span><br><span class="hljs-string">v: 5f646578</span><br><span class="hljs-string">w: 5f6c6f61</span><br><span class="hljs-string">t: 6465727d</span><br><span class="hljs-string">flag: _4nd_dex_loader&#125;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure></li></ul><blockquote><p>flag：0xGame{Do_y0u_l0v3_andr01d_4nd_dex_loader}</p></blockquote><h2 id="Minesweepr"><a href="#Minesweepr" class="headerlink" title="Minesweepr"></a>Minesweepr</h2><blockquote><p>考点：web逆向、js逆向</p></blockquote><ul><li><p>附件是html文件和js文件，推测是一个web逆向题。html打开是一个扫雷游戏网页。因为js主要用来处理网页交互，所以重点关注js文件的内容</p><p><img src="/../images/image-20251023083351084.png" alt="扫雷游戏"></p></li><li><p>网页按F12打开开发人员工具，可以在工具栏源代码模块看js脚本。搜索”flag”可以找到一个可疑的函数：</p><p><img src="/../images/image-20251024112642390.png" alt="js脚本与可疑函数"></p><p>这里函数名和变量名都不是有意义的，不好阅读，可以双击高亮来追踪数据流。</p><p>分析可以发现，0x55ea57被调用了很多次，追踪这个值可以到达0x183c，这个函数负责从0xca50中加载值返回，这算是一个全局的混淆手段了</p><p><img src="/../images/image-20251024162443124.png" alt="0x55ea57被调用了多次"></p><p><img src="/../images/image-20251024162904166.png" alt="0x183c函数"></p><p>根据0x183c的代码可以找到0xca50的字符串表0x1193d5，表中就可以索引出密钥winModal:message2：”WebIsInteresting”了，以及密文”g\x1d%(\x1e,\x15@SA\x5cFD\x0fWJn]P}^}\x0c\x12\x07_]AGYC^o\x04\x00yA-ZGT\x16U\x0e”（0x183c的索引算法有点奇怪，好像索引不到正确的位置上，没搞懂）</p><p>而0x172ca4的解密逻辑可以等价如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>flag+=enc[i]^key[i%<span class="hljs-built_in">len</span>(key)]<br></code></pre></td></tr></table></figure><p>因此可以得到解密脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">enc=<span class="hljs-string">&quot;g\x1d%(\x1e,\x15@SA\x5cFD\x0fWJn]P&#125;^&#125;\x0c\x12\x07_]AGYC^o\x04\x00yA-ZGT\x16U\x0e&quot;</span><br>key=<span class="hljs-string">&quot;WebIsInteresting&quot;</span><br>flag=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    flag+=<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(enc[i])^<span class="hljs-built_in">ord</span>(key[i%<span class="hljs-built_in">len</span>(key)]))<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure></li></ul><blockquote><p>flag：0xGame{463950f9-9824-4bfb-8230-98ab02d431d0}</p></blockquote><h2 id="ezVBS"><a href="#ezVBS" class="headerlink" title="ezVBS"></a>ezVBS</h2><blockquote><p>考点：VBS逆向、VBS去混淆</p></blockquote><ul><li><p>附件程序是个VBS文件，运行显示：</p><p><img src="/../images/image-20251024165818790.png" alt="运行VBS"></p></li><li><p>用记事本打开VBS会发现是一堆奇怪的字符，查了一下说是加了混淆</p><p><img src="/../images/image-20251024170022478.png" alt="记事本打开"></p><p>参考<a href="https://blog.csdn.net/Daphneohh/article/details/143783257">VBS代码混淆</a>，可以使用去混淆脚本进行去混淆，使用方法见链接：</p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs vbscript"><span class="hljs-keyword">Option</span> <span class="hljs-keyword">Explicit</span><br> <br><span class="hljs-keyword">Function</span> Defuscator(vbs)<br><span class="hljs-keyword">Dim</span> t<br>t = <span class="hljs-built_in">InStr</span>(<span class="hljs-number">1</span>, vbs, <span class="hljs-string">&quot;Execute&quot;</span>, <span class="hljs-number">1</span>)<br>t = <span class="hljs-built_in">Mid</span>(vbs, t + <span class="hljs-built_in">Len</span>(<span class="hljs-string">&quot;Execute&quot;</span>)) <br>t = <span class="hljs-built_in">Eval</span>(t)<br>Defuscator = t<br><span class="hljs-keyword">End</span> <span class="hljs-keyword">Function</span><br> <br><span class="hljs-keyword">Dim</span> fso, i<br><span class="hljs-keyword">Const</span> ForReading = <span class="hljs-number">1</span><br><span class="hljs-keyword">Set</span> fso = <span class="hljs-built_in">CreateObject</span>(<span class="hljs-string">&quot;Scripting.FileSystemObject&quot;</span>)<br><span class="hljs-keyword">For</span> i = <span class="hljs-number">0</span> <span class="hljs-keyword">To</span> WScript.Arguments.Count - <span class="hljs-number">1</span> <br><span class="hljs-keyword">Dim</span> FileName<br>FileName = WScript.Arguments(i)<br><span class="hljs-keyword">Dim</span> MyFile<br><span class="hljs-keyword">Set</span> MyFile = fso.OpenTextFile(FileName, ForReading)<br><span class="hljs-keyword">Dim</span> vbs<br>vbs = MyFile.ReadAll<br>WScript.Echo Defuscator(vbs)<br>MyFile.Close<br><span class="hljs-keyword">Next</span><br> <br><span class="hljs-keyword">Set</span> fso = <span class="hljs-literal">Nothing</span><br></code></pre></td></tr></table></figure><p>然后可以得到如下的代码：</p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs vbscript">Microsoft (R) Windows Script Host Version <span class="hljs-number">5.812</span><br>版权所有(C) Microsoft Corporation。保留所有权利。<br><br>code = <span class="hljs-string">&quot;Function l(str):Dim i,j,k,r:j=Len(str):r=&quot;&quot;&quot;&quot;:For i=1 to j:k=Asc(Mid(str,i,1)):If k&gt;=33 And k&lt;=126 Then:r=r&amp;Chr(33+((k+14)Mod 94)):Else:r=r&amp;Chr(k):End If:Next:l=r:End Function:Execute l(&quot;&quot;DEC l x?AFEq@IWQt?E6C J@FC &gt;6DD286i QX i q2D6ec%23=6 l Q7Ie&#123;&amp;*d2Eh=?H&gt;5b%3BKF#JZp:A(w!s@)+z|uvr&#x27;ax^&quot;&quot;&quot;&quot;;$C6tD9`g&#125;y&lt;8_Gfc~4qQ i 7=28 l QH2+2pJ&#125;vsyhrH&#123;7&#125;5K*r?J&amp;DpyE$&gt;&#123;&amp;_HB&#125;z&gt;&#123;*u?J%g:J#|:d&amp;tp|w_52glQ i 6?4 l QQ i u@C : l ` %@ &#123;6?WDECX $E6A b i :7 : Z a kl &#123;6?WDECX %96? i 3:Eq=@4&lt; l pD4W|:5WDEC[ :[ `XX Y ade Y ade Z pD4W|:5WDEC[ : Z `[ `XX Y ade Z pD4W|:5WDEC[ : Z a[ `XX i 4` l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ec Y ecXX |@5 ec Z `[ `X i 4a l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ecXX |@5 ec Z `[ `X i 4b l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - ecX |@5 ec Z `[ `X i 4c l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt;X |@5 ec Z `[ `X i 6?4 l 6?4 U 4` U 4a U 4b U 4c i t=D6 i x7 : Z ` kl &#123;6?WDECX %96? i 3:Eq=@4&lt; l pD4W|:5WDEC[ :[ `XX Y ade Y ade Z pD4W|:5WDEC[ : Z `[ `XX Y ade i 4` l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ec Y ecXX |@5 ec Z `[ `X i 4a l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ecXX |@5 ec Z `[ `X i 4b l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - ecX |@5 ec Z `[ `X i 6?4 l 6?4 U 4` U 4a U 4b U QlQ i t=D6 i 3:Eq=@4&lt; l pD4W|:5WDEC[ :[ `XX Y ade Y ade i 4` l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ec Y ecXX |@5 ec Z `[ `X i 4a l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ecXX |@5 ec Z `[ `X i 6?4 l 6?4 U 4` U 4a U QlQ U QlQ i t?5 x7 i t?5 x7 i &#125;6IE i xu 6?4 l 7=28 %96? i |D8q@I Q*@FC 7=28 :D 4@CC64EPQ i t=D6 i |D8q@I Q*@FC 7=28 :D :?4@CC64EPQ i t?5 x7&quot;&quot;)&quot;</span><br><span class="hljs-keyword">Execute</span> code<br>code = <span class="hljs-string">&quot;Function l(str):Dim i,j,k,r:j=Len(str):r=&quot;&quot;&quot;&quot;:For i=1 to j:k=Asc(Mid(str,i,1)):If k&gt;=33 And k&lt;=126 Then:r=r&amp;Chr(33+((k+14)Mod 94)):Else:r=r&amp;Chr(k):End If:Next:l=r:End Function:Execute l(&quot;&quot;DEC l x?AFEq@IWQt?E6C J@FC 7=28i QX i q2D6ec%23=6 l QeHB)IvGyC%c~&quot;&quot;&quot;&quot;&gt;&#125;twp^h@fg&#x27;qZ`=+#s4EdAFa2(_5Du&#123;Jr$86;z79&amp;:x|*!&lt;Kb?3Q i 7=28 l Q^^H5q&#x27;Z2CGvJ+(fdZyaE#:vz=(faCy28#^H$=xwE#GKE+_f$CvZB@zHa`&#x27;%2qxpJs^6Esgb&amp;+AHF=:&amp;6#&#x27;p2+AHD+zHJ`gr2=yaE#GKEq(@Eq&#x27;p9qg&gt;&#123;ZgwEq(fFq&#x27;f7Z^H8ZAH9`G27~BHu#&#x27;&gt;9CGv7Cy28#&#x27;CEZ(;dZzH5q&#x27;&quot;&quot;&quot;&quot;Eq(f2=AH8#(fz#x%D#yp2=EllQ i 6?4 l QQ i u@C : l ` %@ &#123;6?WDECX $E6A b i :7 : Z a kl &#123;6?WDECX %96? i 3:Eq=@4&lt; l pD4W|:5WDEC[ :[ `XX Y ade Y ade Z pD4W|:5WDEC[ : Z `[ `XX Y ade Z pD4W|:5WDEC[ : Z a[ `XX i 4` l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ec Y ecXX |@5 ec Z `[ `X i 4a l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ecXX |@5 ec Z `[ `X i 4b l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - ecX |@5 ec Z `[ `X i 4c l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt;X |@5 ec Z `[ `X i 6?4 l 6?4 U 4` U 4a U 4b U 4c i t=D6 i x7 : Z ` kl &#123;6?WDECX %96? i 3:Eq=@4&lt; l pD4W|:5WDEC[ :[ `XX Y ade Y ade Z pD4W|:5WDEC[ : Z `[ `XX Y ade i 4` l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ec Y ecXX |@5 ec Z `[ `X i 4a l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ecXX |@5 ec Z `[ `X i 4b l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - ecX |@5 ec Z `[ `X i 6?4 l 6?4 U 4` U 4a U 4b U QlQ i t=D6 i 3:Eq=@4&lt; l pD4W|:5WDEC[ :[ `XX Y ade Y ade i 4` l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ec Y ecXX |@5 ec Z `[ `X i 4a l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ecXX |@5 ec Z `[ `X i 6?4 l 6?4 U 4` U 4a U QlQ U QlQ i t?5 x7 i t?5 x7 i &#125;6IE i xu 6?4 l 7=28 %96? i |D8q@I DEC i t=D6 i |D8q@I Q*@FC 7=28 :D :?4@CC64EPQ i |D8q@I 6?4 i t?5 x7&quot;&quot;)&quot;</span><br><span class="hljs-keyword">Set</span> objFSO = <span class="hljs-built_in">CreateObject</span>(<span class="hljs-string">&quot;Scripting.FileSystemObject&quot;</span>)<br>strScriptPath = WScript.ScriptFullName<br>strTextToWrite = code<br>objFSO.OpenTextFile(strScriptPath, <span class="hljs-number">2</span>, <span class="hljs-literal">True</span>).WriteLine(strTextToWrite)<br></code></pre></td></tr></table></figure><p>可以看到code中有一些可读明文，后面又是一大串奇怪的字符。推测还有一层混淆，可读明文即为解密函数。让AI给出解密脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">l</span>(<span class="hljs-params">encrypted_str</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;VBScript l 函数的 Python 实现&quot;&quot;&quot;</span><br>    result = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(encrypted_str)):<br>        k = <span class="hljs-built_in">ord</span>(encrypted_str[i])<br>        <span class="hljs-keyword">if</span> <span class="hljs-number">33</span> &lt;= k &lt;= <span class="hljs-number">126</span>:<br>            <span class="hljs-comment"># 与 VBScript 相同的算法</span><br>            result += <span class="hljs-built_in">chr</span>(<span class="hljs-number">33</span> + ((k + <span class="hljs-number">14</span>) % <span class="hljs-number">94</span>))<br>        <span class="hljs-keyword">else</span>:<br>            result += <span class="hljs-built_in">chr</span>(k)<br>    <span class="hljs-keyword">return</span> result<br><br><br><span class="hljs-comment"># 你的加密字符串</span><br>encrypted_strings = [<br>    <span class="hljs-string">&quot;DEC l x?AFEq@IWQt?E6C J@FC &gt;6DD286i QX i q2D6ec%23=6 l Q7Ie&#123;&amp;*d2Eh=?H&gt;5b%3BKF#JZp:A(w!s@)+z|uvr&#x27;ax^\&quot;\&quot;\&quot;\&quot;;$C6tD9`g&#125;y&lt;8_Gfc~4qQ i 7=28 l QH2+2pJ&#125;vsyhrH&#123;7&#125;5K*r?J&amp;DpyE$&gt;&#123;&amp;_HB&#125;z&gt;&#123;*u?J%g:J#|:d&amp;tp|w_52glQ i 6?4 l QQ i u@C : l ` %@ &#123;6?WDECX $E6A b i :7 : Z a kl &#123;6?WDECX %96? i 3:Eq=@4&lt; l pD4W|:5WDEC[ :[ `XX Y ade Y ade Z pD4W|:5WDEC[ : Z `[ `XX Y ade Z pD4W|:5WDEC[ : Z a[ `XX i 4` l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ec Y ecXX |@5 ec Z `[ `X i 4a l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ecXX |@5 ec Z `[ `X i 4b l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - ecX |@5 ec Z `[ `X i 4c l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt;X |@5 ec Z `[ `X i 6?4 l 6?4 U 4` U 4a U 4b U 4c i t=D6 i x7 : Z ` kl &#123;6?WDECX %96? i 3:Eq=@4&lt; l pD4W|:5WDEC[ :[ `XX Y ade Y ade Z pD4W|:5WDEC[ : Z `[ `XX Y ade i 4` l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ec Y ecXX |@5 ec Z `[ `X i 4a l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ecXX |@5 ec Z `[ `X i 4b l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - ecX |@5 ec Z `[ `X i 6?4 l 6?4 U 4` U 4a U 4b U QlQ i t=D6 i 3:Eq=@4&lt; l pD4W|:5WDEC[ :[ `XX Y ade Y ade i 4` l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ec Y ecXX |@5 ec Z `[ `X i 4a l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ecXX |@5 ec Z `[ `X i 6?4 l 6?4 U 4` U 4a U QlQ U QlQ i t?5 x7 i t?5 x7 i &#125;6IE i xu 6?4 l 7=28 %96? i |D8q@I Q*@FC 7=28 :D 4@CC64EPQ i t=D6 i |D8q@I Q*@FC 7=28 :D :?4@CC64EPQ i t?5 x7&quot;</span>,<br><br>    <span class="hljs-string">&quot;DEC l x?AFEq@IWQt?E6C J@FC 7=28i QX i q2D6ec%23=6 l QeHB)IvGyC%c~\&quot;\&quot;\&quot;\&quot;&gt;&#125;twp^h@fg&#x27;qZ`=+#s4EdAFa2(_5Du&#123;Jr$86;z79&amp;:x|*!&lt;Kb?3Q i 7=28 l Q^^H5q&#x27;Z2CGvJ+(fdZyaE#:vz=(faCy28#^H$=xwE#GKE+_f$CvZB@zHa`&#x27;%2qxpJs^6Esgb&amp;+AHF=:&amp;6#&#x27;p2+AHD+zHJ`gr2=yaE#GKEq(@Eq&#x27;p9qg&gt;&#123;ZgwEq(fFq&#x27;f7Z^H8ZAH9`G27~BHu#&#x27;&gt;9CGv7Cy28#&#x27;CEZ(;dZzH5q&#x27;\&quot;\&quot;\&quot;\&quot;Eq(f2=AH8#(fz#x%D#yp2=EllQ i 6?4 l QQ i u@C : l ` %@ &#123;6?WDECX $E6A b i :7 : Z a kl &#123;6?WDECX %96? i 3:Eq=@4&lt; l pD4W|:5WDEC[ :[ `XX Y ade Y ade Z pD4W|:5WDEC[ : Z `[ `XX Y ade Z pD4W|:5WDEC[ : Z a[ `XX i 4` l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ec Y ecXX |@5 ec Z `[ `X i 4a l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ecXX |@5 ec Z `[ `X i 4b l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - ecX |@5 ec Z `[ `X i 4c l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt;X |@5 ec Z `[ `X i 6?4 l 6?4 U 4` U 4a U 4b U 4c i t=D6 i x7 : Z ` kl &#123;6?WDECX %96? i 3:Eq=@4&lt; l pD4W|:5WDEC[ :[ `XX Y ade Y ade Z pD4W|:5WDEC[ : Z `[ `XX Y ade i 4` l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ec Y ecXX |@5 ec Z `[ `X i 4a l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ecXX |@5 ec Z `[ `X i 4b l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - ecX |@5 ec Z `[ `X i 6?4 l 6?4 U 4` U 4a U 4b U QlQ i t=D6 i 3:Eq=@4&lt; l pD4W|:5WDEC[ :[ `XX Y ade Y ade i 4` l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ec Y ecXX |@5 ec Z `[ `X i 4a l |:5Wq2D6ec%23=6[ x?EW3:Eq=@4&lt; - Wec Y ecXX |@5 ec Z `[ `X i 6?4 l 6?4 U 4` U 4a U QlQ U QlQ i t?5 x7 i t?5 x7 i &#125;6IE i xu 6?4 l 7=28 %96? i |D8q@I DEC i t=D6 i |D8q@I Q*@FC 7=28 :D :?4@CC64EPQ i |D8q@I 6?4 i t?5 x7&quot;</span><br>]<br><br><span class="hljs-comment"># 解密并显示结果</span><br><span class="hljs-keyword">for</span> i, encrypted <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(encrypted_strings, <span class="hljs-number">1</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;解密第 <span class="hljs-subst">&#123;i&#125;</span> 个字符串:&quot;</span>)<br>    decrypted = l(encrypted)<br>    <span class="hljs-built_in">print</span>(decrypted)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">80</span> + <span class="hljs-string">&quot;\n&quot;</span>)<br></code></pre></td></tr></table></figure><p>输出：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">解密第 <span class="hljs-number">1</span> 个字符串:<br><span class="hljs-built_in">str</span> = InputBox(<span class="hljs-string">&quot;Enter your message: &quot;</span>) : Base64Table = <span class="hljs-string">&quot;fx6LUY5at9lnwmd3TbqzuRy+AipWHPDoXZKMFGCV2I/QQQQjSreEsh18NJkg0v74OcB&quot;</span> : flag = <span class="hljs-string">&quot;waZaAyNGDJ9CwLfNdzYCnyUsAJtSmLU0wqNKmLYFnyT8iyRMi5UEAMH0da8=&quot;</span> : enc = <span class="hljs-string">&quot;&quot;</span> : For i = <span class="hljs-number">1</span> To Len(<span class="hljs-built_in">str</span>) Step <span class="hljs-number">3</span> : <span class="hljs-keyword">if</span> i + <span class="hljs-number">2</span> &lt;= Len(<span class="hljs-built_in">str</span>) Then : bitBlock = Asc(Mid(<span class="hljs-built_in">str</span>, i, <span class="hljs-number">1</span>)) * <span class="hljs-number">256</span> * <span class="hljs-number">256</span> + Asc(Mid(<span class="hljs-built_in">str</span>, i + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)) * <span class="hljs-number">256</span> + Asc(Mid(<span class="hljs-built_in">str</span>, i + <span class="hljs-number">2</span>, <span class="hljs-number">1</span>)) : c1 = Mid(Base64Table, Int(bitBlock \ (<span class="hljs-number">64</span> * <span class="hljs-number">64</span> * <span class="hljs-number">64</span>)) Mod <span class="hljs-number">64</span> + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) : c2 = Mid(Base64Table, Int(bitBlock \ (<span class="hljs-number">64</span> * <span class="hljs-number">64</span>)) Mod <span class="hljs-number">64</span> + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) : c3 = Mid(Base64Table, Int(bitBlock \ <span class="hljs-number">64</span>) Mod <span class="hljs-number">64</span> + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) : c4 = Mid(Base64Table, Int(bitBlock) Mod <span class="hljs-number">64</span> + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) : enc = enc &amp; c1 &amp; c2 &amp; c3 &amp; c4 : Else : If i + <span class="hljs-number">1</span> &lt;= Len(<span class="hljs-built_in">str</span>) Then : bitBlock = Asc(Mid(<span class="hljs-built_in">str</span>, i, <span class="hljs-number">1</span>)) * <span class="hljs-number">256</span> * <span class="hljs-number">256</span> + Asc(Mid(<span class="hljs-built_in">str</span>, i + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)) * <span class="hljs-number">256</span> : c1 = Mid(Base64Table, Int(bitBlock \ (<span class="hljs-number">64</span> * <span class="hljs-number">64</span> * <span class="hljs-number">64</span>)) Mod <span class="hljs-number">64</span> + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) : c2 = Mid(Base64Table, Int(bitBlock \ (<span class="hljs-number">64</span> * <span class="hljs-number">64</span>)) Mod <span class="hljs-number">64</span> + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) : c3 = Mid(Base64Table, Int(bitBlock \ <span class="hljs-number">64</span>) Mod <span class="hljs-number">64</span> + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) : enc = enc &amp; c1 &amp; c2 &amp; c3 &amp; <span class="hljs-string">&quot;=&quot;</span> : Else : bitBlock = Asc(Mid(<span class="hljs-built_in">str</span>, i, <span class="hljs-number">1</span>)) * <span class="hljs-number">256</span> * <span class="hljs-number">256</span> : c1 = Mid(Base64Table, Int(bitBlock \ (<span class="hljs-number">64</span> * <span class="hljs-number">64</span> * <span class="hljs-number">64</span>)) Mod <span class="hljs-number">64</span> + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) : c2 = Mid(Base64Table, Int(bitBlock \ (<span class="hljs-number">64</span> * <span class="hljs-number">64</span>)) Mod <span class="hljs-number">64</span> + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) : enc = enc &amp; c1 &amp; c2 &amp; <span class="hljs-string">&quot;=&quot;</span> &amp; <span class="hljs-string">&quot;=&quot;</span> : End If : End If : Next : IF enc = flag Then : MsgBox <span class="hljs-string">&quot;Your flag is correct!&quot;</span> : Else : MsgBox <span class="hljs-string">&quot;Your flag is incorrect!&quot;</span> : End If<br><br>================================================================================<br><br>解密第 <span class="hljs-number">2</span> 个字符串:<br><span class="hljs-built_in">str</span> = InputBox(<span class="hljs-string">&quot;Enter your flag: &quot;</span>) : Base64Table = <span class="hljs-string">&quot;6wqXxGvJrT4OQQQQmNEHA/9o78VB+1lZRDct5pu2aW0dsFLyCSgejKfhUiIMYPkz3nb&quot;</span> : flag = <span class="hljs-string">&quot;//wdBV+arvGyZW75+J2tRiGKlW72rJagR/wSlIHtRvztZ07SrG+qoKw21VTaBIAyD/etD83UZpwuliUeRVAaZpwsZKwy18CalJ2tRvztBWotBVAhB8mL+8HtBW7uBV7f+/wg+pwh1vafOqwFRVmhrvGfrJagRVrt+Wj5+KwdBVQQQQtBW7alpwgRW7KRITsRJAalt==&quot;</span> : enc = <span class="hljs-string">&quot;&quot;</span> : For i = <span class="hljs-number">1</span> To Len(<span class="hljs-built_in">str</span>) Step <span class="hljs-number">3</span> : <span class="hljs-keyword">if</span> i + <span class="hljs-number">2</span> &lt;= Len(<span class="hljs-built_in">str</span>) Then : bitBlock = Asc(Mid(<span class="hljs-built_in">str</span>, i, <span class="hljs-number">1</span>)) * <span class="hljs-number">256</span> * <span class="hljs-number">256</span> + Asc(Mid(<span class="hljs-built_in">str</span>, i + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)) * <span class="hljs-number">256</span> + Asc(Mid(<span class="hljs-built_in">str</span>, i + <span class="hljs-number">2</span>, <span class="hljs-number">1</span>)) : c1 = Mid(Base64Table, Int(bitBlock \ (<span class="hljs-number">64</span> * <span class="hljs-number">64</span> * <span class="hljs-number">64</span>)) Mod <span class="hljs-number">64</span> + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) : c2 = Mid(Base64Table, Int(bitBlock \ (<span class="hljs-number">64</span> * <span class="hljs-number">64</span>)) Mod <span class="hljs-number">64</span> + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) : c3 = Mid(Base64Table, Int(bitBlock \ <span class="hljs-number">64</span>) Mod <span class="hljs-number">64</span> + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) : c4 = Mid(Base64Table, Int(bitBlock) Mod <span class="hljs-number">64</span> + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) : enc = enc &amp; c1 &amp; c2 &amp; c3 &amp; c4 : Else : If i + <span class="hljs-number">1</span> &lt;= Len(<span class="hljs-built_in">str</span>) Then : bitBlock = Asc(Mid(<span class="hljs-built_in">str</span>, i, <span class="hljs-number">1</span>)) * <span class="hljs-number">256</span> * <span class="hljs-number">256</span> + Asc(Mid(<span class="hljs-built_in">str</span>, i + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)) * <span class="hljs-number">256</span> : c1 = Mid(Base64Table, Int(bitBlock \ (<span class="hljs-number">64</span> * <span class="hljs-number">64</span> * <span class="hljs-number">64</span>)) Mod <span class="hljs-number">64</span> + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) : c2 = Mid(Base64Table, Int(bitBlock \ (<span class="hljs-number">64</span> * <span class="hljs-number">64</span>)) Mod <span class="hljs-number">64</span> + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) : c3 = Mid(Base64Table, Int(bitBlock \ <span class="hljs-number">64</span>) Mod <span class="hljs-number">64</span> + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) : enc = enc &amp; c1 &amp; c2 &amp; c3 &amp; <span class="hljs-string">&quot;=&quot;</span> : Else : bitBlock = Asc(Mid(<span class="hljs-built_in">str</span>, i, <span class="hljs-number">1</span>)) * <span class="hljs-number">256</span> * <span class="hljs-number">256</span> : c1 = Mid(Base64Table, Int(bitBlock \ (<span class="hljs-number">64</span> * <span class="hljs-number">64</span> * <span class="hljs-number">64</span>)) Mod <span class="hljs-number">64</span> + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) : c2 = Mid(Base64Table, Int(bitBlock \ (<span class="hljs-number">64</span> * <span class="hljs-number">64</span>)) Mod <span class="hljs-number">64</span> + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>) : enc = enc &amp; c1 &amp; c2 &amp; <span class="hljs-string">&quot;=&quot;</span> &amp; <span class="hljs-string">&quot;=&quot;</span> : End If : End If : Next : IF enc = flag Then : MsgBox <span class="hljs-built_in">str</span> : Else : MsgBox <span class="hljs-string">&quot;Your flag is incorrect!&quot;</span> : MsgBox enc : End If<br><br>================================================================================<br></code></pre></td></tr></table></figure><p>解密出来是两段代码。但是代码给的base表不是很对，第2段代码中删除base表中间连续QQQQ的几个可以解密出一些类似提示的东西</p><p><img src="/../images/image-20251024172111827.png" alt="类似提示的东西"></p><p>第1段代码的编码表进行同样的修改就得到了flag：</p><p><img src="/../images/image-20251024172507953.png" alt="得到flag"></p></li></ul><blockquote><p>flag：0xGame{bf00591f-a1cb-4191-b41d-d4eecda0b798}</p></blockquote><h2 id="World’s-end-BlackBox"><a href="#World’s-end-BlackBox" class="headerlink" title="World’s_end_BlackBox"></a>World’s_end_BlackBox</h2><blockquote><p>考点：动态调试、魔改RC4算法</p></blockquote><ul><li><p>附件程序运行如图：</p><p><img src="/../images/image-20251024175918607.png" alt="附件程序运行"></p></li><li><p>用IDA打开，main函数由于类的影响不好分析，先进行简单的变量名优化：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  __int64 v3; <span class="hljs-comment">// rax</span><br>  __int64 v4; <span class="hljs-comment">// rax</span><br>  __int64 v5; <span class="hljs-comment">// rax</span><br>  __int64 v6; <span class="hljs-comment">// rax</span><br>  __int64 v7; <span class="hljs-comment">// rax</span><br>  __int64 v8; <span class="hljs-comment">// rax</span><br>  __int64 v9; <span class="hljs-comment">// rax</span><br>  __int64 v10; <span class="hljs-comment">// rax</span><br>  __int64 v11; <span class="hljs-comment">// rax</span><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::iterator __for_end; <span class="hljs-comment">// [rsp+20h] [rbp-60h] BYREF</span><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::iterator __for_begin; <span class="hljs-comment">// [rsp+28h] [rbp-58h] BYREF</span><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt; EndFlag; <span class="hljs-comment">// [rsp+30h] [rbp-50h] BYREF</span><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> encrypted_message; <span class="hljs-comment">// [rsp+50h] [rbp-30h] BYREF</span><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> key; <span class="hljs-comment">// [rsp+70h] [rbp-10h] BYREF</span><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> flag; <span class="hljs-comment">// [rsp+90h] [rbp+10h] BYREF</span><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> v19; <span class="hljs-comment">// [rsp+B0h] [rbp+30h] BYREF</span><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;::value_type __x; <span class="hljs-comment">// [rsp+D0h] [rbp+50h] BYREF</span><br>  <span class="hljs-type">char</span> c; <span class="hljs-comment">// [rsp+D7h] [rbp+57h]</span><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *__for_range; <span class="hljs-comment">// [rsp+D8h] [rbp+58h]</span><br><br>  _main(argc, argv, envp);<br>  SetConsoleOutputCP(<span class="hljs-number">0xFDE9u</span>);<br>  basicString((__int64)&amp;flag);<br>  basicString((__int64)&amp;key);<br>  v3 = operateOut(pOut, &amp;unk_408078);<br>  stdOut(v3, out);<br>  v4 = operateOut(pOut, &amp;unk_408160);<br>  stdOut(v4, out);<br>  getLine(pIn, &amp;key);                           <span class="hljs-comment">// 获取密码</span><br>  <span class="hljs-keyword">if</span> ( getLength(&amp;key) != <span class="hljs-number">12</span> )                  <span class="hljs-comment">// 长度判断</span><br>  &#123;<br>    v5 = operateOut(pOut, <span class="hljs-string">&quot;Length Error!&quot;</span>);<br>    stdOut(v5, out);<br>    system(<span class="hljs-string">&quot;pause&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  &#125;<br>  KeyGenerate(&amp;v19, &amp;KeyEnc[abi:cxx11], &amp;DeKey[abi:cxx11]);<span class="hljs-comment">// key的生成算法</span><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::operator=(&amp;TrueKey[abi:cxx11], &amp;v19);<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>(&amp;v19);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">std</span>::operator!=&lt;<span class="hljs-type">char</span>&gt;(&amp;key, &amp;TrueKey[abi:cxx11]) )<span class="hljs-comment">// 出现了检验逻辑，可以从这里直接获取到真正的key</span><br>  &#123;<br>    v6 = operateOut(pOut, &amp;unk_4081A2);         <span class="hljs-comment">// key错误时的输出</span><br>    stdOut(v6, out);<br>    system(<span class="hljs-string">&quot;pause&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  &#125;<br>  v7 = operateOut(pOut, &amp;Congratulation);       <span class="hljs-comment">// key正确时的输出</span><br>  stdOut(v7, out);<br>  v8 = operateOut(pOut, &amp;unk_408212);<br>  stdOut(v8, out);<br>  getLine(pIn, &amp;flag);                          <span class="hljs-comment">// 获取flag的输入</span><br>  <span class="hljs-keyword">if</span> ( getLength(&amp;flag) != <span class="hljs-number">51</span> )<br>  &#123;<br>    v9 = operateOut(pOut, <span class="hljs-string">&quot;Length Error!&quot;</span>);<br>    stdOut(v9, out);<br>    system(<span class="hljs-string">&quot;pause&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  &#125;<br>  encrypt(&amp;encrypted_message, &amp;flag, &amp;key);     <span class="hljs-comment">// 加密算法，密钥即为前文的key</span><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;::<span class="hljs-built_in">vector</span>(&amp;EndFlag);<br>  __for_range = &amp;encrypted_message;<br>  __for_begin._M_current = (<span class="hljs-type">char</span> *)<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::begin(&amp;encrypted_message);<br>  __for_end._M_current = (<span class="hljs-type">char</span> *)<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::end(__for_range);<br>  <span class="hljs-keyword">while</span> ( __gnu_cxx::operator!=&lt;<span class="hljs-type">char</span> *,<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;(&amp;__for_begin, &amp;__for_end) )<br>  &#123;<br>    c = *__gnu_cxx::__normal_iterator&lt;<span class="hljs-type">char</span> *,<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;::operator*(&amp;__for_begin);<br>    __x = (<span class="hljs-type">unsigned</span> __int8)c;<br>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;::push_back(&amp;EndFlag, &amp;__x);<br>    __gnu_cxx::__normal_iterator&lt;<span class="hljs-type">char</span> *,<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;::operator++(&amp;__for_begin);<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">std</span>::operator==&lt;<span class="hljs-type">int</span>,<span class="hljs-built_in">std</span>::allocator&lt;<span class="hljs-type">int</span>&gt;&gt;(&amp;KALEIDXSCOPE, &amp;EndFlag) )<span class="hljs-comment">// 检验加密结果</span><br>  &#123;<br>    v10 = operateOut(pOut, <span class="hljs-string">&quot;All Perfect!&quot;</span>);<br>    stdOut(v10, out);<br>    system(<span class="hljs-string">&quot;pause&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  &#125;<br>  v11 = operateOut(pOut, <span class="hljs-string">&quot;Try again!&quot;</span>);<br>  stdOut(v11, out);<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;::~<span class="hljs-built_in">vector</span>(&amp;EndFlag);<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>(&amp;encrypted_message);<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>(&amp;key);<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>(&amp;flag);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">//加密函数</span><br><span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *__cdecl <span class="hljs-title function_">modifiedRC4</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *__return_ptr retstr, <span class="hljs-type">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *plaintext, <span class="hljs-type">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *key)</span><br>&#123;<br>  <span class="hljs-type">size_t</span> v3; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">size_t</span> length; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v5; <span class="hljs-comment">// bl</span><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;::reference List; <span class="hljs-comment">// rax</span><br>  __int64 v8; <span class="hljs-comment">// [rsp+0h] [rbp-80h] BYREF</span><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt; k; <span class="hljs-comment">// [rsp+20h] [rbp-60h] BYREF</span><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt; s; <span class="hljs-comment">// [rsp+40h] [rbp-40h] BYREF</span><br>  <span class="hljs-built_in">std</span>::allocator&lt;<span class="hljs-type">int</span>&gt; __a; <span class="hljs-comment">// [rsp+66h] [rbp-1Ah] BYREF</span><br>  <span class="hljs-type">char</span> v12; <span class="hljs-comment">// [rsp+67h] [rbp-19h] BYREF</span><br>  <span class="hljs-type">size_t</span> i; <span class="hljs-comment">// [rsp+68h] [rbp-18h]</span><br><br>  <span class="hljs-built_in">std</span>::allocator&lt;<span class="hljs-type">int</span>&gt;::allocator((<span class="hljs-built_in">std</span>::allocator&lt;<span class="hljs-type">int</span>&gt; *<span class="hljs-type">const</span>)&amp;v8 + <span class="hljs-number">102</span>);<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;::<span class="hljs-built_in">vector</span>(&amp;s, <span class="hljs-number">0x100u</span>LL, &amp;__a);<br>  <span class="hljs-built_in">std</span>::allocator&lt;<span class="hljs-type">int</span>&gt;::~allocator(&amp;__a);<br>  rc4_ksa(&amp;s, key);                             <span class="hljs-comment">// RC4密钥调度算法</span><br>  v3 = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::size(plaintext);<br>  rc4_prga(&amp;k, &amp;s, v3);                         <span class="hljs-comment">// RC4伪随机数生成算法</span><br>  <span class="hljs-built_in">std</span>::allocator&lt;<span class="hljs-type">char</span>&gt;::allocator(&amp;v12);<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::basic_string(retstr, &amp;unk_408037, &amp;v12);<br>  <span class="hljs-built_in">std</span>::allocator&lt;<span class="hljs-type">char</span>&gt;::~allocator(&amp;v12);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0LL</span>; ; ++i )<br>  &#123;<br>    length = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::size(plaintext);<br>    <span class="hljs-keyword">if</span> ( i &gt;= length )<br>      <span class="hljs-keyword">break</span>;<br>    v5 = *(_BYTE *)StrMakeList(plaintext, i);<br>    List = IntMakeList(&amp;k, i);<br>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::operator+=(retstr, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(<span class="hljs-type">char</span>)(v5 ^ *(_BYTE *)List ^ <span class="hljs-number">7</span>));<span class="hljs-comment">// 魔改的地方在这</span><br>  &#125;<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;::~<span class="hljs-built_in">vector</span>(&amp;k);<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;::~<span class="hljs-built_in">vector</span>(&amp;s);<br>  <span class="hljs-keyword">return</span> retstr;<br>&#125;<br><br><span class="hljs-comment">//密钥调度算法</span><br><span class="hljs-type">void</span> __cdecl <span class="hljs-title function_">rc4_ksa</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt; *s, <span class="hljs-type">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> *key)</span><br>&#123;<br>  <span class="hljs-type">int</span> *M_current; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;::iterator v3; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-type">unsigned</span> __int64 v5; <span class="hljs-comment">// rdx</span><br>  _BYTE *List; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v7; <span class="hljs-comment">// dl</span><br>  <span class="hljs-type">int</span> *s_j; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">int</span> *s_i; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">size_t</span> i; <span class="hljs-comment">// [rsp+20h] [rbp-60h]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+2Ch] [rbp-54h]</span><br><br>  M_current = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;::end(s)._M_current;<br>  v3._M_current = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;::begin(s)._M_current;<br>  <span class="hljs-built_in">std</span>::iota&lt;__gnu_cxx::__normal_iterator&lt;<span class="hljs-type">int</span> *,<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;&gt;,<span class="hljs-type">int</span>&gt;(<br>    v3,<br>    (__gnu_cxx::__normal_iterator&lt;<span class="hljs-type">int</span>*,<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt; &gt;)M_current,<br>    <span class="hljs-number">0</span>);<br>  j = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0LL</span>; i &lt;= <span class="hljs-number">255</span>; ++i )<br>  &#123;<br>    v4 = *IntMakeList(s, i) + j;<br>    v5 = i % getLength(key);<br>    List = (_BYTE *)StrMakeList(key, v5);<br>    v7 = v4 + *List;<br>    LODWORD(List) = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)((v4 + (<span class="hljs-type">char</span>)*List) &gt;&gt; <span class="hljs-number">31</span>) &gt;&gt; <span class="hljs-number">24</span>;<br>    j = (<span class="hljs-type">unsigned</span> __int8)((_BYTE)List + v7) - (_DWORD)List;<br>    s_j = IntMakeList(s, j);<br>    s_i = IntMakeList(s, i);<br>    <span class="hljs-built_in">std</span>::swap&lt;<span class="hljs-type">int</span>&gt;(s_i, s_j);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//伪随机数生成算法</span><br><span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt; *__cdecl <span class="hljs-title function_">rc4_prga</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt; *__return_ptr retstr, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt; *s, <span class="hljs-type">size_t</span> length)</span><br>&#123;<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;::reference v3; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> *v4; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">int</span> *v5; <span class="hljs-comment">// rax</span><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;::reference v6; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;::value_type *v7; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">size_t</span> r; <span class="hljs-comment">// [rsp+30h] [rbp-50h]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+38h] [rbp-48h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+3Ch] [rbp-44h]</span><br><br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;::<span class="hljs-built_in">vector</span>(retstr);<br>  i = <span class="hljs-number">0</span>;<br>  j = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( r = <span class="hljs-number">0LL</span>; r &lt; length; ++r )<br>  &#123;<br>    i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>;<br>    v3 = IntMakeList(s, i);<br>    j = (<span class="hljs-type">unsigned</span> __int8)(((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)((j + *v3) &gt;&gt; <span class="hljs-number">31</span>) &gt;&gt; <span class="hljs-number">24</span>) + j + *(_BYTE *)v3)<br>      - ((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)((j + *v3) &gt;&gt; <span class="hljs-number">31</span>) &gt;&gt; <span class="hljs-number">24</span>);<br>    v4 = IntMakeList(s, j);<br>    v5 = IntMakeList(s, i);<br>    <span class="hljs-built_in">std</span>::swap&lt;<span class="hljs-type">int</span>&gt;(v5, v4);<br>    LODWORD(v4) = *IntMakeList(s, i);<br>    v6 = IntMakeList(s, j);<br>    v7 = IntMakeList(<br>           s,<br>           (<span class="hljs-type">int</span>)((<span class="hljs-type">unsigned</span> __int8)(((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(((<span class="hljs-type">int</span>)v4 + *v6) &gt;&gt; <span class="hljs-number">31</span>) &gt;&gt; <span class="hljs-number">24</span>) + (_BYTE)v4 + *(_BYTE *)v6)<br>               - ((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(((<span class="hljs-type">int</span>)v4 + *v6) &gt;&gt; <span class="hljs-number">31</span>) &gt;&gt; <span class="hljs-number">24</span>)));<br>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;::push_back(retstr, v7);<br>  &#125;<br>  <span class="hljs-keyword">return</span> retstr;<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到函数对输入的数据进行了魔改的RC4加密，但实际上没有改变RC4加解密同一个函数的性质，所以解密只需要复现这个代码即可</p><p>下面先获取密钥和加密后的flag数据。在main函数第一个getline处下断点，开始动态调试</p><p><img src="/../images/image-20251024200050353.png" alt="第一个getline处下断点"></p><p>随便输入一个字符后会到长度检测，要求输入的密码长度要等于12，可以输入12个字符也可以后续到这个cmp的时候改jz绕过</p><p><img src="/../images/image-20251024200525655.png" alt="长度检测"></p><p>过了长度检测后就可以一直运行到key检验处，双击生成的密钥的变量名(TrueKey)就可以得到真正的key了（从</p><p>hex窗口可以看到key即为”XaleidscopiX”）</p><p><img src="/../images/image-20251024202016786.png" alt="运行到key检验处"></p><p><img src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-24%20200936.png" alt="真正的key"></p><p>然后还需要获得真正flag的加密数据。往下绕过key检验，运行到jz的时候再改一下ZF标志位（此处应当跳转）</p><p><img src="/../images/image-20251024202256140.png" alt="绕过key检验(已绕过)"></p><p>绕过后终端还有提示</p><p><img src="/../images/image-20251024202606398.png" alt="提示"></p><p>接下来运行到第二个getline，随便输几个数据（有长度检验，最好是输入51个字符，省的绕过长度检验）。然后继续运行到加密结果的检验处</p><p><img src="/../images/image-20251024203359348.png" alt="运行到加密结果检验处"></p><p>其中KALEIDXSCOPE的第一个offset就是正确的flag加密后的数据</p><p><img src="/../images/image-20251024203510922.png" alt="KALEIDXSCOPE第一个offset(unk_2692A10)"></p><p><img src="/../images/image-20251024203610635.png" alt="正确flag加密后的数据"></p><p>解密脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_decrypt</span>(<span class="hljs-params">data, key</span>):<br>    S = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>    j = <span class="hljs-number">0</span><br>    out = []<br><br>    <span class="hljs-comment"># Key-scheduling algorithm (KSA)</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        j = (j + S[i] + key[i % <span class="hljs-built_in">len</span>(key)]) % <span class="hljs-number">256</span><br>        S[i], S[j] = S[j], S[i]<br><br>    <span class="hljs-comment"># Pseudo-random generation algorithm (PRGA)</span><br>    i = <span class="hljs-number">0</span><br>    j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> data:<br>        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span><br>        j = (j + S[i]) % <span class="hljs-number">256</span><br>        S[i], S[j] = S[j], S[i]<br>        K = S[(S[i] + S[j]) % <span class="hljs-number">256</span>]<br>        out.append(K)<br><br>    <span class="hljs-keyword">return</span> out<br><br>enc=[<span class="hljs-number">0x000000FC</span>, <span class="hljs-number">0x000000EA</span>, <span class="hljs-number">0x00000015</span>, <span class="hljs-number">0x0000002C</span>, <span class="hljs-number">0x00000086</span>, <span class="hljs-number">0x00000038</span>, <span class="hljs-number">0x0000003F</span>, <span class="hljs-number">0x000000F3</span>, <span class="hljs-number">0x00000092</span>, <span class="hljs-number">0x000000CE</span>, <span class="hljs-number">0x000000DA</span>, <span class="hljs-number">0x0000008E</span>, <span class="hljs-number">0x00000048</span>, <span class="hljs-number">0x000000D3</span>, <span class="hljs-number">0x00000007</span>, <span class="hljs-number">0x0000009F</span>, <span class="hljs-number">0x000000D9</span>, <span class="hljs-number">0x00000057</span>, <span class="hljs-number">0x000000B1</span>, <span class="hljs-number">0x000000EE</span>, <span class="hljs-number">0x00000041</span>, <span class="hljs-number">0x0000009A</span>, <span class="hljs-number">0x0000004D</span>, <span class="hljs-number">0x000000C5</span>, <span class="hljs-number">0x00000065</span>, <span class="hljs-number">0x0000006A</span>, <span class="hljs-number">0x000000FF</span>, <span class="hljs-number">0x000000C9</span>, <span class="hljs-number">0x0000005D</span>, <span class="hljs-number">0x00000034</span>, <span class="hljs-number">0x000000AD</span>, <span class="hljs-number">0x000000EA</span>, <span class="hljs-number">0x000000B1</span>, <span class="hljs-number">0x00000020</span>, <span class="hljs-number">0x0000004B</span>, <span class="hljs-number">0x000000DC</span>, <span class="hljs-number">0x000000BD</span>, <span class="hljs-number">0x000000D2</span>, <span class="hljs-number">0x00000035</span>, <span class="hljs-number">0x00000002</span>, <span class="hljs-number">0x00000084</span>, <span class="hljs-number">0x00000035</span>, <span class="hljs-number">0x00000071</span>, <span class="hljs-number">0x000000EC</span>, <span class="hljs-number">0x000000E0</span>, <span class="hljs-number">0x00000048</span>, <span class="hljs-number">0x0000008E</span>, <span class="hljs-number">0x000000EA</span>, <span class="hljs-number">0x0000007B</span>, <span class="hljs-number">0x000000AA</span>, <span class="hljs-number">0x000000CF</span>]<br>_key=<span class="hljs-string">&quot;XaleidscopiX&quot;</span><br>key=[]<br>flag=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> _key:<br>    key.append(<span class="hljs-built_in">ord</span>(i))<br><span class="hljs-comment">#print(key)</span><br><br>keystream=rc4_decrypt(enc, key)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    flag.append(enc[i]^keystream[i]^<span class="hljs-number">7</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">chr</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> flag]))<br></code></pre></td></tr></table></figure></li></ul><blockquote><p>flag：0xGame{RC4_15_4_b4s1c&amp;fl3x1bl3_3ncrYp710n4lg0r17hm}</p></blockquote><h2 id="Q-≧▽≦-T"><a href="#Q-≧▽≦-T" class="headerlink" title="Q(≧▽≦)T"></a>Q(≧▽≦)T</h2><blockquote><p>考点：QT程序逆向、crackme、动态调试、RC4、哈希校验</p></blockquote><ul><li><p>附件程序运行如图，是个序列号生成器：</p><p><img src="/../images/image-20251024212602045.png" alt="运行"></p></li><li><p>用IDA打开，出现的是start函数， 看不出什么东西来</p><p><img src="/../images/image-20251024214150526.png" alt="start函数"></p><p>shift+F12看看字符串表，可以发现两串可疑的字符串</p><p><img src="/../images/image-20251024214208963.png" alt="可疑的字符串"></p><p>跟踪过去可以找到这样一个函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">void</span> __fastcall <span class="hljs-title function_">sub_140001890</span><span class="hljs-params">(__int64 a1, __int64 a2, __int64 a3, __int64 a4)</span><br>&#123;<br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v5; <span class="hljs-comment">// rax</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v6; <span class="hljs-comment">// [rsp+80h] [rbp-1F8h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v7; <span class="hljs-comment">// [rsp+88h] [rbp-1F0h]</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v8; <span class="hljs-comment">// [rsp+90h] [rbp-1E8h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v9; <span class="hljs-comment">// [rsp+98h] [rbp-1E0h]</span><br>  __int64 Block; <span class="hljs-comment">// [rsp+A0h] [rbp-1D8h] BYREF</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v11; <span class="hljs-comment">// [rsp+A8h] [rbp-1D0h]</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v12[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+B0h] [rbp-1C8h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v13[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+D0h] [rbp-1A8h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v14[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+F0h] [rbp-188h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v15; <span class="hljs-comment">// [rsp+110h] [rbp-168h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v16[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+130h] [rbp-148h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v17[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+150h] [rbp-128h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v18; <span class="hljs-comment">// [rsp+160h] [rbp-118h]</span><br>  __m128i v19[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+170h] [rbp-108h] BYREF</span><br>  __m128i v20; <span class="hljs-comment">// [rsp+190h] [rbp-E8h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v21[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+1B0h] [rbp-C8h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v22[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+1D0h] [rbp-A8h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v23; <span class="hljs-comment">// [rsp+1E0h] [rbp-98h]</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v24[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+1F0h] [rbp-88h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v25[<span class="hljs-number">13</span>]; <span class="hljs-comment">// [rsp+210h] [rbp-68h] BYREF</span><br><br>  ((<span class="hljs-type">void</span> (__fastcall *)(<span class="hljs-type">void</span> *, <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 **, _QWORD, <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 **))QLineEdit::text)(<br>    QLineEdit::text,<br>    v25,<br>    *(_QWORD *)(*(_QWORD *)(a4 + <span class="hljs-number">40</span>) + <span class="hljs-number">16LL</span>),<br>    v25);<br>  QString::trimmed_helper(QLineEdit::text, v25, v25, v12);<br>  <span class="hljs-keyword">if</span> ( v25[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(v25[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>    <span class="hljs-built_in">free</span>(QLineEdit::text);<br>  ((<span class="hljs-type">void</span> (__fastcall *)(<span class="hljs-type">void</span> *, <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 **, _QWORD, <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 **))QLineEdit::text)(<br>    QLineEdit::text,<br>    v25,<br>    *(_QWORD *)(*(_QWORD *)(a4 + <span class="hljs-number">40</span>) + <span class="hljs-number">24LL</span>),<br>    v13);<br>  <span class="hljs-keyword">if</span> ( v12[<span class="hljs-number">2</span>] == (<span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *)<span class="hljs-number">4</span> )<br>  &#123;<br>    QString::toUtf8_helper(QLineEdit::text, v25, v12, v14);<br>    Block = (__int64)v14[<span class="hljs-number">2</span>];<br>    v11 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)v14[<span class="hljs-number">1</span>];<br>    QCryptographicHash::hash(&amp;Block, v25, &amp;Block, &amp;v15, <span class="hljs-number">4LL</span>);<br>    sub_140001620((__int64)&amp;Block, (__int64)v25, a4, (__int64)v16);<br>    Block = <span class="hljs-number">64LL</span>;<br>    v11 = <span class="hljs-string">&quot;c94201919ec7463313c747d0a27fabcabf1400fa1e9a64d36a6b1a7e7b12ae68&quot;</span>;<br>    QString::fromUtf8(&amp;Block, v25, &amp;Block, v17);<br>    <span class="hljs-keyword">if</span> ( v18 == v16[<span class="hljs-number">2</span>]<br>      &amp;&amp; (v8 = v18, v6 = v18, v9 = v16[<span class="hljs-number">1</span>], v7 = v17[<span class="hljs-number">1</span>], (<span class="hljs-type">unsigned</span> __int8)QtPrivate::equalStrings(&amp;Block, v25, &amp;v6, &amp;v8)) )<br>    &#123;<br>      QString::toUtf8_helper(&amp;Block, v25, v13, v19);<br>      sub_1400016F0((__int64)&amp;Block, (__int64)v25, a4, &amp;v20, v19, (__int64)v14);<br>      sub_140001620((__int64)&amp;Block, (__int64)v25, a4, (__int64)v21);<br>      Block = <span class="hljs-number">72LL</span>;<br>      v11 = <span class="hljs-string">&quot;af33da5e152c15863b3a03c87601899a37d51b8b8168f65aca65352d3669e91959300ccb&quot;</span>;<br>      QString::fromUtf8(&amp;Block, v25, &amp;Block, v22);<br>      <span class="hljs-keyword">if</span> ( v23 == v21[<span class="hljs-number">2</span>]<br>        &amp;&amp; (v8 = v23, v9 = v21[<span class="hljs-number">1</span>],<br>                      v6 = v23,<br>                      v7 = v22[<span class="hljs-number">1</span>],<br>                      (<span class="hljs-type">unsigned</span> __int8)QtPrivate::equalStrings(&amp;Block, v25, &amp;v6, &amp;v8)) )<br>      &#123;<br>        Block = <span class="hljs-number">21LL</span>;<br>        v11 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)&amp;unk_1400061D8;<br>        QString::fromUtf8(&amp;Block, v25, &amp;Block, v25);<br>        Block = <span class="hljs-number">12LL</span>;<br>        v11 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)&amp;unk_1400061EE;<br>        QString::fromUtf8(&amp;Block, v25, &amp;Block, v24);<br>        QMessageBox::information(&amp;Block, v25, v24, a4, v25, <span class="hljs-number">1024LL</span>);<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        Block = <span class="hljs-number">22LL</span>;<br>        v11 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)&amp;unk_1400061C1;<br>        QString::fromUtf8(&amp;Block, v25, &amp;Block, v25);<br>        Block = <span class="hljs-number">12LL</span>;<br>        v11 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)&amp;unk_140006104;<br>        QString::fromUtf8(&amp;Block, v25, &amp;Block, v24);<br>        QMessageBox::warning(&amp;Block, v25, v24, a4, v25, <span class="hljs-number">1024LL</span>);<br>      &#125;<br>      <span class="hljs-keyword">if</span> ( v24[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(v24[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>        <span class="hljs-built_in">free</span>(&amp;Block);<br>      <span class="hljs-keyword">if</span> ( v25[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(v25[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>        <span class="hljs-built_in">free</span>(&amp;Block);<br>      <span class="hljs-keyword">if</span> ( v22[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(v22[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>        <span class="hljs-built_in">free</span>(&amp;Block);<br>      <span class="hljs-keyword">if</span> ( v21[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(v21[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>        <span class="hljs-built_in">free</span>(&amp;Block);<br>      <span class="hljs-keyword">if</span> ( v20.m128i_i64[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub((<span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *)v20.m128i_i64[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>        <span class="hljs-built_in">free</span>(&amp;Block);<br>      <span class="hljs-keyword">if</span> ( !v19[<span class="hljs-number">0</span>].m128i_i64[<span class="hljs-number">0</span>] || _InterlockedSub((<span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *)v19[<span class="hljs-number">0</span>].m128i_i64[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>        <span class="hljs-keyword">goto</span> LABEL_45;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      Block = <span class="hljs-number">25LL</span>;<br>      v11 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)&amp;unk_140006159;<br>      QString::fromUtf8(&amp;Block, v25, &amp;Block, v25);<br>      Block = <span class="hljs-number">12LL</span>;<br>      v11 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)&amp;unk_140006104;<br>      QString::fromUtf8(&amp;Block, v25, &amp;Block, v24);<br>      QMessageBox::warning(&amp;Block, v25, v24, a4, v25, <span class="hljs-number">1024LL</span>);<br>      <span class="hljs-keyword">if</span> ( v24[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(v24[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>        <span class="hljs-built_in">free</span>(&amp;Block);<br>      <span class="hljs-keyword">if</span> ( !v25[<span class="hljs-number">0</span>] || _InterlockedSub(v25[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>        <span class="hljs-keyword">goto</span> LABEL_45;<br>    &#125;<br>    <span class="hljs-built_in">free</span>(&amp;Block);<br>LABEL_45:<br>    <span class="hljs-keyword">if</span> ( v17[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(v17[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>      <span class="hljs-built_in">free</span>(&amp;Block);<br>    <span class="hljs-keyword">if</span> ( v16[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(v16[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>      <span class="hljs-built_in">free</span>(&amp;Block);<br>    <span class="hljs-keyword">if</span> ( v15 &amp;&amp; !_InterlockedSub(v15, <span class="hljs-number">1u</span>) )<br>      <span class="hljs-built_in">free</span>(&amp;Block);<br>    <span class="hljs-keyword">if</span> ( v14[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(v14[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>      <span class="hljs-built_in">free</span>(&amp;Block);<br>    <span class="hljs-keyword">goto</span> LABEL_10;<br>  &#125;<br>  Block = <span class="hljs-number">35LL</span>;<br>  v11 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)&amp;unk_1400060E0;<br>  QString::fromUtf8(&amp;Block, v25, &amp;Block, v25);<br>  Block = <span class="hljs-number">12LL</span>;<br>  v11 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)&amp;unk_140006104;<br>  QString::fromUtf8(&amp;Block, v25, &amp;Block, v24);<br>  QMessageBox::warning(&amp;Block, v25, v24, a4, v25, <span class="hljs-number">1024LL</span>);<br>  <span class="hljs-keyword">if</span> ( v24[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(v24[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>  &#123;<br>    <span class="hljs-built_in">free</span>(&amp;Block);<br>    v5 = v25[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">if</span> ( !v25[<span class="hljs-number">0</span>] )<br>      <span class="hljs-keyword">goto</span> LABEL_10;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v5 = v25[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">if</span> ( !v25[<span class="hljs-number">0</span>] )<br>      <span class="hljs-keyword">goto</span> LABEL_10;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( !_InterlockedSub(v5, <span class="hljs-number">1u</span>) )<br>    <span class="hljs-built_in">free</span>(&amp;Block);<br>LABEL_10:<br>  <span class="hljs-keyword">if</span> ( v13[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(v13[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>    <span class="hljs-built_in">free</span>(&amp;Block);<br>  <span class="hljs-keyword">if</span> ( v12[<span class="hljs-number">0</span>] )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( !_InterlockedSub(v12[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>      <span class="hljs-built_in">free</span>(&amp;Block);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>程序的图形化界面是QT实现的，引入了QT的很多类，所以阅读难度还是有点大的。借助AI优化一下以及一点点动态调试辅助分析可以得到：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __fastcall <span class="hljs-title function_">check</span><span class="hljs-params">(__int64 a1, __int64 a2, __int64 a3, __int64 mainWindows)</span><br>&#123;<br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v5; <span class="hljs-comment">// rax</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v6; <span class="hljs-comment">// [rsp+80h] [rbp-1F8h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v7; <span class="hljs-comment">// [rsp+88h] [rbp-1F0h]</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v8; <span class="hljs-comment">// [rsp+90h] [rbp-1E8h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v9; <span class="hljs-comment">// [rsp+98h] [rbp-1E0h]</span><br>  __int64 Block; <span class="hljs-comment">// [rsp+A0h] [rbp-1D8h] BYREF</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *stringData; <span class="hljs-comment">// [rsp+A8h] [rbp-1D0h]</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *usernameUtf8[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+B0h] [rbp-1C8h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *passwordUtf8[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+D0h] [rbp-1A8h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *usernameBytes[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+F0h] [rbp-188h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *usernameHash; <span class="hljs-comment">// [rsp+110h] [rbp-168h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *usernameHashHex[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+130h] [rbp-148h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v17[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+150h] [rbp-128h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *expectedUserHashSize; <span class="hljs-comment">// [rsp+160h] [rbp-118h]</span><br>  __m128i passwordBytes[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+170h] [rbp-108h] BYREF</span><br>  __m128i v20; <span class="hljs-comment">// [rsp+190h] [rbp-E8h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v21[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+1B0h] [rbp-C8h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v22[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+1D0h] [rbp-A8h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v23; <span class="hljs-comment">// [rsp+1E0h] [rbp-98h]</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v24[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+1F0h] [rbp-88h] BYREF</span><br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *tempBuffer[<span class="hljs-number">13</span>]; <span class="hljs-comment">// [rsp+210h] [rbp-68h] BYREF</span><br><br>  (QLineEdit::text)(QLineEdit::text, tempBuffer, *(*(mainWindows + <span class="hljs-number">40</span>) + <span class="hljs-number">16LL</span>), tempBuffer);<br>  QString::trimmed_helper(QLineEdit::text, tempBuffer, tempBuffer, usernameUtf8);<br>  <span class="hljs-keyword">if</span> ( tempBuffer[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(tempBuffer[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>    <span class="hljs-built_in">free</span>(QLineEdit::text);<br>  (QLineEdit::text)(QLineEdit::text, tempBuffer, *(*(mainWindows + <span class="hljs-number">40</span>) + <span class="hljs-number">24LL</span>), passwordUtf8);<br>  <span class="hljs-keyword">if</span> ( usernameUtf8[<span class="hljs-number">2</span>] == <span class="hljs-number">4</span> )                   <span class="hljs-comment">// 长度检验</span><br>  &#123;<br>    QString::toUtf8_helper(QLineEdit::text, tempBuffer, usernameUtf8, usernameBytes);<br>    Block = usernameBytes[<span class="hljs-number">2</span>];<br>    stringData = usernameBytes[<span class="hljs-number">1</span>];<br>    QCryptographicHash::hash(&amp;Block, tempBuffer, &amp;Block, &amp;usernameHash, <span class="hljs-number">4LL</span>);<span class="hljs-comment">// 求输入的用户名hash</span><br>    toHex(&amp;Block, tempBuffer, mainWindows, usernameHashHex);<br>    Block = <span class="hljs-number">64LL</span>;<br>    stringData = <span class="hljs-string">&quot;c94201919ec7463313c747d0a27fabcabf1400fa1e9a64d36a6b1a7e7b12ae68&quot;</span>;<span class="hljs-comment">// 预设哈希值</span><br>    QString::fromUtf8(&amp;Block, tempBuffer, &amp;Block, v17);<br>    <span class="hljs-keyword">if</span> ( expectedUserHashSize == usernameHashHex[<span class="hljs-number">2</span>]<br>      &amp;&amp; (v8 = expectedUserHashSize,<br>          v6 = expectedUserHashSize,<br>          v9 = usernameHashHex[<span class="hljs-number">1</span>],<br>          v7 = v17[<span class="hljs-number">1</span>],<br>          QtPrivate::equalStrings(&amp;Block, tempBuffer, &amp;v6, &amp;v8)) )<span class="hljs-comment">// 用户名检验</span><br>    &#123;<br>      QString::toUtf8_helper(&amp;Block, tempBuffer, passwordUtf8, passwordBytes);<br>      RC4(&amp;Block, tempBuffer, mainWindows, &amp;v20, passwordBytes, usernameBytes);<br>      toHex(&amp;Block, tempBuffer, mainWindows, v21);<br>      Block = <span class="hljs-number">72LL</span>;<br>      stringData = <span class="hljs-string">&quot;af33da5e152c15863b3a03c87601899a37d51b8b8168f65aca65352d3669e91959300ccb&quot;</span>;<br>      QString::fromUtf8(&amp;Block, tempBuffer, &amp;Block, v22);<br>      <span class="hljs-keyword">if</span> ( v23 == v21[<span class="hljs-number">2</span>]<br>        &amp;&amp; (v8 = v23, v9 = v21[<span class="hljs-number">1</span>], v6 = v23, v7 = v22[<span class="hljs-number">1</span>], QtPrivate::equalStrings(&amp;Block, tempBuffer, &amp;v6, &amp;v8)) )<span class="hljs-comment">// 验证通过</span><br>      &#123;<br>        Block = <span class="hljs-number">21LL</span>;<br>        stringData = &amp;unk_7FF7F2EB61D8;<br>        QString::fromUtf8(&amp;Block, tempBuffer, &amp;Block, tempBuffer);<br>        Block = <span class="hljs-number">12LL</span>;<br>        stringData = &amp;unk_7FF7F2EB61EE;<br>        QString::fromUtf8(&amp;Block, tempBuffer, &amp;Block, v24);<br>        QMessageBox::information(&amp;Block, tempBuffer, v24, mainWindows, tempBuffer, <span class="hljs-number">1024LL</span>);<br>      &#125;<br>      <span class="hljs-keyword">else</span>                                      <span class="hljs-comment">// 密码验证不通过</span><br>      &#123;<br>        Block = <span class="hljs-number">22LL</span>;<br>        stringData = &amp;unk_7FF7F2EB61C1;<br>        QString::fromUtf8(&amp;Block, tempBuffer, &amp;Block, tempBuffer);<br>        Block = <span class="hljs-number">12LL</span>;<br>        stringData = &amp;unk_7FF7F2EB6104;<br>        QString::fromUtf8(&amp;Block, tempBuffer, &amp;Block, v24);<br>        QMessageBox::warning(&amp;Block, tempBuffer, v24, mainWindows, tempBuffer, <span class="hljs-number">1024LL</span>);<br>      &#125;<br>      <span class="hljs-keyword">if</span> ( v24[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(v24[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>        <span class="hljs-built_in">free</span>(&amp;Block);<br>      <span class="hljs-keyword">if</span> ( tempBuffer[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(tempBuffer[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>        <span class="hljs-built_in">free</span>(&amp;Block);<br>      <span class="hljs-keyword">if</span> ( v22[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(v22[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>        <span class="hljs-built_in">free</span>(&amp;Block);<br>      <span class="hljs-keyword">if</span> ( v21[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(v21[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>        <span class="hljs-built_in">free</span>(&amp;Block);<br>      <span class="hljs-keyword">if</span> ( v20.m128i_i64[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(v20.m128i_i64[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>        <span class="hljs-built_in">free</span>(&amp;Block);<br>      <span class="hljs-keyword">if</span> ( !passwordBytes[<span class="hljs-number">0</span>].m128i_i64[<span class="hljs-number">0</span>] || _InterlockedSub(passwordBytes[<span class="hljs-number">0</span>].m128i_i64[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>        <span class="hljs-keyword">goto</span> LABEL_45;<br>    &#125;<br>    <span class="hljs-keyword">else</span>                                        <span class="hljs-comment">// 用户名验证不通过</span><br>    &#123;<br>      Block = <span class="hljs-number">25LL</span>;<br>      stringData = &amp;unk_7FF7F2EB6159;<br>      QString::fromUtf8(&amp;Block, tempBuffer, &amp;Block, tempBuffer);<br>      Block = <span class="hljs-number">12LL</span>;<br>      stringData = &amp;unk_7FF7F2EB6104;<br>      QString::fromUtf8(&amp;Block, tempBuffer, &amp;Block, v24);<br>      QMessageBox::warning(&amp;Block, tempBuffer, v24, mainWindows, tempBuffer, <span class="hljs-number">1024LL</span>);<br>      <span class="hljs-keyword">if</span> ( v24[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(v24[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>        <span class="hljs-built_in">free</span>(&amp;Block);<br>      <span class="hljs-keyword">if</span> ( !tempBuffer[<span class="hljs-number">0</span>] || _InterlockedSub(tempBuffer[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>        <span class="hljs-keyword">goto</span> LABEL_45;<br>    &#125;<br>    <span class="hljs-built_in">free</span>(&amp;Block);<br>LABEL_45:<br>    <span class="hljs-keyword">if</span> ( v17[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(v17[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>      <span class="hljs-built_in">free</span>(&amp;Block);<br>    <span class="hljs-keyword">if</span> ( usernameHashHex[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(usernameHashHex[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>      <span class="hljs-built_in">free</span>(&amp;Block);<br>    <span class="hljs-keyword">if</span> ( usernameHash &amp;&amp; !_InterlockedSub(usernameHash, <span class="hljs-number">1u</span>) )<br>      <span class="hljs-built_in">free</span>(&amp;Block);<br>    <span class="hljs-keyword">if</span> ( usernameBytes[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(usernameBytes[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>      <span class="hljs-built_in">free</span>(&amp;Block);<br>    <span class="hljs-keyword">goto</span> LABEL_10;<br>  &#125;<br>  Block = <span class="hljs-number">35LL</span>;<br>  stringData = &amp;unk_7FF7F2EB60E0;<br>  QString::fromUtf8(&amp;Block, tempBuffer, &amp;Block, tempBuffer);<br>  Block = <span class="hljs-number">12LL</span>;<br>  stringData = &amp;unk_7FF7F2EB6104;<br>  QString::fromUtf8(&amp;Block, tempBuffer, &amp;Block, v24);<br>  QMessageBox::warning(&amp;Block, tempBuffer, v24, mainWindows, tempBuffer, <span class="hljs-number">1024LL</span>);<br>  <span class="hljs-keyword">if</span> ( v24[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(v24[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>  &#123;<br>    <span class="hljs-built_in">free</span>(&amp;Block);<br>    v5 = tempBuffer[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">if</span> ( !tempBuffer[<span class="hljs-number">0</span>] )<br>      <span class="hljs-keyword">goto</span> LABEL_10;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v5 = tempBuffer[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">if</span> ( !tempBuffer[<span class="hljs-number">0</span>] )<br>      <span class="hljs-keyword">goto</span> LABEL_10;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( !_InterlockedSub(v5, <span class="hljs-number">1u</span>) )<br>    <span class="hljs-built_in">free</span>(&amp;Block);<br>LABEL_10:<br>  <span class="hljs-keyword">if</span> ( passwordUtf8[<span class="hljs-number">0</span>] &amp;&amp; !_InterlockedSub(passwordUtf8[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>    <span class="hljs-built_in">free</span>(&amp;Block);<br>  <span class="hljs-keyword">if</span> ( usernameUtf8[<span class="hljs-number">0</span>] )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( !_InterlockedSub(usernameUtf8[<span class="hljs-number">0</span>], <span class="hljs-number">1u</span>) )<br>      <span class="hljs-built_in">free</span>(&amp;Block);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到用户名采用的是哈希检验，密码采用的是RC4检验，密钥为用户名。</p><p>密码检验套在用户名检验里，所以第一步先解出用户名。借助在线解密网站<a href="https://hashes.com/zh/decrypt/hash">MD5 在線免費解密</a>可以得到用户名”Kath”：</p><p><img src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-20%20215617.png" alt="sha256解密得到用户名"></p><p>接下来求解密码。RC4函数如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs C">__m128i *__fastcall <span class="hljs-title function_">RC4</span><span class="hljs-params">(</span><br><span class="hljs-params">        __int64 a1,</span><br><span class="hljs-params">        __int64 a2,</span><br><span class="hljs-params">        __int64 a3,</span><br><span class="hljs-params">        __m128i *a4,</span><br><span class="hljs-params">        <span class="hljs-type">const</span> __m128i *passwordBytes,</span><br><span class="hljs-params">        __int64 usernameBytes)</span><br>&#123;<br>  <span class="hljs-keyword">volatile</span> <span class="hljs-type">signed</span> __int32 *v6; <span class="hljs-comment">// rax</span><br>  __int64 v7; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">bool</span> v8; <span class="hljs-comment">// zf</span><br>  <span class="hljs-type">int</span> keyLength; <span class="hljs-comment">// r11d</span><br>  <span class="hljs-type">int</span> *sBoxPtr; <span class="hljs-comment">// r8</span><br>  __m128i initVal; <span class="hljs-comment">// xmm0</span><br>  __m128i *sBoxInitPtr; <span class="hljs-comment">// rax</span><br>  __m128i v15; <span class="hljs-comment">// xmm2</span><br>  __m128i currentVal; <span class="hljs-comment">// xmm1</span><br>  __int64 keyBytes; <span class="hljs-comment">// rdi</span><br>  <span class="hljs-type">int</span> i_ksa; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">int</span> j_ksa; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v20; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> sBoxVal; <span class="hljs-comment">// r10d</span><br>  __int64 sum; <span class="hljs-comment">// kr00_8</span><br>  __int64 passwordIndex; <span class="hljs-comment">// r12</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// ebp</span><br>  __int64 i; <span class="hljs-comment">// rdi</span><br>  <span class="hljs-type">int</span> temp; <span class="hljs-comment">// eax</span><br>  __int64 v27; <span class="hljs-comment">// kr08_8</span><br>  <span class="hljs-type">char</span> v28; <span class="hljs-comment">// r14</span><br>  _DWORD S[<span class="hljs-number">256</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-438h] BYREF</span><br>  <span class="hljs-type">char</span> v31; <span class="hljs-comment">// [rsp+420h] [rbp-38h] BYREF</span><br><br>  v6 = passwordBytes-&gt;m128i_i64[<span class="hljs-number">0</span>];<br>  v7 = passwordBytes[<span class="hljs-number">1</span>].m128i_i64[<span class="hljs-number">0</span>];<br>  v8 = passwordBytes-&gt;m128i_i64[<span class="hljs-number">0</span>] == <span class="hljs-number">0</span>;<br>  *a4 = _mm_loadu_si128(passwordBytes);<br>  a4[<span class="hljs-number">1</span>].m128i_i64[<span class="hljs-number">0</span>] = v7;<br>  <span class="hljs-keyword">if</span> ( !v8 )<br>    _InterlockedAdd(v6, <span class="hljs-number">1u</span>);<br>  keyLength = *(usernameBytes + <span class="hljs-number">16</span>);<br>  sBoxPtr = S;<br>  initVal = _mm_load_si128(&amp;xmmword_7FF7F2EB6200);<br>  sBoxInitPtr = S;<br>  v15 = _mm_load_si128(&amp;xmmword_7FF7F2EB6210);<br>  <span class="hljs-keyword">do</span><br>  &#123;<br>    currentVal = initVal;<br>    ++sBoxInitPtr;<br>    initVal = _mm_add_epi32(initVal, v15);<br>    sBoxInitPtr[<span class="hljs-number">-1</span>] = currentVal;<br>  &#125;<br>  <span class="hljs-keyword">while</span> ( sBoxInitPtr != &amp;v31 );<br>  keyBytes = *(usernameBytes + <span class="hljs-number">8</span>);<br>  i_ksa = <span class="hljs-number">0</span>;<br>  j_ksa = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">do</span>                                            <span class="hljs-comment">// RC4_KSA</span><br>  &#123;<br>    v20 = i_ksa;<br>    sBoxVal = *sBoxPtr;<br>    ++i_ksa;<br>    ++sBoxPtr;<br>    sum = sBoxVal + j_ksa + *(keyBytes + v20 % keyLength);<br>    j_ksa = (HIBYTE(sum) + sum) - HIBYTE(HIDWORD(sum));<span class="hljs-comment">// j = j % 256</span><br>    *(sBoxPtr - <span class="hljs-number">1</span>) = S[j_ksa];<br>    S[j_ksa] = sBoxVal;<br>  &#125;<br>  <span class="hljs-keyword">while</span> ( i_ksa != <span class="hljs-number">256</span> );<br>  <span class="hljs-keyword">if</span> ( passwordBytes[<span class="hljs-number">1</span>].m128i_i64[<span class="hljs-number">0</span>] &gt; <span class="hljs-number">0</span> )      <span class="hljs-comment">// RC4_PRGA和RC4decrypt</span><br>  &#123;<br>    passwordIndex = <span class="hljs-number">0LL</span>;<br>    j = <span class="hljs-number">0</span>;<br>    LODWORD(i) = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">do</span><br>    &#123;<br>      i = ((i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>);<br>      temp = S[i];<br>      j = (temp + j) % <span class="hljs-number">256</span>;<br>      S[i] = S[j];<br>      S[j] = temp;<br>      v27 = S[i] + temp;<br>      v28 = *(passwordBytes-&gt;m128i_i64[<span class="hljs-number">1</span>] + passwordIndex) ^ S[(HIBYTE(v27) + v27) - HIBYTE(HIDWORD(v27))];<span class="hljs-comment">// v28 = passwordBytes[passwordIndex] ^ S[(S[i]+S[j])%256]</span><br>      <span class="hljs-keyword">if</span> ( !a4-&gt;m128i_i64[<span class="hljs-number">0</span>] || *a4-&gt;m128i_i64[<span class="hljs-number">0</span>] &gt; <span class="hljs-number">1</span> )<br>        QByteArray::reallocData(i, passwordBytes, a4[<span class="hljs-number">1</span>].m128i_i64[<span class="hljs-number">0</span>], a4, <span class="hljs-number">1LL</span>, *initVal.m128i_i64);<br>      *(a4-&gt;m128i_i64[<span class="hljs-number">1</span>] + passwordIndex++) = v28;<br>    &#125;<br>    <span class="hljs-keyword">while</span> ( passwordBytes[<span class="hljs-number">1</span>].m128i_i64[<span class="hljs-number">0</span>] &gt; passwordIndex );<br>  &#125;<br>  <span class="hljs-keyword">return</span> a4;<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看出是标准的RC4，直接复现加密函数即可。解密脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_ksa</span>(<span class="hljs-params">key</span>):<br>    S = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>    j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        j = (j + S[i] + key[i % <span class="hljs-built_in">len</span>(key)]) % <span class="hljs-number">256</span><br>        S[i], S[j] = S[j], S[i]<br>    <span class="hljs-keyword">return</span> S<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_prga</span>(<span class="hljs-params">S, n</span>):<br>    i = j = <span class="hljs-number">0</span><br>    keystream = []<br>    S = S[:]  <span class="hljs-comment"># copy</span><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span><br>        j = (j + S[i]) % <span class="hljs-number">256</span><br>        S[i], S[j] = S[j], S[i]<br>        k = S[(S[i] + S[j]) % <span class="hljs-number">256</span>]<br>        keystream.append(k)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(keystream)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_decrypt</span>(<span class="hljs-params">key, ciphertext</span>):<br>    S = rc4_ksa(key)<br>    ks = rc4_prga(S, <span class="hljs-built_in">len</span>(ciphertext))<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(c ^ k <span class="hljs-keyword">for</span> c, k <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(ciphertext, ks))<br><br>key = <span class="hljs-string">b&quot;Kath&quot;</span><br>cipher = <span class="hljs-string">&quot;af33da5e152c15863b3a03c87601899a37d51b8b8168f65aca65352d3669e91959300ccb&quot;</span><br><br><span class="hljs-comment"># 转成bytes</span><br>ciphertext = <span class="hljs-built_in">bytes</span>.fromhex(cipher)<br><br><span class="hljs-comment"># 解密</span><br>plaintext = rc4_decrypt(key, ciphertext)<br><br><span class="hljs-comment"># 输出</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Plaintext:&quot;</span>, plaintext)<br><br></code></pre></td></tr></table></figure></li></ul><blockquote><p>flag：0xGame{ce5e5621-3d6b-4429-b72a-957abf353390}</p></blockquote><h2 id="Calamity-Fortune"><a href="#Calamity-Fortune" class="headerlink" title="Calamity_Fortune"></a>Calamity_Fortune</h2><blockquote><p><del>这题，哈哈，数据提取错了题目截止提交48分钟后我才发现这个问题解出flag😄🫠我永远都不会原谅我自己了😄哈哈哈哈</del></p><p>考点：函数重写、复杂加密算法逆向、动态调试绕过程序机制</p></blockquote><ul><li><p>附件程序双击运行会提示如图</p><p><img src="/../images/image-20251021220052848.png" alt="双击提示"></p><p>然而，随便输一个数字的话会闪退</p></li><li><p>程序用IDA打开，main函数反编译如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// ecx</span><br>  __int64 v7; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">char</span> v8; <span class="hljs-comment">// cl</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [rsp+20h] [rbp-58h] BYREF</span><br>  <span class="hljs-type">char</span> v11[<span class="hljs-number">9</span>]; <span class="hljs-comment">// [rsp+27h] [rbp-51h] BYREF</span><br>  _QWORD v12[<span class="hljs-number">5</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-48h]</span><br>  <span class="hljs-type">int</span> v13; <span class="hljs-comment">// [rsp+58h] [rbp-20h]</span><br>  __int16 v14; <span class="hljs-comment">// [rsp+5Ch] [rbp-1Ch]</span><br><br>  sub_401600(argc, argv, envp);<br>  SetConsoleOutputCP(<span class="hljs-number">0xFDE9u</span>);<br>  SetConsoleCP(<span class="hljs-number">0xFDE9u</span>);<br>  v3 = time64(<span class="hljs-number">0LL</span>);<br>  srand(v3);<br>  v10 = <span class="hljs-number">0</span>;<br>  v4 = rand();<br>  <span class="hljs-built_in">puts</span>(&amp;Buffer);<br>  v5 = <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;v10);<br>  v6 = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( v10 == v4 % <span class="hljs-number">100</span> + <span class="hljs-number">1</span> )<br>    &#123;<br>      MessageBoxA(<span class="hljs-number">0LL</span>, <span class="hljs-string">&quot;You guessed right! Is it really right?&quot;</span>, <span class="hljs-string">&quot;Result&quot;</span>, <span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      v7 = <span class="hljs-number">0LL</span>;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;You guessed it wrong!&quot;</span>);<br>      <span class="hljs-built_in">puts</span>(&amp;byte_405098);<br>      v12[<span class="hljs-number">0</span>] = <span class="hljs-number">0xD0F0C00002B1973L</span>L;<br>      v12[<span class="hljs-number">1</span>] = <span class="hljs-number">0x182B1A043E1F082BL</span>L;<br>      v12[<span class="hljs-number">2</span>] = <span class="hljs-number">0x151236080A0D071CL</span>L;<br>      v12[<span class="hljs-number">3</span>] = <span class="hljs-number">0xA150C0111330622L</span>L;<br>      v12[<span class="hljs-number">4</span>] = <span class="hljs-number">0xD2B190804073E26L</span>L;<br>      v13 = <span class="hljs-number">251992113</span>;<br>      v14 = <span class="hljs-number">5130</span>;<br>      <span class="hljs-built_in">strcpy</span>(v11, <span class="hljs-string">&quot;Calamity&quot;</span>);<br>      <span class="hljs-keyword">do</span><br>      &#123;<br>        v8 = *((_BYTE *)v12 + v7) ^ v11[v7 &amp; <span class="hljs-number">7</span>];<br>        ++v7;<br>        <span class="hljs-built_in">putchar</span>(v8);<br>      &#125;<br>      <span class="hljs-keyword">while</span> ( v7 != <span class="hljs-number">46</span> );<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> v6;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>v12看着像密文，的确是密文，但不是flag的密文，因为它在输入错误的提示里。暂时没有发现flag检验函数，尝试先绕过数字检验</p><p>在汇编窗口找到数字判断语句（可以在反编译界面选中判断语句所在行，右键Jump to Disasm到达）</p><p><img src="/../images/image-20251021220816989.png" alt="判断语句的汇编"></p><p>可以看到这是一个jz，只需要在执行到这句但是还没步过时，修改ZF标志位即可绕过。在此处F2下断点，开始动调程序。随便输个数字，按回车</p><p><img src="/../images/image-20251021220921683.png" alt="随便输个数字"></p><p>此时程序停在jz处，即我们下断点的地方</p><p><img src="/../images/image-20251021221202643.png" alt="停在jz处"></p><p>在右上侧寄存器窗口找到ZF</p><p><img src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-21%20221235.png" alt="找到ZF"></p><p>双击ZF把它的值改成0x1</p><p><img src="/../images/image-20251021221613970.png" alt="修改ZF标志位"></p><p>可以看到jz语句处有一条箭头出来了</p><p><img src="/../images/image-20251021221637985.png" alt="绿色箭头"></p><p>F8执行jz跳转，跟踪程序执行流。可以看到程序运行到一个类似输出函数的地方</p><p><img src="/../images/image-20251021222114925.png" alt="类似输出函数的地方"></p><p>这时候，在这里多试几次会发现MessageBoxA可以步入。当然要是步过这个call MessageBoxA会发现程序没有弹出窗口，倒是终端输出了新的句子，十分可疑</p><p><img src="/../images/image-20251021222341398.png" alt="终端的新输出"></p><p>所以在程序执行到call cs:MessageBoxA这句的时候按F7步入，就会发现这个MessageBoxA别有洞天</p><p><img src="/../images/image-20251021222417932.png" alt="别有洞天"></p><p>这显然不像是MessageBoxA应该有的操作。可以看到一个可疑的地址被放到了rax里，跟踪这个jmp看看（jmp rax处F7步入）</p><p><img src="/../images/image-20251021222757420.png" alt="jmp后"></p><p>可以看到程序运行到了一个新函数，F5反编译，反编译代码如下（函数有多个模块的加密处理，还是很复杂的，以下是经过变量名优化的代码）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br></pre></td><td class="code"><pre><code class="hljs C">__int64 <span class="hljs-title function_">realMain</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">char</span> v0; <span class="hljs-comment">// dl</span><br>  <span class="hljs-type">char</span> *v1; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v2; <span class="hljs-comment">// dl</span><br>  <span class="hljs-type">char</span> *i; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">unsigned</span> __int8 *pFlag1; <span class="hljs-comment">// r9</span><br>  _BYTE *pFlag; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v7; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">char</span> v8; <span class="hljs-comment">// dl</span><br>  <span class="hljs-type">char</span> *j; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *p_block0; <span class="hljs-comment">// r10</span><br>  <span class="hljs-type">unsigned</span> __int8 *current_1; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">int</span> shift; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> temp_2; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> temp_1; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> cureent_block; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> delta; <span class="hljs-comment">// r11d</span><br>  <span class="hljs-type">int</span> key_value; <span class="hljs-comment">// ebp</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> prev_block; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *block; <span class="hljs-comment">// r8</span><br>  <span class="hljs-type">int</span> rounds; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> next; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> oriDelta; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">unsigned</span> __int8 *encrypted_bytes_1; <span class="hljs-comment">// r10</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *v24; <span class="hljs-comment">// rdi</span><br>  _DWORD *v25; <span class="hljs-comment">// r8</span><br>  _DWORD *v26; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> shift_1; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v28; <span class="hljs-comment">// edx</span><br>  _BYTE *v29; <span class="hljs-comment">// r9</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v30; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">unsigned</span> __int64 k; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v32; <span class="hljs-comment">// dl</span><br>  _BYTE *current1; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">int</span> randNum; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> tmp; <span class="hljs-comment">// r8</span><br>  _BYTE *target; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">unsigned</span> __int8 *v37; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">unsigned</span> __int8 *end; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">unsigned</span> __int8 *current; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> *v40; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">int</span> m; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v42; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> n; <span class="hljs-comment">// dl</span><br>  <span class="hljs-type">char</span> v44; <span class="hljs-comment">// dl</span><br>  <span class="hljs-type">char</span> *ii; <span class="hljs-comment">// rax</span><br>  _QWORD key[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-218h] BYREF</span><br>  <span class="hljs-type">char</span> notice2[<span class="hljs-number">22</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-208h] BYREF</span><br>  __int16 v49; <span class="hljs-comment">// [rsp+46h] [rbp-1F2h] BYREF</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> block0; <span class="hljs-comment">// [rsp+50h] [rbp-1E8h] BYREF</span><br>  <span class="hljs-type">int</span> v51; <span class="hljs-comment">// [rsp+54h] [rbp-1E4h] BYREF</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> block10; <span class="hljs-comment">// [rsp+78h] [rbp-1C0h]</span><br>  _BYTE encrypted_bytes[<span class="hljs-number">44</span>]; <span class="hljs-comment">// [rsp+80h] [rbp-1B8h] BYREF</span><br>  <span class="hljs-type">int</span> v54; <span class="hljs-comment">// [rsp+ACh] [rbp-18Ch] BYREF</span><br>  _BYTE flag[<span class="hljs-number">44</span>]; <span class="hljs-comment">// [rsp+B0h] [rbp-188h] BYREF</span><br>  <span class="hljs-type">char</span> v56; <span class="hljs-comment">// [rsp+DCh] [rbp-15Ch] BYREF</span><br>  _QWORD enc[<span class="hljs-number">7</span>]; <span class="hljs-comment">// [rsp+E0h] [rbp-158h] BYREF</span><br>  <span class="hljs-type">int</span> v58; <span class="hljs-comment">// [rsp+118h] [rbp-120h]</span><br>  _BYTE base64_output[<span class="hljs-number">59</span>]; <span class="hljs-comment">// [rsp+120h] [rbp-118h] BYREF</span><br>  _BYTE end_1[<span class="hljs-number">5</span>]; <span class="hljs-comment">// [rsp+15Bh] [rbp-DDh] BYREF</span><br>  <span class="hljs-type">char</span> temp[<span class="hljs-number">64</span>]; <span class="hljs-comment">// [rsp+160h] [rbp-D8h] BYREF</span><br>  <span class="hljs-type">char</span> notice1[<span class="hljs-number">85</span>]; <span class="hljs-comment">// [rsp+1A0h] [rbp-98h] BYREF</span><br>  _BYTE v63[<span class="hljs-number">3</span>]; <span class="hljs-comment">// [rsp+1F5h] [rbp-43h] BYREF</span><br><br>  v0 = <span class="hljs-number">79</span>;<br>  enc[<span class="hljs-number">0</span>] = <span class="hljs-number">0x280D30732B077874L</span>L;<br>  enc[<span class="hljs-number">1</span>] = <span class="hljs-number">0x242D00103573060BL</span>L;<br>  enc[<span class="hljs-number">2</span>] = <span class="hljs-number">0x141C3406727D2F73L</span>L;<br>  enc[<span class="hljs-number">3</span>] = <span class="hljs-number">0xA71137676362833L</span>L;<br>  enc[<span class="hljs-number">4</span>] = <span class="hljs-number">0xE232B242F04742AL</span>L;<br>  enc[<span class="hljs-number">5</span>] = <span class="hljs-number">0x2F373F03033D7310L</span>L;<br>  enc[<span class="hljs-number">6</span>] = <span class="hljs-number">0x77067C3612772D7DL</span>L;<br>  qmemcpy(key, <span class="hljs-string">&quot;Calamity_Fortune&quot;</span>, <span class="hljs-keyword">sizeof</span>(key));<br>  qmemcpy(<br>    notice1,<br>    <span class="hljs-string">&quot;Ofqni`&#x27;jfcb&#x27;ns&#x27;sont&#x27;afu+&#x27;sob&#x27;tretbvrbis&#x27;bidu~wsnhi&#x27;tohrkc&#x27;eb&#x27;f&#x27;wnbdb&#x27;ha&#x27;dflb&#x27;ahu&#x27;~hry&quot;</span>,<br>    <span class="hljs-keyword">sizeof</span>(notice1));<br>  v1 = notice1;<br>  v58 = <span class="hljs-number">0x37233104</span>;<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    *v1++ = v0 ^ <span class="hljs-number">7</span>;<br>    <span class="hljs-keyword">if</span> ( v63 == v1 )<br>      <span class="hljs-keyword">break</span>;<br>    v0 = *v1;<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(notice1);                                <span class="hljs-comment">// Having made it this far,......</span><br>  v2 = <span class="hljs-number">87</span>;<br>  qmemcpy(notice2, <span class="hljs-string">&quot;Wkbftb&#x27;Niwrs&#x27;~hru&#x27;akf`&quot;</span>, <span class="hljs-keyword">sizeof</span>(notice2));<br>  <span class="hljs-keyword">for</span> ( i = notice2; ; v2 = *i )<br>  &#123;<br>    *i++ = v2 ^ <span class="hljs-number">7</span>;<br>    <span class="hljs-keyword">if</span> ( i == &amp;v49 )<br>      <span class="hljs-keyword">break</span>;<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(notice2);                                <span class="hljs-comment">// Please input your flag</span><br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%44s&quot;</span>, flag);<br>  v4 = flag[<span class="hljs-number">0</span>];<br>  v56 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> ( !flag[<span class="hljs-number">0</span>] )<br>    <span class="hljs-keyword">goto</span> LABEL_11;<br>  pFlag1 = flag;<br>  pFlag = flag;<br>  <span class="hljs-keyword">do</span><br>    v7 = <span class="hljs-number">1</span> - flag + pFlag++;<br>  <span class="hljs-keyword">while</span> ( *pFlag );<br>  <span class="hljs-keyword">if</span> ( v7 != <span class="hljs-number">44</span> )<br>  &#123;<br>LABEL_11:                                       <span class="hljs-comment">// 错误时的输出</span><br>    v8 = <span class="hljs-number">75</span>;<br>    qmemcpy(temp, <span class="hljs-string">&quot;Kbi`so&#x27;Buuhu&amp;&quot;</span>, <span class="hljs-number">13</span>);<br>    <span class="hljs-keyword">for</span> ( j = temp; ; v8 = *j )<br>    &#123;<br>      *j++ = v8 ^ <span class="hljs-number">7</span>;<br>      <span class="hljs-keyword">if</span> ( &amp;temp[<span class="hljs-number">13</span>] == j )<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-built_in">puts</span>(temp);                                 <span class="hljs-comment">// 错误时的输出</span><br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  &#125;<br>  p_block0 = &amp;block0;<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )                                   <span class="hljs-comment">// bytesToBlock，转成uint32_t</span><br>  &#123;<br>    current_1 = pFlag1;<br>    shift = <span class="hljs-number">0</span>;<br>    temp_2 = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>    &#123;<br>      temp_1 = v4 &lt;&lt; shift;<br>      shift += <span class="hljs-number">8</span>;<br>      ++current_1;<br>      temp_2 |= temp_1;<br>      <span class="hljs-keyword">if</span> ( shift == <span class="hljs-number">32</span> )<br>        <span class="hljs-keyword">break</span>;<br>      v4 = *current_1;<br>    &#125;<br>    pFlag1 += <span class="hljs-number">4</span>;<br>    *p_block0++ = temp_2;<br>    <span class="hljs-keyword">if</span> ( &amp;v56 == pFlag1 )<br>      <span class="hljs-keyword">break</span>;<br>    v4 = *pFlag1;<br>  &#125;<br>  cureent_block = block10;<br>  delta = <span class="hljs-number">0x9E3779B9</span>;<br>  key_value = <span class="hljs-number">0x616C6143</span>;<br>  prev_block = block0;<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )                                   <span class="hljs-comment">// xxtea</span><br>  &#123;<br>    block = &amp;block0;<br>    <span class="hljs-keyword">for</span> ( rounds = <span class="hljs-number">0</span>; ; ++rounds )<br>    &#123;<br>      next = block[<span class="hljs-number">1</span>];<br>      ++block;<br>      cureent_block = prev_block<br>                    + (((cureent_block ^ *(key + (((delta &gt;&gt; <span class="hljs-number">2</span>) ^ rounds) &amp; <span class="hljs-number">3</span>))) + (next ^ delta)) ^ (((<span class="hljs-number">4</span> * next) ^ (cureent_block &gt;&gt; <span class="hljs-number">5</span>)) + ((<span class="hljs-number">16</span> * cureent_block) ^ (next &gt;&gt; <span class="hljs-number">3</span>))));<br>      *(block - <span class="hljs-number">1</span>) = cureent_block;<br>      <span class="hljs-keyword">if</span> ( rounds == <span class="hljs-number">9</span> )<br>        <span class="hljs-keyword">break</span>;<br>      prev_block = *block;<br>    &#125;<br>    prev_block = block0;<br>    oriDelta = delta;<br>    delta -= <span class="hljs-number">0x61C88647</span>;<br>    cureent_block = block10<br>                  + ((((cureent_block &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * block0)) + ((<span class="hljs-number">16</span> * cureent_block) ^ (block0 &gt;&gt; <span class="hljs-number">3</span>))) ^ ((block0 ^ oriDelta) + (key_value ^ cureent_block)));<br>    block10 = cureent_block;<br>    <span class="hljs-keyword">if</span> ( delta == <span class="hljs-number">0xCC623AF3</span> )<br>      <span class="hljs-keyword">break</span>;<br>    key_value = *(key + (((delta &gt;&gt; <span class="hljs-number">2</span>) ^ <span class="hljs-number">0xA</span>) &amp; <span class="hljs-number">3</span>));<br>  &#125;<br>  encrypted_bytes_1 = encrypted_bytes;<br>  v24 = &amp;v51;                                   <span class="hljs-comment">// blockToBytes，uint32_t转成bytes</span><br>  v25 = encrypted_bytes;<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    v26 = v25;<br>    <span class="hljs-keyword">for</span> ( shift_1 = <span class="hljs-number">0</span>; shift_1 != <span class="hljs-number">32</span>; shift_1 += <span class="hljs-number">8</span> )<br>    &#123;<br>      v26 = (v26 + <span class="hljs-number">1</span>);<br>      v28 = prev_block &gt;&gt; shift_1;<br>      *(v26 - <span class="hljs-number">1</span>) = v28;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( &amp;v54 == ++v25 )<br>      <span class="hljs-keyword">break</span>;<br>    prev_block = *v24++;<br>  &#125;<br>  qmemcpy(temp, <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>, <span class="hljs-keyword">sizeof</span>(temp));<br>  v29 = base64_output;<br>  <span class="hljs-keyword">do</span>                                            <span class="hljs-comment">// base64encode</span><br>  &#123;<br>    v30 = *encrypted_bytes_1 &lt;&lt; <span class="hljs-number">16</span>;<br>    <span class="hljs-keyword">if</span> ( v7 != <span class="hljs-number">1</span> )<br>    &#123;<br>      v30 |= encrypted_bytes_1[<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">8</span>;<br>      <span class="hljs-keyword">if</span> ( v7 &gt; <span class="hljs-number">2</span> )<br>        v30 |= encrypted_bytes_1[<span class="hljs-number">2</span>];<br>    &#125;<br>    <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0LL</span>; k != <span class="hljs-number">4</span>; ++k )<br>    &#123;<br>      v32 = <span class="hljs-number">61</span>;<br>      <span class="hljs-keyword">if</span> ( k &lt;= v7 )<br>        v32 = temp[(v30 &gt;&gt; (<span class="hljs-number">-6</span> * k + <span class="hljs-number">18</span>)) &amp; <span class="hljs-number">0x3F</span>];<br>      v29[k] = v32;<br>    &#125;<br>    encrypted_bytes_1 += <span class="hljs-number">3</span>;<br>    v29 += <span class="hljs-number">4</span>;<br>    v7 -= <span class="hljs-number">3</span>;<br>  &#125;<br>  <span class="hljs-keyword">while</span> ( (&amp;v54 + <span class="hljs-number">1</span>) != encrypted_bytes_1 );<br>  current1 = end_1;<br>  end_1[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;<br>  srand(<span class="hljs-number">0x65u</span>);                                 <span class="hljs-comment">// shuffle</span><br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    randNum = rand();<br>    tmp = *current1;<br>    target = &amp;base64_output[randNum % (<span class="hljs-number">60</span> - end_1 + current1)];<br>    *current1 = *target;<br>    *target = tmp;<br>    v37 = current1 - <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> ( base64_output == current1 - <span class="hljs-number">1</span> )<br>      <span class="hljs-keyword">break</span>;<br>    --current1;<br>  &#125;<br>  end = current1 + <span class="hljs-number">59</span>;<br>  current = v37;<br>  <span class="hljs-keyword">do</span>                                            <span class="hljs-comment">// xor</span><br>    *current++ ^= <span class="hljs-number">0x45u</span>;<br>  <span class="hljs-keyword">while</span> ( end != current );<br>  v40 = enc + <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">for</span> ( m = <span class="hljs-number">116</span>; ; m = *v40++ )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( *v37 != m )                            <span class="hljs-comment">// 错误处理的输出</span><br>    &#123;<br>      qmemcpy(temp, <span class="hljs-string">&quot;Dfkfjns~&amp;&#x27;wkbftb&#x27;su~&#x27;f`fni&quot;</span>, <span class="hljs-number">26</span>);<br>      v42 = temp;<br>      <span class="hljs-keyword">for</span> ( n = <span class="hljs-number">68</span>; ; n = *v42 )<br>      &#123;<br>        *v42++ = n ^ <span class="hljs-number">7</span>;<br>        <span class="hljs-keyword">if</span> ( &amp;temp[<span class="hljs-number">26</span>] == v42 )<br>          <span class="hljs-keyword">break</span>;<br>      &#125;<br>      <span class="hljs-built_in">puts</span>(temp);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;                                           <span class="hljs-comment">// 错误处理的输出</span><br>    <span class="hljs-keyword">if</span> ( end == ++v37 )<br>      <span class="hljs-keyword">break</span>;<br>  &#125;<br>  v44 = <span class="hljs-number">65</span>;<br>  qmemcpy(temp, <span class="hljs-string">&quot;Ahusrib&amp;@hhc&#x27;Krdl&amp;&quot;</span>, <span class="hljs-number">18</span>);<br>  <span class="hljs-keyword">for</span> ( ii = temp; ; v44 = *ii )<br>  &#123;<br>    *ii++ = v44 ^ <span class="hljs-number">7</span>;<br>    <span class="hljs-keyword">if</span> ( &amp;temp[<span class="hljs-number">18</span>] == ii )<br>      <span class="hljs-keyword">break</span>;<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(temp);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>函数出现在程序输入flag的提示之后，应该就是flag检验函数了。函数使用了很多加密手段，甚至连提示词都是实时解密的。可以看到对输入的flag依次进行了格式转换、魔改XXTEA加密、格式转换、base64编码、shuffle洗牌算法打乱、异或处理，最后才和预设的密文进行比较检验。</p><p>这里给出一个AI复现的、经过测试等价的脚本，方便理解这个复杂的算法（被函数改写整怕了，所以随机数生成算法也复现了）：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-comment">// MSVC-compatible rand</span><br><span class="hljs-type">static</span> <span class="hljs-type">uint32_t</span> rand_seed;<br><span class="hljs-type">void</span> <span class="hljs-title function_">custom_srand</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> seed)</span> &#123; rand_seed = seed; &#125;<br><span class="hljs-type">uint32_t</span> <span class="hljs-title function_">custom_rand</span><span class="hljs-params">()</span> &#123;<br>    rand_seed = rand_seed * <span class="hljs-number">214013</span> + <span class="hljs-number">2531011</span>;<br>    <span class="hljs-keyword">return</span> (rand_seed &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0x7FFF</span>;<br>&#125;<br><br><span class="hljs-comment">// XXTEA encryption (as in realMain)</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">encrypt_xxtea_variant</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> block[<span class="hljs-number">11</span>], <span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> key[<span class="hljs-number">4</span>])</span> &#123;<br>    <span class="hljs-type">uint32_t</span> cureent_block = block[<span class="hljs-number">10</span>];<br>    <span class="hljs-type">uint32_t</span> delta = <span class="hljs-number">0x9E3779B9U</span>;<br>    <span class="hljs-type">uint32_t</span> key_value = <span class="hljs-number">0x616C6143U</span>; <span class="hljs-comment">// 初始值，但第一轮内循环不用它</span><br>    <span class="hljs-type">uint32_t</span> prev_block = block[<span class="hljs-number">0</span>];<br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-type">uint32_t</span>* bptr = &amp;block[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> rounds = <span class="hljs-number">0</span>; ; ++rounds) &#123;<br>            <span class="hljs-type">uint32_t</span> next = bptr[<span class="hljs-number">1</span>];<br>            ++bptr;<br>            <span class="hljs-type">uint32_t</span> k = key[((delta &gt;&gt; <span class="hljs-number">2</span>) ^ rounds) &amp; <span class="hljs-number">3</span>];<br>            <span class="hljs-type">uint32_t</span> term1 = (cureent_block ^ k) + (next ^ delta);<br>            <span class="hljs-type">uint32_t</span> term2 = (<span class="hljs-number">4</span> * next ^ (cureent_block &gt;&gt; <span class="hljs-number">5</span>)) + (<span class="hljs-number">16</span> * cureent_block ^ (next &gt;&gt; <span class="hljs-number">3</span>));<br>            cureent_block = prev_block + (term1 ^ term2);<br>            *(bptr - <span class="hljs-number">1</span>) = cureent_block;<br>            <span class="hljs-keyword">if</span> (rounds == <span class="hljs-number">9</span>) <span class="hljs-keyword">break</span>;<br>            prev_block = *bptr; <span class="hljs-comment">// 此时 *bptr 尚未被修改（是原始值）</span><br>        &#125;<br><br>        prev_block = block[<span class="hljs-number">0</span>];<br>        <span class="hljs-type">uint32_t</span> oriDelta = delta;<br>        delta -= <span class="hljs-number">0x61C88647U</span>;<br>        key_value = key[((oriDelta &gt;&gt; <span class="hljs-number">2</span>) ^ <span class="hljs-number">0xA</span>) &amp; <span class="hljs-number">3</span>];<br>        <span class="hljs-type">uint32_t</span> term1 = ((cureent_block &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * block[<span class="hljs-number">0</span>])) + ((<span class="hljs-number">16</span> * cureent_block) ^ (block[<span class="hljs-number">0</span>] &gt;&gt; <span class="hljs-number">3</span>));<br>        <span class="hljs-type">uint32_t</span> term2 = (block[<span class="hljs-number">0</span>] ^ oriDelta) + (key_value ^ cureent_block);<br>        cureent_block = block[<span class="hljs-number">10</span>] + (term1 ^ term2);<br>        block[<span class="hljs-number">10</span>] = cureent_block;<br><br>        <span class="hljs-keyword">if</span> (delta == <span class="hljs-number">0xCC623AF3U</span>) <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// Base64 encode 44 bytes -&gt; 60 chars</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">base64_encode</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">uint8_t</span>* input, <span class="hljs-type">char</span>* output)</span> &#123;<br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* table = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">44</span>; i += <span class="hljs-number">3</span>) &#123;<br>        <span class="hljs-type">uint32_t</span> val = (input[i] &lt;&lt; <span class="hljs-number">16</span>) |<br>            ((i + <span class="hljs-number">1</span> &lt; <span class="hljs-number">44</span> ? input[i + <span class="hljs-number">1</span>] : <span class="hljs-number">0</span>) &lt;&lt; <span class="hljs-number">8</span>) |<br>            ((i + <span class="hljs-number">2</span> &lt; <span class="hljs-number">44</span> ? input[i + <span class="hljs-number">2</span>] : <span class="hljs-number">0</span>));<br>        output[<span class="hljs-number">0</span>] = table[(val &gt;&gt; <span class="hljs-number">18</span>) &amp; <span class="hljs-number">0x3F</span>];<br>        output[<span class="hljs-number">1</span>] = table[(val &gt;&gt; <span class="hljs-number">12</span>) &amp; <span class="hljs-number">0x3F</span>];<br>        output[<span class="hljs-number">2</span>] = (i + <span class="hljs-number">1</span> &lt; <span class="hljs-number">44</span>) ? table[(val &gt;&gt; <span class="hljs-number">6</span>) &amp; <span class="hljs-number">0x3F</span>] : <span class="hljs-string">&#x27;=&#x27;</span>;<br>        output[<span class="hljs-number">3</span>] = (i + <span class="hljs-number">2</span> &lt; <span class="hljs-number">44</span>) ? table[val &amp; <span class="hljs-number">0x3F</span>] : <span class="hljs-string">&#x27;=&#x27;</span>;<br>        output += <span class="hljs-number">4</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// Step 1: Input flag</span><br>    <span class="hljs-type">char</span> flag[<span class="hljs-number">45</span>] = <span class="hljs-string">&quot;0xGame&#123;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#125;&quot;</span>;<span class="hljs-comment">//测试样例</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Input flag: %s\n&quot;</span>, flag);<br><br>    <span class="hljs-comment">// Step 2: Convert to 11 uint32_t (little-endian)</span><br>    <span class="hljs-type">uint32_t</span> blocks[<span class="hljs-number">11</span>];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">11</span>; i++) &#123;<br>        blocks[i] = (<span class="hljs-type">uint8_t</span>)flag[i * <span class="hljs-number">4</span>] |<br>            ((<span class="hljs-type">uint8_t</span>)flag[i * <span class="hljs-number">4</span> + <span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">8</span>) |<br>            ((<span class="hljs-type">uint8_t</span>)flag[i * <span class="hljs-number">4</span> + <span class="hljs-number">2</span>] &lt;&lt; <span class="hljs-number">16</span>) |<br>            ((<span class="hljs-type">uint8_t</span>)flag[i * <span class="hljs-number">4</span> + <span class="hljs-number">3</span>] &lt;&lt; <span class="hljs-number">24</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// Step 3: XXTEA encrypt</span><br>    <span class="hljs-type">uint32_t</span> key[<span class="hljs-number">4</span>] = &#123;<br>        <span class="hljs-number">0x616C6143</span>, <span class="hljs-comment">// &#x27;C&#x27;,&#x27;a&#x27;,&#x27;l&#x27;,&#x27;a&#x27;</span><br>        <span class="hljs-number">0x7974696D</span>, <span class="hljs-comment">// &#x27;m&#x27;,&#x27;i&#x27;,&#x27;t&#x27;,&#x27;y&#x27;</span><br>        <span class="hljs-number">0x726F465F</span>, <span class="hljs-comment">// &#x27;_&#x27;,&#x27;F&#x27;,&#x27;o&#x27;,&#x27;r&#x27;</span><br>        <span class="hljs-number">0x656E7574</span>  <span class="hljs-comment">// &#x27;t&#x27;,&#x27;u&#x27;,&#x27;n&#x27;,&#x27;e&#x27;</span><br>    &#125;;<br>    encrypt_xxtea_variant(blocks, key);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;TEA encrypted blocks (hex, little-endian order):\n&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">11</span>; i++) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%08x\n&quot;</span>, blocks[i]);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>    <span class="hljs-comment">// Step 4: Convert back to bytes (little-endian)</span><br>    <span class="hljs-type">uint8_t</span> encrypted_bytes[<span class="hljs-number">44</span>];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">11</span>; i++) &#123;<br>        encrypted_bytes[i * <span class="hljs-number">4</span>] = blocks[i] &amp; <span class="hljs-number">0xFF</span>;<br>        encrypted_bytes[i * <span class="hljs-number">4</span> + <span class="hljs-number">1</span>] = (blocks[i] &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>;<br>        encrypted_bytes[i * <span class="hljs-number">4</span> + <span class="hljs-number">2</span>] = (blocks[i] &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>;<br>        encrypted_bytes[i * <span class="hljs-number">4</span> + <span class="hljs-number">3</span>] = (blocks[i] &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xFF</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// Step 5: Base64 encode</span><br>    <span class="hljs-type">char</span> base64_str[<span class="hljs-number">61</span>] = &#123; <span class="hljs-number">0</span> &#125;;<br>    base64_encode(encrypted_bytes, base64_str);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Base64: %s\n&quot;</span>, base64_str);<br><br>    <span class="hljs-comment">// Step 6: Shuffle (Fisher-Yates, i=59 downto 1)</span><br>    custom_srand(<span class="hljs-number">0x65</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">59</span>; i &gt;= <span class="hljs-number">1</span>; i--) &#123;<br>        <span class="hljs-type">int</span> j = custom_rand() % (i + <span class="hljs-number">1</span>);<br>        <span class="hljs-comment">// Swap base64_str[i] and base64_str[j]</span><br>        <span class="hljs-type">char</span> tmp = base64_str[i];<br>        base64_str[i] = base64_str[j];<br>        base64_str[j] = tmp;<br>    &#125;<br><br>    <span class="hljs-comment">// Output shuffled result (before XOR)</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;After shuffle (before XOR): %s\n&quot;</span>, base64_str);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Hex dump:\n&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">60</span>; i++) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%02x &quot;</span>, (<span class="hljs-type">uint8_t</span>)base64_str[i]);<br>        <span class="hljs-keyword">if</span> ((i + <span class="hljs-number">1</span>) % <span class="hljs-number">16</span> == <span class="hljs-number">0</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-number">60</span> % <span class="hljs-number">16</span> != <span class="hljs-number">0</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">60</span>; i++) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%02x &quot;</span>, (<span class="hljs-type">uint8_t</span>)base64_str[i] ^ <span class="hljs-number">0x45</span>);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>解密思路：异或模块直接一模一样地重复一遍即可；shuffle模块可以先从加密算法获得随机数序列，这样方便从后往前索引还原；剩下的看脚本吧🫠（对了，要注意enc数据要从栈上提取，笔者让AI从反编译的代码里提取，肉眼检验没发现bytes截取错了，浪费了好多时间）</p></li><li><p>解密脚本：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-comment">// ========== 你提供的解密函数 ==========</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">decrypt_xxtea_variant</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> block[<span class="hljs-number">11</span>], <span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> key[<span class="hljs-number">4</span>])</span> &#123;<br>    <span class="hljs-type">const</span> <span class="hljs-type">int</span> TOTAL_ROUNDS = <span class="hljs-number">10</span>;<br>    <span class="hljs-type">uint32_t</span> delta = <span class="hljs-number">0xCC623AF3U</span>;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> round = <span class="hljs-number">0</span>; round &lt; TOTAL_ROUNDS; round++) &#123;<br>        <span class="hljs-type">uint32_t</span> oriDelta = delta + <span class="hljs-number">0x61C88647U</span>;<br>        <span class="hljs-type">uint32_t</span> key_value = key[((oriDelta &gt;&gt; <span class="hljs-number">2</span>) ^ <span class="hljs-number">0xA</span>) &amp; <span class="hljs-number">3</span>];<br><br>        <span class="hljs-type">uint32_t</span> C9 = block[<span class="hljs-number">9</span>];<br>        <span class="hljs-type">uint32_t</span> C0 = block[<span class="hljs-number">0</span>];<br>        <span class="hljs-type">uint32_t</span> term1 = ((C9 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * C0)) + ((<span class="hljs-number">16</span> * C9) ^ (C0 &gt;&gt; <span class="hljs-number">3</span>));<br>        <span class="hljs-type">uint32_t</span> term2 = (C0 ^ oriDelta) + (key_value ^ C9);<br>        <span class="hljs-type">uint32_t</span> G = term1 ^ term2;<br>        <span class="hljs-type">uint32_t</span> original_block10 = block[<span class="hljs-number">10</span>] - G;<br><br>        <span class="hljs-type">uint32_t</span> saved_block10 = original_block10;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">9</span>; i &gt;= <span class="hljs-number">0</span>; i--) &#123;<br>            <span class="hljs-type">uint32_t</span> next = (i == <span class="hljs-number">9</span>) ? saved_block10 : block[i + <span class="hljs-number">1</span>];<br>            <span class="hljs-type">uint32_t</span> prev_C = (i == <span class="hljs-number">0</span>) ? saved_block10 : block[i - <span class="hljs-number">1</span>];<br><br>            <span class="hljs-type">uint32_t</span> k = key[((oriDelta &gt;&gt; <span class="hljs-number">2</span>) ^ i) &amp; <span class="hljs-number">3</span>];<br>            <span class="hljs-type">uint32_t</span> part1 = (prev_C ^ k) + (next ^ oriDelta);<br>            <span class="hljs-type">uint32_t</span> part2 = (<span class="hljs-number">4</span> * next ^ (prev_C &gt;&gt; <span class="hljs-number">5</span>)) + (<span class="hljs-number">16</span> * prev_C ^ (next &gt;&gt; <span class="hljs-number">3</span>));<br>            <span class="hljs-type">uint32_t</span> H = part1 ^ part2;<br><br>            block[i] = block[i] - H;<br>        &#125;<br><br>        block[<span class="hljs-number">10</span>] = original_block10;<br>        delta += <span class="hljs-number">0x61C88647U</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">const</span> <span class="hljs-type">char</span>* table = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">base64_decode</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* input, <span class="hljs-type">uint8_t</span>* output)</span> &#123;<br>    <span class="hljs-type">int</span> out_len = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">60</span>; i += <span class="hljs-number">4</span>) &#123;<br>        <span class="hljs-type">uint32_t</span> val = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">4</span>; j++) &#123;<br>            <span class="hljs-type">const</span> <span class="hljs-type">char</span>* p = <span class="hljs-built_in">strchr</span>(table, input[i + j]);<br>            <span class="hljs-keyword">if</span> (p) val = (val &lt;&lt; <span class="hljs-number">6</span>) | (p - table);<br>            <span class="hljs-keyword">else</span> val &lt;&lt;= <span class="hljs-number">6</span>;<br>        &#125;<br>        output[out_len++] = (val &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>;<br>        <span class="hljs-keyword">if</span> (input[i + <span class="hljs-number">2</span>] != <span class="hljs-string">&#x27;=&#x27;</span>) output[out_len++] = (val &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>;<br>        <span class="hljs-keyword">if</span> (input[i + <span class="hljs-number">3</span>] != <span class="hljs-string">&#x27;=&#x27;</span>) output[out_len++] = val &amp; <span class="hljs-number">0xFF</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> out_len;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">deshuffle</span><span class="hljs-params">(<span class="hljs-type">char</span>* cipher, <span class="hljs-type">uint32_t</span>* rand_seq)</span> &#123;<br>    <span class="hljs-comment">// 逆序遍历：t 从 58 到 0</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> t = <span class="hljs-number">58</span>; t &gt;= <span class="hljs-number">0</span>; t--) &#123;<br>        <span class="hljs-type">int</span> i = <span class="hljs-number">59</span> - t;          <span class="hljs-comment">// 加密时的 i</span><br>        <span class="hljs-type">int</span> j = rand_seq[t];     <span class="hljs-comment">// 加密时的 j</span><br>        <span class="hljs-comment">// 再次交换 cipher[i] 和 cipher[j]</span><br>        <span class="hljs-type">char</span> temp = cipher[i];<br>        cipher[i] = cipher[j];<br>        cipher[j] = temp;<br>    &#125;<br>&#125;<br><span class="hljs-comment">// ========== 主程序 ==========</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// Step 1: 使用你提供的 60 字节目标密文</span><br>    <span class="hljs-type">uint8_t</span> encrypted_target_bytes[<span class="hljs-number">60</span>] = &#123;<br>        <span class="hljs-number">0x74</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x28</span>,<br>        <span class="hljs-number">0x0B</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x24</span>,<br>        <span class="hljs-number">0x73</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0x14</span>,<br>        <span class="hljs-number">0x33</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x0A</span>,<br>        <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x4</span>, <span class="hljs-number">0x2f</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x2b</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0xe</span>,<br>        <span class="hljs-number">0x10</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x2F</span>,<br>        <span class="hljs-number">0x7D</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x77</span>,<br>        <span class="hljs-number">0x04</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x37</span><br>    &#125;;<br><br>    <span class="hljs-comment">// Step 2: XOR 0x45 得到 shuffled base64 字符串</span><br>    <span class="hljs-type">char</span> shuffled_b64[<span class="hljs-number">60</span>] = &#123; <span class="hljs-number">0</span> &#125;;<br>    <span class="hljs-comment">//printf(&quot;step1: xor\n&quot;);</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">60</span>; i++) &#123;<br>        shuffled_b64[i] = encrypted_target_bytes[i] ^ <span class="hljs-number">0x45</span>;<br>        <span class="hljs-comment">//printf(&quot;%c&quot;, shuffled_b64[i]);</span><br>    &#125;<br>    <span class="hljs-comment">//printf(&quot;\nstep2: deshuffle\n&quot;);</span><br>    <span class="hljs-comment">// Step 3: 使用你提供的 rand() 序列（原始值，未取模）</span><br>    <span class="hljs-type">uint32_t</span> rand_seq[<span class="hljs-number">59</span>] = &#123;<br>        <span class="hljs-number">8</span>, <span class="hljs-number">46</span>, <span class="hljs-number">21</span>, <span class="hljs-number">19</span>, <span class="hljs-number">35</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">7</span>, <span class="hljs-number">37</span>, <span class="hljs-number">17</span>,<br>        <span class="hljs-number">33</span>, <span class="hljs-number">13</span>, <span class="hljs-number">17</span>, <span class="hljs-number">10</span>, <span class="hljs-number">34</span>, <span class="hljs-number">34</span>, <span class="hljs-number">6</span>, <span class="hljs-number">20</span>, <span class="hljs-number">35</span>, <span class="hljs-number">10</span>,<br>        <span class="hljs-number">22</span>, <span class="hljs-number">21</span>, <span class="hljs-number">7</span>, <span class="hljs-number">16</span>, <span class="hljs-number">6</span>, <span class="hljs-number">18</span>, <span class="hljs-number">30</span>, <span class="hljs-number">32</span>, <span class="hljs-number">6</span>, <span class="hljs-number">2</span>,<br>        <span class="hljs-number">9</span>, <span class="hljs-number">0</span>, <span class="hljs-number">7</span>, <span class="hljs-number">4</span>, <span class="hljs-number">23</span>, <span class="hljs-number">18</span>, <span class="hljs-number">18</span>, <span class="hljs-number">16</span>, <span class="hljs-number">15</span>, <span class="hljs-number">15</span>,<br>        <span class="hljs-number">6</span>, <span class="hljs-number">15</span>, <span class="hljs-number">16</span>, <span class="hljs-number">3</span>, <span class="hljs-number">13</span>, <span class="hljs-number">13</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">11</span>, <span class="hljs-number">10</span>,<br>        <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br>    &#125;;<br>    deshuffle(shuffled_b64, rand_seq);<br>    <span class="hljs-comment">//for (int i = 0; i &lt; 60; i++) &#123;</span><br>        <span class="hljs-comment">//printf(&quot;%c&quot;, shuffled_b64[i]);</span><br>    <span class="hljs-comment">//&#125;</span><br>    <span class="hljs-type">char</span> original_b64[<span class="hljs-number">61</span>] = &#123; <span class="hljs-number">0</span> &#125;;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">60</span>; i++) &#123;<br>        original_b64[i] = shuffled_b64[i];<br>    &#125;<br>    original_b64[<span class="hljs-number">60</span>] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>    <span class="hljs-comment">//printf(&quot;\n&quot;);</span><br><br>    <span class="hljs-comment">// Step 4: Base64 解码</span><br>    <span class="hljs-type">uint8_t</span> encrypted_bytes[<span class="hljs-number">44</span>];<br>    <span class="hljs-type">int</span> decoded_len = base64_decode(original_b64, encrypted_bytes);<br>    <span class="hljs-keyword">if</span> (decoded_len != <span class="hljs-number">44</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// Step 5: 重组为 11 个 uint32_t（小端序）</span><br>    <span class="hljs-type">uint32_t</span> block[<span class="hljs-number">11</span>];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">11</span>; i++) &#123;<br>        block[i] = ((<span class="hljs-type">uint32_t</span>)encrypted_bytes[i * <span class="hljs-number">4</span> + <span class="hljs-number">0</span>] &lt;&lt; <span class="hljs-number">0</span>) |<br>            ((<span class="hljs-type">uint32_t</span>)encrypted_bytes[i * <span class="hljs-number">4</span> + <span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">8</span>) |<br>            ((<span class="hljs-type">uint32_t</span>)encrypted_bytes[i * <span class="hljs-number">4</span> + <span class="hljs-number">2</span>] &lt;&lt; <span class="hljs-number">16</span>) |<br>            ((<span class="hljs-type">uint32_t</span>)encrypted_bytes[i * <span class="hljs-number">4</span> + <span class="hljs-number">3</span>] &lt;&lt; <span class="hljs-number">24</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// Step 6: 设置密钥 &quot;Calamity_Fortune&quot;（16 字节）</span><br>    <span class="hljs-type">uint32_t</span> key[<span class="hljs-number">4</span>] = &#123;<br>        <span class="hljs-number">0x616C6143U</span>,<br>        <span class="hljs-number">0x7974696DU</span>,<br>        <span class="hljs-number">0x726F465FU</span>,<br>        <span class="hljs-number">0x656E7574U</span><br>    &#125;;<br><br>    <span class="hljs-comment">// Step 7: 调用你提供的解密函数</span><br>    decrypt_xxtea_variant(block, key);<br><br>    <span class="hljs-comment">// Step 8: 转回 flag 字符串（小端）</span><br>    <span class="hljs-type">char</span> flag[<span class="hljs-number">45</span>] = &#123; <span class="hljs-number">0</span> &#125;;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">11</span>; i++) &#123;<br>        flag[i * <span class="hljs-number">4</span> + <span class="hljs-number">0</span>] = (block[i] &gt;&gt; <span class="hljs-number">0</span>) &amp; <span class="hljs-number">0xFF</span>;<br>        flag[i * <span class="hljs-number">4</span> + <span class="hljs-number">1</span>] = (block[i] &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>;<br>        flag[i * <span class="hljs-number">4</span> + <span class="hljs-number">2</span>] = (block[i] &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>;<br>        flag[i * <span class="hljs-number">4</span> + <span class="hljs-number">3</span>] = (block[i] &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xFF</span>;<br>    &#125;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Flag: %s\n&quot;</span>, flag);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><blockquote><p>flag：0xGame{f279c1e7-8b0d-4a3b-9c6f-5e4d2a1b0c89}</p></blockquote>]]></content>
    
    
    <summary type="html">0xGame2025 Week3 Reverse方向全解&amp;详解</summary>
    
    
    
    <category term="WriteUp&amp;复现" scheme="https://sydzi.github.io/categories/WriteUp-%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="CTF" scheme="https://sydzi.github.io/tags/CTF/"/>
    
    <category term="WriteUp" scheme="https://sydzi.github.io/tags/WriteUp/"/>
    
    <category term="Reverse" scheme="https://sydzi.github.io/tags/Reverse/"/>
    
  </entry>
  
  <entry>
    <title>0xGame2025Week2WriteUp</title>
    <link href="https://sydzi.github.io/2025/10/19/0xGame2025Week2ReverseWriteUp/"/>
    <id>https://sydzi.github.io/2025/10/19/0xGame2025Week2ReverseWriteUp/</id>
    <published>2025-10-19T03:41:33.000Z</published>
    <updated>2026-02-15T15:23:13.805Z</updated>
    
    <content type="html"><![CDATA[<p>0xGame2025 Week2 Reverse方向全解&amp;详解</p><span id="more"></span><h2 id="shuffle"><a href="#shuffle" class="headerlink" title="shuffle"></a>shuffle</h2><ul><li><p>附件用IDA打开，main函数反编译后大概长这样：</p><p><img src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-08%20220553.png" alt="main函数"></p><p>这是shuffle函数：</p><p><img src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-08%20220917.png" alt="shuffle函数"></p><p>可以看出这是在考随机数，有了种子就可以得到一模一样的随机数序列。回到main函数，双击seed可以得到一个值：</p><p><img src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-08%20220939.png" alt="main函数中的seed"></p><p>但是经过测试这个seed解不出flag，回头看可以发现上图中seed还有另一个引用：runtime_env，很可疑了。双击跳转：</p><p><img src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-08%20220959.png" alt="另有其seed"></p><p>出现了对seed的赋值，结合名字的”runtime”可以推测这个才是真正的seed</p></li><li><p>解密脚本：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">unshuffle_simple</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *str, <span class="hljs-type">int</span> length)</span> &#123;<br>    <span class="hljs-type">int</span> *rand_vals = (<span class="hljs-type">int</span>*)<span class="hljs-built_in">malloc</span>(length * <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">int</span>));<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> temp;<br>    <span class="hljs-type">int</span> i, j;<br><br>    <span class="hljs-comment">// 先获取所有随机值</span><br>    <span class="hljs-keyword">for</span> (i = length - <span class="hljs-number">1</span>; i &gt; <span class="hljs-number">0</span>; --i) &#123;<br>        rand_vals[i] = rand();<br>    &#125;<br><br>    <span class="hljs-comment">// 逆向洗牌：从前往后</span><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">1</span>; i &lt; length; i++) &#123;<br>        j = rand_vals[i] % (i + <span class="hljs-number">1</span>);<br>        <span class="hljs-comment">// 执行相同的交换</span><br>        temp = str[i];<br>        str[i] = str[j];<br>        str[j] = temp;<br>    &#125;<br><br>    <span class="hljs-built_in">free</span>(rand_vals);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> seed = <span class="hljs-number">0x666</span>;<br>    <span class="hljs-type">char</span> flag[] = <span class="hljs-string">&quot;23-64bed6&#125;-xm5300-&#123;faGa34-0e04c2e7c2a78f39a4&quot;</span>;<br>    <span class="hljs-type">int</span> length = <span class="hljs-built_in">strlen</span>(flag);<br>    srand(seed);<br>    unshuffle_simple((<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>*)flag, length);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;flag: %s\n&quot;</span>, flag);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h2 id="算数高手"><a href="#算数高手" class="headerlink" title="算数高手"></a>算数高手</h2><ul><li><p>附件程序是个pythonexe，相关知识可以参考<a href="http://sydzi.github.io/2025/10/05/Day17-python%E9%80%86%E5%90%91/">Day17:python逆向</a><del>（王婆卖瓜ing</del>。使用<a href="https://github.com/extremecoders-re/pyinstxtractor">pyinstxtractor</a>解包后可以得到一个文件夹：</p><p><img src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-09%20082444.png" alt="pyinstxtractor解包"></p><p><img src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-09%20082559.png" alt="解包得到的文件夹"></p></li><li><p>根据pyinstxtractor的提示可以找到疑似入口文件，同名的文件可能性大点。然后用uncompyle6把pyc转成py格式：</p><p><img src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-09%20082742.png" alt="pyc转成py(忽略我的环境报错)"></p></li><li><p>直接得到flag</p></li></ul><h2 id="BabyJar"><a href="#BabyJar" class="headerlink" title="BabyJar"></a>BabyJar</h2><ul><li><p>附件程序是个jar文件，用jd-gui打开：</p><p><img src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-09%20090601.png" alt="main函数"></p><p><img src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-09%20090623.png" alt="encrypt函数"></p></li><li><p>可以看到这是一个java的flag检验程序，加密逻辑在encrypt方法里。上图选中的那行把字节的高位移到低位，低位移到高位，所以再操作一次就可以还原。还要注意encrypt的返回值进行了base64编码。</p></li><li><p>解密脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">enc,key</span>):<br>    enc=base64.b64decode(enc)<br>    flag=<span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> enc:<br>        temp=((i&amp;<span class="hljs-number">240</span>)&gt;&gt;<span class="hljs-number">4</span>|(i&amp;<span class="hljs-number">15</span>)&lt;&lt;<span class="hljs-number">4</span>)<br>        flag+=<span class="hljs-built_in">chr</span>(temp^key)<br>    <span class="hljs-keyword">return</span> flag<br><br>enc=<span class="hljs-string">&quot;QsY1V5cX9jJyF2JSAgdikwfCEneTAgICUpNnd1Iyk8IXUkJ3QhcyZ8J3YpY=&quot;</span><br>key=<span class="hljs-number">20</span><br>flag=<span class="hljs-string">&quot;&quot;</span><br>flag=decrypt(enc,key)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure></li></ul><h2 id="16bit"><a href="#16bit" class="headerlink" title="16bit"></a>16bit</h2><ul><li><p>根据题目名称和提示可以推测考察16位环境逆向。附件程序不能运行，IDA也反编译不了，只能读汇编：</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-symbol">seg000:</span><span class="hljs-number">0000</span> <span class="hljs-comment">; =============== S U B R O U T I N E =======================================</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0000</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0000</span> <span class="hljs-comment">; Attributes: noreturn</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0000</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0000</span>                 <span class="hljs-meta">public</span> start<br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0000</span> start           proc <span class="hljs-built_in">near</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0000</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ax</span>, <span class="hljs-built_in">seg</span> dseg<br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0003</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ds</span>, <span class="hljs-built_in">ax</span>          <span class="hljs-comment">; dseg是数据段，有flag加密后的数据</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0005</span>                 <span class="hljs-meta">assume</span> <span class="hljs-built_in">ds</span>:dseg<br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0005</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">cx</span>, <span class="hljs-number">17h</span>         <span class="hljs-comment">; count寄存器，一般存放循环次数</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0008</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">si</span>, <span class="hljs-number">0</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">000B</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">di</span>, <span class="hljs-number">0</span><br><span class="hljs-symbol">seg000:</span>000E<br><span class="hljs-symbol">seg000:</span>000E loc_1000E:                              <span class="hljs-comment">; CODE XREF: start+1C↓j</span><br><span class="hljs-symbol">seg000:</span>000E                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">al</span>, [<span class="hljs-built_in">si</span>+<span class="hljs-number">0Ah</span>]    <span class="hljs-comment">; si=0时[0Ah]即dseg：000A，是flag密文的位置，此处是在取出密文</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0012</span>                 <span class="hljs-keyword">sub</span>     <span class="hljs-built_in">al</span>, <span class="hljs-number">9</span>           <span class="hljs-comment">; 减9</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0014</span>                 <span class="hljs-keyword">xor</span>     <span class="hljs-built_in">al</span>, <span class="hljs-number">0Eh</span>         <span class="hljs-comment">; 异或</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0016</span>                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">di</span>+<span class="hljs-number">38h</span>], <span class="hljs-built_in">al</span>    <span class="hljs-comment">; 解密后的数据存放到以[38h]即dseg:0038h为起始的区域</span><br><span class="hljs-symbol">seg000:</span>001A                 <span class="hljs-keyword">inc</span>     <span class="hljs-built_in">si</span>              <span class="hljs-comment">; 往下取</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">001B</span>                 <span class="hljs-keyword">inc</span>     <span class="hljs-built_in">di</span>              <span class="hljs-comment">; 往下存</span><br><span class="hljs-symbol">seg000:</span>001C                 <span class="hljs-keyword">loop</span>    loc_1000E       <span class="hljs-comment">; si=0时[0Ah]即dseg：000A，是flag密文的位置，此处是在取出密文</span><br><span class="hljs-symbol">seg000:</span>001E                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">cx</span>, <span class="hljs-number">17h</span>         <span class="hljs-comment">; 更新循环次数</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0021</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0021</span> loc_10021:                              <span class="hljs-comment">; CODE XREF: start+2F↓j</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0021</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">al</span>, [<span class="hljs-built_in">si</span>+<span class="hljs-number">0Ah</span>]    <span class="hljs-comment">; 此处si=17h,所以取的是以dseg:0021h为起始的数据</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0025</span>                 <span class="hljs-keyword">xor</span>     <span class="hljs-built_in">al</span>, <span class="hljs-number">0Eh</span>         <span class="hljs-comment">; 异或</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0027</span>                 <span class="hljs-keyword">sub</span>     <span class="hljs-built_in">al</span>, <span class="hljs-number">9</span>           <span class="hljs-comment">; 减9</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0029</span>                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">di</span>+<span class="hljs-number">38h</span>], <span class="hljs-built_in">al</span>    <span class="hljs-comment">; 解密后的数据存放到seg:004f为起始的区域</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">002D</span>                 <span class="hljs-keyword">inc</span>     <span class="hljs-built_in">si</span>              <span class="hljs-comment">; 往下取</span><br><span class="hljs-symbol">seg000:</span>002E                 <span class="hljs-keyword">inc</span>     <span class="hljs-built_in">di</span>              <span class="hljs-comment">; 往下存</span><br><span class="hljs-symbol">seg000:</span>002F                 <span class="hljs-keyword">loop</span>    loc_10021       <span class="hljs-comment">; 此处si=17h,所以取的是以dseg:0021h为起始的数据</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0031</span>                 <span class="hljs-keyword">mov</span>     byte_100A6, <span class="hljs-number">24h</span> <span class="hljs-comment">; &#x27;$&#x27; ; byte_100A6是&quot;flag=&quot;，此处是在打印flag</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0036</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">dx</span>, <span class="hljs-number">67h</span> <span class="hljs-comment">; &#x27;g&#x27;</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0039</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-number">ah</span>, <span class="hljs-number">9</span><br><span class="hljs-symbol">seg000:</span>003B                 <span class="hljs-keyword">int</span>     <span class="hljs-number">21h</span>             <span class="hljs-comment">; DOS - PRINT STRING</span><br><span class="hljs-symbol">seg000:</span>003B                                         <span class="hljs-comment">; DS:DX -&gt; string terminated by &quot;$&quot;</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">003D</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">dx</span>, <span class="hljs-number">38h</span> <span class="hljs-comment">; &#x27;8&#x27;</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0040</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-number">ah</span>, <span class="hljs-number">9</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0042</span>                 <span class="hljs-keyword">int</span>     <span class="hljs-number">21h</span>             <span class="hljs-comment">; DOS - PRINT STRING</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0042</span>                                         <span class="hljs-comment">; DS:DX -&gt; string terminated by &quot;$&quot;</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0044</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ax</span>, <span class="hljs-number">4C00h</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0047</span>                 <span class="hljs-keyword">int</span>     <span class="hljs-number">21h</span>             <span class="hljs-comment">; DOS - 2+ - QUIT WITH EXIT CODE (EXIT)</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0047</span> start           endp                    <span class="hljs-comment">; AL = exit code</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0047</span><br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0047</span> seg000          ends<br><span class="hljs-symbol">seg000:</span><span class="hljs-number">0047</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0009</span> <span class="hljs-comment">; ===========================================================================</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0009</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0009</span> <span class="hljs-comment">; Segment type: Pure data</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0009</span> dseg            <span class="hljs-meta">segment</span> para <span class="hljs-meta">public</span> <span class="hljs-string">&#x27;DATA&#x27;</span> <span class="hljs-meta">use16</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0009</span>                 <span class="hljs-meta">assume</span> <span class="hljs-built_in">cs</span>:dseg<br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0009</span>                 <span class="hljs-comment">;org 9</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0009</span>                 <span class="hljs-meta">align</span> <span class="hljs-number">2</span><br><span class="hljs-symbol">dseg:</span>000A                 <span class="hljs-built_in">db</span>  <span class="hljs-number">47h</span> <span class="hljs-comment">; G</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">000B</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">7Fh</span> <span class="hljs-comment">; </span><br><span class="hljs-symbol">dseg:</span>000C                 <span class="hljs-built_in">db</span>  <span class="hljs-number">52h</span> <span class="hljs-comment">; R</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">000D</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">78h</span> <span class="hljs-comment">; x</span><br><span class="hljs-symbol">dseg:</span>000E                 <span class="hljs-built_in">db</span>  <span class="hljs-number">6Ch</span> <span class="hljs-comment">; l</span><br><span class="hljs-symbol">dseg:</span>000F                 <span class="hljs-built_in">db</span>  <span class="hljs-number">74h</span> <span class="hljs-comment">; t</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0010</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">7Eh</span> <span class="hljs-comment">; ~</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0011</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">72h</span> <span class="hljs-comment">; r</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0012</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">47h</span> <span class="hljs-comment">; G</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0013</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">47h</span> <span class="hljs-comment">; G</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0014</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">73h</span> <span class="hljs-comment">; s</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0015</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">5Ah</span> <span class="hljs-comment">; Z</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0016</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">84h</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0017</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">5Ah</span> <span class="hljs-comment">; Z</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0018</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">43h</span> <span class="hljs-comment">; C</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0019</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">85h</span><br><span class="hljs-symbol">dseg:</span>001A                 <span class="hljs-built_in">db</span>  <span class="hljs-number">46h</span> <span class="hljs-comment">; F</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">001B</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">5Ah</span> <span class="hljs-comment">; Z</span><br><span class="hljs-symbol">dseg:</span>001C                 <span class="hljs-built_in">db</span>  <span class="hljs-number">83h</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">001D</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">6Fh</span> <span class="hljs-comment">; o</span><br><span class="hljs-symbol">dseg:</span>001E                 <span class="hljs-built_in">db</span>  <span class="hljs-number">46h</span> <span class="hljs-comment">; F</span><br><span class="hljs-symbol">dseg:</span>001F                 <span class="hljs-built_in">db</span>  <span class="hljs-number">5Ah</span> <span class="hljs-comment">; Z</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0020</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">6Ch</span> <span class="hljs-comment">; l</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0021</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">33h</span> <span class="hljs-comment">; 3</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0022</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">30h</span> <span class="hljs-comment">; 0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0023</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">73h</span> <span class="hljs-comment">; s</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0024</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">32h</span> <span class="hljs-comment">; 2</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0025</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">75h</span> <span class="hljs-comment">; u</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0026</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">66h</span> <span class="hljs-comment">; f</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0027</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">37h</span> <span class="hljs-comment">; 7</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0028</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">61h</span> <span class="hljs-comment">; a</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0029</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">66h</span> <span class="hljs-comment">; f</span><br><span class="hljs-symbol">dseg:</span>002A                 <span class="hljs-built_in">db</span>  <span class="hljs-number">33h</span> <span class="hljs-comment">; 3</span><br><span class="hljs-symbol">dseg:</span>002B                 <span class="hljs-built_in">db</span>  <span class="hljs-number">30h</span> <span class="hljs-comment">; 0</span><br><span class="hljs-symbol">dseg:</span>002C                 <span class="hljs-built_in">db</span>  <span class="hljs-number">78h</span> <span class="hljs-comment">; x</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">002D</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">66h</span> <span class="hljs-comment">; f</span><br><span class="hljs-symbol">dseg:</span>002E                 <span class="hljs-built_in">db</span>  <span class="hljs-number">40h</span> <span class="hljs-comment">; @</span><br><span class="hljs-symbol">dseg:</span>002F                 <span class="hljs-built_in">db</span>  <span class="hljs-number">35h</span> <span class="hljs-comment">; 5</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0030</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">61h</span> <span class="hljs-comment">; a</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0031</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">4Eh</span> <span class="hljs-comment">; N</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0032</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">64h</span> <span class="hljs-comment">; d</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0033</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">34h</span> <span class="hljs-comment">; 4</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0034</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">65h</span> <span class="hljs-comment">; e</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0035</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">32h</span> <span class="hljs-comment">; 2</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0036</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">33h</span> <span class="hljs-comment">; 3</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0037</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">88h</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0038</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0039</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span>003A                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span>003B                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span>003C                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">003D</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span>003E                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span>003F                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0040</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0041</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0042</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0043</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0044</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0045</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0046</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0047</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0048</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0049</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span>004A                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span>004B                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span>004C                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">004D</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span>004E                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span>004F                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0050</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0051</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0052</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0053</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0054</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0055</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0056</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0057</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0058</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0059</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span>005A                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span>005B                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span>005C                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">005D</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span>005E                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span>005F                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0060</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0061</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0062</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0063</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0064</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0065</span>                 <span class="hljs-built_in">db</span>    <span class="hljs-number">0</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0066</span> byte_100A6      <span class="hljs-built_in">db</span> <span class="hljs-number">0</span>                    <span class="hljs-comment">; DATA XREF: start+31↑w</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0067</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">66h</span> <span class="hljs-comment">; f</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0068</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">6Ch</span> <span class="hljs-comment">; l</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">0069</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">61h</span> <span class="hljs-comment">; a</span><br><span class="hljs-symbol">dseg:</span>006A                 <span class="hljs-built_in">db</span>  <span class="hljs-number">67h</span> <span class="hljs-comment">; g</span><br><span class="hljs-symbol">dseg:</span>006B                 <span class="hljs-built_in">db</span>  <span class="hljs-number">20h</span><br><span class="hljs-symbol">dseg:</span>006C                 <span class="hljs-built_in">db</span>  <span class="hljs-number">3Dh</span> <span class="hljs-comment">; =</span><br><span class="hljs-symbol">dseg:</span><span class="hljs-number">006D</span>                 <span class="hljs-built_in">db</span>  <span class="hljs-number">24h</span> <span class="hljs-comment">; $</span><br><span class="hljs-symbol">dseg:</span>006E                 <span class="hljs-built_in">db</span>    ? <span class="hljs-comment">;</span><br><span class="hljs-symbol">dseg:</span>006F                 <span class="hljs-built_in">db</span>    ? <span class="hljs-comment">;</span><br><span class="hljs-symbol">dseg:</span>006F dseg            ends<br><span class="hljs-symbol">dseg:</span>006F<br><span class="hljs-symbol">seg002:</span><span class="hljs-number">0000</span> <span class="hljs-comment">; ===========================================================================</span><br></code></pre></td></tr></table></figure></li><li><p>可以看出程序分两部分对flag的密文进行了解密，模拟这段代码就可以得到flag。解密脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python">data = [<br>    <span class="hljs-number">0x47</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x47</span>,<br>    <span class="hljs-number">0x73</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x6F</span>,<br>    <span class="hljs-number">0x46</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x37</span>,<br>    <span class="hljs-number">0x61</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x4E</span>,<br>    <span class="hljs-number">0x64</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x88</span><br>]<br><br>output = []<br><br><span class="hljs-comment"># 第一段解密（前 0x17 字节）</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x17</span>):<br>    al = data[i]<br>    al = (al - <span class="hljs-number">9</span>) &amp; <span class="hljs-number">0xFF</span><br>    al = al ^ <span class="hljs-number">0x0E</span><br>    output.append(al)<br><br><span class="hljs-comment"># 第二段解密（后 0x17 字节）</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x17</span>,<span class="hljs-number">0x2E</span>):<br>    al = data[i]<br>    al = al ^ <span class="hljs-number">0x0E</span><br>    al = (al - <span class="hljs-number">9</span>) &amp; <span class="hljs-number">0xFF</span><br>    output.append(al)<br><br><span class="hljs-comment"># 输出为字符串</span><br>flag = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> output)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure></li></ul><h2 id="TELF"><a href="#TELF" class="headerlink" title="TELF"></a>TELF</h2><ul><li><p>题目提示加壳，DIE检查发现附件程序加了upx壳：</p><p><img src="/../images/image-20251010194622670.png" alt="DIE检查"></p><p>这是个elf文件，考察elf手动脱壳的话难度不小。使用upx工具会发现脱不了壳，推测有upx特征魔改。用010editor打开附件程序，注意到出现了可疑字样”X1c”：</p><p><img src="/../images/image-20251010195805683.png" alt="可疑字样"></p><p>修改”X1c”为”UPX”后程序可正常工具脱壳：</p><p><img src="/../images/image-20251010195916919.png" alt="工具脱壳"></p><p>脱壳后的程序用IDA打开，main函数如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  __int64 block; <span class="hljs-comment">// [rsp+8h] [rbp-A8h] BYREF</span><br>  _QWORD fl4g[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+10h] [rbp-A0h] BYREF</span><br>  <span class="hljs-type">char</span> flag[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+50h] [rbp-60h] BYREF</span><br>  __int64 v7; <span class="hljs-comment">// [rsp+58h] [rbp-58h]</span><br>  __int64 v8; <span class="hljs-comment">// [rsp+60h] [rbp-50h]</span><br>  __int64 v9; <span class="hljs-comment">// [rsp+68h] [rbp-48h]</span><br>  __int64 v10; <span class="hljs-comment">// [rsp+70h] [rbp-40h]</span><br>  __int64 v11; <span class="hljs-comment">// [rsp+78h] [rbp-38h]</span><br>  __int64 v12; <span class="hljs-comment">// [rsp+80h] [rbp-30h]</span><br>  _DWORD key[<span class="hljs-number">5</span>]; <span class="hljs-comment">// [rsp+90h] [rbp-20h] BYREF</span><br>  <span class="hljs-type">int</span> k; <span class="hljs-comment">// [rsp+A4h] [rbp-Ch]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+A8h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+ACh] [rbp-4h]</span><br><br>  srand(<span class="hljs-number">0xF6950u</span>);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">3</span>; ++i )<br>    key[i] = rand();<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Please input your flag: &quot;</span>);<br>  <span class="hljs-keyword">if</span> ( __isoc99_scanf(<span class="hljs-string">&quot;%56s&quot;</span>, flag) == <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(flag) == <span class="hljs-number">56</span> )<br>    &#123;<br>      fl4g[<span class="hljs-number">0</span>] = *flag;<br>      fl4g[<span class="hljs-number">1</span>] = v7;<br>      fl4g[<span class="hljs-number">2</span>] = v8;<br>      fl4g[<span class="hljs-number">3</span>] = v9;<br>      fl4g[<span class="hljs-number">4</span>] = v10;<br>      fl4g[<span class="hljs-number">5</span>] = v11;<br>      fl4g[<span class="hljs-number">6</span>] = v12;<br>      <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">55</span>; j += <span class="hljs-number">8</span> )<br>      &#123;<br>        block = fl4g[j / <span class="hljs-number">8u</span>];<br>        encrypt(&amp;block, key);<br>        fl4g[j / <span class="hljs-number">8u</span>] = block;<br>      &#125;<br>      <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt;= <span class="hljs-number">55</span>; ++k )<br>      &#123;<br>        <span class="hljs-keyword">if</span> ( enc[k] != *(fl4g + k) )<br>        &#123;<br>          <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Try Again!&quot;</span>);<br>          <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        &#125;<br>      &#125;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Congratulation!&quot;</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Length Error!&quot;</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    fwrite(<span class="hljs-string">&quot;Input error or EOF\n&quot;</span>, <span class="hljs-number">1uLL</span>, <span class="hljs-number">0x13u</span>LL, _bss_start);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看出程序用先随机数生成了key，然后对输入的flag进行了加密，最后是校验。加密函数如下，是tea加密：</p><p><img src="/../images/image-20251010200059379.png" alt="encrypt函数"></p><p>但是用相同种子生成的随机数组成的key会解密失败，动调会发现key和自己使用同一种子生成的key不同（IDAelf动调教程见<a href="https://www.52pojie.cn/thread-730499-1-1.html">ida动态调试elf(无坑详细)</a>）：</p><p><img src="/../images/image-20251010201432090.png" alt="动调时的key"></p><p>这样就能解密了。tea加密的主要逻辑是异或，所以只需要还原出加密时的相关变量就可以了</p></li><li><p>解密脚本：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">decrypt</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span>* block, <span class="hljs-type">uint32_t</span>* key)</span> &#123;<br>    <span class="hljs-type">uint32_t</span> p1 = block[<span class="hljs-number">0</span>];<br>    <span class="hljs-type">uint32_t</span> p2 = block[<span class="hljs-number">1</span>];<br>    <span class="hljs-type">int</span> sum = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) &#123;<br>        sum -= <span class="hljs-number">0x61C88647</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) &#123;<br>        p2 -= (p1 + sum) ^ (<span class="hljs-number">16</span> * p1 + key[<span class="hljs-number">2</span>]) ^ ((p1 &gt;&gt; <span class="hljs-number">5</span>) + key[<span class="hljs-number">3</span>]);<br>        p1 -= (p2 + sum) ^ (<span class="hljs-number">16</span> * p2 + key[<span class="hljs-number">0</span>]) ^ ((p2 &gt;&gt; <span class="hljs-number">5</span>) + key[<span class="hljs-number">1</span>]);<br>        sum += <span class="hljs-number">0x61C88647</span>;<br>    &#125;<br>    block[<span class="hljs-number">0</span>] = p1;<br>    block[<span class="hljs-number">1</span>] = p2;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">uint32_t</span> key[<span class="hljs-number">4</span>] = &#123; <span class="hljs-number">0x7e4d087b</span>, <span class="hljs-number">0x7a4db733</span>, <span class="hljs-number">0x70fe9df0</span>, <span class="hljs-number">0x595607f7</span> &#125;;<br>    <span class="hljs-type">uint32_t</span> enc[<span class="hljs-number">14</span>] = &#123;<br>        <span class="hljs-number">0xDC01DAAD</span>, <span class="hljs-number">0x088A5BAE</span>, <span class="hljs-number">0x8F4FF54E</span>, <span class="hljs-number">0x9E9D5F6E</span>,<br>        <span class="hljs-number">0x08A94E0A</span>, <span class="hljs-number">0xC245AB25</span>, <span class="hljs-number">0x438FC94B</span>, <span class="hljs-number">0x28D6513D</span>,<br>        <span class="hljs-number">0xF4CD72F6</span>, <span class="hljs-number">0x3B4AB42B</span>, <span class="hljs-number">0xEF6636FB</span>, <span class="hljs-number">0xB28C8AD6</span>,<br>        <span class="hljs-number">0x1B9C1AEB</span>, <span class="hljs-number">0x531F9C0A</span><br>    &#125;;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">14</span>; i += <span class="hljs-number">2</span>) &#123;<br>        decrypt(&amp;enc[i], key);<br>    &#125;<br><br>    <span class="hljs-type">char</span>* flagChar = (<span class="hljs-type">char</span>*)enc;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">56</span>; i++) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, flagChar[i]);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <summary type="html">0xGame2025 Week2 Reverse方向全解&amp;详解</summary>
    
    
    
    <category term="WriteUp&amp;复现" scheme="https://sydzi.github.io/categories/WriteUp-%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="CTF" scheme="https://sydzi.github.io/tags/CTF/"/>
    
    <category term="WriteUp" scheme="https://sydzi.github.io/tags/WriteUp/"/>
    
    <category term="Reverse" scheme="https://sydzi.github.io/tags/Reverse/"/>
    
  </entry>
  
  <entry>
    <title>Moectf2025ReverseWriteUp</title>
    <link href="https://sydzi.github.io/2025/10/12/Moectf2025ReverseWriteUp/"/>
    <id>https://sydzi.github.io/2025/10/12/Moectf2025ReverseWriteUp/</id>
    <published>2025-10-11T16:00:01.000Z</published>
    <updated>2026-02-15T15:23:13.863Z</updated>
    
    <content type="html"><![CDATA[<p>Moectf2025 Reverse方向全解&amp;详解</p><span id="more"></span><h2 id="week1"><a href="#week1" class="headerlink" title="week1"></a>week1</h2><h3 id="upx"><a href="#upx" class="headerlink" title="upx"></a>upx</h3><ul><li><p>附件程序用010editor打开，可以看到upx版本，可以找对应版本upx程序脱壳，也可以手动脱壳（采用内存镜像法）：</p><p>用x64dbg打开程序，先移除预设断点</p><p><img src="/../images/image-20250828230432945-1760193218428-1.png" alt="移除预设断点"></p><p>在“内存映射”窗口给程序的.rsrc段下一次性内存访问断点，F9运行</p><p><img src="/../images/image-20250828230606530-1760193218428-2.png" alt="下一次性读取断点"></p><p>然后在UPX0段或者UPX1段下一次性内存写入断点，F9运行</p><p><img src="/../images/image-20250828230727951-1760193218429-4.png" alt="下一次性内存写入断点"></p><p>回到“CPU”窗口，可以看到在RIP不远处有一个大跳（RIP在0x00007FF7BB887423处)</p><p><img src="/../images/image-20250828231133499-1760193218429-8.png" alt="大跳"></p><p>跟进去，还有个跳转表，继续跟进，可以看到程序的OEP了</p><p><img src="/../images/image-20250828231234644-1760193218428-3.png" alt="OEP"></p><p>然后在此处使用scylla dump出程序，并且修复IAT，得到upx_dump_SCY.exe，可以分析了</p></li><li><p>分析main函数，发现每个输入的字符异或了0x21，而非末位字符还异或了原来的下一位。由于异或有交换律，所以解密逻辑可以是：先对每个处理完的字符异或0x21，然后再从倒数第二位开始和下一位异或，这样就恢复了复原出了flag（但是给的密文少了最后一位，即字符串的结束符。根据最后一位和倒数第二位的关系0x56&#x3D;125 ^ 0x21 ^ 末位 得出：末位&#x3D;10，所以末位^0x21&#x3D;43，将密文补充完整）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//main函数</span><br>__int64 <span class="hljs-title function_">sub_7FF6FC2718A0</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">char</span> *v0; <span class="hljs-comment">// rdi</span><br>  __int64 i; <span class="hljs-comment">// rcx</span><br>  FILE *Stream; <span class="hljs-comment">// rax</span><br>  _BYTE v4[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-20h] BYREF</span><br>  <span class="hljs-type">char</span> v5; <span class="hljs-comment">// [rsp+20h] [rbp+0h] BYREF</span><br>  _DWORD cipher[<span class="hljs-number">44</span>]; <span class="hljs-comment">// [rsp+30h] [rbp+10h]</span><br>  <span class="hljs-type">char</span> flag[<span class="hljs-number">132</span>]; <span class="hljs-comment">// [rsp+E0h] [rbp+C0h] BYREF</span><br>  <span class="hljs-type">int</span> length; <span class="hljs-comment">// [rsp+164h] [rbp+144h]</span><br>  _BYTE v9[<span class="hljs-number">60</span>]; <span class="hljs-comment">// [rsp+188h] [rbp+168h]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+1C4h] [rbp+1A4h]</span><br>  <span class="hljs-type">int</span> Char; <span class="hljs-comment">// [rsp+1E4h] [rbp+1C4h]</span><br>  <span class="hljs-type">int</span> k; <span class="hljs-comment">// [rsp+204h] [rbp+1E4h]</span><br><br>  v0 = &amp;v5;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">130LL</span>; i; --i )<br>  &#123;<br>    *(_DWORD *)v0 = <span class="hljs-number">-858993460</span>;<br>    v0 += <span class="hljs-number">4</span>;<br>  &#125;<br>  sub_7FF6FC271375((__int64)&amp;word_7FF6FC28200E);<br>  cipher[<span class="hljs-number">0</span>] = <span class="hljs-number">35</span>;<br>  cipher[<span class="hljs-number">1</span>] = <span class="hljs-number">43</span>;<br>  cipher[<span class="hljs-number">2</span>] = <span class="hljs-number">39</span>;<br>  cipher[<span class="hljs-number">3</span>] = <span class="hljs-number">54</span>;<br>  cipher[<span class="hljs-number">4</span>] = <span class="hljs-number">51</span>;<br>  cipher[<span class="hljs-number">5</span>] = <span class="hljs-number">60</span>;<br>  cipher[<span class="hljs-number">6</span>] = <span class="hljs-number">3</span>;<br>  cipher[<span class="hljs-number">7</span>] = <span class="hljs-number">72</span>;<br>  cipher[<span class="hljs-number">8</span>] = <span class="hljs-number">100</span>;<br>  cipher[<span class="hljs-number">9</span>] = <span class="hljs-number">11</span>;<br>  cipher[<span class="hljs-number">10</span>] = <span class="hljs-number">29</span>;<br>  cipher[<span class="hljs-number">11</span>] = <span class="hljs-number">118</span>;<br>  cipher[<span class="hljs-number">12</span>] = <span class="hljs-number">123</span>;<br>  cipher[<span class="hljs-number">13</span>] = <span class="hljs-number">16</span>;<br>  cipher[<span class="hljs-number">14</span>] = <span class="hljs-number">11</span>;<br>  cipher[<span class="hljs-number">15</span>] = <span class="hljs-number">58</span>;<br>  cipher[<span class="hljs-number">16</span>] = <span class="hljs-number">63</span>;<br>  cipher[<span class="hljs-number">17</span>] = <span class="hljs-number">101</span>;<br>  cipher[<span class="hljs-number">18</span>] = <span class="hljs-number">118</span>;<br>  cipher[<span class="hljs-number">19</span>] = <span class="hljs-number">41</span>;<br>  cipher[<span class="hljs-number">20</span>] = <span class="hljs-number">21</span>;<br>  cipher[<span class="hljs-number">21</span>] = <span class="hljs-number">55</span>;<br>  cipher[<span class="hljs-number">22</span>] = <span class="hljs-number">28</span>;<br>  cipher[<span class="hljs-number">23</span>] = <span class="hljs-number">10</span>;<br>  cipher[<span class="hljs-number">24</span>] = <span class="hljs-number">8</span>;<br>  cipher[<span class="hljs-number">25</span>] = <span class="hljs-number">33</span>;<br>  cipher[<span class="hljs-number">26</span>] = <span class="hljs-number">62</span>;<br>  cipher[<span class="hljs-number">27</span>] = <span class="hljs-number">60</span>;<br>  cipher[<span class="hljs-number">28</span>] = <span class="hljs-number">61</span>;<br>  cipher[<span class="hljs-number">29</span>] = <span class="hljs-number">22</span>;<br>  cipher[<span class="hljs-number">30</span>] = <span class="hljs-number">11</span>;<br>  cipher[<span class="hljs-number">31</span>] = <span class="hljs-number">36</span>;<br>  cipher[<span class="hljs-number">32</span>] = <span class="hljs-number">41</span>;<br>  cipher[<span class="hljs-number">33</span>] = <span class="hljs-number">36</span>;<br>  cipher[<span class="hljs-number">34</span>] = <span class="hljs-number">86</span>;<br>  sub_7FF6FC27119F((__int64)aPleaseInputYou);   <span class="hljs-comment">// &quot;please input your flag: &quot;</span><br>  Stream = _acrt_iob_func(<span class="hljs-number">0</span>);<br>  fgets(flag, <span class="hljs-number">100</span>, Stream);<br>  length = j_strlen(flag);<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt; length; ++j )<br>  &#123;<br>    Char = flag[j] ^ <span class="hljs-number">0x21</span>;<br>    <span class="hljs-keyword">if</span> ( j &lt; length - <span class="hljs-number">1</span> )<br>      Char ^= flag[j + <span class="hljs-number">1</span>];<br>    v9[j] = Char;<br>  &#125;<br>  <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">35</span>; ++k )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( (<span class="hljs-type">char</span>)v9[k] != cipher[k] )<br>    &#123;<br>      sub_7FF6FC27119F((__int64)aYouWillNeverGe);<span class="hljs-comment">// &quot;you will never get the flag!!!!\n&quot;</span><br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>  &#125;<br>  sub_7FF6FC271311(v4, qword_7FF6FC27AD00);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>解密脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">enc=[<br>    <span class="hljs-number">0x23</span>, <span class="hljs-number">0x2b</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x3c</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x48</span>,<br>    <span class="hljs-number">0x64</span>, <span class="hljs-number">0x0b</span>, <span class="hljs-number">0x1d</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x7b</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x0b</span>, <span class="hljs-number">0x3a</span>,<br>    <span class="hljs-number">0x3f</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x1c</span>, <span class="hljs-number">0x0a</span>,<br>    <span class="hljs-number">0x08</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x3e</span>, <span class="hljs-number">0x3c</span>, <span class="hljs-number">0x3d</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x0b</span>, <span class="hljs-number">0x24</span>,<br>    <span class="hljs-number">0x29</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">43</span><br>]<br>xored=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    xored.append(enc[i]^<span class="hljs-number">0x21</span>)<br><span class="hljs-comment">#print(xored)</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(xored)-<span class="hljs-number">2</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>    xored[i]=xored[i]^xored[i+<span class="hljs-number">1</span>]<br>flag=<span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xored)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure></li></ul><h3 id="maze"><a href="#maze" class="headerlink" title="maze"></a>maze</h3><ul><li><p>附件程序main函数逻辑如下，wasd迷宫题，迷宫在函数maze_init中</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> __int64 count; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// ebx</span><br>  __int64 index; <span class="hljs-comment">// r9</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// r11d</span><br>  <span class="hljs-type">unsigned</span> __int64 y; <span class="hljs-comment">// r8</span><br>  __int64 x; <span class="hljs-comment">// r10</span><br>  <span class="hljs-type">unsigned</span> __int64 n0x37_1; <span class="hljs-comment">// rdi</span><br>  <span class="hljs-type">char</span> *Format; <span class="hljs-comment">// rcx</span><br>  _BYTE flag[<span class="hljs-number">1008</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-408h]</span><br><br>  maze_init();<br>  <span class="hljs-built_in">printf</span>(asc_140004138);<br>  <span class="hljs-built_in">printf</span>(&amp;Format_);<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>LABEL_2:<br>    <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>    &#123;<br>      <span class="hljs-built_in">printf</span>(asc_140004190);<br>      <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>);<br>      count = <span class="hljs-number">-1LL</span>;<br>      <span class="hljs-keyword">do</span><br>        ++count;<br>      <span class="hljs-keyword">while</span> ( flag[count] );<br>      <span class="hljs-keyword">if</span> ( count &lt;= <span class="hljs-number">999</span> )<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-built_in">printf</span>(&amp;Format__0);<br>    &#125;<br>    v4 = <span class="hljs-number">1</span>;<br>    index = <span class="hljs-number">0LL</span>;<br>    v6 = <span class="hljs-number">1</span>;<br>    y = <span class="hljs-number">1LL</span>;<span class="hljs-comment">// 起点y</span><br>    x = <span class="hljs-number">1LL</span>;<span class="hljs-comment">// 起点x</span><br>    <span class="hljs-keyword">if</span> ( (<span class="hljs-type">int</span>)count &gt; <span class="hljs-number">0</span> )<br>      <span class="hljs-keyword">break</span>;<br>LABEL_19:<br>    Format = (<span class="hljs-type">char</span> *)&amp;byte_140004118;<br>LABEL_20:<br>    <span class="hljs-built_in">printf</span>(Format);<br>    <span class="hljs-built_in">printf</span>(&amp;Format__1);<br>  &#125;<br>  n0x37_1 = <span class="hljs-number">1LL</span>;<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-keyword">switch</span> ( flag[index] )<br>    &#123;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;A&#x27;</span>:<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;a&#x27;</span>:<br>        --v4;<br>        --x;<br>        --n0x37_1;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;D&#x27;</span>:<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;d&#x27;</span>:<br>        ++v4;<br>        ++x;<br>        ++n0x37_1;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;S&#x27;</span>:<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;s&#x27;</span>:<br>        ++v6;<br>        ++y;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;W&#x27;</span>:<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;w&#x27;</span>:<br>        --v6;<br>        --y;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">default</span>:<br>        <span class="hljs-built_in">printf</span>(&amp;Format__2);<br>        <span class="hljs-built_in">printf</span>(&amp;Format__1);<br>        <span class="hljs-keyword">goto</span> LABEL_2;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( y &gt; <span class="hljs-number">0x37</span> || n0x37_1 &gt; <span class="hljs-number">0x37</span> )<br>    &#123;<br>      Format = (<span class="hljs-type">char</span> *)&amp;unk_1400040D8;<br>      <span class="hljs-keyword">goto</span> LABEL_20;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( byte_140005660[<span class="hljs-number">56</span> * y + x] == <span class="hljs-number">49</span> )<br>    &#123;<br>      Format = (<span class="hljs-type">char</span> *)&amp;unk_1400040F8;<br>      <span class="hljs-keyword">goto</span> LABEL_20;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( y == <span class="hljs-number">15</span> &amp;&amp; x == <span class="hljs-number">32</span> )<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">if</span> ( ++index &gt;= (<span class="hljs-type">int</span>)count )<br>      <span class="hljs-keyword">goto</span> LABEL_19;<br>  &#125;<br>  <span class="hljs-built_in">printf</span>(asc_1400041E0);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;moectf&#123;%s&#125;\n&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>maze_init函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 <span class="hljs-title function_">maze_init</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *all_1; <span class="hljs-comment">// r9</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> **v1; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">int</span> n56_2; <span class="hljs-comment">// r11d</span><br>  __int64 v3; <span class="hljs-comment">// r10</span><br>  __int64 n56; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// r8d</span><br>  __int64 i; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v7; <span class="hljs-comment">// dl</span><br>  __int64 v8; <span class="hljs-comment">// rcx</span><br>  _QWORD v9[<span class="hljs-number">56</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-E0h] BYREF</span><br><br>  v9[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;10100000000000000010000011011101011111111101011100000111&quot;</span>;<br>  all_1 = <span class="hljs-string">&quot;11111111111111111111111111111111111111111111111111111111&quot;</span>;<br>  v9[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;11111111111111111111111111111111111111111111111111111111&quot;</span>;<br>  v9[<span class="hljs-number">2</span>] = <span class="hljs-string">&quot;10111010111111111010111011000001000001000001000101110111&quot;</span>;<br>  v9[<span class="hljs-number">3</span>] = <span class="hljs-string">&quot;10000010000010000010001011011111111101110111011101110111&quot;</span>;<br>  v9[<span class="hljs-number">4</span>] = <span class="hljs-string">&quot;10111111111011101110111011010000000000010100010001110111&quot;</span>;<br>  v9[<span class="hljs-number">5</span>] = <span class="hljs-string">&quot;10100000001000101000100011010101111111011101110101110111&quot;</span>;<br>  v9[<span class="hljs-number">6</span>] = <span class="hljs-string">&quot;10101011111110111011101011010101000001000000010101110111&quot;</span>;<br>  v9[<span class="hljs-number">7</span>] = <span class="hljs-string">&quot;10101010000010100000101011110101110101111101111111110111&quot;</span>;<br>  v9[<span class="hljs-number">8</span>] = <span class="hljs-string">&quot;10111010111010101111101011100101000100000101000101110111&quot;</span>;<br>  v9[<span class="hljs-number">9</span>] = <span class="hljs-string">&quot;10000010001010001000001011001111011111010101011101110111&quot;</span>;<br>  v9[<span class="hljs-number">10</span>] = <span class="hljs-string">&quot;11111011101011111011111111101000100000101100101001110111&quot;</span>;<br>  v9[<span class="hljs-number">11</span>] = <span class="hljs-string">&quot;10001010001000100010000010001010011000100010010011000001&quot;</span>;<br>  v9[<span class="hljs-number">12</span>] = <span class="hljs-string">&quot;10111010111110101010111011011001011111010101011101011101&quot;</span>;<br>  v9[<span class="hljs-number">13</span>] = <span class="hljs-string">&quot;10001010001000001010001011000101000100000101000101011101&quot;</span>;<br>  v9[<span class="hljs-number">14</span>] = <span class="hljs-string">&quot;11101011101111111011101011110101110111111101110101011101&quot;</span>;<br>  v9[<span class="hljs-number">15</span>] = <span class="hljs-string">&quot;10001000101000001010001011000100010100000101000101011101&quot;</span>;<br>  v9[<span class="hljs-number">16</span>] = <span class="hljs-string">&quot;10111111101011101110111011011111110101110111011101011101&quot;</span>;<br>  v9[<span class="hljs-number">17</span>] = <span class="hljs-string">&quot;10001000001000100000001011000100000100010000000101011001&quot;</span>;<br>  v9[<span class="hljs-number">18</span>] = <span class="hljs-string">&quot;11101011111011111111101011110101111101111111110101011011&quot;</span>;<br>  v9[<span class="hljs-number">19</span>] = <span class="hljs-string">&quot;10101000000010001000101011010100000001000100010101011011&quot;</span>;<br>  v9[<span class="hljs-number">20</span>] = <span class="hljs-string">&quot;10101111111110101010101011010111111111010101010101011011&quot;</span>;<br>  v9[<span class="hljs-number">21</span>] = <span class="hljs-string">&quot;10100000000000100010101011010000000000010001010101011011&quot;</span>;<br>  v9[<span class="hljs-number">22</span>] = <span class="hljs-string">&quot;10111111111111111110111011011111111111111111011101011011&quot;</span>;<br>  v9[<span class="hljs-number">23</span>] = <span class="hljs-string">&quot;10000000001111000000000011110111010000111100011111011011&quot;</span>;<br>  v9[<span class="hljs-number">24</span>] = <span class="hljs-string">&quot;11101111100000011011011111111010110111011101100001011011&quot;</span>;<br>  v9[<span class="hljs-number">25</span>] = <span class="hljs-string">&quot;11101111111111111011011111111101110111101101100001011011&quot;</span>;<br>  v9[<span class="hljs-number">26</span>] = <span class="hljs-string">&quot;10001000111111000010000011111010110111011101100001011011&quot;</span>;<br>  v9[<span class="hljs-number">27</span>] = <span class="hljs-string">&quot;10111010111111111010111011110111010000111101100001010011&quot;</span>;<br>  v9[<span class="hljs-number">28</span>] = <span class="hljs-string">&quot;10000010000010000010001011111111111111111101100001010111&quot;</span>;<br>  v9[<span class="hljs-number">29</span>] = <span class="hljs-string">&quot;10111111111011101110111011110001000110001101100001010001&quot;</span>;<br>  v9[<span class="hljs-number">30</span>] = <span class="hljs-string">&quot;10100000001000101000100011110111011101111101100001011101&quot;</span>;<br>  v9[<span class="hljs-number">31</span>] = <span class="hljs-string">&quot;10101011111110111011101011110001000101111101100001011101&quot;</span>;<br>  v9[<span class="hljs-number">32</span>] = <span class="hljs-string">&quot;10101010000010100000101011111101011101111101100001011101&quot;</span>;<br>  v9[<span class="hljs-number">33</span>] = <span class="hljs-string">&quot;10111010111010101111101011110001000110001101100001011101&quot;</span>;<br>  v9[<span class="hljs-number">34</span>] = <span class="hljs-string">&quot;10000010001010101000001011111111111111111101100001011101&quot;</span>;<br>  v9[<span class="hljs-number">35</span>] = <span class="hljs-string">&quot;11111011101011111011111110000000000000001101100001011101&quot;</span>;<br>  v9[<span class="hljs-number">36</span>] = <span class="hljs-string">&quot;10001010001000100010000011111111111111111100110011011101&quot;</span>;<br>  v9[<span class="hljs-number">37</span>] = <span class="hljs-string">&quot;10111010111110101010111010010000000011111110001111011101&quot;</span>;<br>  v9[<span class="hljs-number">38</span>] = <span class="hljs-string">&quot;10001010001000001010001010110111000001111110100101011101&quot;</span>;<br>  v9[<span class="hljs-number">39</span>] = <span class="hljs-string">&quot;11101011101111111011101000110011001111111100110111011101&quot;</span>;<br>  v9[<span class="hljs-number">40</span>] = <span class="hljs-string">&quot;10001000101000001010001011111111111111111111110111010001&quot;</span>;<br>  v1 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> **)v9;<br>  v9[<span class="hljs-number">55</span>] = <span class="hljs-string">&quot;11111111111111111111111111111111111111111111111111111111&quot;</span>;<br>  v9[<span class="hljs-number">41</span>] = <span class="hljs-string">&quot;10111111101011101110111010100001001100000000000011011011&quot;</span>;<br>  n56_2 = <span class="hljs-number">0</span>;<br>  v9[<span class="hljs-number">42</span>] = <span class="hljs-string">&quot;10001000001000100000001011111111111101011101111001011011&quot;</span>;<br>  v3 = <span class="hljs-number">0LL</span>;<br>  v9[<span class="hljs-number">43</span>] = <span class="hljs-string">&quot;10101011111011111111101011000000000001000100010111011011&quot;</span>;<br>  v9[<span class="hljs-number">44</span>] = <span class="hljs-string">&quot;10101000000010001000101010010111111111111111111111011011&quot;</span>;<br>  v9[<span class="hljs-number">45</span>] = <span class="hljs-string">&quot;10101111111110101010101010110111111111111111111101011011&quot;</span>;<br>  v9[<span class="hljs-number">46</span>] = <span class="hljs-string">&quot;10100000000000100010101011100000000000000000000011011011&quot;</span>;<br>  v9[<span class="hljs-number">47</span>] = <span class="hljs-string">&quot;10111111111111111110011011111111111111111111111011011011&quot;</span>;<br>  v9[<span class="hljs-number">48</span>] = <span class="hljs-string">&quot;10000011111111111111000010000000000000000000000000011001&quot;</span>;<br>  v9[<span class="hljs-number">49</span>] = <span class="hljs-string">&quot;11111011111111111111111111111111111111111111111111111101&quot;</span>;<br>  v9[<span class="hljs-number">50</span>] = <span class="hljs-string">&quot;11111011100001100110110111000000000000000000000111111101&quot;</span>;<br>  v9[<span class="hljs-number">51</span>] = <span class="hljs-string">&quot;11111011101111011010000111011111111111111111110111111101&quot;</span>;<br>  v9[<span class="hljs-number">52</span>] = <span class="hljs-string">&quot;11111011100001000010110110000111111111111111110000000001&quot;</span>;<br>  v9[<span class="hljs-number">53</span>] = <span class="hljs-string">&quot;11111011101111011010110111101111111111111111111111111111&quot;</span>;<br>  v9[<span class="hljs-number">54</span>] = <span class="hljs-string">&quot;11110000000000011000110000000000000000000000000000000011&quot;</span>;<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    n56 = <span class="hljs-number">-1LL</span>;<br>    <span class="hljs-keyword">do</span><br>      ++n56;<br>    <span class="hljs-keyword">while</span> ( all_1[n56] );<br>    <span class="hljs-keyword">if</span> ( n56 != <span class="hljs-number">56</span> )<br>    &#123;<br>      <span class="hljs-built_in">printf</span>((<span class="hljs-type">char</span> *)&amp;Format__3);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    v5 = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0LL</span>; i &lt; <span class="hljs-number">56</span>; ++i )<br>    &#123;<br>      v7 = all_1[i];<br>      <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int8)(v7 - <span class="hljs-number">48</span>) &gt; <span class="hljs-number">1u</span> )<br>      &#123;<br>        <span class="hljs-built_in">printf</span>((<span class="hljs-type">char</span> *)&amp;Format__4);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>      &#125;<br>      v8 = v3 + i;<br>      ++v5;<br>      byte_140005660[v8] = v7;<br>    &#125;<br>    ++n56_2;<br>    ++v1;<br>    v3 += <span class="hljs-number">56LL</span>;<br>    <span class="hljs-keyword">if</span> ( n56_2 &gt;= <span class="hljs-number">56</span> )<br>      <span class="hljs-keyword">break</span>;<br>    all_1 = *v1;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( n48 != <span class="hljs-number">48</span> )<br>  &#123;<br>    <span class="hljs-built_in">printf</span>((<span class="hljs-type">char</span> *)&amp;Format);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( n48_0 != <span class="hljs-number">48</span> )<br>  &#123;<br>    <span class="hljs-built_in">printf</span>((<span class="hljs-type">char</span> *)&amp;Format__5);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> i;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>使用神奇妙妙工具得到迷宫路径：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> mycode <span class="hljs-keyword">import</span> maze<br>Maze = [<br>    <span class="hljs-string">&quot;11111111111111111111111111111111111111111111111111111111&quot;</span>,<br>    <span class="hljs-string">&quot;10100000000000000010000011011101011111111101011100000111&quot;</span>,<br>    <span class="hljs-string">&quot;10111010111111111010111011000001000001000001000101110111&quot;</span>,<br>    <span class="hljs-string">&quot;10000010000010000010001011011111111101110111011101110111&quot;</span>,<br>    <span class="hljs-string">&quot;10111111111011101110111011010000000000010100010001110111&quot;</span>,<br>    <span class="hljs-string">&quot;10100000001000101000100011010101111111011101110101110111&quot;</span>,<br>    <span class="hljs-string">&quot;10101011111110111011101011010101000001000000010101110111&quot;</span>,<br>    <span class="hljs-string">&quot;10101010000010100000101011110101110101111101111111110111&quot;</span>,<br>    <span class="hljs-string">&quot;10111010111010101111101011100101000100000101000101110111&quot;</span>,<br>    <span class="hljs-string">&quot;10000010001010001000001011001111011111010101011101110111&quot;</span>,<br>    <span class="hljs-string">&quot;11111011101011111011111111101000100000101100101001110111&quot;</span>,<br>    <span class="hljs-string">&quot;10001010001000100010000010001010011000100010010011000001&quot;</span>,<br>    <span class="hljs-string">&quot;10111010111110101010111011011001011111010101011101011101&quot;</span>,<br>    <span class="hljs-string">&quot;10001010001000001010001011000101000100000101000101011101&quot;</span>,<br>    <span class="hljs-string">&quot;11101011101111111011101011110101110111111101110101011101&quot;</span>,<br>    <span class="hljs-string">&quot;10001000101000001010001011000100010100000101000101011101&quot;</span>,<br>    <span class="hljs-string">&quot;10111111101011101110111011011111110101110111011101011101&quot;</span>,<br>    <span class="hljs-string">&quot;10001000001000100000001011000100000100010000000101011001&quot;</span>,<br>    <span class="hljs-string">&quot;11101011111011111111101011110101111101111111110101011011&quot;</span>,<br>    <span class="hljs-string">&quot;10101000000010001000101011010100000001000100010101011011&quot;</span>,<br>    <span class="hljs-string">&quot;10101111111110101010101011010111111111010101010101011011&quot;</span>,<br>    <span class="hljs-string">&quot;10100000000000100010101011010000000000010001010101011011&quot;</span>,<br>    <span class="hljs-string">&quot;10111111111111111110111011011111111111111111011101011011&quot;</span>,<br>    <span class="hljs-string">&quot;10000000001111000000000011110111010000111100011111011011&quot;</span>,<br>    <span class="hljs-string">&quot;11101111100000011011011111111010110111011101100001011011&quot;</span>,<br>    <span class="hljs-string">&quot;11101111111111111011011111111101110111101101100001011011&quot;</span>,<br>    <span class="hljs-string">&quot;10001000111111000010000011111010110111011101100001011011&quot;</span>,<br>    <span class="hljs-string">&quot;10111010111111111010111011110111010000111101100001010011&quot;</span>,<br>    <span class="hljs-string">&quot;10000010000010000010001011111111111111111101100001010111&quot;</span>,<br>    <span class="hljs-string">&quot;10111111111011101110111011110001000110001101100001010001&quot;</span>,<br>    <span class="hljs-string">&quot;10100000001000101000100011110111011101111101100001011101&quot;</span>,<br>    <span class="hljs-string">&quot;10101011111110111011101011110001000101111101100001011101&quot;</span>,<br>    <span class="hljs-string">&quot;10101010000010100000101011111101011101111101100001011101&quot;</span>,<br>    <span class="hljs-string">&quot;10111010111010101111101011110001000110001101100001011101&quot;</span>,<br>    <span class="hljs-string">&quot;10000010001010101000001011111111111111111101100001011101&quot;</span>,<br>    <span class="hljs-string">&quot;11111011101011111011111110000000000000001101100001011101&quot;</span>,<br>    <span class="hljs-string">&quot;10001010001000100010000011111111111111111100110011011101&quot;</span>,<br>    <span class="hljs-string">&quot;10111010111110101010111010010000000011111110001111011101&quot;</span>,<br>    <span class="hljs-string">&quot;10001010001000001010001010110111000001111110100101011101&quot;</span>,<br>    <span class="hljs-string">&quot;11101011101111111011101000110011001111111100110111011101&quot;</span>,<br>    <span class="hljs-string">&quot;10001000101000001010001011111111111111111111110111010001&quot;</span>,<br>    <span class="hljs-string">&quot;10111111101011101110111010100001001100000000000011011011&quot;</span>,<br>    <span class="hljs-string">&quot;10001000001000100000001011111111111101011101111001011011&quot;</span>,<br>    <span class="hljs-string">&quot;10101011111011111111101011000000000001000100010111011011&quot;</span>,<br>    <span class="hljs-string">&quot;10101000000010001000101010010111111111111111111111011011&quot;</span>,<br>    <span class="hljs-string">&quot;10101111111110101010101010110111111111111111111101011011&quot;</span>,<br>    <span class="hljs-string">&quot;10100000000000100010101011100000000000000000000011011011&quot;</span>,<br>    <span class="hljs-string">&quot;10111111111111111110011011111111111111111111111011011011&quot;</span>,<br>    <span class="hljs-string">&quot;10000011111111111111000010000000000000000000000000011001&quot;</span>,<br>    <span class="hljs-string">&quot;11111011111111111111111111111111111111111111111111111101&quot;</span>,<br>    <span class="hljs-string">&quot;11111011100001100110110111000000000000000000000111111101&quot;</span>,<br>    <span class="hljs-string">&quot;11111011101111011010000111011111111111111111110111111101&quot;</span>,<br>    <span class="hljs-string">&quot;11111011100001000010110110000111111111111111110000000001&quot;</span>,<br>    <span class="hljs-string">&quot;11111011101111011010110111101111111111111111111111111111&quot;</span>,<br>    <span class="hljs-string">&quot;11110000000000011000110000000000000000000000000000000011&quot;</span>,<br>    <span class="hljs-string">&quot;11111111111111111111111111111111111111111111111111111111&quot;</span><br>]<br>start=(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)<br>end=(<span class="hljs-number">15</span>,<span class="hljs-number">32</span>)<br>path=maze.solve(Maze,start,end)<br><span class="hljs-built_in">print</span>(path)<br><br><br><span class="hljs-comment">#mycode.maze:</span><br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve</span>(<span class="hljs-params">maze, start, end, directions=<span class="hljs-literal">None</span>, wall=<span class="hljs-string">&#x27;1&#x27;</span>, free=<span class="hljs-string">&#x27;0&#x27;</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    参数:</span><br><span class="hljs-string">        maze: 二维字符串列表</span><br><span class="hljs-string">        start: 起点坐标 (row, col)</span><br><span class="hljs-string">        end: 终点坐标 (row, col)</span><br><span class="hljs-string">        directions: 自定义方向指令 (默认WASD)</span><br><span class="hljs-string">        wall: 墙字符 (默认&#x27;1&#x27;)</span><br><span class="hljs-string">        free: 通路字符 (默认&#x27;0&#x27;)</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    返回:</span><br><span class="hljs-string">        移动指令字符串 或 None(无解)</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> directions <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        directions = &#123;<br>            <span class="hljs-string">&#x27;W&#x27;</span>: (-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>),  <span class="hljs-comment"># 上</span><br>            <span class="hljs-string">&#x27;A&#x27;</span>: (<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>),   <span class="hljs-comment"># 左</span><br>            <span class="hljs-string">&#x27;S&#x27;</span>: (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>),    <span class="hljs-comment"># 下</span><br>            <span class="hljs-string">&#x27;D&#x27;</span>: (<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)     <span class="hljs-comment"># 右</span><br>        &#125;<br>    <br>    rows, cols = <span class="hljs-built_in">len</span>(maze), <span class="hljs-built_in">len</span>(maze[<span class="hljs-number">0</span>])<br>    <br>    <span class="hljs-comment"># 坐标验证</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">is_valid</span>(<span class="hljs-params">pos</span>):<br>        r, c = pos<br>        <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span> &lt;= r &lt; rows <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> &lt;= c &lt; cols <span class="hljs-keyword">and</span> maze[r][c] == free)<br>    <br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> is_valid(start):<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f&quot;无效起点 <span class="hljs-subst">&#123;start&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> is_valid(end):<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f&quot;无效终点 <span class="hljs-subst">&#123;end&#125;</span>&quot;</span>)<br><br>    <span class="hljs-comment"># BFS核心（修复了变量名冲突）</span><br>    queue = deque([(start[<span class="hljs-number">0</span>], start[<span class="hljs-number">1</span>], <span class="hljs-string">&quot;&quot;</span>)])<br>    visited = <span class="hljs-built_in">set</span>([(start[<span class="hljs-number">0</span>], start[<span class="hljs-number">1</span>])])<br>    <br>    <span class="hljs-keyword">while</span> queue:<br>        row, col, current_path = queue.popleft()  <span class="hljs-comment"># 改名为 current_path</span><br>        <br>        <span class="hljs-keyword">if</span> (row, col) == end:<br>            <span class="hljs-keyword">return</span> current_path<br>        <br>        <span class="hljs-keyword">for</span> move, (dr, dc) <span class="hljs-keyword">in</span> directions.items():<br>            new_row, new_col = row + dr, col + dc<br>            <br>            <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt;= new_row &lt; rows <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> &lt;= new_col &lt; cols <span class="hljs-keyword">and</span> <br>                maze[new_row][new_col] == free <span class="hljs-keyword">and</span>  <span class="hljs-comment"># 使用通路字符 free</span><br>                (new_row, new_col) <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> visited):<br>                <br>                visited.add((new_row, new_col))<br>                queue.append((new_row, new_col, current_path + move))  <span class="hljs-comment"># 使用 current_path</span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>  <span class="hljs-comment"># 无解</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="flower"><a href="#flower" class="headerlink" title="flower"></a>flower</h3><ul><li><p>附件程序用IDA打开，在汇编界面上下滑动可以找到花指令引起的红色栈帧报错。打开IDA工具栏的“Options”选项的“General”，勾选“Stackpointer”，可以看到栈帧信息</p><p><img src="/../images/image-20250829121800223-1760193218429-5.png" alt="General"></p><p><img src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-29%20121722-1760193218429-7.png" alt="Stackpointer"></p><p>可以看到红色报错的函数栈帧超过了1000，有点反常，找到栈帧发生突变的地方，发现用sub rsp,1000h改变了栈帧，把这条指令nop掉。本题这个类型的花指令占绝大多数，需要耐心的一个一个nop掉。（还有sub rsp,400h的，主要留意栈帧大于100）</p><p><img src="/../images/image-20250829122250848-1760193218429-6.png" alt="nop花指令"></p><p>还有另一种花指令：</p><p><img src="/../images/image-20250829130321938-1760193218429-9.png" alt="第二种花指令"></p><p>图中Label+1是0x004048EF，被0x004048EE处的指令覆盖住了，所以undefine一下，IDA就会自动纠错。把没用的指令nop掉</p><p><img src="/../images/image-20250829133142939-1760193218429-10.png" alt="自动纠错"></p><p>接下来要做的修改有2点。首先可以看到0x004048E5处有一个恒跳花指令，这个要nop掉。</p><p><img src="/../images/image-20250829140959636-1760193218429-11.png" alt="nop掉恒跳"></p><p>然后是call loc_4048EF，由于call是会占用栈帧的，更何况call一个标签没有ret恢复栈帧，后面栈帧还是会报错（这里有一个试错过程，不把call改成jmp的话，函数undefine+code+create function后依旧反编译不了）。做法就是工具栏edit-&gt;patch program-&gt;change byte，把十六进制码E8改成E9</p><p><img src="/../images/image-20250829141054207-1760193218429-12.png" alt="call改jmp"></p><p>然后就是选中函数名undefine+code+create function了，就可以正常反编译了</p></li><li><p>main函数逻辑主要是把flag掐头去尾，中间部分加密后比对</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 __fastcall <span class="hljs-title function_">solve</span><span class="hljs-params">(_QWORD *flag)</span><br>&#123;<br>  <span class="hljs-type">char</span> v1; <span class="hljs-comment">// bl</span><br>  <span class="hljs-type">bool</span> v2; <span class="hljs-comment">// r12</span><br>  __int64 v3; <span class="hljs-comment">// rax</span><br>  __int64 v4; <span class="hljs-comment">// rbx</span><br>  __int64 v5; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> *flag[i]; <span class="hljs-comment">// rax</span><br>  __int64 v7; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v9; <span class="hljs-comment">// [rsp+17h] [rbp-59h] BYREF</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+18h] [rbp-58h]</span><br>  <span class="hljs-type">int</span> len; <span class="hljs-comment">// [rsp+1Ch] [rbp-54h]</span><br>  __int64 flag_start; <span class="hljs-comment">// [rsp+20h] [rbp-50h] BYREF</span><br>  __int64 flag_end; <span class="hljs-comment">// [rsp+28h] [rbp-48h] BYREF</span><br>  <span class="hljs-type">void</span> *fl4g[<span class="hljs-number">5</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-40h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 v15; <span class="hljs-comment">// [rsp+58h] [rbp-18h]</span><br>  __int64 savedregs; <span class="hljs-comment">// [rsp+70h] [rbp+0h] BYREF</span><br><br>  v15 = __readfsqword(<span class="hljs-number">0x28u</span>);<br>  v1 = <span class="hljs-number">0</span>;<br>  v2 = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int64)length((__int64)flag) &gt; <span class="hljs-number">7</span> )<br>  &#123;<br>    substr(fl4g, flag, <span class="hljs-number">0LL</span>, <span class="hljs-number">7uLL</span>);<br>    v1 = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> ( !(<span class="hljs-type">unsigned</span> __int8)cmp((__int64)fl4g, (__int64)<span class="hljs-string">&quot;moectf&#123;&quot;</span>) &amp;&amp; *(_BYTE *)get_last_str(flag) == <span class="hljs-number">125</span> )<br>      v2 = <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v1 )<br>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>(fl4g);<br>  <span class="hljs-keyword">if</span> ( v2 )<br>  &#123;<br>    v3 = <span class="hljs-built_in">cout</span>((<span class="hljs-built_in">std</span>::ostream *)&amp;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>);<br>    out(v3, (__int64 (*)(<span class="hljs-type">void</span>))<span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>&lt;<span class="hljs-type">char</span>,<span class="hljs-built_in">std</span>::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">std</span>::allocator&lt;<span class="hljs-type">char</span>&gt;::allocator((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;savedregs - <span class="hljs-number">89</span>);<br>    flag_end = getEnd(flag);<br>    v4 = cutTail(&amp;flag_end, <span class="hljs-number">1LL</span>);<br>    flag_start = getStart((__int64)flag);<br>    v5 = cutHead(&amp;flag_start, <span class="hljs-number">7LL</span>);<br>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::basic_string&lt;__gnu_cxx::__normal_iterator&lt;<span class="hljs-type">char</span> *,<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;,<span class="hljs-type">void</span>&gt;(fl4g, v5, v4, (__int64)&amp;v9);<span class="hljs-comment">// 掐头去尾</span><br>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::operator=(flag, fl4g);<br>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>(fl4g);<br>    <span class="hljs-built_in">std</span>::allocator&lt;<span class="hljs-type">char</span>&gt;::~allocator();<br>    len = length((__int64)flag);<br>    <span class="hljs-keyword">if</span> ( len == <span class="hljs-number">32</span> )<br>    &#123;<br>      <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; len; ++i )<br>      &#123;<br>        flag[i] = (<span class="hljs-type">char</span> *)toList(flag, i);      <span class="hljs-comment">// flag[i]</span><br>        <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)encode(*flag[i]) != enc[i] )<br>          <span class="hljs-keyword">break</span>;<br>      &#125;<br>    &#125;<br>    v7 = <span class="hljs-built_in">cout</span>((<span class="hljs-built_in">std</span>::ostream *)&amp;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>);<br>    out(v7, (__int64 (*)(<span class="hljs-type">void</span>))<span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>&lt;<span class="hljs-type">char</span>,<span class="hljs-built_in">std</span>::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;);<br>  &#125;<br>  <span class="hljs-keyword">return</span> v15 - __readfsqword(<span class="hljs-number">0x28u</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>加密函数encode如下，就是把flag[i]和key异或，key会递增。需要注意的是，静态分析下得到的key是不正确的（静态分析得到的key是0x23，但是动态调试会发现程序运行到此处key变成0x29），动调得到的key才能解密出flag</p><p><img src="/../images/image-20250829141947673-1760193218429-13.png" alt="encode函数"></p></li><li><p>解密脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">data = [<br>    <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x7E</span>,<br>    <span class="hljs-number">0x44</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x52</span>,<br>    <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x2B</span><br>]<br>key=<span class="hljs-number">0x29</span><br>result=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(data)):<br>    plaintext=(data[i]^key)&amp;<span class="hljs-number">0xff</span><br>    key+=<span class="hljs-number">1</span><br>    result.append(plaintext)<br>flag=<span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> result)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure></li></ul><h3 id="tea"><a href="#tea" class="headerlink" title="tea"></a>tea</h3><ul><li><p>IDA打开附件程序，main函数逻辑是将输入的flag分成10份，每次取两份进行加密，加密出来的数据和enc比较。key和enc已经给定</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//main函数</span><br><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">char</span> *v3; <span class="hljs-comment">// rdi</span><br>  __int64 i; <span class="hljs-comment">// rcx</span><br>  _BYTE v6[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-20h] BYREF</span><br>  <span class="hljs-type">char</span> v7; <span class="hljs-comment">// [rsp+20h] [rbp+0h] BYREF</span><br>  _DWORD key[<span class="hljs-number">12</span>]; <span class="hljs-comment">// [rsp+28h] [rbp+8h] BYREF</span><br>  _DWORD enc[<span class="hljs-number">20</span>]; <span class="hljs-comment">// [rsp+58h] [rbp+38h]</span><br>  _DWORD fl4g[<span class="hljs-number">20</span>]; <span class="hljs-comment">// [rsp+A8h] [rbp+88h] BYREF</span><br>  _DWORD Flag[<span class="hljs-number">20</span>]; <span class="hljs-comment">// [rsp+F8h] [rbp+D8h] BYREF</span><br>  <span class="hljs-type">char</span> flag[<span class="hljs-number">64</span>]; <span class="hljs-comment">// [rsp+148h] [rbp+128h] BYREF</span><br>  <span class="hljs-type">size_t</span> length; <span class="hljs-comment">// [rsp+188h] [rbp+168h]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+1A4h] [rbp+184h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> part1; <span class="hljs-comment">// [rsp+1C8h] [rbp+1A8h] BYREF</span><br>  <span class="hljs-type">int</span> part2; <span class="hljs-comment">// [rsp+1CCh] [rbp+1ACh]</span><br>  <span class="hljs-type">int</span> v17; <span class="hljs-comment">// [rsp+1E4h] [rbp+1C4h]</span><br>  <span class="hljs-type">int</span> k; <span class="hljs-comment">// [rsp+204h] [rbp+1E4h]</span><br><br>  v3 = &amp;v7;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">130LL</span>; i; --i )<br>  &#123;<br>    *(_DWORD *)v3 = <span class="hljs-number">-858993460</span>;<br>    v3 += <span class="hljs-number">4</span>;<br>  &#125;<br>  sub_7FF6DAA21384(byte_7FF6DAA33015);<br>  key[<span class="hljs-number">0</span>] = <span class="hljs-number">289739801</span>;<br>  key[<span class="hljs-number">1</span>] = <span class="hljs-number">427884820</span>;<br>  key[<span class="hljs-number">2</span>] = <span class="hljs-number">1363251608</span>;<br>  key[<span class="hljs-number">3</span>] = <span class="hljs-number">269567252</span>;<br>  enc[<span class="hljs-number">0</span>] = <span class="hljs-number">2026214571</span>;<br>  enc[<span class="hljs-number">1</span>] = <span class="hljs-number">578894681</span>;<br>  enc[<span class="hljs-number">2</span>] = <span class="hljs-number">1193947460</span>;<br>  enc[<span class="hljs-number">3</span>] = <span class="hljs-number">-229306230</span>;<br>  enc[<span class="hljs-number">4</span>] = <span class="hljs-number">73202484</span>;<br>  enc[<span class="hljs-number">5</span>] = <span class="hljs-number">961145356</span>;<br>  enc[<span class="hljs-number">6</span>] = <span class="hljs-number">-881456792</span>;<br>  enc[<span class="hljs-number">7</span>] = <span class="hljs-number">358205817</span>;<br>  enc[<span class="hljs-number">8</span>] = <span class="hljs-number">-554069347</span>;<br>  enc[<span class="hljs-number">9</span>] = <span class="hljs-number">119347883</span>;<br>  enc[<span class="hljs-number">10</span>] = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">memset</span>(fl4g, <span class="hljs-number">0</span>, <span class="hljs-number">44uLL</span>);<br>  <span class="hljs-built_in">memset</span>(Flag, <span class="hljs-number">0</span>, <span class="hljs-number">44uLL</span>);<br>  <span class="hljs-built_in">printf</span>(&amp;You_are_wrong___);<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, flag);<br>  length = j_strlen(flag);<br>  j_memcpy(fl4g, flag, length);<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">5</span>; ++j )<br>  &#123;<br>    part1 = fl4g[<span class="hljs-number">2</span> * j];<br>    part2 = fl4g[<span class="hljs-number">2</span> * j + <span class="hljs-number">1</span>];<br>    tea(&amp;part1, key);<span class="hljs-comment">// 这里传的是地址，tea内可以通过part1的地址得到part2</span><br>    Flag[<span class="hljs-number">2</span> * j] = part1;<br>    Flag[<span class="hljs-number">2</span> * j + <span class="hljs-number">1</span>] = part2;<br>  &#125;<br>  v17 = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">11</span>; ++k )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( Flag[k] != enc[k] )<br>    &#123;<br>      v17 = <span class="hljs-number">0</span>;<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;You are wrong!!&quot;</span>);<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v17 == <span class="hljs-number">1</span> )<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Congratulations!!!!&quot;</span>);<br>  sub_7FF6DAA21320(v6, &amp;unk_7FF6DAA2AE60);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>加密函数是改动的tea加密</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">Tea</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *part1, _DWORD *key)</span><br>&#123;<br>  __int64 n4; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> delta; <span class="hljs-comment">// [rsp+24h] [rbp+4h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> p1; <span class="hljs-comment">// [rsp+44h] [rbp+24h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> p2; <span class="hljs-comment">// [rsp+64h] [rbp+44h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+A4h] [rbp+84h]</span><br><br>  sub_7FF6DAA21384((__int64)&amp;byte_7FF6DAA33015);<br>  delta = <span class="hljs-number">0</span>;<br>  p1 = *part1;<br>  p2 = part1[<span class="hljs-number">1</span>];<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; ++i )<br>  &#123;<br>    delta += <span class="hljs-number">1131796</span>;<br>    p1 += (key[<span class="hljs-number">1</span>] + (p2 &gt;&gt; <span class="hljs-number">5</span>)) ^ (delta + p2) ^ (*key + <span class="hljs-number">16</span> * p2);<br>    p2 += (key[<span class="hljs-number">3</span>] + (p1 &gt;&gt; <span class="hljs-number">5</span>)) ^ (delta + p1) ^ (key[<span class="hljs-number">2</span>] + <span class="hljs-number">16</span> * p1);<br>  &#125;<br>  *part1 = p1;<br>  n4 = <span class="hljs-number">4LL</span>;<br>  part1[<span class="hljs-number">1</span>] = p2;<br>  <span class="hljs-keyword">return</span> n4;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>解密逻辑：将tea内的p1 p2位置对调，”+”改成”-“，然后delta从最后一轮的值往回递减就可以了。解密脚本：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">tea_decrypt</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> *a,<span class="hljs-type">uint32_t</span> *k)</span> &#123;<br><span class="hljs-type">uint32_t</span> delta = <span class="hljs-number">1131796</span> * <span class="hljs-number">32</span>;<br><span class="hljs-type">uint32_t</span> p1 = *a;<br><span class="hljs-type">uint32_t</span> p2 = *(a + <span class="hljs-number">1</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) &#123;<br>p2 -= ((k[<span class="hljs-number">3</span>] + (p1 &gt;&gt; <span class="hljs-number">5</span>)) ^ (delta + p1) ^ (k[<span class="hljs-number">2</span>] + <span class="hljs-number">16</span> * p1));<br>p1 -= ((k[<span class="hljs-number">1</span>] + (p2 &gt;&gt; <span class="hljs-number">5</span>)) ^ (delta + p2) ^ (*k + <span class="hljs-number">16</span> * p2));<br>delta -= <span class="hljs-number">1131796</span>;<br>&#125;<br>*a = p1;<br>*(a+<span class="hljs-number">1</span>)= p2;<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-type">uint32_t</span> key[<span class="hljs-number">4</span>];<br><span class="hljs-type">uint32_t</span> enc[<span class="hljs-number">11</span>];<br>key[<span class="hljs-number">0</span>] = <span class="hljs-number">289739801</span>;<br>key[<span class="hljs-number">1</span>] = <span class="hljs-number">427884820</span>;<br>key[<span class="hljs-number">2</span>] = <span class="hljs-number">1363251608</span>;<br>key[<span class="hljs-number">3</span>] = <span class="hljs-number">269567252</span>;<br>enc[<span class="hljs-number">0</span>] = <span class="hljs-number">2026214571</span>;<br>enc[<span class="hljs-number">1</span>] = <span class="hljs-number">578894681</span>;<br>enc[<span class="hljs-number">2</span>] = <span class="hljs-number">1193947460</span>;<br>enc[<span class="hljs-number">3</span>] = <span class="hljs-number">-229306230</span>;<br>enc[<span class="hljs-number">4</span>] = <span class="hljs-number">73202484</span>;<br>enc[<span class="hljs-number">5</span>] = <span class="hljs-number">961145356</span>;<br>enc[<span class="hljs-number">6</span>] = <span class="hljs-number">-881456792</span>;<br>enc[<span class="hljs-number">7</span>] = <span class="hljs-number">358205817</span>;<br>enc[<span class="hljs-number">8</span>] = <span class="hljs-number">-554069347</span>;<br>enc[<span class="hljs-number">9</span>] = <span class="hljs-number">119347883</span>;<br>enc[<span class="hljs-number">10</span>] = <span class="hljs-number">0</span>;<br><span class="hljs-type">char</span> flag[<span class="hljs-number">45</span>] = &#123; <span class="hljs-number">0</span> &#125;;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br><span class="hljs-type">uint32_t</span> block[<span class="hljs-number">2</span>] = &#123;enc[<span class="hljs-number">2</span>*i],enc[<span class="hljs-number">2</span>*i+<span class="hljs-number">1</span>]&#125;;<br>tea_decrypt(block, key);<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">4</span>; j++) &#123;<br>flag[<span class="hljs-number">8</span> * i + j] = (block[<span class="hljs-number">0</span>] &gt;&gt; (j * <span class="hljs-number">8</span>)) &amp; <span class="hljs-number">0xff</span>;<span class="hljs-comment">//右移j个字符，然后取最后一个</span><br>flag[<span class="hljs-number">8</span> * i + j + <span class="hljs-number">4</span>] = (block[<span class="hljs-number">1</span>] &gt;&gt; (j * <span class="hljs-number">8</span>)) &amp; <span class="hljs-number">0xff</span>;<br>&#125;<br>&#125;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, flag);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="ez3"><a href="#ez3" class="headerlink" title="ez3"></a>ez3</h3><ul><li><p>附件程序main函数逻辑主要是获取flag，然后掐头去尾，对中间部分进行check。main函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">char</span> v3; <span class="hljs-comment">// bl</span><br>  <span class="hljs-type">bool</span> v4; <span class="hljs-comment">// r12</span><br>  __int64 v5; <span class="hljs-comment">// rbx</span><br>  __int64 v6; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v8; <span class="hljs-comment">// [rsp+Fh] [rbp-71h] BYREF</span><br>  __int64 Start; <span class="hljs-comment">// [rsp+10h] [rbp-70h] BYREF</span><br>  __int64 end; <span class="hljs-comment">// [rsp+18h] [rbp-68h] BYREF</span><br>  _BYTE flag[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-60h] BYREF</span><br>  _QWORD fl4g[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-40h] BYREF</span><br><br>  fl4g[<span class="hljs-number">5</span>] = __readfsqword(<span class="hljs-number">0x28u</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Input your flag:\n&gt; &quot;</span>, argv, envp);<br>  fflush(<span class="hljs-built_in">stdout</span>);<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::basic_string(flag);<br>  <span class="hljs-built_in">cin</span>(&amp;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cin</span>);<br>  <span class="hljs-keyword">if</span> ( length(flag) == <span class="hljs-number">42</span> )<br>  &#123;<br>    v3 = <span class="hljs-number">0</span>;<br>    v4 = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> ( length(flag) &gt; <span class="hljs-number">7</span> )<br>    &#123;<br>      substr(fl4g, flag, <span class="hljs-number">0LL</span>, <span class="hljs-number">7LL</span>);<br>      v3 = <span class="hljs-number">1</span>;<br>      <span class="hljs-keyword">if</span> ( !cmp(fl4g, <span class="hljs-string">&quot;moectf&#123;&quot;</span>) &amp;&amp; *get_last_str(flag) == <span class="hljs-number">125</span> )<br>        v4 = <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v3 )<br>      <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>(fl4g);<br>    <span class="hljs-keyword">if</span> ( v4 )<br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;FORMAT ERROR!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-built_in">std</span>::allocator&lt;<span class="hljs-type">char</span>&gt;::allocator(&amp;v8);<br>      end = getEnd(flag);<br>      v5 = cutTail(&amp;end, <span class="hljs-number">1LL</span>);<br>      Start = getStart(flag);<br>      v6 = cutHead(&amp;Start, <span class="hljs-number">7LL</span>);<br>      <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::basic_string&lt;__gnu_cxx::__normal_iterator&lt;<span class="hljs-type">char</span> *,<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;,<span class="hljs-type">void</span>&gt;(fl4g, v6, v5, &amp;v8);<br>      strcopy(flag, fl4g);<br>      <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>(fl4g);<br>      <span class="hljs-built_in">std</span>::allocator&lt;<span class="hljs-type">char</span>&gt;::~allocator(&amp;v8);<br>      <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::basic_string(fl4g, flag);<br>      LOBYTE(v5) = check(fl4g);<br>      <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>(fl4g);<br>      <span class="hljs-keyword">if</span> ( v5 )<br>      &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;OK&quot;</span>);<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;But I don&#x27;t know what the true flag is&quot;</span>);<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;try again~&quot;</span>);<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Length error!&quot;</span>);<br>  &#125;<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>(flag);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>check函数：</p><p><img src="/../images/image-20250829115915331-1760193218429-15.png" alt="check函数"></p><p>题目提示了z3，所以使用z3约束求解。思路就是复现check函数逻辑，爆破出flag</p></li><li><p>脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br><br>enc = [<br>    <span class="hljs-number">0x0B1B0</span>, <span class="hljs-number">0x5678</span>, <span class="hljs-number">0x7FF2</span>, <span class="hljs-number">0xA332</span>, <span class="hljs-number">0xA0E8</span>, <span class="hljs-number">0x364C</span>, <span class="hljs-number">0x2BD4</span>,<br>    <span class="hljs-number">0xC8FE</span>, <span class="hljs-number">0x4A7C</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x2BE4</span>, <span class="hljs-number">0x4144</span>, <span class="hljs-number">0x3BA6</span>, <span class="hljs-number">0xBE8C</span>, <span class="hljs-number">0x8F7E</span>,<br>    <span class="hljs-number">0x35F8</span>, <span class="hljs-number">0x61AA</span>, <span class="hljs-number">0x2B4A</span>, <span class="hljs-number">0x6828</span>, <span class="hljs-number">0xB39E</span>, <span class="hljs-number">0xB542</span>, <span class="hljs-number">0x33EC</span>, <span class="hljs-number">0xC7D8</span>,<br>    <span class="hljs-number">0x448C</span>, <span class="hljs-number">0x9310</span>, <span class="hljs-number">0x8808</span>, <span class="hljs-number">0xADD4</span>, <span class="hljs-number">0x3CC2</span>, <span class="hljs-number">0x796</span>, <span class="hljs-number">0xC940</span>, <span class="hljs-number">0x4E32</span>,<br>    <span class="hljs-number">0x4E2E</span>, <span class="hljs-number">0x924A</span>, <span class="hljs-number">0x5B5C</span><br>]<br><br>s=Solver()<br>flag=[BitVec(<span class="hljs-string">f&#x27;flag_<span class="hljs-subst">&#123;i&#125;</span>&#x27;</span>,<span class="hljs-number">32</span>)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">34</span>)]<br>b=[BitVec(<span class="hljs-string">f&#x27;b_<span class="hljs-subst">&#123;i&#125;</span>&#x27;</span>,<span class="hljs-number">32</span>)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">34</span>)]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">34</span>):<br>    s.add(flag[i]&gt;=<span class="hljs-number">32</span>,flag[i]&lt;=<span class="hljs-number">126</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">34</span>):<br>    <span class="hljs-keyword">if</span> i==<span class="hljs-number">0</span>:<br>        s.add(b[<span class="hljs-number">0</span>]==(<span class="hljs-number">47806</span>*flag[<span class="hljs-number">0</span>])%<span class="hljs-number">51966</span>)<br>    <span class="hljs-keyword">else</span>:<br>        b_value=<span class="hljs-number">47806</span>*(flag[i]+i)<br>        b_xored=b_value^(b[i-<span class="hljs-number">1</span>]^<span class="hljs-number">0x114514</span>)<br>        s.add(b[i]==b_xored%<span class="hljs-number">51966</span>)<br>    s.add(b[i]==enc[i])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;solutions found:&quot;</span>)<br><span class="hljs-keyword">while</span> s.check()==sat:<br>    model=s.model()<br>    solution=<span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">chr</span>(model[flag[i]].as_long())<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">34</span>)])<br>    <span class="hljs-built_in">print</span>(solution)<br>    exception=Or([flag[i]!=model[flag[i]]<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">34</span>)])<span class="hljs-comment">#避免重复情况</span><br>    s.add(exception)<br></code></pre></td></tr></table></figure></li></ul><h3 id="逆向工程入门指北"><a href="#逆向工程入门指北" class="headerlink" title="逆向工程入门指北"></a>逆向工程入门指北</h3><ul><li><p>IDA打开附件程序，在字符串窗口可以直接看到flag</p><p><img src="/../images/image-20250829104220942-1760193218429-14.png" alt="字符串窗口"></p></li></ul><h2 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h2><h3 id="base"><a href="#base" class="headerlink" title="base"></a>base</h3><ul><li><p>运行附件程序，直接让输入flag。IDA打开分析main函数，发现使用了标准base64加密，并且密文直接给了。cyberchef一把梭</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//main函数</span><br><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  FILE *Stream; <span class="hljs-comment">// rax</span><br>  __int64 v4; <span class="hljs-comment">// rdx</span><br>  __int64 length; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> __int64 n; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> *Str1; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *Format; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">char</span> v11[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-98h] BYREF</span><br>  <span class="hljs-type">char</span> flag[<span class="hljs-number">112</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-88h] BYREF</span><br><br>  <span class="hljs-built_in">printf</span>(::Format);<br>  <span class="hljs-built_in">printf</span>((<span class="hljs-type">char</span> *)&amp;Format_);<br>  Stream = _acrt_iob_func(<span class="hljs-number">0</span>);<br>  fgets(flag, <span class="hljs-number">100</span>, Stream);<br>  v4 = <span class="hljs-number">-1LL</span>;<br>  length = <span class="hljs-number">-1LL</span>;<br>  <span class="hljs-keyword">do</span><br>    ++length;<br>  <span class="hljs-keyword">while</span> ( flag[length] );<br>  <span class="hljs-keyword">if</span> ( length &amp;&amp; v11[length + <span class="hljs-number">15</span>] == <span class="hljs-number">10</span> )<br>  &#123;<br>    n = length - <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> ( n &gt;= <span class="hljs-number">0x64</span> )<br>      _report_securityfailure_(flag);<br>    flag[n] = <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">do</span><br>    ++v4;<br>  <span class="hljs-keyword">while</span> ( flag[v4] );<br>  Str1 = (<span class="hljs-type">char</span> *)baseEncode(flag, v4, v11);<span class="hljs-comment">// 标准base64加密</span><br>  v8 = <span class="hljs-built_in">strcmp</span>(Str1, <span class="hljs-string">&quot;bW9lY3Rme1kwdV9DNG5fRzAwZF9BdF9CNDVlNjQhIX0=&quot;</span>);<br>  Format = (<span class="hljs-type">char</span> *)&amp;unk_140003300;<br>  <span class="hljs-keyword">if</span> ( v8 )<br>    Format = (<span class="hljs-type">char</span> *)&amp;byte_140003318;<br>  <span class="hljs-built_in">printf</span>(Format);<br>  <span class="hljs-built_in">free</span>(Str1);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/../images/image-20250821000019398-1760193218429-16.png" alt="cyberchef一把梭"></p></li></ul><h3 id="speed"><a href="#speed" class="headerlink" title="speed"></a>speed</h3><ul><li><p>附件程序运行出现一道黑影，看不清。IDA分析main函数，发现使用了WNDCLASSA结构体（详细信息见：<a href="https://learn.microsoft.com/zh-cn/windows/win32/api/winuser/ns-winuser-wndclassa">WNDCLASSA （winuser.h） - Win32 apps | Microsoft Learn</a>），主要逻辑是创建窗口，关键部分是窗口结构体变量lpfnWndProc，它指向了窗口的逻辑（即代码中的WndProc函数）</p><p><img src="/../images/image-20250828214030322-1760193218429-17.png" alt="main函数"></p></li><li><p>分析WndProc函数发现，窗口似乎直接输出flag。于是下断点，动态调试</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//WndProc函数</span><br>LRESULT __fastcall <span class="hljs-title function_">WndProc</span><span class="hljs-params">(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam)</span><br>&#123;<br>  tagPAINTSTRUCT Paint; <span class="hljs-comment">// [rsp+30h] [rbp-50h] BYREF</span><br>  <span class="hljs-type">char</span> Destination[<span class="hljs-number">14</span>]; <span class="hljs-comment">// [rsp+80h] [rbp+0h] BYREF</span><br>  __int16 v7; <span class="hljs-comment">// [rsp+8Eh] [rbp+Eh]</span><br>  __int64 v8; <span class="hljs-comment">// [rsp+90h] [rbp+10h]</span><br>  __int64 v9; <span class="hljs-comment">// [rsp+98h] [rbp+18h]</span><br>  __int64 v10; <span class="hljs-comment">// [rsp+A0h] [rbp+20h]</span><br>  __int64 v11; <span class="hljs-comment">// [rsp+A8h] [rbp+28h]</span><br>  __int64 v12; <span class="hljs-comment">// [rsp+B0h] [rbp+30h]</span><br>  __int64 v13; <span class="hljs-comment">// [rsp+B8h] [rbp+38h]</span><br>  __int64 v14; <span class="hljs-comment">// [rsp+C0h] [rbp+40h]</span><br>  __int64 v15; <span class="hljs-comment">// [rsp+C8h] [rbp+48h]</span><br>  __int64 v16; <span class="hljs-comment">// [rsp+D0h] [rbp+50h]</span><br>  __int64 v17; <span class="hljs-comment">// [rsp+D8h] [rbp+58h]</span><br>  __int64 v18; <span class="hljs-comment">// [rsp+E0h] [rbp+60h]</span><br>  __int64 v19; <span class="hljs-comment">// [rsp+E8h] [rbp+68h]</span><br>  __int64 v20; <span class="hljs-comment">// [rsp+F0h] [rbp+70h]</span><br>  __int64 v21; <span class="hljs-comment">// [rsp+F8h] [rbp+78h]</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tagRECT</span> <span class="hljs-title">Rect</span>;</span> <span class="hljs-comment">// [rsp+100h] [rbp+80h] BYREF</span><br>  <span class="hljs-type">char</span> mylittlepony[<span class="hljs-number">13</span>]; <span class="hljs-comment">// [rsp+113h] [rbp+93h] BYREF</span><br>  <span class="hljs-type">char</span> Source[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+120h] [rbp+A0h] BYREF</span><br>  __int64 v25; <span class="hljs-comment">// [rsp+128h] [rbp+A8h]</span><br>  _QWORD v26[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+130h] [rbp+B0h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+140h] [rbp+C0h]</span><br>  <span class="hljs-type">int</span> n12; <span class="hljs-comment">// [rsp+144h] [rbp+C4h]</span><br>  HDC hdc; <span class="hljs-comment">// [rsp+148h] [rbp+C8h]</span><br><br>  <span class="hljs-keyword">if</span> ( Msg == <span class="hljs-number">2</span> )<br>  &#123;<br>    PostQuitMessage(<span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( Msg == <span class="hljs-number">15</span> )<br>  &#123;<br>    hdc = BeginPaint(hWnd, &amp;Paint);<br>    <span class="hljs-built_in">strcpy</span>(Destination, <span class="hljs-string">&quot;Your flag is &quot;</span>);<br>    v7 = <span class="hljs-number">0</span>;<br>    v8 = <span class="hljs-number">0LL</span>;<br>    v9 = <span class="hljs-number">0LL</span>;<br>    v10 = <span class="hljs-number">0LL</span>;<br>    v11 = <span class="hljs-number">0LL</span>;<br>    v12 = <span class="hljs-number">0LL</span>;<br>    v13 = <span class="hljs-number">0LL</span>;<br>    v14 = <span class="hljs-number">0LL</span>;<br>    v15 = <span class="hljs-number">0LL</span>;<br>    v16 = <span class="hljs-number">0LL</span>;<br>    v17 = <span class="hljs-number">0LL</span>;<br>    v18 = <span class="hljs-number">0LL</span>;<br>    v19 = <span class="hljs-number">0LL</span>;<br>    v20 = <span class="hljs-number">0LL</span>;<br>    v21 = <span class="hljs-number">0LL</span>;<br>    *(_QWORD *)Source = <span class="hljs-number">0x7F1B3E885EF9160L</span>L;<br>    v25 = <span class="hljs-number">0x2CD336BCB0464A89L</span>L;<br>    v26[<span class="hljs-number">0</span>] = <span class="hljs-number">0xEF5FC91642917EE1u</span>LL;<br>    *(_QWORD *)((<span class="hljs-type">char</span> *)v26 + <span class="hljs-number">6</span>) = <span class="hljs-number">0x739D40A4E356EF5FL</span>L;<br>    <span class="hljs-built_in">strcpy</span>(mylittlepony, <span class="hljs-string">&quot;mylittlepony&quot;</span>);<br>    n12 = <span class="hljs-number">12</span>;<br>    i = <span class="hljs-built_in">strlen</span>(Source);<br>    RC4Crypt((<span class="hljs-type">unsigned</span> __int8 *)Source, i, (<span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> __int8 *)mylittlepony, <span class="hljs-number">12</span>);<br>    <span class="hljs-built_in">strcat</span>(Destination, Source);<br>    GetClientRect(hWnd, &amp;Rect);<br>    DrawTextA(hdc, Destination, <span class="hljs-number">-1</span>, &amp;Rect, <span class="hljs-number">0x40005u</span>);<br>    EndPaint(hWnd, &amp;Paint);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-keyword">return</span> DefWindowProcA(hWnd, Msg, wParam, lParam);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>动态调试结果如图：</p><p><img src="/../images/image-20250828214156948-1760193218429-19.png" alt="动态调试"></p></li></ul><h3 id="ezpy"><a href="#ezpy" class="headerlink" title="ezpy"></a>ezpy</h3><ul><li><p>使用decompyle3反编译得到：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">caesar_cipher_encrypt</span>(<span class="hljs-params">text, shift</span>):<br>    result = []<br>    <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> text:<br>        <span class="hljs-keyword">if</span> char.isalpha():<br>            <span class="hljs-keyword">if</span> char.islower():<br>                new_char = <span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(char) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;a&quot;</span>) + shift) % <span class="hljs-number">26</span> + <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;a&quot;</span>))<br>            <span class="hljs-keyword">elif</span> char.isupper():<br>                new_char = <span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(char) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;A&quot;</span>) + shift) % <span class="hljs-number">26</span> + <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;A&quot;</span>))<br>            result.append(new_char)<br>        <span class="hljs-keyword">else</span>:<br>            result.append(char)<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>.join(result)<br><br><br>user_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;please input your flag：&quot;</span>)<br>a = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> a != <span class="hljs-number">1</span>:<br>    plaintext = user_input<br>    shift = <span class="hljs-number">114514</span><br>    encrypted_text = caesar_cipher_encrypt(plaintext, shift)<br>    <span class="hljs-keyword">if</span> encrypted_text == <span class="hljs-string">&quot;wyomdp&#123;I0e_Ux0G_zim&#125;&quot;</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Correct!!!!&quot;</span>)<br></code></pre></td></tr></table></figure></li><li><p>可以看出实现了一个凯撒加密，分析逻辑可以看出实际上是给每个字母移位了10（ascii码+10），所以给字母减10就ok了，可以基于源码进行微小改动得到解密脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">caesar_cipher_decrypt</span>(<span class="hljs-params">text, shift</span>):<br>    result = []<br>    <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> text:<br>        <span class="hljs-keyword">if</span> char.isalpha():<br>            <span class="hljs-keyword">if</span> char.islower():<br>                new_char = <span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(char) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;a&quot;</span>) - shift) % <span class="hljs-number">26</span> + <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;a&quot;</span>))<span class="hljs-comment">#&#x27;+&#x27;改为-&quot;</span><br>            <span class="hljs-keyword">elif</span> char.isupper():<br>                new_char = <span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(char) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;A&quot;</span>) - shift) % <span class="hljs-number">26</span> + <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;A&quot;</span>))<br>            result.append(new_char)<br>        <span class="hljs-keyword">else</span>:<br>            result.append(char)<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>.join(result)<br>enc=<span class="hljs-string">&quot;wyomdp&#123;I0e_Ux0G_zim&#125;&quot;</span><br>flag=caesar_cipher_decrypt(enc,<span class="hljs-number">114514</span>)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure></li></ul><h3 id="catch"><a href="#catch" class="headerlink" title="catch"></a>catch</h3><ul><li><p>先看main函数反编译结果，发现只有简单的两个函数，其中solve函数有更复杂的逻辑：</p><p><img src="/../images/image-20250828215740728-1760193218429-18.png" alt="main函数"></p></li><li><p>然而solve函数并不能看出什么有用的逻辑出来，sub_114514出现了flag字样，但是动调发现没有用处</p><p><img src="/../images/image-20250828215832225-1760193218429-20.png" alt="solve函数"></p></li><li><p>结合题目提示try catch不能被正确反编译，于是直接查看汇编代码。在汇编代码里看到一个类似flag格式的字符串，分析后续逻辑发现对这个字符串进行了处理，分析发现处理结果就是flag</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-symbol">.text:</span>00000001400014D6 <span class="hljs-comment">; =============== S U B R O U T I N E =======================================</span><br><span class="hljs-symbol">.text:</span>00000001400014D6<br><span class="hljs-symbol">.text:</span>00000001400014D6 <span class="hljs-comment">; Attributes: bp-based frame fpd=10h</span><br><span class="hljs-symbol">.text:</span>00000001400014D6<br><span class="hljs-symbol">.text:</span>00000001400014D6 <span class="hljs-comment">; void __noreturn solve(void)</span><br><span class="hljs-symbol">.text:</span>00000001400014D6                 <span class="hljs-meta">public</span> _Z5solvev<br><span class="hljs-symbol">.text:</span>00000001400014D6 _Z5solvev       proc <span class="hljs-built_in">near</span>               <span class="hljs-comment">; CODE XREF: main+D↓p</span><br><span class="hljs-symbol">.text:</span>00000001400014D6                                         <span class="hljs-comment">; DATA XREF: .pdata:000000014002D078↓o ...</span><br><span class="hljs-symbol">.text:</span>00000001400014D6<br><span class="hljs-symbol">.text:</span>00000001400014D6 length          = <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> -<span class="hljs-number">1Ch</span><br><span class="hljs-symbol">.text:</span>00000001400014D6 C               = <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> -<span class="hljs-number">18h</span><br><span class="hljs-symbol">.text:</span>00000001400014D6 count           = <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> -<span class="hljs-number">14h</span><br><span class="hljs-symbol">.text:</span>00000001400014D6<br><span class="hljs-symbol">.text:</span>00000001400014D6 <span class="hljs-comment">; __unwind &#123; // __gxx_personality_seh0</span><br><span class="hljs-symbol">.text:</span>00000001400014D6                 <span class="hljs-keyword">push</span>    <span class="hljs-built_in">rbp</span><br><span class="hljs-symbol">.text:</span>00000001400014D7                 <span class="hljs-keyword">push</span>    <span class="hljs-built_in">rsi</span><br><span class="hljs-symbol">.text:</span>00000001400014D8                 <span class="hljs-keyword">push</span>    <span class="hljs-built_in">rbx</span><br><span class="hljs-symbol">.text:</span>00000001400014D9                 <span class="hljs-keyword">sub</span>     <span class="hljs-built_in">rsp</span>, <span class="hljs-number">30h</span><br><span class="hljs-symbol">.text:</span>00000001400014<span class="hljs-built_in">DD</span>                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rbp</span>, [<span class="hljs-built_in">rsp</span>+<span class="hljs-number">30h</span>]<br><span class="hljs-symbol">.text:</span>00000001400014E2                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rax</span>, aMyFlagIsHidden <span class="hljs-comment">; &quot;my flag is hidden in this program. Can &quot;...</span><br><span class="hljs-symbol">.text:</span>00000001400014E9                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rcx</span>, <span class="hljs-built_in">rax</span>        <span class="hljs-comment">; char *</span><br><span class="hljs-symbol">.text:</span>00000001400014EC                 <span class="hljs-keyword">call</span>    print<br><span class="hljs-symbol">.text:</span>00000001400014F1 <span class="hljs-comment">;   try &#123;</span><br><span class="hljs-symbol">.text:</span>00000001400014F1                 <span class="hljs-keyword">call</span>    _Z10sub_114514v <span class="hljs-comment">; sub_114514(void)</span><br><span class="hljs-symbol">.text:</span>00000001400014F1 <span class="hljs-comment">;   &#125; // starts at 1400014F1</span><br><span class="hljs-symbol">.text:</span>00000001400014F6                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-number">10h</span>        <span class="hljs-comment">; thrown_size</span><br><span class="hljs-symbol">.text:</span>00000001400014FB                 <span class="hljs-keyword">call</span>    __cxa_allocate_exception<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001500</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rbx</span>, <span class="hljs-built_in">rax</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001503</span>                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rax</span>, aNothingButErro <span class="hljs-comment">; &quot;nothing but error&quot;</span><br><span class="hljs-symbol">.text:</span>000000014000150A                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rdx</span>, <span class="hljs-built_in">rax</span>        <span class="hljs-comment">; char *</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">000000014000150D</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rcx</span>, <span class="hljs-built_in">rbx</span>        <span class="hljs-comment">; this</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001510</span> <span class="hljs-comment">;   try &#123;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001510</span>                 <span class="hljs-keyword">call</span>    _ZNSt11logic_errorC1EPKc <span class="hljs-comment">; std::logic_error::logic_error(char const*)</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001510</span> <span class="hljs-comment">;   &#125; // starts at 140001510</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001515</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">r8</span>, <span class="hljs-built_in">cs</span>:_refptr__ZNSt11logic_errorD1Ev <span class="hljs-comment">; void (*)(void *)</span><br><span class="hljs-symbol">.text:</span>000000014000151C                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rax</span>, _ZTISt11logic_error <span class="hljs-comment">; `typeinfo for&#x27;std::logic_error</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001523</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rdx</span>, <span class="hljs-built_in">rax</span>        <span class="hljs-comment">; lptinfo</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001526</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rcx</span>, <span class="hljs-built_in">rbx</span>        <span class="hljs-comment">; void *</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001529</span> <span class="hljs-comment">;   try &#123;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001529</span>                 <span class="hljs-keyword">call</span>    __cxa_throw<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001529</span> <span class="hljs-comment">;   &#125; // starts at 140001529</span><br><span class="hljs-symbol">.text:</span>000000014000152E <span class="hljs-comment">; ---------------------------------------------------------------------------</span><br><span class="hljs-symbol">.text:</span>000000014000152E <span class="hljs-comment">;   cleanup() // owned by 140001510</span><br><span class="hljs-symbol">.text:</span>000000014000152E                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rsi</span>, <span class="hljs-built_in">rax</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001531</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rcx</span>, <span class="hljs-built_in">rbx</span>        <span class="hljs-comment">; void *</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001534</span>                 <span class="hljs-keyword">call</span>    __cxa_free_exception<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001539</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rax</span>, <span class="hljs-built_in">rsi</span><br><span class="hljs-symbol">.text:</span>000000014000153C                 <span class="hljs-keyword">jmp</span>     short $+<span class="hljs-number">2</span><br><span class="hljs-symbol">.text:</span>000000014000153E <span class="hljs-comment">; ---------------------------------------------------------------------------</span><br><span class="hljs-symbol">.text:</span>000000014000153E<br><span class="hljs-symbol">.text:</span>000000014000153E loc_14000153E:                          <span class="hljs-comment">; CODE XREF: solve(void)+66↑j</span><br><span class="hljs-symbol">.text:</span>000000014000153E <span class="hljs-comment">;   catch(...) // owned by 1400014F1    ; void *</span><br><span class="hljs-symbol">.text:</span>000000014000153E <span class="hljs-comment">;   catch(...) // owned by 140001529</span><br><span class="hljs-symbol">.text:</span>000000014000153E                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rcx</span>, <span class="hljs-built_in">rax</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001541</span>                 <span class="hljs-keyword">call</span>    __cxa_begin_catch<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001546</span>                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rax</span>, enc        <span class="hljs-comment">; &quot;zbrpgs&#123;F4z3_Ge1px_jvgu_@sybjre_qrfhjn&#125;&quot;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">000000014000154D</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rcx</span>, <span class="hljs-built_in">rax</span>        <span class="hljs-comment">; Str</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001550</span>                 <span class="hljs-keyword">call</span>    strlen<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001555</span>                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+length], <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001558</span>                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+count], <span class="hljs-number">0</span><br><span class="hljs-symbol">.text:</span>000000014000155F                 <span class="hljs-keyword">jmp</span>     loc_14000160E<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001564</span> <span class="hljs-comment">; ---------------------------------------------------------------------------</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001564</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001564</span> loc_140001564:                          <span class="hljs-comment">; CODE XREF: solve(void)+13E↓j</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001564</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+count]<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001567</span>                 <span class="hljs-keyword">cdqe</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001569</span>                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdx</span>, enc        <span class="hljs-comment">; &quot;zbrpgs&#123;F4z3_Ge1px_jvgu_@sybjre_qrfhjn&#125;&quot;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001570</span>                 <span class="hljs-keyword">movzx</span>   <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">byte</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">rax</span>+<span class="hljs-built_in">rdx</span>]<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001574</span>                 <span class="hljs-keyword">movzx</span>   <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">al</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001577</span>                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+C], <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span>000000014000157A                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+C]<br><span class="hljs-symbol">.text:</span><span class="hljs-number">000000014000157D</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-built_in">eax</span>        <span class="hljs-comment">; C</span><br><span class="hljs-symbol">.text:</span>000000014000157F                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rax</span>, <span class="hljs-built_in">cs</span>:__imp_islower<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001586</span>                 <span class="hljs-keyword">call</span>    <span class="hljs-built_in">rax</span> <span class="hljs-comment">; __imp_islower ; 判断字母大小写</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001588</span>                 <span class="hljs-keyword">test</span>    <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span>000000014000158A                 <span class="hljs-keyword">jz</span>      short loc_1400015B9 <span class="hljs-comment">; 大写字母跳转</span><br><span class="hljs-symbol">.text:</span>000000014000158C                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+C] <span class="hljs-comment">; enc[count]</span><br><span class="hljs-symbol">.text:</span>000000014000158F                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">edx</span>, [<span class="hljs-built_in">rax</span>-<span class="hljs-number">54h</span>]  <span class="hljs-comment">; enc[count]-0x54</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001592</span>                 <span class="hljs-keyword">movsxd</span>  <span class="hljs-built_in">rax</span>, <span class="hljs-built_in">edx</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001595</span>                 <span class="hljs-keyword">imul</span>    <span class="hljs-built_in">rax</span>, <span class="hljs-number">4EC4EC4Fh</span>  <span class="hljs-comment">; 从这里开始</span><br><span class="hljs-symbol">.text:</span>000000014000159C                 <span class="hljs-keyword">shr</span>     <span class="hljs-built_in">rax</span>, <span class="hljs-number">20h</span><br><span class="hljs-symbol">.text:</span>00000001400015A0                 <span class="hljs-keyword">sar</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-number">3</span><br><span class="hljs-symbol">.text:</span>00000001400015A3                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-built_in">edx</span><br><span class="hljs-symbol">.text:</span>00000001400015A5                 <span class="hljs-keyword">sar</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-number">1Fh</span><br><span class="hljs-symbol">.text:</span>00000001400015A8                 <span class="hljs-keyword">sub</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">ecx</span><br><span class="hljs-symbol">.text:</span>00000001400015AA                 <span class="hljs-keyword">imul</span>    <span class="hljs-built_in">ecx</span>, <span class="hljs-built_in">eax</span>, <span class="hljs-number">1Ah</span><br><span class="hljs-symbol">.text:</span>00000001400015AD                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">edx</span><br><span class="hljs-symbol">.text:</span>00000001400015AF                 <span class="hljs-keyword">sub</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">ecx</span>        <span class="hljs-comment">; 到这里结束，实现的是除以26</span><br><span class="hljs-symbol">.text:</span>00000001400015B1                 <span class="hljs-keyword">add</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-number">61h</span> <span class="hljs-comment">; &#x27;a&#x27;  ; 加上0x61</span><br><span class="hljs-symbol">.text:</span>00000001400015B4                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+C], <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span>00000001400015B7                 <span class="hljs-keyword">jmp</span>     short loc_1400015F6<br><span class="hljs-symbol">.text:</span>00000001400015B9 <span class="hljs-comment">; ---------------------------------------------------------------------------</span><br><span class="hljs-symbol">.text:</span>00000001400015B9<br><span class="hljs-symbol">.text:</span>00000001400015B9 loc_1400015B9:                          <span class="hljs-comment">; CODE XREF: solve(void)+B4↑j</span><br><span class="hljs-symbol">.text:</span>00000001400015B9                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+C]<br><span class="hljs-symbol">.text:</span>00000001400015BC                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-built_in">eax</span>        <span class="hljs-comment">; C</span><br><span class="hljs-symbol">.text:</span>00000001400015BE                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rax</span>, <span class="hljs-built_in">cs</span>:__imp_isupper<br><span class="hljs-symbol">.text:</span>00000001400015C5                 <span class="hljs-keyword">call</span>    <span class="hljs-built_in">rax</span> <span class="hljs-comment">; __imp_isupper ; 判断字母大小写</span><br><span class="hljs-symbol">.text:</span>00000001400015C7                 <span class="hljs-keyword">test</span>    <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span>00000001400015C9                 <span class="hljs-keyword">jz</span>      short loc_1400015F6 <span class="hljs-comment">; 非字母跳转</span><br><span class="hljs-symbol">.text:</span>00000001400015CB                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+C] <span class="hljs-comment">; enc[count]</span><br><span class="hljs-symbol">.text:</span>00000001400015CE                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">edx</span>, [<span class="hljs-built_in">rax</span>-<span class="hljs-number">34h</span>]  <span class="hljs-comment">; enc[count]-0x34</span><br><span class="hljs-symbol">.text:</span>00000001400015D1                 <span class="hljs-keyword">movsxd</span>  <span class="hljs-built_in">rax</span>, <span class="hljs-built_in">edx</span><br><span class="hljs-symbol">.text:</span>00000001400015D4                 <span class="hljs-keyword">imul</span>    <span class="hljs-built_in">rax</span>, <span class="hljs-number">4EC4EC4Fh</span>  <span class="hljs-comment">; 从这里开始</span><br><span class="hljs-symbol">.text:</span>00000001400015<span class="hljs-built_in">DB</span>                 <span class="hljs-keyword">shr</span>     <span class="hljs-built_in">rax</span>, <span class="hljs-number">20h</span><br><span class="hljs-symbol">.text:</span>00000001400015DF                 <span class="hljs-keyword">sar</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-number">3</span><br><span class="hljs-symbol">.text:</span>00000001400015E2                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-built_in">edx</span><br><span class="hljs-symbol">.text:</span>00000001400015E4                 <span class="hljs-keyword">sar</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-number">1Fh</span><br><span class="hljs-symbol">.text:</span>00000001400015E7                 <span class="hljs-keyword">sub</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">ecx</span><br><span class="hljs-symbol">.text:</span>00000001400015E9                 <span class="hljs-keyword">imul</span>    <span class="hljs-built_in">ecx</span>, <span class="hljs-built_in">eax</span>, <span class="hljs-number">1Ah</span><br><span class="hljs-symbol">.text:</span>00000001400015EC                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">edx</span><br><span class="hljs-symbol">.text:</span>00000001400015EE                 <span class="hljs-keyword">sub</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">ecx</span>        <span class="hljs-comment">; 到这里结束，实现的是除以26</span><br><span class="hljs-symbol">.text:</span>00000001400015F0                 <span class="hljs-keyword">add</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-number">41h</span> <span class="hljs-comment">; &#x27;A&#x27;  ; 加上0x41</span><br><span class="hljs-symbol">.text:</span>00000001400015F3                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+C], <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span>00000001400015F6<br><span class="hljs-symbol">.text:</span>00000001400015F6 loc_1400015F6:                          <span class="hljs-comment">; CODE XREF: solve(void)+E1↑j</span><br><span class="hljs-symbol">.text:</span>00000001400015F6                                         <span class="hljs-comment">; solve(void)+F3↑j</span><br><span class="hljs-symbol">.text:</span>00000001400015F6                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+C]<br><span class="hljs-symbol">.text:</span>00000001400015F9                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span>00000001400015FB                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+count]<br><span class="hljs-symbol">.text:</span>00000001400015FE                 <span class="hljs-keyword">cdqe</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001600</span>                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdx</span>, enc        <span class="hljs-comment">; &quot;zbrpgs&#123;F4z3_Ge1px_jvgu_@sybjre_qrfhjn&#125;&quot;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001607</span>                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rax</span>+<span class="hljs-built_in">rdx</span>], <span class="hljs-built_in">cl</span><br><span class="hljs-symbol">.text:</span>000000014000160A                 <span class="hljs-keyword">add</span>     [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+count], <span class="hljs-number">1</span><br><span class="hljs-symbol">.text:</span>000000014000160E<br><span class="hljs-symbol">.text:</span>000000014000160E loc_14000160E:                          <span class="hljs-comment">; CODE XREF: solve(void)+89↑j</span><br><span class="hljs-symbol">.text:</span>000000014000160E                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+count]<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001611</span>                 <span class="hljs-keyword">cmp</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+length]<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001614</span>                 <span class="hljs-keyword">jl</span>      loc_140001564<br><span class="hljs-symbol">.text:</span>000000014000161A                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rax</span>, aSoYouDidnTCatc <span class="hljs-comment">; &quot;so you didn&#x27;t catch me?\n&quot;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001621</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rcx</span>, <span class="hljs-built_in">rax</span>        <span class="hljs-comment">; char *</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001624</span> <span class="hljs-comment">;   try &#123;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001624</span>                 <span class="hljs-keyword">call</span>    print<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001624</span> <span class="hljs-comment">;   &#125; // starts at 140001624</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001629</span>                 <span class="hljs-keyword">call</span>    __cxa_end_catch<br><span class="hljs-symbol">.text:</span>000000014000162E                 <span class="hljs-keyword">jmp</span>     short loc_140001644<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001630</span> <span class="hljs-comment">; ---------------------------------------------------------------------------</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001630</span> <span class="hljs-comment">;   cleanup() // owned by 140001624</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001630</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rbx</span>, <span class="hljs-built_in">rax</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001633</span>                 <span class="hljs-keyword">call</span>    __cxa_end_catch<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001638</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rax</span>, <span class="hljs-built_in">rbx</span><br><span class="hljs-symbol">.text:</span>000000014000163B                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rcx</span>, <span class="hljs-built_in">rax</span>        <span class="hljs-comment">; gcc_exc</span><br><span class="hljs-symbol">.text:</span>000000014000163E                 <span class="hljs-keyword">call</span>    _Unwind_Resume<br><span class="hljs-symbol">.text:</span>000000014000163E <span class="hljs-comment">; ---------------------------------------------------------------------------</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001643</span>                 <span class="hljs-meta">align</span> <span class="hljs-number">4</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001644</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001644</span> loc_140001644:                          <span class="hljs-comment">; CODE XREF: solve(void)+158↑j</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001644</span>                 <span class="hljs-keyword">add</span>     <span class="hljs-built_in">rsp</span>, <span class="hljs-number">30h</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001648</span>                 <span class="hljs-keyword">pop</span>     <span class="hljs-built_in">rbx</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001649</span>                 <span class="hljs-keyword">pop</span>     <span class="hljs-built_in">rsi</span><br><span class="hljs-symbol">.text:</span>000000014000164A                 <span class="hljs-keyword">pop</span>     <span class="hljs-built_in">rbp</span><br><span class="hljs-symbol">.text:</span>000000014000164B                 <span class="hljs-keyword">retn</span><br><span class="hljs-symbol">.text:</span>000000014000164B <span class="hljs-comment">; &#125; // starts at 1400014D6</span><br><span class="hljs-symbol">.text:</span>000000014000164B _Z5solvev       endp<br></code></pre></td></tr></table></figure></li><li><p>解密脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode</span>(<span class="hljs-params">s</span>):<br>    result = []<br>    <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> s:<br>        <span class="hljs-comment">#小写字母</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;a&#x27;</span> &lt;= char &lt;= <span class="hljs-string">&#x27;z&#x27;</span>:<br>            new_char = <span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(char) - <span class="hljs-number">0x54</span>) % <span class="hljs-number">26</span> + <span class="hljs-number">0x61</span>)<br>            result.append(new_char)<br>        <span class="hljs-comment">#大写字母</span><br>        <span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;A&#x27;</span> &lt;= char &lt;= <span class="hljs-string">&#x27;Z&#x27;</span>:<br>            new_char = <span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(char) - <span class="hljs-number">0x34</span>) % <span class="hljs-number">26</span> + <span class="hljs-number">0x41</span>)<br>            result.append(new_char)<br>        <span class="hljs-comment">#非字母</span><br>        <span class="hljs-keyword">else</span>:<br>            result.append(char)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(result)<br><br>enc = <span class="hljs-string">&quot;zbrpgs&#123;F4z3_Ge1px_jvgu_@sybjre_qrfhjn&#125;&quot;</span><br>flag = decode(enc)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure></li></ul><h3 id="upx-revenge"><a href="#upx-revenge" class="headerlink" title="upx_revenge"></a>upx_revenge</h3><ul><li><p>附件程序运行不了，如图：</p><p><img src="/../images/image-20251003124237857-1760193218429-23.png" alt="运行报错"></p><p>题目提示upx特征段魔改，但是自己尝试后发现魔改特征段不会导致程序运行不了</p><p>后来琢磨了半天，拷打<del>(bushi</del>了一下出题人，才发现这个程序缺了bytes（看了官方WriteUp，发现这确实是一个考点😭，我真傻，真的，我单知道upx魔改会改特征段数据，我不知道还可以删数据😭）</p><p><img src="/../images/image-20251003124409938-1760193218429-22.png" alt="这是week1_upx的结尾"></p><p><img src="/../images/image-20251003124456921-1760193218429-21.png" alt="这是本题程序的结尾"></p><p>缺少的地方在upx特征段，可以发现upx1段开头的四个字节错位了，错位到upx特征段上了，所以要给特征段插入四个字节</p><p><img src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-03%20124610-1760193218429-24.png" alt="这是week1_upx的特征段"></p><p><img src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-03%20124713-1760193218429-26.png" alt="这是本题程序的特征段"></p><p>用010editor在49 01 00 C3后面按Ctrl+shift+I插入4bytes（默认填充为0），会发现程序可以运行了</p><p><img src="/../images/image-20251003125528890-1760193218429-25.png" alt="插入4字节"></p><p><img src="/../images/image-20251003125621022-1760193218429-29.png" alt="程序可以运行了"></p></li><li><p>采用手动脱壳的办法。具体操作可以参考week1_upx的解法或者看看<a href="http://sydzi.github.io/2025/07/29/Day9-%E5%A3%B3/">Day9:壳与脱壳（一）</a>和<a href="http://sydzi.github.io/2025/07/30/Day10-%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%EF%BC%88%E4%BA%8C%EF%BC%89/">Day10:壳与脱壳（二）</a><del>（王婆卖瓜这一块</del>，这里从找到OEP开始：</p><p><img src="/../images/image-20251003131740100-1760193218429-28.png" alt="OEP"></p><p>下断点F9运行到上图这个大跳，然后F7步入</p><p><img src="/../images/image-20251003131847409-1760193218429-31.png" alt="OEP位置"></p><p>RIP指向此处时，打开scylla进行转储和IAT重建修复转储。这里需要注意，IAT搜索出来的结果里有一个损坏的导入，需要把它删掉</p><p><img src="/../images/image-20251003132216493-1760193218429-27.png" alt="删除无效导入结点"></p><p>脱壳后的_dump_SCY.exe文件就可以用IDA打开正常分析了</p></li><li><p>首先查看字符串表，可以发现可疑的的提示”correct”</p><p><img src="/../images/image-20251003132623642-1760193218429-30.png" alt="可疑的提示"></p></li><li><p>跟踪correct可以找到main函数。下面是优化后的main函数和相关的函数</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// Hidden C++ exception states: #wind=5</span><br><span class="hljs-function"><span class="hljs-type">int</span> __fastcall <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  __int64 v3; <span class="hljs-comment">// rax</span><br>  __int64 v4; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">unsigned</span> __int8 v5; <span class="hljs-comment">// al</span><br>  __int64 v6; <span class="hljs-comment">// r8</span><br>  <span class="hljs-type">void</span> **v7; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">void</span> **v8; <span class="hljs-comment">// rsi</span><br>  <span class="hljs-type">size_t</span> length; <span class="hljs-comment">// rdi</span><br>  <span class="hljs-type">void</span> *v10; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">void</span> *v11; <span class="hljs-comment">// rcx</span><br>  _QWORD *newBuffer; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> *v13; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">char</span> *enc; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> *v15; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">void</span> **encryptedFlag; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">int</span> v17; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *outString; <span class="hljs-comment">// rdx</span><br>  __int64 v19; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">void</span> *v20; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">void</span> *v21; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">void</span> *v22; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">void</span> *v23; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">void</span> *CopiedFlag[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+28h] [rbp-51h] BYREF</span><br>  <span class="hljs-type">char</span> *bufferEnd; <span class="hljs-comment">// [rsp+38h] [rbp-41h]</span><br>  <span class="hljs-type">void</span> *flag[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-39h] BYREF</span><br>  __m128i si128; <span class="hljs-comment">// [rsp+50h] [rbp-29h]</span><br>  <span class="hljs-type">void</span> *encodeResult[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+60h] [rbp-19h] BYREF</span><br>  <span class="hljs-type">size_t</span> Size; <span class="hljs-comment">// [rsp+70h] [rbp-9h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v31; <span class="hljs-comment">// [rsp+78h] [rbp-1h]</span><br>  <span class="hljs-type">void</span> *modifiedBaseTable[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+80h] [rbp+7h] BYREF</span><br>  __m128i v33; <span class="hljs-comment">// [rsp+90h] [rbp+17h]</span><br>  __int128 v34; <span class="hljs-comment">// [rsp+A0h] [rbp+27h]</span><br>  __int64 v35; <span class="hljs-comment">// [rsp+B0h] [rbp+37h]</span><br>  __int64 v36; <span class="hljs-comment">// [rsp+B8h] [rbp+3Fh]</span><br><br>  v3 = <span class="hljs-built_in">output</span>(std::cout, pleaseEnterYourFlag);<br>  std::istream::<span class="hljs-keyword">operator</span>&gt;&gt;(v3, out_flush);<br>  *flag = <span class="hljs-number">0LL</span>;<br>  si128 = _mm_load_si128(&amp;xmmword_7FF7420B44B0);<br>  <span class="hljs-built_in">LOBYTE</span>(flag[<span class="hljs-number">0</span>]) = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">LOBYTE</span>(v4) = <span class="hljs-number">10</span>;<br>  v5 = std::ios::<span class="hljs-built_in">widen</span>(&amp;std::cin + *(std::cin + <span class="hljs-number">4LL</span>), v4);<br>  <span class="hljs-built_in">input</span>(std::cin, flag, v5);<br>  v7 = flag;<br>  <span class="hljs-keyword">if</span> ( si<span class="hljs-number">128.</span>m128i_i64[<span class="hljs-number">1</span>] &gt; <span class="hljs-number">0xFuLL</span> )            <span class="hljs-comment">// si128.m128i_i64[1]是输入的flag的长度</span><br>    v7 = flag[<span class="hljs-number">0</span>];<br>  v8 = flag;<br>  <span class="hljs-keyword">if</span> ( si<span class="hljs-number">128.</span>m128i_i64[<span class="hljs-number">1</span>] &gt; <span class="hljs-number">0xFuLL</span> )<br>    v8 = flag[<span class="hljs-number">0</span>];<br>  *CopiedFlag = <span class="hljs-number">0LL</span>;<br>  bufferEnd = <span class="hljs-number">0LL</span>;<br>  length = v7 + si<span class="hljs-number">128.</span>m128i_i64[<span class="hljs-number">0</span>] - v8;<br>  <span class="hljs-keyword">if</span> ( length )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( length &gt; <span class="hljs-number">0x7FFFFFFFFFFFFFFFLL</span> )<br>      <span class="hljs-built_in">lengthError</span>();<br>    <span class="hljs-keyword">if</span> ( length &lt; <span class="hljs-number">0x1000</span> )<br>    &#123;<br>      newBuffer = <span class="hljs-keyword">operator</span> <span class="hljs-built_in">new</span>(length);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-keyword">if</span> ( length + <span class="hljs-number">39</span> &lt; length )<br>        <span class="hljs-built_in">sub_7FF7420B1170</span>();<br>      v10 = <span class="hljs-keyword">operator</span> <span class="hljs-built_in">new</span>(length + <span class="hljs-number">39</span>);<br>      v11 = v10;<br>      <span class="hljs-keyword">if</span> ( !v10 )<br>LABEL_31:<br>        <span class="hljs-built_in">invalid_parameter_noinfo_noreturn</span>();<br>      newBuffer = ((v10 + <span class="hljs-number">39</span>) &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFE0uLL</span>);<br>      *(newBuffer - <span class="hljs-number">1</span>) = v11;<br>    &#125;<br>    CopiedFlag[<span class="hljs-number">0</span>] = newBuffer;<br>    v13 = newBuffer + length;<br>    bufferEnd = newBuffer + length;<br>    <span class="hljs-built_in">memmove</span>(newBuffer, v8, length);<br>    CopiedFlag[<span class="hljs-number">1</span>] = v13;<br>  &#125;<br>  <span class="hljs-built_in">XORencrypt</span>(modifiedBaseTable, v7, v6);        <span class="hljs-comment">// 魔改base64的编码表</span><br>  <span class="hljs-built_in">baseEncode</span>(encodeResult, CopiedFlag, modifiedBaseTable);<span class="hljs-comment">// base64编码</span><br>  v34 = <span class="hljs-number">0LL</span>;<br>  enc = <span class="hljs-keyword">operator</span> <span class="hljs-built_in">new</span>(<span class="hljs-number">0x30uLL</span>);<br>  v15 = enc;<br>  *&amp;v34 = enc;<br>  v35 = <span class="hljs-number">44LL</span>;<br>  v36 = <span class="hljs-number">47LL</span>;<br>  <span class="hljs-built_in">strcpy</span>(enc, <span class="hljs-string">&quot;lY7bW=\\ck?eyjX7]TZ\\&#125;CVbh\\tOyTH6&gt;jH7XmFifG]H7&quot;</span>);<br>  encryptedFlag = encodeResult;<br>  <span class="hljs-keyword">if</span> ( v31 &gt; <span class="hljs-number">0xF</span> )<br>    encryptedFlag = encodeResult[<span class="hljs-number">0</span>];<br>  <span class="hljs-keyword">if</span> ( Size != <span class="hljs-number">44</span> || (v17 = <span class="hljs-built_in">memcmp</span>(encryptedFlag, enc, <span class="hljs-number">0x2CuLL</span>), outString = aCorrect, v17) )<br>    outString = aWrong;<br>  v19 = <span class="hljs-built_in">output</span>(std::cout, outString);<br>  std::istream::<span class="hljs-keyword">operator</span>&gt;&gt;(v19, out_flush);<br>  <span class="hljs-built_in">j_j_free</span>(v15);<br>  <span class="hljs-keyword">if</span> ( v31 &gt; <span class="hljs-number">0xF</span> )<br>  &#123;<br>    v20 = encodeResult[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">if</span> ( v31 + <span class="hljs-number">1</span> &gt;= <span class="hljs-number">0x1000</span> )<br>    &#123;<br>      v20 = *(encodeResult[<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>);<br>      <span class="hljs-keyword">if</span> ( (encodeResult[<span class="hljs-number">0</span>] - v20 - <span class="hljs-number">8</span>) &gt; <span class="hljs-number">0x1F</span> )<br>        <span class="hljs-built_in">invalid_parameter_noinfo_noreturn</span>();<br>    &#125;<br>    <span class="hljs-built_in">j_j_free</span>(v20);<br>  &#125;<br>  Size = <span class="hljs-number">0LL</span>;<br>  v31 = <span class="hljs-number">15LL</span>;<br>  <span class="hljs-built_in">LOBYTE</span>(encodeResult[<span class="hljs-number">0</span>]) = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> ( v<span class="hljs-number">33.</span>m128i_i64[<span class="hljs-number">1</span>] &gt; <span class="hljs-number">0xFuLL</span> )<br>  &#123;<br>    v21 = modifiedBaseTable[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">if</span> ( (v<span class="hljs-number">33.</span>m128i_i64[<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>) &gt;= <span class="hljs-number">0x1000</span> )<br>    &#123;<br>      v21 = *(modifiedBaseTable[<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>);<br>      <span class="hljs-keyword">if</span> ( (modifiedBaseTable[<span class="hljs-number">0</span>] - v21 - <span class="hljs-number">8</span>) &gt; <span class="hljs-number">0x1F</span> )<br>        <span class="hljs-built_in">invalid_parameter_noinfo_noreturn</span>();<br>    &#125;<br>    <span class="hljs-built_in">j_j_free</span>(v21);<br>  &#125;<br>  v33 = _mm_load_si128(&amp;xmmword_7FF7420B44B0);<br>  <span class="hljs-built_in">LOBYTE</span>(modifiedBaseTable[<span class="hljs-number">0</span>]) = <span class="hljs-number">0</span>;<br>  v22 = CopiedFlag[<span class="hljs-number">0</span>];<br>  <span class="hljs-keyword">if</span> ( CopiedFlag[<span class="hljs-number">0</span>] )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( (bufferEnd - CopiedFlag[<span class="hljs-number">0</span>]) &gt;= <span class="hljs-number">0x1000</span> )<br>    &#123;<br>      v22 = *(CopiedFlag[<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>);<br>      <span class="hljs-keyword">if</span> ( (CopiedFlag[<span class="hljs-number">0</span>] - v22 - <span class="hljs-number">8</span>) &gt; <span class="hljs-number">0x1F</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_31;<br>    &#125;<br>    <span class="hljs-built_in">j_j_free</span>(v22);<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( si<span class="hljs-number">128.</span>m128i_i64[<span class="hljs-number">1</span>] &gt; <span class="hljs-number">0xFuLL</span> )<br>  &#123;<br>    v23 = flag[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">if</span> ( (si<span class="hljs-number">128.</span>m128i_i64[<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>) &gt;= <span class="hljs-number">0x1000</span> )<br>    &#123;<br>      v23 = *(flag[<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>);<br>      <span class="hljs-keyword">if</span> ( (flag[<span class="hljs-number">0</span>] - v23 - <span class="hljs-number">8</span>) &gt; <span class="hljs-number">0x1F</span> )<br>        <span class="hljs-built_in">invalid_parameter_noinfo_noreturn</span>();<br>    &#125;<br>    <span class="hljs-built_in">j_j_free</span>(v23);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// Hidden C++ exception states: #wind=5</span><br><span class="hljs-function">_QWORD *__fastcall <span class="hljs-title">XORencrypt</span><span class="hljs-params">(_QWORD *modifiedTable, __int64 a2, __int64 a3)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">void</span> **pTableStart; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">void</span> **pCurrentPos; <span class="hljs-comment">// rdi</span><br>  <span class="hljs-type">void</span> **i; <span class="hljs-comment">// rsi</span><br>  <span class="hljs-type">char</span> xored; <span class="hljs-comment">// r9</span><br>  <span class="hljs-type">unsigned</span> __int64 cucrrentSize; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">unsigned</span> __int64 capacity; <span class="hljs-comment">// rdx</span><br>  _QWORD *Table; <span class="hljs-comment">// rax</span><br><br>  *modifiedTable = <span class="hljs-number">0LL</span>;<br>  modifiedTable[<span class="hljs-number">2</span>] = <span class="hljs-number">0LL</span>;<br>  modifiedTable[<span class="hljs-number">3</span>] = <span class="hljs-number">15LL</span>;<br>  *modifiedTable = <span class="hljs-number">0</span>;<br>  pTableStart = &amp;oriTable;<br>  pCurrentPos = &amp;oriTable;<br>  <span class="hljs-keyword">if</span> ( *(&amp;xmmword_7FF7420B6760 + <span class="hljs-number">1</span>) &gt; <span class="hljs-number">0xFuLL</span> )<br>  &#123;<br>    pCurrentPos = oriTable;                     <span class="hljs-comment">// oriTable是原始的base64编码表</span><br>    pTableStart = oriTable;<br>  &#125;<br>  <span class="hljs-keyword">for</span> ( i = (pTableStart + xmmword_7FF7420B6760); pCurrentPos != i; pCurrentPos = (pCurrentPos + <span class="hljs-number">1</span>) )<br>  &#123;<br>    xored = *pCurrentPos ^ <span class="hljs-number">0xE</span>;                 <span class="hljs-comment">// 遍历Table并异或0xE，创建一个魔改的编码表</span><br>    cucrrentSize = modifiedTable[<span class="hljs-number">2</span>];<br>    capacity = modifiedTable[<span class="hljs-number">3</span>];<br>    <span class="hljs-keyword">if</span> ( cucrrentSize &gt;= capacity )<br>    &#123;<br>      <span class="hljs-built_in">needExpand</span>(modifiedTable, capacity, a3, xored);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      modifiedTable[<span class="hljs-number">2</span>] = cucrrentSize + <span class="hljs-number">1</span>;      <span class="hljs-comment">// 此处开始写入xor处理后的table字符</span><br>      Table = modifiedTable;<br>      <span class="hljs-keyword">if</span> ( capacity &gt; <span class="hljs-number">0xF</span> )<br>        Table = *modifiedTable;<br>      *(Table + cucrrentSize) = xored;<br>      *(Table + cucrrentSize + <span class="hljs-number">1</span>) = <span class="hljs-number">0</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> modifiedTable;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>可以看出逻辑就是先魔改base64的编码表，然后再用魔改的编码表对flag进行base64编码，最后和给定的密文比较。可以先对enc进行异或，然后再base64解码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">enc = <span class="hljs-string">&quot;lY7bW=\\ck?eyjX7]TZ\\&#125;CVbh\\tOyTH6&gt;jH7XmFifG]H7&quot;</span><br>data = <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> enc:<br>    data += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(char) ^ <span class="hljs-number">0xE</span>)<br><span class="hljs-built_in">print</span>(data)<br><span class="hljs-comment">#bW9lY3Rme1kwdV9SZTRsMXlfRzAwZF80dF9VcHghISF9</span><br></code></pre></td></tr></table></figure><p><img src="/../images/image-20251003134212864-1760193218429-34.png" alt="base64解码"></p></li></ul><h3 id="Two-cups-of-tea"><a href="#Two-cups-of-tea" class="headerlink" title="Two cups of tea"></a>Two cups of tea</h3><ul><li><p>反编译的代码分析优化后大概是这样：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//main函数部分</span><br><span class="hljs-function"><span class="hljs-type">int</span> __fastcall <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  __int64 n; <span class="hljs-comment">// rbx</span><br>  FILE *Stream; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">size_t</span> length; <span class="hljs-comment">// rax</span><br>  __int64 v6; <span class="hljs-comment">// rdx</span><br>  __int64 count; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> __int64 tmp4key; <span class="hljs-comment">// [rsp+20h] [rbp-E0h] BYREF</span><br>  <span class="hljs-type">char</span> key_2; <span class="hljs-comment">// [rsp+28h] [rbp-D8h]</span><br>  __int64 key_1; <span class="hljs-comment">// [rsp+30h] [rbp-D0h] BYREF</span><br>  <span class="hljs-type">int</span> key_3; <span class="hljs-comment">// [rsp+38h] [rbp-C8h]</span><br>  <span class="hljs-type">int</span> key_4; <span class="hljs-comment">// [rsp+3Ch] [rbp-C4h]</span><br>  _DWORD enc[<span class="hljs-number">10</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-C0h]</span><br>  _OWORD flag[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+68h] [rbp-98h] BYREF</span><br>  __int64 v16; <span class="hljs-comment">// [rsp+88h] [rbp-78h]</span><br>  <span class="hljs-type">char</span> Buffer[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+90h] [rbp-70h] BYREF</span><br>  __int128 v18; <span class="hljs-comment">// [rsp+A0h] [rbp-60h]</span><br>  __int64 v19; <span class="hljs-comment">// [rsp+B0h] [rbp-50h]</span><br><br>  n = <span class="hljs-number">0LL</span>;<br>  key_1 = <span class="hljs-number">2LL</span>;<br>  key_2 = <span class="hljs-number">0</span>;<br>  key_3 = <span class="hljs-number">2</span>;<br>  key_4 = <span class="hljs-number">5</span>;<br>  enc[<span class="hljs-number">0</span>] = <span class="hljs-number">0x5D624C34</span>;<br>  enc[<span class="hljs-number">1</span>] = <span class="hljs-number">0x8629FEAD</span>;<br>  enc[<span class="hljs-number">2</span>] = <span class="hljs-number">0x9D11379B</span>;<br>  enc[<span class="hljs-number">3</span>] = <span class="hljs-number">0xFCD53211</span>;<br>  enc[<span class="hljs-number">4</span>] = <span class="hljs-number">0x460F63CE</span>;<br>  enc[<span class="hljs-number">5</span>] = <span class="hljs-number">0xC5816E68</span>;<br>  enc[<span class="hljs-number">6</span>] = <span class="hljs-number">0xFE5300AD</span>;<br>  enc[<span class="hljs-number">7</span>] = <span class="hljs-number">0xA0015EE</span>;<br>  enc[<span class="hljs-number">8</span>] = <span class="hljs-number">0x9806DBBB</span>;<br>  enc[<span class="hljs-number">9</span>] = <span class="hljs-number">0xEF4A2648</span>;<br>  tmp4key = <span class="hljs-number">0xD0FCC6A7B8941CAFuLL</span>;<br>  <span class="hljs-built_in">key_init</span>(*&amp;argc, &amp;tmp4key, &amp;key_1);<span class="hljs-comment">// 这里初始化了key,不必理会具体实现，可以动调得到结果</span><br>  <span class="hljs-built_in">printf</span>(&amp;pleaseEnterYourFlag);<br>  Stream = _acrt_iob_func(<span class="hljs-number">0</span>);<br>  <span class="hljs-built_in">fgets</span>(Buffer, <span class="hljs-number">100</span>, Stream);<br>  length = <span class="hljs-built_in">strcspn</span>(Buffer, <span class="hljs-string">&quot;\n&quot;</span>);<span class="hljs-comment">// 获取flag的长度</span><br>  <span class="hljs-keyword">if</span> ( length &gt;= <span class="hljs-number">0x64</span> )<br>    _report_securityfailure_();<br>  Buffer[length] = <span class="hljs-number">0</span>;<br>  flag[<span class="hljs-number">0</span>] = *Buffer;<br>  key_1 = tmp4key;<br>  v16 = v19;<br>  flag[<span class="hljs-number">1</span>] = v18;<br>  key_3 = <span class="hljs-number">0x12345678</span>;<br>  key_4 = <span class="hljs-number">0x9ABCDEF0</span>;<br>  <span class="hljs-built_in">modefiedTea</span>(flag, v6, &amp;key_1);<span class="hljs-comment">// 魔改的tea，加密flag以便比对验证</span><br>  count = <span class="hljs-number">-1LL</span>;<br>  <span class="hljs-keyword">do</span><br>    ++count;<br>  <span class="hljs-keyword">while</span> ( Buffer[count] );<span class="hljs-comment">// 确认flag长度</span><br>  <span class="hljs-keyword">if</span> ( count == <span class="hljs-number">40</span> )<br>  &#123;<br>    <span class="hljs-keyword">while</span> ( *(flag + n * <span class="hljs-number">4</span>) == enc[n] )<span class="hljs-comment">// 比对验证</span><br>    &#123;<br>      <span class="hljs-keyword">if</span> ( ++n &gt;= <span class="hljs-number">10</span> )<br>      &#123;<br>        <span class="hljs-built_in">printf</span>(right);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>      &#125;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(wrong);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">printf</span>(Format_0);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><br><span class="hljs-comment">//魔改tea部分</span><br><span class="hljs-function">__int64 __fastcall <span class="hljs-title">modefiedTea</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *flag, __int64 a2, __int64 key)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_9; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> delta; <span class="hljs-comment">// r11d</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_eight; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_1; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_2; <span class="hljs-comment">// ebp</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_3; <span class="hljs-comment">// r14d</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_4; <span class="hljs-comment">// r15d</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_5; <span class="hljs-comment">// r12d</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_6; <span class="hljs-comment">// r13d</span><br>  <span class="hljs-type">int</span> flag_o; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_7; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">int</span> key_0; <span class="hljs-comment">// edi</span><br>  <span class="hljs-type">int</span> key_1; <span class="hljs-comment">// ebx</span><br>  __int64 key_3; <span class="hljs-comment">// r10</span><br>  <span class="hljs-type">int</span> key_2; <span class="hljs-comment">// r11d</span><br>  <span class="hljs-type">int</span> v18; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">bool</span> Count; <span class="hljs-comment">// zf</span><br>  __int64 flag_seven; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_0; <span class="hljs-comment">// [rsp+0h] [rbp-58h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_nine; <span class="hljs-comment">// [rsp+4h] [rbp-54h]</span><br>  <span class="hljs-type">int</span> count; <span class="hljs-comment">// [rsp+8h] [rbp-50h]</span><br>  <span class="hljs-type">int</span> delta_1; <span class="hljs-comment">// [rsp+68h] [rbp+10h]</span><br>  __int64 Key; <span class="hljs-comment">// [rsp+70h] [rbp+18h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_8; <span class="hljs-comment">// [rsp+78h] [rbp+20h]</span><br><br>  Key = key;<br>  flag_9 = flag[<span class="hljs-number">9</span>];<br>  delta = <span class="hljs-number">0</span>;<br>  flag_eight = flag[<span class="hljs-number">8</span>];<br>  flag_1 = flag[<span class="hljs-number">1</span>];<br>  flag_2 = flag[<span class="hljs-number">2</span>];<br>  flag_3 = flag[<span class="hljs-number">3</span>];<br>  flag_4 = flag[<span class="hljs-number">4</span>];<br>  flag_5 = flag[<span class="hljs-number">5</span>];<br>  flag_6 = flag[<span class="hljs-number">6</span>];<br>  flag_o = *flag;<br>  flag_7 = flag[<span class="hljs-number">7</span>];<br>  flag_8 = flag_eight;<br>  flag_nine = flag_9;<br>  count = <span class="hljs-number">11</span>;<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    delta_1 = delta - <span class="hljs-number">1640531527</span>;<br>    key_0 = *(key + <span class="hljs-number">4LL</span> * (((delta - <span class="hljs-number">1640531527</span>) &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>));<br>    flag_0 = flag_o<br>           + ((((<span class="hljs-number">16</span> * flag_9) ^ (flag_1 &gt;&gt; <span class="hljs-number">3</span>)) + ((flag_9 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_1))) ^ (((delta - <span class="hljs-number">1640531527</span>) ^ flag_1)<br>                                                                                  + (key_0 ^ flag_9)));<br>    key_1 = *(Key + <span class="hljs-number">4</span> * (((delta - <span class="hljs-number">1640531527</span>) &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span> ^ <span class="hljs-number">1LL</span>));<br>    flag_1 += ((flag_0 ^ key_1) + ((delta - <span class="hljs-number">1640531527</span>) ^ flag_2)) ^ (((<span class="hljs-number">16</span> * flag_0) ^ (flag_2 &gt;&gt; <span class="hljs-number">3</span>))<br>                                                                    + ((flag_0 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_2)));<br>    key_3 = ((delta - <span class="hljs-number">1640531527</span>) &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span> ^ <span class="hljs-number">3LL</span>;<br>    key_2 = *(Key + <span class="hljs-number">4</span> * (((delta - <span class="hljs-number">1640531527</span>) &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span> ^ <span class="hljs-number">2LL</span>));<br>    flag_2 += ((flag_1 ^ key_2) + (delta_1 ^ flag_3)) ^ (((<span class="hljs-number">16</span> * flag_1) ^ (flag_3 &gt;&gt; <span class="hljs-number">3</span>)) + ((flag_1 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_3)));<br>    flag_3 += ((delta_1 ^ flag_4) + (flag_2 ^ *(Key + <span class="hljs-number">4</span> * key_3))) ^ (((<span class="hljs-number">16</span> * flag_2) ^ (flag_4 &gt;&gt; <span class="hljs-number">3</span>))<br>                                                                    + ((flag_2 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_4)));<br>    flag_4 += ((flag_3 ^ key_0) + (delta_1 ^ flag_5)) ^ (((<span class="hljs-number">16</span> * flag_3) ^ (flag_5 &gt;&gt; <span class="hljs-number">3</span>)) + ((flag_3 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_5)));<br>    flag_5 += ((flag_4 ^ key_1) + (delta_1 ^ flag_6)) ^ (((<span class="hljs-number">16</span> * flag_4) ^ (flag_6 &gt;&gt; <span class="hljs-number">3</span>)) + ((flag_4 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_6)));<br>    v18 = (flag_5 ^ key_2) + (delta_1 ^ flag_7);<br>    delta = delta_1;<br>    flag_6 += v18 ^ (((<span class="hljs-number">16</span> * flag_5) ^ (flag_7 &gt;&gt; <span class="hljs-number">3</span>)) + ((flag_5 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_7)));<br>    flag_7 += ((flag_6 ^ *(Key + <span class="hljs-number">4</span> * key_3)) + (delta_1 ^ flag_8)) ^ (((<span class="hljs-number">16</span> * flag_6) ^ (flag_8 &gt;&gt; <span class="hljs-number">3</span>))<br>                                                                    + ((flag_6 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_8)));<br>    flag_8 += ((flag_7 ^ key_0) + (delta_1 ^ flag_nine)) ^ (((<span class="hljs-number">16</span> * flag_7) ^ (flag_nine &gt;&gt; <span class="hljs-number">3</span>))<br>                                                          + ((flag_7 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_nine)));<br>    flag_9 = (((flag_8 ^ key_1) + (delta_1 ^ flag_0)) ^ (((<span class="hljs-number">16</span> * flag_8) ^ (flag_0 &gt;&gt; <span class="hljs-number">3</span>)) + ((flag_8 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_0))))<br>           + flag_nine;<br>    key = Key;<br>    Count = count-- == <span class="hljs-number">1</span>;<br>    flag_nine = flag_9;<br>    <span class="hljs-keyword">if</span> ( Count )<br>      <span class="hljs-keyword">break</span>;<br>    flag_o = flag_0;<br>  &#125;<br>  flag_seven = flag_7;<br>  flag[<span class="hljs-number">1</span>] = flag_1;<br>  flag[<span class="hljs-number">2</span>] = flag_2;<br>  flag[<span class="hljs-number">3</span>] = flag_3;<br>  flag[<span class="hljs-number">4</span>] = flag_4;<br>  flag[<span class="hljs-number">5</span>] = flag_5;<br>  flag[<span class="hljs-number">6</span>] = flag_6;<br>  flag[<span class="hljs-number">7</span>] = flag_7;<br>  flag[<span class="hljs-number">8</span>] = flag_8;<br>  flag[<span class="hljs-number">9</span>] = flag_9;<br>  *flag = flag_0;<br>  <span class="hljs-keyword">return</span> flag_seven;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>由于加密主要依赖的是异或，只要复原出加密时的环境（相关变量），就可以再次加密实现复原。下图是AI给的加密逻辑分析。首先每轮加密的密钥不同，其次每个字符块的加密都依赖前一块和后一块。突破口：对于flag9而言，它的前一块和后一块都是经过本轮加密的，也就是说在最后一轮，flag9依赖的是最终密文的flag0和flag8，可以利用最终密文直接解密。解密出最后一轮的未加密flag9后，就可以往回解密flag8-flag0，就这样11轮解密回去。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">┌─────────────────────────────────────────────────────────────────────────┐<br>│               修改版TEA加密（10块Feistel结构，11轮）                        │<br>└─────────────────────────────────────────────────────────────────────────┘<br><br>输入: flag[0]...flag[9] (10个32位字), key[0]...key[3] (128位密钥)<br><br>初始化:<br>   delta = 0<br>   count = 11<br><br>开始循环（11轮）:<br>   delta_1 = delta - 0x61C88647  (无符号减法，1640531527的十六进制)<br><br>   密钥调度:<br>        k0 = key[(delta_1&gt;&gt;2) &amp; 3]<br>        k1 = key[((delta_1&gt;&gt;2) &amp; 3) ^ 1]<br>        k2 = key[((delta_1&gt;&gt;2) &amp; 3) ^ 2]<br>        k3 = key[((delta_1&gt;&gt;2) &amp; 3) ^ 3]<br><br>   加密链（每轮更新所有10个字，顺序依赖）:<br>        flag0 += F(flag9, flag1, delta_1, k0)<br>        flag1 += F(flag0, flag2, delta_1, k1)<br>        flag2 += F(flag1, flag3, delta_1, k2)<br>        flag3 += F(flag2, flag4, delta_1, k3)<br>        flag4 += F(flag3, flag5, delta_1, k0)<br>        flag5 += F(flag4, flag6, delta_1, k1)<br>        flag6 += F(flag5, flag7, delta_1, k2)<br>        flag7 += F(flag6, flag8, delta_1, k3)<br>        flag8 += F(flag7, flag9, delta_1, k0)<br>        flag9 += F(flag8, flag0, delta_1, k1)<br><br>   其中 F(a, b, delta, k) = <br>        ((16*a) ^ (b&gt;&gt;3)) + ((a&gt;&gt;5) ^ (4*b))) ^ ( (delta ^ b) + (k ^ a) )<br><br>   更新delta = delta_1<br><br>循环结束（count减至1）<br><br>输出: 加密后的flag[0]...flag[9]<br></code></pre></td></tr></table></figure></li><li><p>解密脚本：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modefiedTea_decrypt</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span>* flag, <span class="hljs-type">uint32_t</span>* key)</span> </span>&#123;<br>    <span class="hljs-type">int32_t</span> deltas[<span class="hljs-number">11</span>];<br>    <span class="hljs-type">int32_t</span> delta = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">11</span>; i++) &#123;<br>        delta -= <span class="hljs-number">1640531527</span>; <br>        deltas[i] = delta;<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> round = <span class="hljs-number">10</span>; round &gt;= <span class="hljs-number">0</span>; round--) &#123;<br>        <span class="hljs-type">uint32_t</span> delta_1 = deltas[round];<br><br>        <span class="hljs-type">uint32_t</span> k0 = key[((delta_1 &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>)];<br>        <span class="hljs-type">uint32_t</span> k1 = key[((delta_1 &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>) ^ <span class="hljs-number">1</span>];<br>        <span class="hljs-type">uint32_t</span> k2 = key[((delta_1 &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>) ^ <span class="hljs-number">2</span>];<br>        <span class="hljs-type">uint32_t</span> k3 = key[((delta_1 &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>) ^ <span class="hljs-number">3</span>];<br><br>        flag[<span class="hljs-number">9</span>] -= ((flag[<span class="hljs-number">8</span>] ^ k1) + (delta_1 ^ flag[<span class="hljs-number">0</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">8</span>]) ^ (flag[<span class="hljs-number">0</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">8</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">0</span>])));<br>        flag[<span class="hljs-number">8</span>] -= ((flag[<span class="hljs-number">7</span>] ^ k0) + (delta_1 ^ flag[<span class="hljs-number">9</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">7</span>]) ^ (flag[<span class="hljs-number">9</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">7</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">9</span>])));<br>        flag[<span class="hljs-number">7</span>] -= ((flag[<span class="hljs-number">6</span>] ^ k3) + (delta_1 ^ flag[<span class="hljs-number">8</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">6</span>]) ^ (flag[<span class="hljs-number">8</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">6</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">8</span>])));<br>        flag[<span class="hljs-number">6</span>] -= ((flag[<span class="hljs-number">5</span>] ^ k2) + (delta_1 ^ flag[<span class="hljs-number">7</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">5</span>]) ^ (flag[<span class="hljs-number">7</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">5</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">7</span>])));<br>        flag[<span class="hljs-number">5</span>] -= ((flag[<span class="hljs-number">4</span>] ^ k1) + (delta_1 ^ flag[<span class="hljs-number">6</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">4</span>]) ^ (flag[<span class="hljs-number">6</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">4</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">6</span>])));<br>        flag[<span class="hljs-number">4</span>] -= ((flag[<span class="hljs-number">3</span>] ^ k0) + (delta_1 ^ flag[<span class="hljs-number">5</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">3</span>]) ^ (flag[<span class="hljs-number">5</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">3</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">5</span>])));<br>        flag[<span class="hljs-number">3</span>] -= ((flag[<span class="hljs-number">2</span>] ^ k3) + (delta_1 ^ flag[<span class="hljs-number">4</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">2</span>]) ^ (flag[<span class="hljs-number">4</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">2</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">4</span>])));<br>        flag[<span class="hljs-number">2</span>] -= ((flag[<span class="hljs-number">1</span>] ^ k2) + (delta_1 ^ flag[<span class="hljs-number">3</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">1</span>]) ^ (flag[<span class="hljs-number">3</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">3</span>])));<br>        flag[<span class="hljs-number">1</span>] -= ((flag[<span class="hljs-number">0</span>] ^ k1) + (delta_1 ^ flag[<span class="hljs-number">2</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">0</span>]) ^ (flag[<span class="hljs-number">2</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">0</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">2</span>])));<br>        flag[<span class="hljs-number">0</span>] -= ((flag[<span class="hljs-number">9</span>] ^ k0) + (delta_1 ^ flag[<span class="hljs-number">1</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">9</span>]) ^ (flag[<span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">9</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">1</span>])));<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">uint32_t</span> enc[<span class="hljs-number">10</span>] = &#123;<br>        <span class="hljs-number">0x5D624C34</span>, <span class="hljs-number">0x8629FEAD</span>, <span class="hljs-number">0x9D11379B</span>, <span class="hljs-number">0xFCD53211</span>,<br>        <span class="hljs-number">0x460F63CE</span>, <span class="hljs-number">0xC5816E68</span>, <span class="hljs-number">0xFE5300AD</span>, <span class="hljs-number">0x0A0015EE</span>,<br>        <span class="hljs-number">0x9806DBBB</span>, <span class="hljs-number">0xEF4A2648</span><br>    &#125;;<br>    <span class="hljs-type">uint32_t</span> key[<span class="hljs-number">4</span>] = &#123;<br>        <span class="hljs-number">0x63656F6D</span>, <span class="hljs-number">0x21216674</span>, <span class="hljs-number">0x12345678</span>, <span class="hljs-number">0x9ABCDEF0</span><br>    &#125;;<br><br>    <span class="hljs-built_in">modefiedTea_decrypt</span>(enc, key);<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* flag_str = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>*)enc;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i++) &#123;<br>        <span class="hljs-keyword">if</span> (flag_str[i] &gt;= <span class="hljs-number">32</span> &amp;&amp; flag_str[i] &lt;= <span class="hljs-number">126</span>) &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, flag_str[i]);<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\\x%02X&quot;</span>, flag_str[i]);<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h2 id="week3"><a href="#week3" class="headerlink" title="week3"></a>week3</h2><h3 id="have-fun"><a href="#have-fun" class="headerlink" title="have_fun"></a>have_fun</h3><ul><li><p>附件是一个Windows GUI程序，界面如图。工具栏的“交互”实现flag的验证。</p><p><img src="/../images/image-20250828184625164-1760193218429-35.png" alt="界面"></p></li><li><p>main函数主要实现的是创建窗口，涉及到WNDCLASSEXW结构体（详细信息见：<a href="https://learn.microsoft.com/zh-cn/windows/win32/api/winuser/ns-winuser-wndclassexw">WNDCLASSEXW （winuser.h） - Win32 apps | Microsoft Learn</a>）。其中，结构体变量lpfnWndProc涉及窗口过程的实现，所以flag验证的相关逻辑在lpfnWndProc指向的函数中查看（图中重命名为ToolBar）</p><p><img src="/../images/image-20250828184701147-1760193218429-32.png" alt="main函数"></p></li><li><p>ToolBar中，实现了工具栏三个选项的交互逻辑，其中，DialogBoxParamW实现的是”交互“选项（因为参数DialogFunc看着最复杂，最像flag验证逻辑）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//ToolBar函数</span><br>LRESULT __fastcall <span class="hljs-title function_">ToolBar</span><span class="hljs-params">(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam)</span><br>&#123;<br>  HDC hdc; <span class="hljs-comment">// rsi</span><br>  HFONT FontW; <span class="hljs-comment">// rdi</span><br>  HGDIOBJ h; <span class="hljs-comment">// rbx</span><br>  tagPAINTSTRUCT Paint; <span class="hljs-comment">// [rsp+70h] [rbp-88h] BYREF</span><br><br>  <span class="hljs-keyword">switch</span> ( Msg )<br>  &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">2u</span>:<br>      PostQuitMessage(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">0xFu</span>:<br>      hdc = BeginPaint(hWnd, &amp;Paint);<br>      SetTextColor(hdc, <span class="hljs-number">0xFFu</span>);<br>      SetBkMode(hdc, <span class="hljs-number">1</span>);<br>      FontW = CreateFontW(<span class="hljs-number">36</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">700</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1u</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0x20u</span>, &amp;pszFaceName);<br>      h = SelectObject(hdc, FontW);<br>      TextOutW(hdc, <span class="hljs-number">500</span>, <span class="hljs-number">160</span>, &amp;String, <span class="hljs-number">15</span>);<br>      TextOutW(hdc, <span class="hljs-number">500</span>, <span class="hljs-number">200</span>, &amp;word_7FF6D7EA3350, <span class="hljs-number">10</span>);<br>      SelectObject(hdc, h);<br>      DeleteObject(FontW);<br>      EndPaint(hWnd, &amp;Paint);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">0x111u</span>:<br>      <span class="hljs-keyword">switch</span> ( wParam )<br>      &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x68u</span>:<br>          DialogBoxParamW(hInstance, <span class="hljs-number">0x67</span>, hWnd, sub_7FF6D7EA1420, <span class="hljs-number">0LL</span>);<br>          <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x69u</span>:<br>          DestroyWindow(hWnd);<br>          <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x9C42u</span>:<br>          DialogBoxParamW(hInstance, <span class="hljs-number">0x66</span>, hWnd, DialogFunc, <span class="hljs-number">0LL</span>);<span class="hljs-comment">//“交互”选项</span><br>          <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>          <span class="hljs-keyword">return</span> DefWindowProcW(hWnd, Msg, wParam, lParam);<br>      &#125;<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>      <span class="hljs-keyword">return</span> DefWindowProcW(hWnd, Msg, wParam, lParam);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>DialogFunc函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs c">INT_PTR __fastcall <span class="hljs-title function_">DialogFunc</span><span class="hljs-params">(HWND hDlg, <span class="hljs-type">int</span> a2, <span class="hljs-type">unsigned</span> __int16 n1003)</span><br>&#123;<br>  HWND hDlg_1; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// edx</span><br>  __int64 length; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> n32_2; <span class="hljs-comment">// r8d</span><br>  __m128 si128; <span class="hljs-comment">// xmm2</span><br>  __int64 v8; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">unsigned</span> __int64 v9; <span class="hljs-comment">// rcx</span><br>  __m128 v10; <span class="hljs-comment">// xmm0</span><br>  __m128 v11; <span class="hljs-comment">// xmm1</span><br>  __m128 v12; <span class="hljs-comment">// xmm0</span><br>  __m128 v13; <span class="hljs-comment">// xmm1</span><br>  __int64 count; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">unsigned</span> __int16 *currentChar; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">int</span> currentEnc; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> judgeNumber; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">const</span> WCHAR *PrintText; <span class="hljs-comment">// r8</span><br>  _OWORD v20[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-1D8h] BYREF</span><br>  WCHAR flag[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-1B8h] BYREF</span><br>  _OWORD v22[<span class="hljs-number">12</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-1A8h] BYREF</span><br>  _WORD flag_xored[<span class="hljs-number">104</span>]; <span class="hljs-comment">// [rsp+F0h] [rbp-E8h] BYREF</span><br><br>  hDlg_1 = hDlg;<br>  v4 = a2 - <span class="hljs-number">272</span>;<br>  <span class="hljs-keyword">if</span> ( !v4 )<br>  &#123;<br>    PrintText = &amp;word_7FF6D7EA3368;<br>LABEL_22:<br>    SetDlgItemTextW(hDlg, <span class="hljs-number">1002</span>, PrintText);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1LL</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v4 != <span class="hljs-number">1</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( (n1003 - <span class="hljs-number">1</span>) &gt; <span class="hljs-number">1u</span> )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( n1003 == <span class="hljs-number">1003</span> )<br>    &#123;<br>      GetDlgItemTextW(hDlg, <span class="hljs-number">1001</span>, flag, <span class="hljs-number">100</span>);<br>      length = <span class="hljs-number">-1LL</span>;<br>      <span class="hljs-keyword">do</span><br>        ++length;<br>      <span class="hljs-keyword">while</span> ( flag[length] );<br>      n32_2 = <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">if</span> ( length &gt;= <span class="hljs-number">32</span> )<span class="hljs-comment">// flag长度大于32的情况（实际上不能是这种情况）</span><br>      &#123;<br>        si128 = _mm_load_si128(&amp;xmmword_7FF6D7EA33F0);<br>        v8 = <span class="hljs-number">0LL</span>;<br>        v9 = <span class="hljs-number">0LL</span>;<br>        <span class="hljs-keyword">do</span><br>        &#123;<br>          v10 = _mm_loadu_si128(&amp;flag[v9 / <span class="hljs-number">2</span>]);<br>          n32_2 += <span class="hljs-number">32</span>;<br>          v8 += <span class="hljs-number">32LL</span>;<br>          v11 = _mm_loadu_si128(&amp;v22[v9 / <span class="hljs-number">0x10</span>]);<br>          v9 += <span class="hljs-number">64LL</span>;<br>          v22[v9 / <span class="hljs-number">0x10</span> + <span class="hljs-number">8</span>] = _mm_xor_ps(v10, si128);<br>          v12 = _mm_loadu_si128(&amp;v20[v9 / <span class="hljs-number">0x10</span>]);<br>          v22[v9 / <span class="hljs-number">0x10</span> + <span class="hljs-number">9</span>] = _mm_xor_ps(v11, si128);<br>          v13 = _mm_loadu_si128(&amp;v20[v9 / <span class="hljs-number">0x10</span> + <span class="hljs-number">1</span>]);<br>          v22[v9 / <span class="hljs-number">0x10</span> + <span class="hljs-number">10</span>] = _mm_xor_ps(v12, si128);<br>          v22[v9 / <span class="hljs-number">0x10</span> + <span class="hljs-number">11</span>] = _mm_xor_ps(v13, si128);<br>        &#125;<br>        <span class="hljs-keyword">while</span> ( v8 &lt; (length - (length &amp; <span class="hljs-number">31</span>)) );<br>      &#125;<br>      count = n32_2;<span class="hljs-comment">// 上述情况应不成立，因此n32_2为0</span><br>      <span class="hljs-keyword">if</span> ( n32_2 &lt; length )<br>      &#123;<br>        <span class="hljs-keyword">do</span><br>        &#123;<br>          flag_xored[count] = flag[count] ^ <span class="hljs-number">0x2A</span>;<br>          ++count;<br>        &#125;<br>        <span class="hljs-keyword">while</span> ( count &lt; length );<br>      &#125;<br>      flag_xored[length] = <span class="hljs-number">0</span>;<br>      currentChar = flag_xored;<br>      <span class="hljs-keyword">do</span><br>      &#123;<br>        currentEnc = *(currentChar + &amp;enc - flag_xored);<span class="hljs-comment">// enc[currentChar-flag_xored]</span><br>        judgeNumber = *currentChar - currentEnc;<br>        <span class="hljs-keyword">if</span> ( judgeNumber )<br>          <span class="hljs-keyword">break</span>;<br>        ++currentChar;<br>      &#125;<br>      <span class="hljs-keyword">while</span> ( currentEnc );<br>      <span class="hljs-keyword">if</span> ( judgeNumber || (PrintText = &amp;right, length != <span class="hljs-number">16</span>) )<span class="hljs-comment">// flag长度由此处得出</span><br>        PrintText = &amp;wrong;<br>      hDlg = hDlg_1;<br>      <span class="hljs-keyword">goto</span> LABEL_22;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  &#125;<br>  EndDialog(hDlg, n1003);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>逻辑很明显，遍历flag，每个字符异或0x2A，然后和enc比较。解密脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">enc = [<br>    <span class="hljs-number">0x0047</span>, <span class="hljs-number">0x0045</span>, <span class="hljs-number">0x004F</span>, <span class="hljs-number">0x0049</span>, <span class="hljs-number">0x005E</span>, <span class="hljs-number">0x004C</span>, <span class="hljs-number">0x0051</span>, <span class="hljs-number">0x0062</span>, <span class="hljs-number">0x006A</span>, <span class="hljs-number">0x005C</span>, <span class="hljs-number">0x001E</span>, <span class="hljs-number">0x0075</span>, <span class="hljs-number">0x004C</span>, <span class="hljs-number">0x007F</span>, <span class="hljs-number">0x0044</span>, <span class="hljs-number">0x0057</span><br>]<br>flag = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(b ^ <span class="hljs-number">0x2A</span>) <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> enc)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure></li></ul><h3 id="guess"><a href="#guess" class="headerlink" title="guess"></a>guess</h3><ul><li><p>附件程序是一个猜数字游戏，用IDA打开，通过字符串表的关键数据”You are right!\n”可以快速定位到main函数的位置</p><p><img src="/../images/image-20250907190954175-1760193218429-33.png" alt="关键数据"></p></li><li><p>main函数F5反编译不了，sp value报错，说明有花指令。把栈指针勾选上，会发现栈帧突变的位置：</p><p><img src="/../images/image-20250907191116300-1760193218429-36.png" alt="栈帧突变"></p><p>栈帧改变太多，明显不对，把sub rsp, rax给nop掉。然后可以发现函数末尾栈帧会有点问题：</p><p><img src="/../images/image-20250907191353142-1760193218429-37.png" alt="函数末尾栈帧"></p><p>把add rsp, 1428h也给nop掉，这样main函数基本上可以反编译了</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//优化后的main函数</span><br><span class="hljs-comment">// bad sp value at call has been detected, the output may be wrong!</span><br><span class="hljs-function"><span class="hljs-type">int</span> __fastcall <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">bool</span> v3; <span class="hljs-comment">// dl</span><br>  std::ostream *v4; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v5; <span class="hljs-comment">// eax</span><br>  _QWORD *v6; <span class="hljs-comment">// rax</span><br>  std::ostream *v8; <span class="hljs-comment">// rax</span><br>  __int64 v9; <span class="hljs-comment">// rax</span><br>  __int64 v10; <span class="hljs-comment">// rbx</span><br>  std::ostream *v11; <span class="hljs-comment">// rax</span><br>  std::ostream *v12; <span class="hljs-comment">// rax</span><br>  std::ostream *v13; <span class="hljs-comment">// rax</span><br>  std::ostream *v14; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> n0x64; <span class="hljs-comment">// [rsp+2Ch] [rbp-54h]</span><br>  _BYTE v17[<span class="hljs-number">2512</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-50h] BYREF</span><br>  _BYTE v18[<span class="hljs-number">2512</span>]; <span class="hljs-comment">// [rsp+A00h] [rbp+980h] BYREF</span><br>  _BYTE v19[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+13D0h] [rbp+1350h] BYREF</span><br>  _BYTE v20[<span class="hljs-number">40</span>]; <span class="hljs-comment">// [rsp+13F0h] [rbp+1370h] BYREF</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> n0x64_1; <span class="hljs-comment">// [rsp+1418h] [rbp+1398h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+141Ch] [rbp+139Ch]</span><br><br>  _main(argc, argv, envp);<br>  std::ios_base::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0LL</span>, v3);<br>  std::ios::<span class="hljs-built_in">tie</span>((<span class="hljs-type">char</span> *)in + <span class="hljs-number">16</span>, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;Welcome to MoeCTF 2025!\n&quot;</span>);<br>  <span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;Let&#x27;s play a game!\n&quot;</span>);<br>  <span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;I have a secret number between 0 and 99, and you can guess it 10 times.\n&quot;</span>);<br>  v4 = (std::ostream *)<span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;If you successly guessed it, I will give you the flag!&quot;</span>);<br>  <span class="hljs-built_in">endl</span>(v4);<br>  <span class="hljs-built_in">random_device</span>((std::random_device *)v18);<br>  v5 = <span class="hljs-built_in">random_operator</span>(v18);<br>  <span class="hljs-built_in">mersenne_twister_engine</span>(v17, v5);<br>  std::random_device::~<span class="hljs-built_in">random_device</span>((std::random_device *)v18);<br>  n0x64_1 = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-built_in">mersenne_twister_engine_operator</span>(v17) % <span class="hljs-number">0x64</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">9</span>; ++i )<br>  &#123;<br>    <span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;Please input your number: &quot;</span>);<br>    std::ostream::<span class="hljs-built_in">flush</span>(out);<br>    v6 = (_QWORD *)<span class="hljs-built_in">cin</span>(in);<br>    <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int8)std::ios::<span class="hljs-keyword">operator</span>!((<span class="hljs-type">char</span> *)v6 + *(_QWORD *)(*v6 - <span class="hljs-number">24LL</span>)) || n0x64 &gt;= <span class="hljs-number">0x64</span> )<br>    &#123;<br>      v8 = (std::ostream *)<span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;Invalid input&quot;</span>);<br>      <span class="hljs-built_in">endl</span>(v8);<br>      std::ios::<span class="hljs-built_in">clear</span>((<span class="hljs-type">char</span> *)in + <span class="hljs-number">16</span>, <span class="hljs-number">0LL</span>);<br>      v9 = std::numeric_limits&lt;<span class="hljs-type">long</span> <span class="hljs-type">long</span>&gt;::<span class="hljs-built_in">max</span>();<br>      std::istream::<span class="hljs-built_in">ignore</span>(in, v9, <span class="hljs-number">10</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-keyword">if</span> ( n0x64_1 == n0x64 )<br>      &#123;<br>        <span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;You are right!\n&quot;</span>);<br>        v10 = <span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;The flag is moectf&#123;&quot;</span>);<br>        <span class="hljs-built_in">hex_to_binary</span>(v20, &amp;enc[abi:cxx11]);<br>        <span class="hljs-built_in">rc4_decrypt</span>(v19, v20, &amp;key[abi:cxx11]);<br>        v11 = (std::ostream *)std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">char</span>&gt;(v10, v19);<br>        v12 = (std::ostream *)<span class="hljs-built_in">cout</span>(v11, <span class="hljs-string">&quot;&#125;.&quot;</span>);<br>        <span class="hljs-built_in">endl</span>(v12);<br>        std::string::~<span class="hljs-built_in">string</span>(v19);<br>        std::string::~<span class="hljs-built_in">string</span>(v20);<br>        <span class="hljs-keyword">break</span>;<br>      &#125;<br>      v13 = (std::ostream *)<span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;That&#x27;s not right...&quot;</span>);<br>      <span class="hljs-built_in">endl</span>(v13);<br>    &#125;<br>  &#125;<br>  v14 = (std::ostream *)<span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;Thanks for your playing!&quot;</span>);<br>  <span class="hljs-built_in">endl</span>(v14);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>可以看出，main函数的逻辑是先获取一个数字输入，然后经过和随机数有关的各种操作来判断是否符合条件，符合条件就输出flag。既然可以直接输出flag，不妨就动调改变判断结果直接得到flag。找到和输出有关的判断逻辑的位置：</p><p><img src="/../images/image-20250907193423247-1760193218429-39.png" alt="跳转的关键逻辑"></p><p>动调程序步过此处后，改一下ZF即可让程序跳到”You are right!\n”处获得flag输出。好在本题没有给动调挖坑，可以直接得到flag：</p><p><img src="/../images/image-20250907193656681-1760193218429-40.png" alt="得到flag"></p></li></ul><h3 id="rusty-sudoku"><a href="#rusty-sudoku" class="headerlink" title="rusty_sudoku"></a>rusty_sudoku</h3><ul><li><p>rust语言的数独游戏。运行附件程序，提示逆向分析程序找到数独并求解。用IDA打开，结合AI辅助优化后main函数长这样：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">rusty_sudoku::main</span><span class="hljs-params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="hljs-function"></span>&#123;<br>  __int128 *md5_ctx_prt; <span class="hljs-comment">// rdi</span><br>  __int64 temp; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">size_t</span> cupy_size; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">unsigned</span> __int8 *input_end; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">unsigned</span> __int8 *trimmed_length; <span class="hljs-comment">// rsi</span><br>  <span class="hljs-type">unsigned</span> __int8 *trimmed_start; <span class="hljs-comment">// r9</span><br>  <span class="hljs-type">unsigned</span> __int8 *input_ptr; <span class="hljs-comment">// r8</span><br>  <span class="hljs-type">char</span> is_whitespace; <span class="hljs-comment">// r11</span><br>  <span class="hljs-type">unsigned</span> __int8 *current_ptr; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">unsigned</span> __int8 *trimmed_count; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> codepoint; <span class="hljs-comment">// r11d</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> temp_val1; <span class="hljs-comment">// r14d</span><br>  <span class="hljs-type">int</span> temp_val2; <span class="hljs-comment">// ebp</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> high_byte; <span class="hljs-comment">// ebx</span><br>  __int64 alloc_result; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">char</span> is_whitespace2; <span class="hljs-comment">// bl</span><br>  <span class="hljs-type">unsigned</span> __int8 *end_ptr; <span class="hljs-comment">// r11</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> codepoint2; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">char</span> byte1; <span class="hljs-comment">// bl</span><br>  <span class="hljs-type">char</span> byte2; <span class="hljs-comment">// bp</span><br>  <span class="hljs-type">int</span> temp_val3; <span class="hljs-comment">// ebp</span><br>  <span class="hljs-type">int</span> temp_val4; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> high_byte2; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-type">size_t</span> actual_size; <span class="hljs-comment">// r15</span><br>  __int64 alloc_size; <span class="hljs-comment">// r14</span><br>  __int64 allocated_mem; <span class="hljs-comment">// rax</span><br>  __int64 expected_char; <span class="hljs-comment">// r9</span><br>  __int64 input_data; <span class="hljs-comment">// rdx</span><br>  __int64 index; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> user_char; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">int</span> v34; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> temp_val5; <span class="hljs-comment">// r8d</span><br>  __int64 result; <span class="hljs-comment">// rax</span><br>  __int64 user_index; <span class="hljs-comment">// rax</span><br>  __int64 sudoku_index; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">int</span> user_codepointer; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v40; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> temp_val6; <span class="hljs-comment">// r11d</span><br>  <span class="hljs-type">int</span> temp_val7; <span class="hljs-comment">// r10d</span><br>  <span class="hljs-type">int</span> v43; <span class="hljs-comment">// r10d</span><br>  <span class="hljs-type">int</span> temp_val8; <span class="hljs-comment">// ebp</span><br>  <span class="hljs-type">int</span> temp_val9; <span class="hljs-comment">// r11d</span><br>  __int64 temp_arg1; <span class="hljs-comment">// rdx</span><br>  __int64 temp_arg2; <span class="hljs-comment">// rdx</span><br>  __int64 temp_arg3; <span class="hljs-comment">// rdx</span><br>  _BYTE buf[<span class="hljs-number">88</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-178h] BYREF</span><br>  __int128 fmt_arg1; <span class="hljs-comment">// [rsp+90h] [rbp-118h] BYREF</span><br>  __int128 fmt_arg2; <span class="hljs-comment">// [rsp+A0h] [rbp-108h]</span><br>  __int128 fmt_arg3; <span class="hljs-comment">// [rsp+B0h] [rbp-F8h]</span><br>  __int128 fmt_arg4; <span class="hljs-comment">// [rsp+C0h] [rbp-E8h]</span><br>  __int128 fmt_arg5; <span class="hljs-comment">// [rsp+D0h] [rbp-D8h]</span><br>  __int64 fmt_arg6; <span class="hljs-comment">// [rsp+E0h] [rbp-C8h]</span><br>  _OWORD stdin_handle[<span class="hljs-number">5</span>]; <span class="hljs-comment">// [rsp+F0h] [rbp-B8h] BYREF</span><br>  <span class="hljs-type">char</span> board_data; <span class="hljs-comment">// [rsp+140h] [rbp-68h]</span><br>  _BYTE md5_hash[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+150h] [rbp-58h] BYREF</span><br><br>  *buf = &amp;welcome;                              <span class="hljs-comment">// &quot;Welcome to MoeCTF 2025!\nPlease **find** my sudoku and fill it correctly.\nAnd then I will give you the flag.\nInput your answer in one line (without spaces).\nfor example, 854219763397865421261473985785126394649538172132947856926384517513792648478651239 represents:\n854|219|763\n397|865|421\n261|473|985\n-----------\n785|126|394\n649|538|172\n132|947|856\n-----------\n926|384|517\n513|792|648\n478|651|239\n\nYour answer:\n&quot;</span><br>  *&amp;buf[<span class="hljs-number">8</span>] = <span class="hljs-number">1LL</span>;<br>  *&amp;buf[<span class="hljs-number">16</span>] = <span class="hljs-number">8LL</span>;<br>  *&amp;buf[<span class="hljs-number">24</span>] = <span class="hljs-number">0LL</span>;<br>  std::io::stdio::_print(a1, a2, a3, buf);<br>  *buf = <span class="hljs-number">0LL</span>;<br>  *&amp;buf[<span class="hljs-number">8</span>] = <span class="hljs-number">1LL</span>;<br>  *&amp;buf[<span class="hljs-number">16</span>] = <span class="hljs-number">0LL</span>;<br>  *&amp;stdin_handle[<span class="hljs-number">0</span>] = std::io::stdio::<span class="hljs-built_in">stdin</span>();<br>  md5_ctx_prt = stdin_handle;<br>  <span class="hljs-keyword">if</span> ( (std::io::stdio::Stdin::<span class="hljs-built_in">read_line</span>(stdin_handle, a2, buf, stdin_handle) &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> )<br>  &#123;<br>    *&amp;fmt_arg1 = temp;<br>    core::result::<span class="hljs-built_in">unwrap_failed</span>(stdin_handle, a2, <span class="hljs-number">14</span>, <span class="hljs-string">&quot;Invalid input.src\\main.rs&quot;</span>, &amp;fmt_arg1, &amp;off_7FF6BF752050);<br>  &#125;<br>  cupy_size = *&amp;buf[<span class="hljs-number">8</span>];<br>  input_end = (*&amp;buf[<span class="hljs-number">8</span>] + *&amp;buf[<span class="hljs-number">16</span>]);<br>  <span class="hljs-keyword">if</span> ( *&amp;buf[<span class="hljs-number">16</span>] )<br>  &#123;<br>    trimmed_length = <span class="hljs-number">0LL</span>;<br>    trimmed_start = <span class="hljs-number">0LL</span>;<br>    input_ptr = *&amp;buf[<span class="hljs-number">8</span>];<br>    <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>    &#123;<br>      current_ptr = input_ptr;<br>      trimmed_count = trimmed_start;<br>      codepoint = *input_ptr;<br>      <span class="hljs-keyword">if</span> ( (codepoint &amp; <span class="hljs-number">0x80u</span>) != <span class="hljs-number">0</span> )<br>      &#123;<br>        v14 = codepoint &amp; <span class="hljs-number">0x1F</span>;<br>        temp_val1 = input_ptr[<span class="hljs-number">1</span>] &amp; <span class="hljs-number">0x3F</span>;<br>        <span class="hljs-keyword">if</span> ( codepoint &lt;= <span class="hljs-number">0xDFu</span> )<br>        &#123;<br>          input_ptr += <span class="hljs-number">2</span>;<br>          codepoint = temp_val1 | (v14 &lt;&lt; <span class="hljs-number">6</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          temp_val2 = (temp_val1 &lt;&lt; <span class="hljs-number">6</span>) | input_ptr[<span class="hljs-number">2</span>] &amp; <span class="hljs-number">0x3F</span>;<br>          <span class="hljs-keyword">if</span> ( codepoint &lt; <span class="hljs-number">0xF0u</span> )<br>          &#123;<br>            input_ptr += <span class="hljs-number">3</span>;<br>            codepoint = (v14 &lt;&lt; <span class="hljs-number">12</span>) | temp_val2;<br>          &#125;<br>          <span class="hljs-keyword">else</span><br>          &#123;<br>            input_ptr += <span class="hljs-number">4</span>;<br>            codepoint = ((codepoint &amp; <span class="hljs-number">7</span>) &lt;&lt; <span class="hljs-number">18</span>) | (temp_val2 &lt;&lt; <span class="hljs-number">6</span>) | current_ptr[<span class="hljs-number">3</span>] &amp; <span class="hljs-number">0x3F</span>;<br>          &#125;<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        ++input_ptr;<br>      &#125;<br>      trimmed_start = &amp;trimmed_count[input_ptr - current_ptr];<br>      <span class="hljs-keyword">if</span> ( codepoint - <span class="hljs-number">9</span> &gt;= <span class="hljs-number">5</span> &amp;&amp; codepoint != <span class="hljs-number">32</span> )<br>      &#123;<br>        <span class="hljs-keyword">if</span> ( codepoint &lt; <span class="hljs-number">0x80</span> )<br>          <span class="hljs-keyword">goto</span> LABEL_27;<br>        high_byte = codepoint &gt;&gt; <span class="hljs-number">8</span>;<br>        <span class="hljs-keyword">if</span> ( codepoint &gt;&gt; <span class="hljs-number">8</span> &gt; <span class="hljs-number">0x1F</span> )<br>        &#123;<br>          <span class="hljs-keyword">if</span> ( high_byte == <span class="hljs-number">32</span> )<br>          &#123;<br>            is_whitespace = *(core::unicode::unicode_data::white_space::WHITESPACE_MAP + codepoint) &gt;&gt; <span class="hljs-number">1</span>;<br>          &#125;<br>          <span class="hljs-keyword">else</span><br>          &#123;<br>            <span class="hljs-keyword">if</span> ( high_byte != <span class="hljs-number">48</span> )<br>              <span class="hljs-keyword">goto</span> LABEL_27;<br>            is_whitespace = codepoint == <span class="hljs-number">12288</span>;<br>          &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( high_byte )<br>        &#123;<br>          <span class="hljs-keyword">if</span> ( high_byte != <span class="hljs-number">22</span> )<br>            <span class="hljs-keyword">goto</span> LABEL_27;<br>          is_whitespace = codepoint == <span class="hljs-number">5760</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          is_whitespace = *(core::unicode::unicode_data::white_space::WHITESPACE_MAP + codepoint);<br>        &#125;<br>        <span class="hljs-keyword">if</span> ( (is_whitespace &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> )<br>          <span class="hljs-keyword">goto</span> LABEL_27;<br>      &#125;<br>      <span class="hljs-keyword">if</span> ( input_ptr == input_end )<br>      &#123;<br>        alloc_result = <span class="hljs-number">1LL</span>;<br>        <span class="hljs-keyword">goto</span> LABEL_58;<br>      &#125;<br>    &#125;<br>  &#125;<br>  trimmed_start = <span class="hljs-number">0LL</span>;<br>  input_ptr = *&amp;buf[<span class="hljs-number">8</span>];<br>  trimmed_count = <span class="hljs-number">0LL</span>;<br>LABEL_27:<br>  <span class="hljs-keyword">if</span> ( input_ptr == input_end )<br>    <span class="hljs-keyword">goto</span> LABEL_53;<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    end_ptr = input_end;<br>    codepoint2 = *(input_end - <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span> ( (codepoint2 &amp; <span class="hljs-number">0x80000000</span>) != <span class="hljs-number">0</span> )<br>    &#123;<br>      byte1 = *(input_end - <span class="hljs-number">2</span>);<br>      <span class="hljs-keyword">if</span> ( byte1 &gt;= <span class="hljs-number">-64</span> )<br>      &#123;<br>        input_end -= <span class="hljs-number">2</span>;<br>        temp_val4 = byte1 &amp; <span class="hljs-number">0x1F</span>;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        byte2 = *(input_end - <span class="hljs-number">3</span>);<br>        <span class="hljs-keyword">if</span> ( byte2 &gt;= <span class="hljs-number">-64</span> )<br>        &#123;<br>          input_end -= <span class="hljs-number">3</span>;<br>          temp_val3 = byte2 &amp; <span class="hljs-number">0xF</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          input_end -= <span class="hljs-number">4</span>;<br>          temp_val3 = ((*(end_ptr - <span class="hljs-number">4</span>) &amp; <span class="hljs-number">7</span>) &lt;&lt; <span class="hljs-number">6</span>) | byte2 &amp; <span class="hljs-number">0x3F</span>;<br>        &#125;<br>        temp_val4 = (temp_val3 &lt;&lt; <span class="hljs-number">6</span>) | byte1 &amp; <span class="hljs-number">0x3F</span>;<br>      &#125;<br>      codepoint2 = (temp_val4 &lt;&lt; <span class="hljs-number">6</span>) | codepoint2 &amp; <span class="hljs-number">0x3F</span>;<br>      <span class="hljs-keyword">if</span> ( codepoint2 - <span class="hljs-number">9</span> &lt; <span class="hljs-number">5</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_31;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      --input_end;<br>      <span class="hljs-keyword">if</span> ( codepoint2 - <span class="hljs-number">9</span> &lt; <span class="hljs-number">5</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_31;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( codepoint2 == <span class="hljs-number">32</span> )<br>      <span class="hljs-keyword">goto</span> LABEL_31;<br>    <span class="hljs-keyword">if</span> ( codepoint2 &lt; <span class="hljs-number">0x80</span> )<br>      <span class="hljs-keyword">break</span>;<br>    high_byte2 = codepoint2 &gt;&gt; <span class="hljs-number">8</span>;<br>    <span class="hljs-keyword">if</span> ( codepoint2 &gt;&gt; <span class="hljs-number">8</span> &lt;= <span class="hljs-number">0x1F</span> )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( high_byte2 )<br>      &#123;<br>        <span class="hljs-keyword">if</span> ( high_byte2 != <span class="hljs-number">22</span> )<br>          <span class="hljs-keyword">break</span>;<br>        is_whitespace2 = codepoint2 == <span class="hljs-number">5760</span>;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        is_whitespace2 = *(core::unicode::unicode_data::white_space::WHITESPACE_MAP + codepoint2);<br>      &#125;<br>      <span class="hljs-keyword">goto</span> LABEL_30;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( high_byte2 == <span class="hljs-number">32</span> )<br>    &#123;<br>      is_whitespace2 = *(core::unicode::unicode_data::white_space::WHITESPACE_MAP + codepoint2) &gt;&gt; <span class="hljs-number">1</span>;<br>      <span class="hljs-keyword">goto</span> LABEL_30;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( high_byte2 != <span class="hljs-number">48</span> )<br>      <span class="hljs-keyword">break</span>;<br>    is_whitespace2 = codepoint2 == <span class="hljs-number">12288</span>;<br>LABEL_30:<br>    <span class="hljs-keyword">if</span> ( (is_whitespace2 &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> )<br>      <span class="hljs-keyword">break</span>;<br>LABEL_31:<br>    <span class="hljs-keyword">if</span> ( input_ptr == input_end )<br>      <span class="hljs-keyword">goto</span> LABEL_53;<br>  &#125;<br>  trimmed_start = &amp;end_ptr[trimmed_start - input_ptr];<br>LABEL_53:<br>  trimmed_length = (trimmed_start - trimmed_count);<br>  <span class="hljs-keyword">if</span> ( trimmed_start - trimmed_count &lt; <span class="hljs-number">0</span> )<br>  &#123;<br>    alloc_size = <span class="hljs-number">0LL</span>;<br>    <span class="hljs-keyword">goto</span> LABEL_110;<br>  &#125;<br>  cupy_size = &amp;trimmed_count[*&amp;buf[<span class="hljs-number">8</span>]];<br>  <span class="hljs-keyword">if</span> ( trimmed_start == trimmed_count )<br>  &#123;<br>    alloc_result = <span class="hljs-number">1LL</span>;<br>    trimmed_length = <span class="hljs-number">0LL</span>;<br>    <span class="hljs-keyword">goto</span> LABEL_58;<br>  &#125;<br>  actual_size = &amp;trimmed_count[*&amp;buf[<span class="hljs-number">8</span>]];<br>  <span class="hljs-built_in">RNvCs73fAdSrgOJL_7___rustc35___rust_no_alloc_shim_is_unstable_v2</span>(stdin_handle, trimmed_length);<br>  alloc_size = <span class="hljs-number">1LL</span>;<br>  allocated_mem = __rustc::__rust_alloc(stdin_handle, trimmed_length, <span class="hljs-number">1LL</span>, trimmed_length);<br>  <span class="hljs-keyword">if</span> ( !allocated_mem )<br>LABEL_110:<br>    alloc::raw_vec::<span class="hljs-built_in">handle_error</span>(stdin_handle, trimmed_length, trimmed_length, alloc_size, &amp;off_7FF6BF7521D8);<span class="hljs-comment">// &quot;/rustc/29483883eed69d5fb4db01964cdf2af4d86e9cb2\\library\\alloc\\src\\slice.rs&quot;</span><br>  alloc_result = allocated_mem;<br>  cupy_size = actual_size;<br>LABEL_58:<br>  <span class="hljs-built_in">memcpy</span>(stdin_handle, trimmed_length, cupy_size);<br>  input_data = *buf;<br>  <span class="hljs-keyword">if</span> ( *buf )<br>    __rustc::__rust_dealloc(stdin_handle, trimmed_length, *buf, *&amp;buf[<span class="hljs-number">8</span>], <span class="hljs-number">1LL</span>);<br>  <span class="hljs-keyword">if</span> ( trimmed_length == <span class="hljs-number">81</span> )<br>  &#123;<br>    index = <span class="hljs-number">0LL</span>;<br>    <span class="hljs-keyword">while</span> ( index != <span class="hljs-number">81</span> )<br>    &#123;<br>      user_char = *(alloc_result + index);<br>      <span class="hljs-keyword">if</span> ( (user_char &amp; <span class="hljs-number">0x80u</span>) == <span class="hljs-number">0</span> )<br>      &#123;<br>        ++index;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        v34 = user_char &amp; <span class="hljs-number">0x1F</span>;<br>        expected_char = *(alloc_result + index + <span class="hljs-number">1</span>) &amp; <span class="hljs-number">0x3F</span>;<br>        <span class="hljs-keyword">if</span> ( user_char &lt;= <span class="hljs-number">0xDFu</span> )<br>        &#123;<br>          index += <span class="hljs-number">2LL</span>;<br>          input_data = expected_char | (v34 &lt;&lt; <span class="hljs-number">6</span>);<br>          user_char = input_data;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          expected_char = (expected_char &lt;&lt; <span class="hljs-number">6</span>);<br>          temp_val5 = expected_char | *(alloc_result + index + <span class="hljs-number">2</span>) &amp; <span class="hljs-number">0x3F</span>;<br>          <span class="hljs-keyword">if</span> ( user_char &lt; <span class="hljs-number">0xF0u</span> )<br>          &#123;<br>            index += <span class="hljs-number">3LL</span>;<br>            input_data = (v34 &lt;&lt; <span class="hljs-number">12</span>);<br>            user_char = input_data | temp_val5;<br>          &#125;<br>          <span class="hljs-keyword">else</span><br>          &#123;<br>            input_data = (user_char &amp; <span class="hljs-number">7</span>) &lt;&lt; <span class="hljs-number">18</span>;<br>            user_char = input_data | (temp_val5 &lt;&lt; <span class="hljs-number">6</span>) | *(alloc_result + index + <span class="hljs-number">3</span>) &amp; <span class="hljs-number">0x3F</span>;<br>            <span class="hljs-keyword">if</span> ( user_char == <span class="hljs-number">1114112</span> )<br>              <span class="hljs-keyword">break</span>;<br>            index += <span class="hljs-number">4LL</span>;<br>          &#125;<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">if</span> ( (user_char - <span class="hljs-number">58</span>) &lt; <span class="hljs-number">0xFFFFFFF6</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_72;<br>    &#125;<br>    user_index = <span class="hljs-number">0LL</span>;<br>    sudoku_index = <span class="hljs-number">0LL</span>;<br>    <span class="hljs-keyword">while</span> ( user_index != <span class="hljs-number">81</span> )<br>    &#123;<br>      user_codepointer = *(alloc_result + user_index);<br>      <span class="hljs-keyword">if</span> ( (user_codepointer &amp; <span class="hljs-number">0x80u</span>) != <span class="hljs-number">0</span> )<br>      &#123;<br>        v40 = user_codepointer &amp; <span class="hljs-number">0x1F</span>;<br>        temp_val6 = *(alloc_result + user_index + <span class="hljs-number">1</span>) &amp; <span class="hljs-number">0x3F</span>;<br>        <span class="hljs-keyword">if</span> ( user_codepointer &lt;= <span class="hljs-number">0xDFu</span> )<br>        &#123;<br>          user_index += <span class="hljs-number">2LL</span>;<br>          expected_char = temp_val6 | (v40 &lt;&lt; <span class="hljs-number">6</span>);<br>          user_codepointer = expected_char;<br>          <span class="hljs-keyword">if</span> ( sudoku_index == <span class="hljs-number">81</span> )<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          temp_val7 = (temp_val6 &lt;&lt; <span class="hljs-number">6</span>) | *(alloc_result + user_index + <span class="hljs-number">2</span>) &amp; <span class="hljs-number">0x3F</span>;<br>          <span class="hljs-keyword">if</span> ( user_codepointer &lt; <span class="hljs-number">0xF0u</span> )<br>          &#123;<br>            user_index += <span class="hljs-number">3LL</span>;<br>            expected_char = (v40 &lt;&lt; <span class="hljs-number">12</span>);<br>            user_codepointer = expected_char | temp_val7;<br>            <span class="hljs-keyword">if</span> ( sudoku_index == <span class="hljs-number">81</span> )<br>              <span class="hljs-keyword">break</span>;<br>          &#125;<br>          <span class="hljs-keyword">else</span><br>          &#123;<br>            expected_char = (user_codepointer &amp; <span class="hljs-number">7</span>) &lt;&lt; <span class="hljs-number">18</span>;<br>            user_codepointer = expected_char | (temp_val7 &lt;&lt; <span class="hljs-number">6</span>) | *(alloc_result + user_index + <span class="hljs-number">3</span>) &amp; <span class="hljs-number">0x3F</span>;<br>            <span class="hljs-keyword">if</span> ( user_codepointer == <span class="hljs-number">1114112</span> )<br>              <span class="hljs-keyword">break</span>;<br>            user_index += <span class="hljs-number">4LL</span>;<br>            <span class="hljs-keyword">if</span> ( sudoku_index == <span class="hljs-number">81</span> )<br>              <span class="hljs-keyword">break</span>;<br>          &#125;<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        ++user_index;<br>        <span class="hljs-keyword">if</span> ( sudoku_index == <span class="hljs-number">81</span> )<br>          <span class="hljs-keyword">break</span>;<br>      &#125;<br>      expected_char = sudoku[sudoku_index];<br>      <span class="hljs-keyword">if</span> ( (expected_char &amp; <span class="hljs-number">0x80u</span>) != <span class="hljs-number">0LL</span> )<br>      &#123;<br>        v43 = expected_char &amp; <span class="hljs-number">0x1F</span>;<br>        temp_val8 = sudoku[sudoku_index + <span class="hljs-number">1</span>] &amp; <span class="hljs-number">0x3F</span>;<br>        <span class="hljs-keyword">if</span> ( expected_char &lt;= <span class="hljs-number">0xDFu</span> )<br>        &#123;<br>          sudoku_index += <span class="hljs-number">2LL</span>;<br>          expected_char = temp_val8 | (v43 &lt;&lt; <span class="hljs-number">6</span>);<br>          <span class="hljs-keyword">if</span> ( user_codepointer == <span class="hljs-number">1114112</span> )<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          temp_val9 = (temp_val8 &lt;&lt; <span class="hljs-number">6</span>) | sudoku[sudoku_index + <span class="hljs-number">2</span>] &amp; <span class="hljs-number">0x3F</span>;<br>          <span class="hljs-keyword">if</span> ( expected_char &lt; <span class="hljs-number">0xF0u</span> )<br>          &#123;<br>            sudoku_index += <span class="hljs-number">3LL</span>;<br>            expected_char = (v43 &lt;&lt; <span class="hljs-number">12</span>) | temp_val9;<br>            <span class="hljs-keyword">if</span> ( user_codepointer == <span class="hljs-number">1114112</span> )<br>              <span class="hljs-keyword">break</span>;<br>          &#125;<br>          <span class="hljs-keyword">else</span><br>          &#123;<br>            expected_char = ((expected_char &amp; <span class="hljs-number">7</span>) &lt;&lt; <span class="hljs-number">18</span>) | (temp_val9 &lt;&lt; <span class="hljs-number">6</span>) | sudoku[sudoku_index + <span class="hljs-number">3</span>] &amp; <span class="hljs-number">0x3Fu</span>;<br>            <span class="hljs-keyword">if</span> ( expected_char == <span class="hljs-number">1114112</span> )<br>              <span class="hljs-keyword">break</span>;<br>            sudoku_index += <span class="hljs-number">4LL</span>;<br>            <span class="hljs-keyword">if</span> ( user_codepointer == <span class="hljs-number">1114112</span> )<br>              <span class="hljs-keyword">break</span>;<br>          &#125;<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        ++sudoku_index;<br>        <span class="hljs-keyword">if</span> ( user_codepointer == <span class="hljs-number">1114112</span> )<br>          <span class="hljs-keyword">break</span>;<br>      &#125;<br>      <span class="hljs-keyword">if</span> ( expected_char != <span class="hljs-number">46</span> &amp;&amp; user_codepointer != expected_char )<br>      &#123;<br>        *&amp;stdin_handle[<span class="hljs-number">0</span>] = aYouShouldNotCh;<br>        *(&amp;stdin_handle[<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>) = <span class="hljs-number">32LL</span>;<br>        *&amp;fmt_arg1 = stdin_handle;<br>        *(&amp;fmt_arg1 + <span class="hljs-number">1</span>) = &lt;&amp;T_as_core::fmt::Display&gt;::fmt;<br>        *buf = &amp;unk_7FF6BF<span class="hljs-number">7524E0</span>;<br>        *&amp;buf[<span class="hljs-number">8</span>] = <span class="hljs-number">2LL</span>;<br>        *&amp;buf[<span class="hljs-number">32</span>] = <span class="hljs-number">0LL</span>;<br>        *&amp;buf[<span class="hljs-number">16</span>] = &amp;fmt_arg1;<br>        *&amp;buf[<span class="hljs-number">24</span>] = <span class="hljs-number">1LL</span>;<br>        result = std::io::stdio::_print(stdin_handle, <span class="hljs-number">81LL</span>, sudoku_index, buf);<br>        <span class="hljs-keyword">goto</span> LABEL_73;<br>      &#125;<br>    &#125;<br>    sudoku::board::sudoku::Sudoku::<span class="hljs-built_in">from_str_line</span>(stdin_handle, <span class="hljs-number">81LL</span>, alloc_result, buf, <span class="hljs-number">81LL</span>, expected_char);<br>    <span class="hljs-keyword">if</span> ( buf[<span class="hljs-number">0</span>] == <span class="hljs-number">1</span> )<br>    &#123;<br>      *&amp;fmt_arg1 = *&amp;buf[<span class="hljs-number">4</span>];<br>      core::result::<span class="hljs-built_in">unwrap_failed</span>(<br>        stdin_handle,<br>        <span class="hljs-number">81</span>,<br>        <span class="hljs-number">43</span>,<br>        <span class="hljs-string">&quot;called `Result::unwrap()` on an `Err` value&quot;</span>,<br>        &amp;fmt_arg1,<br>        &amp;unk_7FF6BF752070);<br>    &#125;<br>    board_data = buf[<span class="hljs-number">81</span>];<br>    stdin_handle[<span class="hljs-number">4</span>] = *&amp;buf[<span class="hljs-number">65</span>];<br>    stdin_handle[<span class="hljs-number">3</span>] = *&amp;buf[<span class="hljs-number">49</span>];<br>    stdin_handle[<span class="hljs-number">2</span>] = *&amp;buf[<span class="hljs-number">33</span>];<br>    stdin_handle[<span class="hljs-number">1</span>] = *&amp;buf[<span class="hljs-number">17</span>];<br>    stdin_handle[<span class="hljs-number">0</span>] = *&amp;buf[<span class="hljs-number">1</span>];<br>    <span class="hljs-keyword">if</span> ( sudoku::board::sudoku::Sudoku::<span class="hljs-built_in">is_solved</span>(stdin_handle, <span class="hljs-number">81LL</span>, temp_arg1, stdin_handle) )<br>    &#123;<br>      *buf = &amp;off_7FF6BF752490;                 <span class="hljs-comment">// &quot;Congratulation!\n&quot;</span><br>      *&amp;buf[<span class="hljs-number">8</span>] = <span class="hljs-number">1LL</span>;<br>      *&amp;buf[<span class="hljs-number">16</span>] = <span class="hljs-number">8LL</span>;<br>      *&amp;buf[<span class="hljs-number">24</span>] = <span class="hljs-number">0LL</span>;<br>      std::io::stdio::_print(stdin_handle, <span class="hljs-number">81LL</span>, temp_arg2, buf);<br>      fmt_arg4 = <span class="hljs-number">0LL</span>;<br>      fmt_arg3 = <span class="hljs-number">0LL</span>;<br>      fmt_arg2 = <span class="hljs-number">0LL</span>;<br>      fmt_arg1 = <span class="hljs-number">0LL</span>;<br>      fmt_arg6 = <span class="hljs-number">0LL</span>;<br>      fmt_arg5 = ::fmt_arg5;<br>      md5_ctx_prt = &amp;fmt_arg1;<br>      md5::<span class="hljs-built_in">consume</span>(&amp;fmt_arg1, <span class="hljs-number">81LL</span>, alloc_result, &amp;fmt_arg1, <span class="hljs-number">81LL</span>);<br>      *&amp;buf[<span class="hljs-number">80</span>] = fmt_arg6;<br>      *&amp;buf[<span class="hljs-number">64</span>] = fmt_arg5;<br>      *&amp;buf[<span class="hljs-number">48</span>] = fmt_arg4;<br>      *&amp;buf[<span class="hljs-number">32</span>] = fmt_arg3;<br>      *&amp;buf[<span class="hljs-number">16</span>] = fmt_arg2;<br>      *buf = fmt_arg1;<br>      md5::Context::<span class="hljs-built_in">finalize</span>(&amp;fmt_arg1, <span class="hljs-number">81LL</span>, buf, md5_hash);<br>      *&amp;fmt_arg1 = md5_hash;<br>      *(&amp;fmt_arg1 + <span class="hljs-number">1</span>) = &lt;md5::Digest_as_core::fmt::LowerHex&gt;::fmt;<br>      *buf = &amp;YourFlagIs;                       <span class="hljs-comment">// &quot;Your flag is moectf&#123;&quot;</span><br>      *&amp;buf[<span class="hljs-number">8</span>] = <span class="hljs-number">2LL</span>;<br>      *&amp;buf[<span class="hljs-number">32</span>] = <span class="hljs-number">0LL</span>;<br>      *&amp;buf[<span class="hljs-number">16</span>] = &amp;fmt_arg1;<br>      *&amp;buf[<span class="hljs-number">24</span>] = <span class="hljs-number">1LL</span>;<br>      result = std::io::stdio::_print(&amp;fmt_arg1, <span class="hljs-number">81LL</span>, temp_arg3, buf);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      *buf = &amp;TryAgain;                         <span class="hljs-comment">// &quot;try again~\n&quot;</span><br>      *&amp;buf[<span class="hljs-number">8</span>] = <span class="hljs-number">1LL</span>;<br>      *&amp;buf[<span class="hljs-number">16</span>] = <span class="hljs-number">8LL</span>;<br>      *&amp;buf[<span class="hljs-number">24</span>] = <span class="hljs-number">0LL</span>;<br>      result = std::io::stdio::_print(stdin_handle, <span class="hljs-number">81LL</span>, temp_arg2, buf);<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>LABEL_72:<br>    *buf = &amp;Invalid;                            <span class="hljs-comment">// &quot;Invalid Solution.\n&quot;</span><br>    *&amp;buf[<span class="hljs-number">8</span>] = <span class="hljs-number">1LL</span>;<br>    *&amp;buf[<span class="hljs-number">16</span>] = <span class="hljs-number">8LL</span>;<br>    *&amp;buf[<span class="hljs-number">24</span>] = <span class="hljs-number">0LL</span>;<br>    result = std::io::stdio::_print(stdin_handle, trimmed_length, input_data, buf);<br>  &#125;<br>LABEL_73:<br>  <span class="hljs-keyword">if</span> ( trimmed_length )<br>    <span class="hljs-keyword">return</span> __rustc::__rust_dealloc(md5_ctx_prt, trimmed_length, trimmed_length, alloc_result, <span class="hljs-number">1LL</span>);<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>rust逆向的伪代码不好分析，但是作为数独游戏，只需要找到数独就可以了，可以shift+F12在字符串表窗口找到可疑的数据：</p><p><img src="/../images/image-20250910112618179-1760193218429-38.png" alt="可疑的数据"></p></li><li><p>结合伪代码，可以分析出程序接受用户输入的已求解的数独后会进行检验，若数独正确且求解成功，会输出flag，flag是md5加密后的数独。所以直接利用程序得到flag即可。网上找一个数独求解工具求解：<a href="https://sudoku.vc/zh-CN/sudoku-solver">数独求解器 - 免费在线数独方案解题工具</a>（建议不要直接把数独复制给AI求解，因为AI会乱改数据，笔者卡在求解这一步好久😅）</p><p><img src="/../images/image-20250910112549164-1760193218429-42.png" alt="求解数独"></p></li><li><p>IDA动态调试（直接运行程序输入正确数独貌似会闪退），把解出来的数独按提示的顺序输入，就可以得到flag：</p><p><img src="/../images/image-20250910112516212-1760193218429-41.png" alt="得到flag"></p></li></ul><h2 id="week4"><a href="#week4" class="headerlink" title="week4"></a>week4</h2><h3 id="ezandroid"><a href="#ezandroid" class="headerlink" title="ezandroid"></a>ezandroid</h3><ul><li><p>附件apk用JEB打开，发现逻辑主要是将输入的文本base64加密后进行比较</p><p><img src="/../images/image-20250907203522833-1760193218429-43.png" alt="函数逻辑"></p></li><li><p>cyberchef一把梭</p><p><img src="/../images/image-20250907203551932-1760193218429-44.png" alt="cyberchef一把梭"></p></li></ul><h3 id="ezandroid-pro"><a href="#ezandroid-pro" class="headerlink" title="ezandroid.pro"></a>ezandroid.pro</h3><ul><li><p>附件apk用JEB打开，可以发现使用了一个从native层ezandroidpro库载入的函数check，由check判断输入是否正确</p><p><img src="/../images/image-20250907212718438-1760193218429-45.png" alt="JEB反编译结果"></p></li><li><p>把apk解压，在IDA中打开lib&#x2F;armeabi-v7a&#x2F;libezandroidpro.so，在Exports界面找到Java_com_example_ezandroidpro_MainActivity_check函数，即apk载入的check函数</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">bool</span> __fastcall <span class="hljs-title">Java_com_example_ezandroidpro_MainActivity_check</span><span class="hljs-params">(<span class="hljs-type">int</span> JENV, <span class="hljs-type">int</span> a2, <span class="hljs-type">int</span> a3)</span></span><br><span class="hljs-function"></span>&#123;<br>  _BOOL4 ret; <span class="hljs-comment">// r5</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *flag; <span class="hljs-comment">// r0</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *src; <span class="hljs-comment">// r4</span><br>  <span class="hljs-type">size_t</span> length; <span class="hljs-comment">// r0</span><br>  <span class="hljs-type">size_t</span> n; <span class="hljs-comment">// r5</span><br>  <span class="hljs-type">char</span> *dest; <span class="hljs-comment">// r9</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v11; <span class="hljs-comment">// r10</span><br>  <span class="hljs-type">char</span> *str; <span class="hljs-comment">// r4</span><br>  <span class="hljs-type">int</span> n96; <span class="hljs-comment">// r2</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// r0</span><br>  <span class="hljs-type">unsigned</span> __int8 *v15; <span class="hljs-comment">// r2</span><br>  <span class="hljs-type">int</span> v16; <span class="hljs-comment">// r1</span><br>  <span class="hljs-type">char</span> *_str; <span class="hljs-comment">// r3</span><br>  <span class="hljs-type">void</span> *s1_1; <span class="hljs-comment">// r6</span><br>  <span class="hljs-type">unsigned</span> __int8 v20; <span class="hljs-comment">// [sp+4h] [bp-44h] BYREF</span><br>  _BYTE v21[<span class="hljs-number">7</span>]; <span class="hljs-comment">// [sp+5h] [bp-43h] BYREF</span><br>  <span class="hljs-type">void</span> *s1; <span class="hljs-comment">// [sp+Ch] [bp-3Ch]</span><br>  _DWORD v23[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [sp+10h] [bp-38h] BYREF</span><br>  <span class="hljs-type">void</span> *key; <span class="hljs-comment">// [sp+18h] [bp-30h]</span><br>  _DWORD v25[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [sp+1Ch] [bp-2Ch] BYREF</span><br>  <span class="hljs-type">void</span> *dest_1; <span class="hljs-comment">// [sp+24h] [bp-24h]</span><br><br>  ret = <span class="hljs-number">0</span>;<br>  flag = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)(*(<span class="hljs-built_in">int</span> (__fastcall **)(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>, _DWORD))(*(_DWORD *)JENV + <span class="hljs-number">676</span>))(JENV, a3, <span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">if</span> ( !flag )<br>    <span class="hljs-keyword">return</span> ret;<br>  src = flag;<br>  length = <span class="hljs-built_in">strlen</span>(flag);<br>  <span class="hljs-keyword">if</span> ( length &gt;= <span class="hljs-number">0xFFFFFFF0</span> )<br>    std::__basic_string_common&lt;<span class="hljs-literal">true</span>&gt;::__throw_length_error(v25);<br>  n = length;<br>  <span class="hljs-keyword">if</span> ( length &gt;= <span class="hljs-number">0xB</span> )<br>  &#123;<br>    v11 = (length + <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFFFFFFF0</span>;<br>    dest = (<span class="hljs-type">char</span> *)<span class="hljs-keyword">operator</span> <span class="hljs-built_in">new</span>(v11);<br>    v25[<span class="hljs-number">1</span>] = n;<br>    dest_1 = dest;<br>    v25[<span class="hljs-number">0</span>] = v11 + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">goto</span> LABEL_7;<br>  &#125;<br>  <span class="hljs-built_in">LOBYTE</span>(v25[<span class="hljs-number">0</span>]) = <span class="hljs-number">2</span> * length;<br>  dest = (<span class="hljs-type">char</span> *)v25 + <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> ( length )<br>LABEL_7:<br>    <span class="hljs-built_in">j_memcpy</span>(dest, src, n);<br>  dest[n] = <span class="hljs-number">0</span>;<br>  (*(<span class="hljs-built_in">void</span> (__fastcall **)(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *))(*(_DWORD *)JENV + <span class="hljs-number">680</span>))(JENV, a3, src);<br>  key = (<span class="hljs-type">void</span> *)<span class="hljs-keyword">operator</span> <span class="hljs-built_in">new</span>(<span class="hljs-number">0x20u</span>);<br>  <span class="hljs-built_in">strcpy</span>((<span class="hljs-type">char</span> *)key, <span class="hljs-string">&quot;moectf2025!!!!!!&quot;</span>);<br>  v23[<span class="hljs-number">1</span>] = <span class="hljs-number">16</span>;<br>  v23[<span class="hljs-number">0</span>] = <span class="hljs-number">33</span>;<br>  str = (<span class="hljs-type">char</span> *)<span class="hljs-keyword">operator</span> <span class="hljs-built_in">new</span>(<span class="hljs-number">0x70u</span>);<br>  <span class="hljs-built_in">strcpy</span>(str, <span class="hljs-string">&quot;4EEB1EEF2914D79BFA8C5006332097ED2EF06C4A59CAE31C827A08D45CC649C0B971BF2EFBCB160E531A646DF7A6AC0B&quot;</span>);<br>  <span class="hljs-built_in">sm4Encrypt</span>((<span class="hljs-type">int</span>)&amp;v20, (<span class="hljs-type">int</span>)v25, (<span class="hljs-type">int</span>)v23);<br>  n96 = *(_DWORD *)&amp;v21[<span class="hljs-number">3</span>];<br>  v14 = v20 &amp; <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> ( !v14 )<br>    n96 = v20 &gt;&gt; <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> ( n96 == <span class="hljs-number">96</span> )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( v14 )<br>    &#123;<br>      s1_1 = s1;<br>      ret = <span class="hljs-built_in">memcmp</span>(s1, str, <span class="hljs-number">0x60u</span>) == <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">goto</span> LABEL_20;<br>    &#125;<br>    v15 = v21;<br>    v16 = v20 &gt;&gt; <span class="hljs-number">1</span>;<br>    _str = str;<br>    <span class="hljs-keyword">do</span><br>    &#123;<br>      ret = *v15 == (<span class="hljs-type">unsigned</span> __int8)*_str;<br>      <span class="hljs-keyword">if</span> ( *v15 != (<span class="hljs-type">unsigned</span> __int8)*_str )<br>        <span class="hljs-keyword">break</span>;<br>      ++_str;<br>      ++v15;<br>      --v16;<br>    &#125;<br>    <span class="hljs-keyword">while</span> ( v16 );<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    ret = <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v14 )<br>  &#123;<br>    s1_1 = s1;<br>LABEL_20:<br>    <span class="hljs-function"><span class="hljs-keyword">operator</span> <span class="hljs-title">delete</span><span class="hljs-params">(s1_1)</span></span>;<br>  &#125;<br>  <span class="hljs-function"><span class="hljs-keyword">operator</span> <span class="hljs-title">delete</span><span class="hljs-params">(str)</span></span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">LOBYTE</span>(v23[<span class="hljs-number">0</span>]) &lt;&lt; <span class="hljs-number">31</span> )<br>    <span class="hljs-function"><span class="hljs-keyword">operator</span> <span class="hljs-title">delete</span><span class="hljs-params">(key)</span></span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">LOBYTE</span>(v25[<span class="hljs-number">0</span>]) &lt;&lt; <span class="hljs-number">31</span> )<br>    <span class="hljs-function"><span class="hljs-keyword">operator</span> <span class="hljs-title">delete</span><span class="hljs-params">(dest_1)</span></span>;<br>  <span class="hljs-keyword">return</span> ret;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>可以看到，check函数使用了sm4加密，密钥可能是“moectf2025!!!!!!”，还需要知道加密模式。借助AI分析具体加密函数知道采用ECB加密模式，cyberchef一把梭：</p><p><img src="/../images/image-20250907220527950-1760193218429-47.png" alt="cyberchef一把梭"></p></li></ul><h3 id="A-simple-program"><a href="#A-simple-program" class="headerlink" title="A simple program"></a>A simple program</h3><ul><li><p>附件程序main函数反编译出来大概是这样：</p><p><img src="/../images/image-20250909145857318-1760193218429-48.png" alt="main函数"></p><p>但是Str2这个像模像样的flag是假的，提交会显示错误。结合题目提示，flag应该藏在其他地方。</p></li><li><p>IDA看不出有什么套路在里面，但是在X32Dbg，strncmp是可以点进去的（在IDA中，strncmp是粉色的导入函数，点击函数没有详细内容），点进去会发现，里面还有一个strncmp</p><p><img src="/../images/image-20250909150500077-1760193218429-49.png" alt="strncmp:别有洞天"></p><p>加上注释：</p><p><img src="/../images/image-20250909195444724-1760193218429-46.png" alt="加上注释"></p></li><li><p>所以真正的检验逻辑在strncmp里，程序从chall.4D31A4取出真正的密文，然后把输入的flag进行异或处理再比较。在转储中跟随4D31A4可以获得密文：</p><p><img src="/../images/image-20250909195828121-1760193218429-50.png" alt="转储中的密文"></p></li><li><p>解密脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">enc=[<span class="hljs-number">0x4E</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x5E</span>]<br>flag=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> enc:<br>    flag+=<span class="hljs-built_in">chr</span>(i^<span class="hljs-number">0x23</span>)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure></li></ul><h2 id="week5"><a href="#week5" class="headerlink" title="week5"></a>week5</h2><h3 id="2048-master-re"><a href="#2048-master-re" class="headerlink" title="2048_master_re"></a>2048_master_re</h3><ul><li><p>附件程序是一个2048小游戏，通过方向键来操作数字整体移动。根据游戏窗口可以推测这也是一个GUI程序。</p><p><img src="/../images/image-20250927191149395-1760193218429-51.png" alt="游戏窗口"></p></li><li><p>用IDA打开附件程序，shift+F12可以在字符串窗口看见一些蛛丝马迹（因为是MFC GUI程序，也可以直接找WinMain函数，然后再从中找出和flag检验有关的逻辑）：</p><p><img src="/../images/image-20250927191413499-1760193218429-52.png" alt="字符串窗口"></p></li><li><p>跟踪flag.txt可以发现一个疑似的关键函数：</p><p><img src="/../images/image-20250927191650957-1760193218429-54.png" alt="疑似关键逻辑的函数"></p><p>通过粗略分析可以推测程序从flag.txt里读取数据，然后进行检验。但是此处没有直接的和flag相关的提示，跟踪到上级函数看看。选中函数名按X查找交叉引用，跳转到上一级函数：</p><p><img src="/../images/image-20250927192543291-1760193218429-53.png" alt="出题人的提示"></p><p>出题人根据可疑函数的返回值设置了提示，看来flag检验逻辑在此没错了。回到可疑函数，可以看到函数后半部分是对Block的检验，所以推测sub_401A81是一个加密函数。跟踪进去可以找到一个魔改xxtea函数和一个疑似数据格式转换的函数。这是优化后的样子：</p><p><img src="/../images/image-20250927194329834-1760193218429-55.png" alt="sub_401A81"></p><p>到这里大概掌握了一些信息了。但还是要完整分析一下程序的整体逻辑，继续找上级函数，回溯到WinMain函数。下面是沿着正向调用逻辑的分析：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> __stdcall <span class="hljs-title">WinMain</span><span class="hljs-params">(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, <span class="hljs-type">int</span> nShowCmd)</span></span><br><span class="hljs-function"></span>&#123;<br>  MSG Msg; <span class="hljs-comment">// [rsp+60h] [rbp-90h] BYREF</span><br>  WNDCLASSEXA v6; <span class="hljs-comment">// [rsp+90h] [rbp-60h] BYREF</span><br><br>  <span class="hljs-built_in">memset</span>(&amp;v6, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(v6));<br>  v<span class="hljs-number">6.</span>cbSize = <span class="hljs-number">80</span>;<br>  v<span class="hljs-number">6.l</span>pfnWndProc = check_2048;                  <span class="hljs-comment">// 游戏的检验逻辑</span><br>  v<span class="hljs-number">6.</span>hInstance = hInstance;<br>  v<span class="hljs-number">6.</span>hCursor = <span class="hljs-built_in">LoadCursorA</span>(<span class="hljs-number">0LL</span>, <span class="hljs-number">0x7F00</span>);<br>  v<span class="hljs-number">6.</span>hbrBackground = <span class="hljs-number">5</span>;<br>  v<span class="hljs-number">6.l</span>pszClassName = <span class="hljs-string">&quot;WindowClass&quot;</span>;<br>  v<span class="hljs-number">6.</span>hIcon = <span class="hljs-built_in">LoadIconA</span>(<span class="hljs-number">0LL</span>, <span class="hljs-number">0x7F00</span>);<br>  v<span class="hljs-number">6.</span>hIconSm = <span class="hljs-built_in">LoadIconA</span>(<span class="hljs-number">0LL</span>, <span class="hljs-number">0x7F00</span>);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">RegisterClassExA</span>(&amp;v6) )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">CreateWindowExA</span>(<br>           <span class="hljs-number">0x200u</span>,<br>           <span class="hljs-string">&quot;WindowClass&quot;</span>,<br>           <span class="hljs-string">&quot;2048&quot;</span>,<br>           <span class="hljs-number">0x10CF0000u</span>,<br>           <span class="hljs-number">0x80000000</span>,<br>           <span class="hljs-number">0x80000000</span>,<br>           <span class="hljs-number">640</span>,<br>           <span class="hljs-number">480</span>,<br>           <span class="hljs-number">0LL</span>,<br>           <span class="hljs-number">0LL</span>,<br>           hInstance,<br>           <span class="hljs-number">0LL</span>) )<br>    &#123;<br>      <span class="hljs-keyword">while</span> ( <span class="hljs-built_in">GetMessageA</span>(&amp;Msg, <span class="hljs-number">0LL</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) &gt; <span class="hljs-number">0</span> )<br>      &#123;<br>        <span class="hljs-built_in">TranslateMessage</span>(&amp;Msg);<br>        <span class="hljs-built_in">DispatchMessageA</span>(&amp;Msg);<br>      &#125;<br>      <span class="hljs-keyword">return</span> Msg.wParam;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-built_in">MessageBoxA</span>(<span class="hljs-number">0LL</span>, <span class="hljs-string">&quot;Window Creation Failed!&quot;</span>, <span class="hljs-string">&quot;Error!&quot;</span>, <span class="hljs-number">0x30u</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">MessageBoxA</span>(<span class="hljs-number">0LL</span>, <span class="hljs-string">&quot;Window Registration Failed!&quot;</span>, <span class="hljs-string">&quot;Error!&quot;</span>, <span class="hljs-number">0x30u</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//游戏检验函数</span><br><span class="hljs-function">LRESULT __fastcall <span class="hljs-title">check_2048</span><span class="hljs-params">(HWND hWnd, UINT n20, WPARAM wParam, LPARAM lParam)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v4; <span class="hljs-comment">// eax</span><br>  tagPAINTSTRUCT Paint; <span class="hljs-comment">// [rsp+50h] [rbp-30h] BYREF</span><br>  <span class="hljs-keyword">struct</span> <span class="hljs-title class_">tagRECT</span> Rect; <span class="hljs-comment">// [rsp+230h] [rbp+1B0h] BYREF</span><br>  HGDIOBJ h; <span class="hljs-comment">// [rsp+248h] [rbp+1C8h]</span><br>  HDC hdcSrc; <span class="hljs-comment">// [rsp+250h] [rbp+1D0h]</span><br>  HDC hdc; <span class="hljs-comment">// [rsp+258h] [rbp+1D8h]</span><br>  LONG dwNewLong; <span class="hljs-comment">// [rsp+264h] [rbp+1E4h]</span><br>  HMENU SystemMenu; <span class="hljs-comment">// [rsp+268h] [rbp+1E8h]</span><br>  <span class="hljs-type">int</span> i2; <span class="hljs-comment">// [rsp+274h] [rbp+1F4h]</span><br>  <span class="hljs-type">int</span> i1; <span class="hljs-comment">// [rsp+278h] [rbp+1F8h]</span><br>  <span class="hljs-type">int</span> nn; <span class="hljs-comment">// [rsp+27Ch] [rbp+1FCh]</span><br>  <span class="hljs-type">int</span> mm; <span class="hljs-comment">// [rsp+280h] [rbp+200h]</span><br>  <span class="hljs-type">int</span> kk; <span class="hljs-comment">// [rsp+284h] [rbp+204h]</span><br>  <span class="hljs-type">int</span> v18; <span class="hljs-comment">// [rsp+288h] [rbp+208h]</span><br>  <span class="hljs-type">int</span> jj; <span class="hljs-comment">// [rsp+28Ch] [rbp+20Ch]</span><br>  <span class="hljs-type">int</span> i14; <span class="hljs-comment">// [rsp+290h] [rbp+210h]</span><br>  <span class="hljs-type">int</span> i13; <span class="hljs-comment">// [rsp+294h] [rbp+214h]</span><br>  <span class="hljs-type">int</span> i12; <span class="hljs-comment">// [rsp+298h] [rbp+218h]</span><br>  <span class="hljs-type">int</span> i11; <span class="hljs-comment">// [rsp+29Ch] [rbp+21Ch]</span><br>  <span class="hljs-type">int</span> i10; <span class="hljs-comment">// [rsp+2A0h] [rbp+220h]</span><br>  <span class="hljs-type">int</span> v25; <span class="hljs-comment">// [rsp+2A4h] [rbp+224h]</span><br>  <span class="hljs-type">int</span> i9; <span class="hljs-comment">// [rsp+2A8h] [rbp+228h]</span><br>  <span class="hljs-type">int</span> i8; <span class="hljs-comment">// [rsp+2ACh] [rbp+22Ch]</span><br>  <span class="hljs-type">int</span> i7; <span class="hljs-comment">// [rsp+2B0h] [rbp+230h]</span><br>  <span class="hljs-type">int</span> i6; <span class="hljs-comment">// [rsp+2B4h] [rbp+234h]</span><br>  <span class="hljs-type">int</span> i5; <span class="hljs-comment">// [rsp+2B8h] [rbp+238h]</span><br>  <span class="hljs-type">int</span> i4; <span class="hljs-comment">// [rsp+2BCh] [rbp+23Ch]</span><br>  <span class="hljs-type">int</span> v32; <span class="hljs-comment">// [rsp+2C0h] [rbp+240h]</span><br>  <span class="hljs-type">int</span> i3; <span class="hljs-comment">// [rsp+2C4h] [rbp+244h]</span><br>  <span class="hljs-type">int</span> ii; <span class="hljs-comment">// [rsp+2C8h] [rbp+248h]</span><br>  <span class="hljs-type">int</span> n; <span class="hljs-comment">// [rsp+2CCh] [rbp+24Ch]</span><br>  <span class="hljs-type">int</span> m; <span class="hljs-comment">// [rsp+2D0h] [rbp+250h]</span><br>  <span class="hljs-type">int</span> k; <span class="hljs-comment">// [rsp+2D4h] [rbp+254h]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+2D8h] [rbp+258h]</span><br>  <span class="hljs-type">int</span> v39; <span class="hljs-comment">// [rsp+2DCh] [rbp+25Ch]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+2E0h] [rbp+260h]</span><br>  <span class="hljs-type">char</span> v41; <span class="hljs-comment">// [rsp+2E7h] [rbp+267h]</span><br>  <span class="hljs-type">int</span> i16; <span class="hljs-comment">// [rsp+2E8h] [rbp+268h]</span><br>  <span class="hljs-type">int</span> i15; <span class="hljs-comment">// [rsp+2ECh] [rbp+26Ch]</span><br><br>  <span class="hljs-keyword">if</span> ( n20 == <span class="hljs-number">15</span> )                              <span class="hljs-comment">// 下面开始是一大串的检验操作</span><br>  &#123;<br>    hdc = <span class="hljs-built_in">BeginPaint</span>(hWnd, &amp;Paint);<br>    hdcSrc = <span class="hljs-built_in">CreateCompatibleDC</span>(hdc);<br>    <span class="hljs-built_in">GetClientRect</span>(hWnd, &amp;Rect);<br>    h = <span class="hljs-built_in">CreateCompatibleBitmap</span>(hdc, Rect.right, Rect.bottom);<br>    <span class="hljs-built_in">SelectObject</span>(hdcSrc, h);<br>    <span class="hljs-built_in">sub_4022AF</span>(hdcSrc);<br>    <span class="hljs-built_in">BitBlt</span>(hdc, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, Rect.right, Rect.bottom, hdcSrc, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0xCC0020u</span>);<br>    <span class="hljs-built_in">DeleteObject</span>(h);<br>    <span class="hljs-built_in">DeleteDC</span>(hdcSrc);<br>    <span class="hljs-built_in">EndPaint</span>(hWnd, &amp;Paint);<br>  &#125;<br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( n20 &gt; <span class="hljs-number">0xF</span> )<br>  &#123;<br><span class="hljs-comment">//...此处省略</span><br>  &#125;<br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( n20 == <span class="hljs-number">1</span> )<br>  &#123;<br>    SystemMenu = <span class="hljs-built_in">GetSystemMenu</span>(hWnd, <span class="hljs-number">0</span>);<br>    dwNewLong = <span class="hljs-built_in">GetWindowLongA</span>(hWnd, <span class="hljs-number">-16</span>) &amp; <span class="hljs-number">0xFFF8FFFF</span>;<br>    <span class="hljs-built_in">SetWindowLongA</span>(hWnd, <span class="hljs-number">-16</span>, dwNewLong);<br>    <span class="hljs-built_in">SetWindowPos</span>(hWnd, <span class="hljs-number">0LL</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3u</span>);<br>    <span class="hljs-built_in">ShowWindow</span>(hWnd, <span class="hljs-number">1</span>);<br>    v4 = <span class="hljs-built_in">time64</span>(<span class="hljs-number">0LL</span>);<br>    <span class="hljs-built_in">srand</span>(v4);<br>    hThread = <span class="hljs-built_in">CreateThread</span>(<span class="hljs-number">0LL</span>, <span class="hljs-number">0LL</span>, StartAddress, <span class="hljs-number">0LL</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0LL</span>);<br>    <span class="hljs-built_in">CreateThread</span>(<span class="hljs-number">0LL</span>, <span class="hljs-number">0LL</span>, check_flag, <span class="hljs-number">0LL</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0LL</span>);<span class="hljs-comment">// 这里创建了线程，而flag的检验函数就在这个线程里</span><br>    <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">sub_401DBF</span>(<span class="hljs-string">&quot;layout.dat&quot;</span>) )<br>    &#123;<br>      <span class="hljs-built_in">sub_4645D0</span>(&amp;Paint, <span class="hljs-string">&quot;layout.dat&quot;</span>, <span class="hljs-number">8</span>);<br>      <span class="hljs-keyword">for</span> ( i15 = <span class="hljs-number">1</span>; i15 &lt;= <span class="hljs-number">4</span>; ++i15 )<br>      &#123;<br>        <span class="hljs-keyword">for</span> ( i16 = <span class="hljs-number">1</span>; i16 &lt;= <span class="hljs-number">4</span>; ++i16 )<br>          <span class="hljs-built_in">sub_453880</span>(&amp;Paint, &amp;dword_4B6040[<span class="hljs-number">5</span> * i15 + i16]);<br>      &#125;<br>      <span class="hljs-built_in">sub_453880</span>(&amp;Paint, &amp;dword_4B60A4);<br>      <span class="hljs-built_in">sub_464580</span>(&amp;Paint);<br>      <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">MessageBoxA</span>(<span class="hljs-number">0LL</span>, <span class="hljs-string">&quot;Continue?&quot;</span>, <span class="hljs-string">&quot;E=hv&quot;</span>, <span class="hljs-number">4u</span>) == <span class="hljs-number">7</span> )<br>      &#123;<br>        <span class="hljs-built_in">memset</span>(dword_4B6040, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(dword_4B6040));<br>        <span class="hljs-built_in">check</span>();<br>        <span class="hljs-built_in">check</span>();<br>        <span class="hljs-built_in">InvalidateRect</span>(hWnd, <span class="hljs-number">0LL</span>, <span class="hljs-number">1</span>);<br>        dword_4B60A4 = <span class="hljs-number">0</span>;<br>      &#125;<br>      <span class="hljs-built_in">sub_464C70</span>(&amp;Paint);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-built_in">check</span>();<br>      <span class="hljs-built_in">check</span>();<br>      dword_4B60A4 = <span class="hljs-number">0</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-keyword">if</span> ( n20 != <span class="hljs-number">2</span> )<br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">DefWindowProcA</span>(hWnd, n20, wParam, lParam);<br>    <span class="hljs-built_in">TerminateThread</span>(hThread, <span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">PostQuitMessage</span>(<span class="hljs-number">0</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br><br><span class="hljs-comment">//flag的检验函数</span><br><span class="hljs-function">__int64 __fastcall <span class="hljs-title">check_flag</span><span class="hljs-params">(LPVOID lpThreadParameter)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">sub_401DBF</span>(<span class="hljs-string">&quot;flag.txt&quot;</span>) )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">get_check_flag</span>() )                       <span class="hljs-comment">// 获取并检验flag</span><br>  &#123;<br>    <span class="hljs-built_in">MessageBoxA</span>(<br>      hWnd,<br>      <span class="hljs-string">&quot;It seems you&#x27;ve uncovered some clues, but they&#x27;re not enough to unlock the deepest secrets.&quot;</span>,<br>      <span class="hljs-string">&quot;sandtea&quot;</span>,<br>      <span class="hljs-number">0x30u</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1LL</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">MessageBoxA</span>(hWnd, <span class="hljs-string">&quot;You have found the final secret of 2048! - sandtea&quot;</span>, <span class="hljs-string">&quot;Congratulations&quot;</span>, <span class="hljs-number">0x40u</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//获取并检验flag的函数</span><br><span class="hljs-function">__int64 <span class="hljs-title">get_check_flag</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">size_t</span> length; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> flag[<span class="hljs-number">136</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-D0h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 block_num; <span class="hljs-comment">// [rsp+A8h] [rbp-48h] BYREF</span><br>  <span class="hljs-type">char</span> key[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+B0h] [rbp-40h] BYREF</span><br>  <span class="hljs-type">void</span> *Block; <span class="hljs-comment">// [rsp+D0h] [rbp-20h]</span><br>  FILE *FILE; <span class="hljs-comment">// [rsp+D8h] [rbp-18h]</span><br>  <span class="hljs-type">unsigned</span> __int64 i; <span class="hljs-comment">// [rsp+E0h] [rbp-10h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [rsp+ECh] [rbp-4h]</span><br><br>  FILE = <span class="hljs-built_in">fopen</span>(<span class="hljs-string">&quot;flag.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>);<br>  <span class="hljs-built_in">file_read</span>(FILE, <span class="hljs-string">&quot;%100s&quot;</span>, flag);<br>  <span class="hljs-built_in">fclose</span>(FILE);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(flag) != <span class="hljs-number">37</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1LL</span>;<br>  <span class="hljs-built_in">strcpy</span>(key, <span class="hljs-string">&quot;2048master2048ma&quot;</span>);<br>  length = <span class="hljs-built_in">strlen</span>(flag);<br>  Block = <span class="hljs-built_in">encrypt</span>(flag, length, key, &amp;block_num);<br>  <span class="hljs-keyword">if</span> ( Block )<br>  &#123;<br>    v8 = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0LL</span>; i &lt; block_num; ++i )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( *(Block + i) != byte_495280[i] )<br>        v8 = <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-built_in">free</span>(Block);<br>    <span class="hljs-keyword">return</span> v8;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">sub_428D00</span>(<span class="hljs-string">&quot;Encryption failed\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1LL</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//加密函数</span><br><span class="hljs-function">__int64 __fastcall <span class="hljs-title">encrypt</span><span class="hljs-params">(__int64 flag, <span class="hljs-type">unsigned</span> __int64 length, _QWORD *key, __int64 block_num)</span></span><br><span class="hljs-function"></span>&#123;<br>  __int64 v5; <span class="hljs-comment">// rdx</span><br>  _QWORD Key[<span class="hljs-number">3</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-30h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 word_num; <span class="hljs-comment">// [rsp+38h] [rbp-18h] BYREF</span><br>  _WORD *block; <span class="hljs-comment">// [rsp+40h] [rbp-10h]</span><br>  <span class="hljs-type">void</span> *mem; <span class="hljs-comment">// [rsp+48h] [rbp-8h]</span><br><br>  mem = <span class="hljs-built_in">new_mem</span>(flag, length, &amp;word_num);       <span class="hljs-comment">// 根据传入的flag申请了一块内存，word_num是申请的word个数</span><br>  <span class="hljs-keyword">if</span> ( !mem )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  v5 = key[<span class="hljs-number">1</span>];                                  <span class="hljs-comment">// 这是传入的密钥</span><br>  Key[<span class="hljs-number">0</span>] = *key;<br>  Key[<span class="hljs-number">1</span>] = v5;<br>  <span class="hljs-built_in">modifiedXXTea</span>(mem, word_num, Key);            <span class="hljs-comment">// xxtea加密</span><br>  block = <span class="hljs-built_in">make_blocks</span>(mem, word_num, block_num);<span class="hljs-comment">// 对加密后的数据进行一些转换，以便后续和给定的数据进行校验</span><br>  <span class="hljs-built_in">free</span>(mem);<br>  <span class="hljs-keyword">return</span> block;<br>&#125;<br><br><span class="hljs-comment">//申请内存的函数</span><br><span class="hljs-function">_DWORD *__fastcall <span class="hljs-title">new_mem</span><span class="hljs-params">(__int64 flag, <span class="hljs-type">unsigned</span> __int64 length, <span class="hljs-type">unsigned</span> __int64 *word_num)</span></span><br><span class="hljs-function"></span>&#123;<br>  _DWORD *mem; <span class="hljs-comment">// [rsp+28h] [rbp-18h]</span><br>  <span class="hljs-type">unsigned</span> __int64 Word_num; <span class="hljs-comment">// [rsp+30h] [rbp-10h]</span><br>  <span class="hljs-type">unsigned</span> __int64 i; <span class="hljs-comment">// [rsp+38h] [rbp-8h]</span><br><br>  Word_num = (length + <span class="hljs-number">3</span>) &gt;&gt; <span class="hljs-number">2</span>;                 <span class="hljs-comment">// 10</span><br>  mem = <span class="hljs-built_in">calloc</span>(Word_num, <span class="hljs-number">4uLL</span>);                 <span class="hljs-comment">// 10*4字节的内存空间</span><br>  <span class="hljs-keyword">if</span> ( !mem )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0LL</span>; i &lt; length; ++i )<br>    mem[i &gt;&gt; <span class="hljs-number">2</span>] |= *(flag + i) &lt;&lt; (<span class="hljs-number">8</span> * (i &amp; <span class="hljs-number">3</span>));<br><br>  *word_num = Word_num;<br>  <span class="hljs-keyword">return</span> mem;<br>&#125;<br><br><span class="hljs-comment">//魔改xxtea函数</span><br><span class="hljs-function"><span class="hljs-type">bool</span> __fastcall <span class="hljs-title">modifiedXXTea</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *block, <span class="hljs-type">int</span> word_num, __int64 key)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *p1; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *last_one1; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">bool</span> result; <span class="hljs-comment">// al</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *v6; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// [rsp+8h] [rbp-18h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [rsp+8h] [rbp-18h]</span><br>  <span class="hljs-type">int</span> round; <span class="hljs-comment">// [rsp+Ch] [rbp-14h]</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [rsp+Ch] [rbp-14h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+10h] [rbp-10h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+10h] [rbp-10h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> delta; <span class="hljs-comment">// [rsp+14h] [rbp-Ch]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> delta1; <span class="hljs-comment">// [rsp+14h] [rbp-Ch]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> last_one; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v16; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v17; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> p2; <span class="hljs-comment">// [rsp+1Ch] [rbp-4h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v19; <span class="hljs-comment">// [rsp+1Ch] [rbp-4h]</span><br>  <span class="hljs-type">int</span> v20; <span class="hljs-comment">// [rsp+38h] [rbp+18h]</span><br><br>  <span class="hljs-keyword">if</span> ( word_num &lt;= <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( word_num &lt; <span class="hljs-number">-1</span> )<br>    &#123;<br>      v20 = -word_num;<br>      v10 = <span class="hljs-number">52</span> / -word_num + <span class="hljs-number">6</span>;<br>      delta1 = <span class="hljs-number">0x3E9779B9</span> * v10;<br>      v19 = *block;<br>      <span class="hljs-keyword">do</span><br>      &#123;<br>        v8 = (delta1 &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br>        <span class="hljs-keyword">for</span> ( i = v20 - <span class="hljs-number">1</span>; i; --i )<br>        &#123;<br>          v16 = block[i - <span class="hljs-number">1</span>];<br>          v6 = &amp;block[i];<br>          *v6 -= (((<span class="hljs-number">4</span> * v19) ^ (v16 &gt;&gt; <span class="hljs-number">5</span>)) + ((v19 &gt;&gt; <span class="hljs-number">3</span>) ^ (<span class="hljs-number">16</span> * v16))) ^ ((v19 ^ delta1)<br>                                                                         + (v16 ^ *(<span class="hljs-number">4LL</span> * (v8 ^ i &amp; <span class="hljs-number">3</span>) + key)));<br>          v19 = *v6;<br>        &#125;<br>        v17 = block[v20 - <span class="hljs-number">1</span>];<br>        *block -= (((<span class="hljs-number">4</span> * v19) ^ (v17 &gt;&gt; <span class="hljs-number">5</span>)) + ((v19 &gt;&gt; <span class="hljs-number">3</span>) ^ (<span class="hljs-number">16</span> * v17))) ^ ((v19 ^ delta1) + (v17 ^ *(<span class="hljs-number">4LL</span> * v8 + key)));<br>        v19 = *block;<br>        delta1 -= <span class="hljs-number">0x3E9779B9</span>;<br>        result = --v10 != <span class="hljs-number">0</span>;<br>      &#125;<br>      <span class="hljs-keyword">while</span> ( v10 );<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    round = <span class="hljs-number">52</span> / word_num + <span class="hljs-number">6</span>;<br>    delta = <span class="hljs-number">0</span>;<br>    last_one = block[word_num - <span class="hljs-number">1</span>];<br>    <span class="hljs-keyword">do</span><br>    &#123;<br>      delta += <span class="hljs-number">0x3E9779B9</span>;<br>      v7 = (delta &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br>      <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; word_num - <span class="hljs-number">1</span> &gt; j; ++j )<br>      &#123;<br>        p2 = block[j + <span class="hljs-number">1</span>];<br>        p1 = &amp;block[j];<br>        *p1 += (((<span class="hljs-number">4</span> * p2) ^ (last_one &gt;&gt; <span class="hljs-number">5</span>)) + ((p2 &gt;&gt; <span class="hljs-number">3</span>) ^ (<span class="hljs-number">16</span> * last_one))) ^ ((p2 ^ delta)<br>                                                                               + (last_one ^ *(<span class="hljs-number">4LL</span> * (v7 ^ j &amp; <span class="hljs-number">3</span>) + key)));<br>        last_one = *p1;<br>      &#125;<br>      last_one1 = &amp;block[word_num - <span class="hljs-number">1</span>];<br>      *last_one1 += (((<span class="hljs-number">4</span> * *block) ^ (last_one &gt;&gt; <span class="hljs-number">5</span>)) + ((*block &gt;&gt; <span class="hljs-number">3</span>) ^ (<span class="hljs-number">16</span> * last_one))) ^ ((*block ^ delta)<br>                                                                                            + (last_one ^ *(<span class="hljs-number">4LL</span> * (v7 ^ j &amp; <span class="hljs-number">3</span>) + key)));<br>      last_one = *last_one1;<br>      result = --round != <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">while</span> ( round );<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-comment">//数据格式转换函数</span><br><span class="hljs-function">_WORD *__fastcall <span class="hljs-title">make_blocks</span><span class="hljs-params">(__int64 mem, <span class="hljs-type">unsigned</span> __int64 num_word, <span class="hljs-type">size_t</span> *block_num)</span></span><br><span class="hljs-function"></span>&#123;<br>  _WORD *block; <span class="hljs-comment">// [rsp+20h] [rbp-10h]</span><br>  <span class="hljs-type">unsigned</span> __int64 i; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br><br>  *block_num = <span class="hljs-number">4</span> * num_word; <br>  block = <span class="hljs-built_in">malloc</span>(*block_num);<br>  <span class="hljs-keyword">if</span> ( !block )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0LL</span>; i &lt; num_word; ++i )<br>  &#123;<br>    block[<span class="hljs-number">2</span> * i] = *(<span class="hljs-number">4</span> * i + mem);<br>    <span class="hljs-built_in">LOBYTE</span>(block[<span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>]) = <span class="hljs-built_in">BYTE2</span>(*(<span class="hljs-number">4</span> * i + mem));<br>    <span class="hljs-built_in">HIBYTE</span>(block[<span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>]) = <span class="hljs-built_in">HIBYTE</span>(*(<span class="hljs-number">4</span> * i + mem));<br>  &#125;<br>  <span class="hljs-keyword">return</span> block;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>所以要解出flag，就需要逆向这个xxtea加密。把这个任务交给AI，可以得到解密脚本：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><br><span class="hljs-comment">// 加密数据（make_blocks的输出）</span><br><span class="hljs-type">uint8_t</span> encrypted_data[<span class="hljs-number">40</span>] = &#123;<br>    <span class="hljs-number">0x35</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0xCC</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0xFF</span>,<br>    <span class="hljs-number">0x9F</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0xAE</span>,<br>    <span class="hljs-number">0xD7</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0xD9</span>,<br>    <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0x63</span><br>&#125;;<br><br><span class="hljs-comment">// 密钥</span><br><span class="hljs-type">char</span> key[<span class="hljs-number">17</span>] = <span class="hljs-string">&quot;2048master2048ma&quot;</span>;<br><br><span class="hljs-comment">// 逆make_blocks：将_WORD数组转换回DWORD数组</span><br><span class="hljs-type">uint32_t</span>* <span class="hljs-title function_">unmake_blocks</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span>* blocks, <span class="hljs-type">size_t</span> block_bytes, <span class="hljs-type">size_t</span>* num_dwords)</span> &#123;<br>    *num_dwords = block_bytes / <span class="hljs-number">4</span>;<br>    <span class="hljs-type">uint32_t</span>* dwords = (<span class="hljs-type">uint32_t</span>*)<span class="hljs-built_in">malloc</span>(*num_dwords * <span class="hljs-number">4</span>);<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; *num_dwords; i++) &#123;<br>        <span class="hljs-comment">// 将两个WORD合并为一个DWORD</span><br>        <span class="hljs-type">uint16_t</span> low_word = *(<span class="hljs-type">uint16_t</span>*)&amp;blocks[<span class="hljs-number">4</span> * i];<br>        <span class="hljs-type">uint16_t</span> high_word = *(<span class="hljs-type">uint16_t</span>*)&amp;blocks[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>];<br>        dwords[i] = (high_word &lt;&lt; <span class="hljs-number">16</span>) | low_word;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> dwords;<br>&#125;<br><br><span class="hljs-comment">// 逆modifiedXXTea解密</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">decrypt_tea</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span>* data, <span class="hljs-type">int</span> num_dwords, <span class="hljs-type">uint32_t</span>* tea_key)</span> &#123;<br>    <span class="hljs-keyword">if</span> (num_dwords &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;<br><br>    <span class="hljs-type">int</span> rounds = <span class="hljs-number">52</span> / num_dwords + <span class="hljs-number">6</span>;<br>    <span class="hljs-type">uint32_t</span> delta = <span class="hljs-number">0x3E9779B9</span> * rounds; <span class="hljs-comment">// 1050114489</span><br><br>    <span class="hljs-type">uint32_t</span> sum = delta;<br>    <span class="hljs-type">uint32_t</span> y = data[<span class="hljs-number">0</span>];<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; rounds; i++) &#123;<br>        <span class="hljs-type">uint32_t</span> e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = num_dwords - <span class="hljs-number">1</span>; j &gt; <span class="hljs-number">0</span>; j--) &#123;<br>            <span class="hljs-type">uint32_t</span> z = data[j - <span class="hljs-number">1</span>];<br>            data[j] -= (((z &gt;&gt; <span class="hljs-number">5</span>) ^ (y &lt;&lt; <span class="hljs-number">2</span>)) + ((y &gt;&gt; <span class="hljs-number">3</span>) ^ (z &lt;&lt; <span class="hljs-number">4</span>))) ^ ((sum ^ y) + (tea_key[(j ^ e) &amp; <span class="hljs-number">3</span>] ^ z));<br>            y = data[j];<br>        &#125;<br><br>        <span class="hljs-type">uint32_t</span> z = data[num_dwords - <span class="hljs-number">1</span>];<br>        data[<span class="hljs-number">0</span>] -= (((z &gt;&gt; <span class="hljs-number">5</span>) ^ (y &lt;&lt; <span class="hljs-number">2</span>)) + ((y &gt;&gt; <span class="hljs-number">3</span>) ^ (z &lt;&lt; <span class="hljs-number">4</span>))) ^ ((sum ^ y) + (tea_key[e] ^ z));<br>        y = data[<span class="hljs-number">0</span>];<br><br>        sum -= <span class="hljs-number">0x3E9779B9</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 从DWORD数组提取字符串</span><br><span class="hljs-type">char</span>* <span class="hljs-title function_">extract_string</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span>* dwords, <span class="hljs-type">size_t</span> num_dwords, <span class="hljs-type">size_t</span> original_len)</span> &#123;<br>    <span class="hljs-type">char</span>* str =(<span class="hljs-type">char</span>*) <span class="hljs-built_in">malloc</span>(original_len + <span class="hljs-number">1</span>);<br>    <span class="hljs-built_in">memset</span>(str, <span class="hljs-number">0</span>, original_len + <span class="hljs-number">1</span>);<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; original_len; i++) &#123;<br>        <span class="hljs-type">uint32_t</span> dword = dwords[i &gt;&gt; <span class="hljs-number">2</span>];<br>        str[i] = (dword &gt;&gt; (<span class="hljs-number">8</span> * (i &amp; <span class="hljs-number">3</span>))) &amp; <span class="hljs-number">0xFF</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> str;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 步骤1: 逆make_blocks</span><br>    <span class="hljs-type">size_t</span> num_dwords;<br>    <span class="hljs-type">uint32_t</span>* tea_encrypted = unmake_blocks(encrypted_data, <span class="hljs-number">40</span>, &amp;num_dwords);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;After unmake_blocks (%zu DWORDs):\n&quot;</span>, num_dwords);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; num_dwords; i++) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;0x%08X &quot;</span>, tea_encrypted[i]);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n\n&quot;</span>);<br><br>    <span class="hljs-comment">// 步骤2: 准备TEA密钥（将字符串转换为4个32位整数）</span><br>    <span class="hljs-type">uint32_t</span> tea_key[<span class="hljs-number">4</span>];<br>    <span class="hljs-built_in">memcpy</span>(tea_key, key, <span class="hljs-number">16</span>);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;TEA Key:\n&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;0x%08X &quot;</span>, tea_key[i]);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n\n&quot;</span>);<br><br>    <span class="hljs-comment">// 步骤3: 逆modifiedXXTea解密</span><br>    decrypt_tea(tea_encrypted, num_dwords, tea_key);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;After TEA decryption:\n&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; num_dwords; i++) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;0x%08X &quot;</span>, tea_encrypted[i]);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n\n&quot;</span>);<br><br>    <span class="hljs-comment">// 步骤4: 提取flag字符串（原始长度37字节）</span><br>    <span class="hljs-type">char</span>* flag = extract_string(tea_encrypted, num_dwords, <span class="hljs-number">37</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Decrypted flag: %s\n&quot;</span>, flag);<br><br>    <span class="hljs-comment">// 清理</span><br>    <span class="hljs-built_in">free</span>(tea_encrypted);<br>    <span class="hljs-built_in">free</span>(flag);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <summary type="html">Moectf2025 Reverse WriteUp</summary>
    
    
    
    <category term="WriteUp&amp;复现" scheme="https://sydzi.github.io/categories/WriteUp-%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="CTF" scheme="https://sydzi.github.io/tags/CTF/"/>
    
    <category term="WriteUp" scheme="https://sydzi.github.io/tags/WriteUp/"/>
    
    <category term="Reverse" scheme="https://sydzi.github.io/tags/Reverse/"/>
    
  </entry>
  
  <entry>
    <title>0xGame2025Week1WriteUp</title>
    <link href="https://sydzi.github.io/2025/10/10/0xGame2025Week1ReverseWriteUp/"/>
    <id>https://sydzi.github.io/2025/10/10/0xGame2025Week1ReverseWriteUp/</id>
    <published>2025-10-10T13:23:04.000Z</published>
    <updated>2026-02-15T15:23:13.801Z</updated>
    
    <content type="html"><![CDATA[<p>0xGame2025 Week1 Reverse方向全解&amp;详解</p><span id="more"></span><h2 id="EasyXor"><a href="#EasyXor" class="headerlink" title="EasyXor"></a>EasyXor</h2><ul><li><p>附件程序用IDA打开就是main函数的位置了，按F5反编译得到如下：</p><p><img src="/../images/image-20251003215402469-1760102969152-3.png" alt="反编译结果"></p><p>进行一些小小的变量名优化可以得到：</p><p><img src="/../images/image-20251003215440797-1760102969152-2.png" alt="小小的优化后"></p></li><li><p>可以看出，函数获取flag输入，然后对flag每一位进行异或，异或的值来自一个给定的字符串，要求异或后的值要等于str[i]-i。所以解密思路是，把异或关系中的Char和str[i]-i进行对调，即由Char^key[index%length] &#x3D;&#x3D; str[i]-i 得到 ( str[i]-i )^key[index%length] &#x3D;&#x3D; Char。解密脚本：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-type">char</span> str[] = &#123;<br>    <span class="hljs-number">0x42</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x27</span>,<br>    <span class="hljs-number">0x55</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x23</span>,<br>    <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span><br>    &#125;;<br>    <span class="hljs-type">char</span> key[] = <span class="hljs-string">&quot;raputa0xGame2025&quot;</span>;<br>    <span class="hljs-type">char</span> flag[<span class="hljs-number">45</span>];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">43</span>; i++) &#123;<br>        flag[i] = (str[i] - i) ^ key[i % <span class="hljs-built_in">strlen</span>(key)];<br>    &#125;<br>    flag[<span class="hljs-number">44</span>] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, flag);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h2 id="BaseUpx"><a href="#BaseUpx" class="headerlink" title="BaseUpx"></a>BaseUpx</h2><ul><li><p>题目提示有Upx壳，用DIE打开附件程序可以看出这是标准upx4.24</p><p><img src="/../images/image-20251003221920374-1760102969152-1.png" alt="DIE界面"></p></li><li><p>在Github上下载<a href="https://github.com/upx/upx/releases/tag/v4.2.4">Release UPX 4.2.4 · upx&#x2F;upx</a>，使用指令upx -d脱壳</p><p><img src="/../images/image-20251003222033233-1760102969152-7.png" alt="脱壳"></p></li><li><p>然后就可以把脱壳后的程序拿到IDA里分析，打开就是main函数了，按F5反编译：</p><p><img src="/../images/image-20251003222227627-1760102969152-5.png" alt="反编译结果"></p></li><li><p>可以看到函数对输入的enc（实际上是flag）进行了base64encode，然后和str进行比较。因此思路是拿到str，直接用<a href="https://cyberchef.org/">CyberChef</a>来进行base64解码：</p><p><img src="/../images/image-20251003222543143-1760102969152-6.png" alt="cyberchef解密"></p></li></ul><h2 id="SignIn"><a href="#SignIn" class="headerlink" title="SignIn"></a>SignIn</h2><ul><li><p>附件程序用IDA打开，直接就是main函数了，按F5反编译，提示flag在程序里</p><p><img src="/../images/image-20251003222821412-1760102969152-4.png" alt="main函数"></p></li><li><p>shift+F12查看字符串表，就可以找到flag了</p><p><img src="/../images/image-20251003222909434-1760102969152-8.png" alt="字符串表"></p></li></ul><h2 id="SignIn2"><a href="#SignIn2" class="headerlink" title="SignIn2"></a>SignIn2</h2><ul><li><p>运行附件程序可以看到一些提示：</p><p><img src="/../images/image-20251003223506054-1760102969152-9.png" alt="提示"></p><p>提示ROT47，应该是某种加密</p></li><li><p>附件程序用IDA打开，按F5反编译main函数：</p><p><img src="/../images/image-20251003223242376-1760102969152-10.png" alt="main函数"></p><p>可以看到程序里本来就有一个flag，程序拿到我们输入的数字后对flag进行了加密，然后检查加密后的flag开头几个字母是不是”0xGame”。既然提到了ROT47，就把flag的数据拿到<a href="https://cyberchef.org/">CyberChef</a>里看看能不能解密，刚好可以找到一个ROT 47 Brust Force（flag就直接复制程序里的就好了）：</p><p><img src="/../images/image-20251004143034177-1760102969153-11.png" alt="cyberchef"></p><p>当时解完没细看flag内容，复现这题来写博客的时候看到这个flag还有点怀疑对不对😂</p></li></ul><h2 id="ZZZ"><a href="#ZZZ" class="headerlink" title="ZZZ"></a>ZZZ</h2><ul><li><p>附件程序用IDA打开，直接就是main函数了，按F5反编译一下：</p><p><img src="/../images/image-20251004151114879-1760102969153-12.png" alt="main函数反编译结果"></p></li><li><p>可以看出程序拿到输入的flag后先检查了一下格式，然后截取除了4个部分，拿这4个部分建立了等式。结合题目ZZZ可以推测这是在考z3求解。题目为了保证唯一解还给了flag的sha256来验证</p></li><li><p>用z3复现一下等式，再加上sha256验证：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> hashlib<br>sha256=<span class="hljs-string">&#x27;4aba519d4666f5421488afaaf89efdcbe48e7a53f814ce5c1d82b46b55032651&#x27;</span><br>s=Solver()<br>x1=BitVec(<span class="hljs-string">&#x27;x1&#x27;</span>,<span class="hljs-number">32</span>)<br>x2=BitVec(<span class="hljs-string">&#x27;x2&#x27;</span>,<span class="hljs-number">32</span>)<br>x3=BitVec(<span class="hljs-string">&#x27;x3&#x27;</span>,<span class="hljs-number">32</span>)<br>x4=BitVec(<span class="hljs-string">&#x27;x4&#x27;</span>,<span class="hljs-number">32</span>)<br>s.add(<span class="hljs-number">3</span> * x2 + <span class="hljs-number">5</span> * x1 + <span class="hljs-number">7</span> * x4 + <span class="hljs-number">2</span> * x3 == -<span class="hljs-number">1445932505</span>)<br>s.add(<span class="hljs-number">2</span> * (<span class="hljs-number">2</span> * (<span class="hljs-number">2</span> * x2 + x3) + x1) + x4 == -<span class="hljs-number">672666814</span>)<br>s.add(<span class="hljs-number">7</span> * x2 + <span class="hljs-number">3</span> * x1 + <span class="hljs-number">5</span> * x4 + <span class="hljs-number">4</span> * x3 == <span class="hljs-number">958464147</span>)<br>s.add(((x1 ^ x2) &lt;&lt; <span class="hljs-number">6</span>) + ((x3 &gt;&gt; <span class="hljs-number">6</span>) ^ <span class="hljs-number">0x4514</span>) == <span class="hljs-number">123074281</span>)<br><br><span class="hljs-keyword">while</span> s.check() == sat:<br>    model=s.model()<br>    x1_val=model[x1].as_long()<br>    x2_val=model[x2].as_long()<br>    x3_val=model[x3].as_long()<br>    x4_val=model[x4].as_long()<br>    flag=<span class="hljs-string">f&quot;0xGame&#123;&#123;<span class="hljs-subst">&#123;x1_val:08x&#125;</span><span class="hljs-subst">&#123;x2_val:08x&#125;</span><span class="hljs-subst">&#123;x3_val:08x&#125;</span><span class="hljs-subst">&#123;x4_val:08x&#125;</span>&#125;&#125;&quot;</span><br>    <span class="hljs-keyword">if</span> hashlib.sha256(flag.encode()).hexdigest()==sha256:<span class="hljs-comment">#验证是否为正确flag</span><br>        <span class="hljs-built_in">print</span>(flag)<br>    exception=Or(x1!=x1_val,x2!=x2_val,x3!=x3_val,x4!=x4_val)<span class="hljs-comment">#排除同一解</span><br>    s.add(exception)<br></code></pre></td></tr></table></figure></li></ul><h2 id="DyDebug"><a href="#DyDebug" class="headerlink" title="DyDebug"></a>DyDebug</h2><ul><li><p>附件程序用IDA打开，直接就是main函数了，按F5看看反编译：</p><p><img src="/../images/image-20251004131520036-1760102969153-13.png" alt="main函数反编译结果"></p></li><li><p>如注释写的，程序对我们的输入没有任何操作，而是拿了flag明文来比较，所以可以直接动态调试拿到flag明文。这里需要知道一些汇编小知识：函数的返回值存放在寄存器rax里。然后开始我们的操作：</p><p>在main函数反编译界面选中解密函数decrypt_string()所在行，右键选择jump to disasm跳到汇编界面：</p><p><img src="/../images/image-20251004134158983-1760102969153-14.png" alt="jump to disasm"></p><p>光标停在的地方附近就有一个call _Z14decrypt_stringPKcy指令，后面有注释是解密函数decrypt_string()</p><p><img src="/../images/image-20251004134355375-1760102969153-15.png" alt="光标停在这里"></p><p>其实光标停在的位置的指令就是取函数返回值的操作了。函数的返回值放在rax里，而这条指令把rax mov（移动）到了[rbp-10h+decrypted_str]，看不懂没关系，只需要知道函数返回值可以通过这里的rax看到就行了。这个返回值就是解密后得到的flag明文。在光标停在的位置按F2下断点</p><p><img src="/../images/image-20251004134943597-1760102969153-16.png" alt="F2下断点"></p><p>把界面正上方的”no debugger”改选成”local windows debugger”，按旁边绿色的三角形开始调试</p><p><img src="/../images/image-20251004135012031-1760102969153-20.png" alt="local windows debugger"></p><p>这时候会弹出命令行窗口，随便输入一点东西，按回车</p><p><img src="/../images/image-20251004135050308-1760102969153-18.png" alt="随便输点东西"></p><p>可以看到IDA里程序停在了我们刚刚下断点的地方</p><p><img src="/../images/image-20251004135229299-1760102969153-17.png" alt="停在了断点位置"></p><p>把鼠标移到rax上就可以看到flag了，双击rax到flag的位置，可以把这一串数据复制给AI提取</p><p><img src="/../images/image-20251004135253094-1760102969153-19.png" alt="flag的位置"></p></li></ul>]]></content>
    
    
    <summary type="html">0xGame2025 Week1 Reverse方向全解&amp;详解</summary>
    
    
    
    <category term="WriteUp&amp;复现" scheme="https://sydzi.github.io/categories/WriteUp-%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="CTF" scheme="https://sydzi.github.io/tags/CTF/"/>
    
    <category term="WriteUp" scheme="https://sydzi.github.io/tags/WriteUp/"/>
    
    <category term="Reverse" scheme="https://sydzi.github.io/tags/Reverse/"/>
    
  </entry>
  
  <entry>
    <title>Day17:python逆向</title>
    <link href="https://sydzi.github.io/2025/10/05/Day17-python%E9%80%86%E5%90%91/"/>
    <id>https://sydzi.github.io/2025/10/05/Day17-python%E9%80%86%E5%90%91/</id>
    <published>2025-10-05T09:09:34.000Z</published>
    <updated>2026-02-15T15:23:13.839Z</updated>
    
    <content type="html"><![CDATA[<p>pyc逆向，python可执行文件逆向</p><span id="more"></span><h2 id="pyc文件"><a href="#pyc文件" class="headerlink" title="pyc文件"></a>pyc文件</h2><ul><li>pyc文件是py文件编译过程中产生的中间文件，是一种二进制文件。pyc文件可以由python虚拟机直接执行。不同版本的python编译出来的pyc文件是不同的</li></ul><h3 id="pyc文件结构"><a href="#pyc文件结构" class="headerlink" title="pyc文件结构"></a>pyc文件结构</h3><ul><li><p>一个pyc文件由以下几个部分组成：</p><p><img src="/../images/image-20251005201501358.png" alt="pyc文件格式(图片截取自CTF wiki)"></p><p>其中CodeObject是经过序列化处理的python源码的二进制码</p></li></ul><h3 id="pyc字节码"><a href="#pyc字节码" class="headerlink" title="pyc字节码"></a>pyc字节码</h3><ul><li><p>pyc文件是二进制文件，因此也可以进行反汇编。pyc文件有专门的汇编代码，就像java有smali汇编一样。</p></li><li><p>下面是一个pyc文件的反汇编代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">原代码行号|指令的偏移|指令符号|指令参数（索引值）|参数实际值     <br>  0           0 RESUME                   0<br><br>  1           2 LOAD_CONST               0 (&lt;code object add at 0x00000186246D3770, file &quot;test.py&quot;, line 1&gt;)<br>              4 MAKE_FUNCTION            0<br>              6 STORE_NAME               0 (add)//把add函数存入函数表，给索引值0<br><br>  3           8 PUSH_NULL<br>             10 LOAD_NAME                1 (print)//加载函数表索引为1的函数print<br>             12 LOAD_CONST               1 (&#x27;hello python&#x27;)//加载常量表索引为1的&quot;hello python&quot;<br>             14 CALL                     1//call索引为1的函数print<br>             22 POP_TOP<br><br>  4          24 PUSH_NULL<br>             26 LOAD_NAME                1 (print)<br>             28 PUSH_NULL<br>             30 LOAD_NAME                0 (add)<br>             32 LOAD_CONST               2 (1)<br>             34 LOAD_CONST               3 (2)<br>             36 CALL                     2<br>             44 CALL                     1<br>             52 POP_TOP<br>             54 RETURN_CONST             4 (None)<br><br>Disassembly of &lt;code object add at 0x00000186246D3770, file &quot;test.py&quot;, line 1&gt;:<br>  1           0 RESUME                   0<br><br>  2           2 LOAD_FAST                0 (a)<br>              4 LOAD_FAST                1 (b)<br>              6 BINARY_OP                0 (+)<br>             10 RETURN_VALUE<br><br></code></pre></td></tr></table></figure><p>对上面的一些指令进行解释：</p><ul><li>LOAD_CONST用于加载常量，后面跟着的数字是常量在常量表中的索引</li><li>LOAD_NAME用于加载函数，后面跟着的数字是函数在函数表中的索引</li><li>LOAD_FAST用于加载局部变量（如函数定义时候的参数或者内部变量）</li><li>可以注意到LOAD_NAME总是先于LOAD_CONST的，即函数比参数先一步加载</li><li>python虚拟机是基于栈的，所以可以看到POP等字眼，LOAD系列操作实际上是入栈操作</li></ul></li></ul><h3 id="pyc文件逆向"><a href="#pyc文件逆向" class="headerlink" title="pyc文件逆向"></a>pyc文件逆向</h3><ul><li>未经过混淆的pyc文件，可以直接通过在线工具（如：<a href="https://www.lddgo.net/string/pyc-compile-decompile">在线Python pyc文件编译与反编译</a>）或者uncompyle6、decompyle3（均可通过pip install安装）转成python代码</li><li>pyc文件的混淆，就类似花指令，通过在汇编层面插入垃圾指令干扰静态分析。解决办法就是修改二进制文件，把垃圾指令的二进制码给删除。可以看看这篇：<a href="https://zhuanlan.zhihu.com/p/145811103"> Python代码保护 | pyc 混淆从入门到工具实现 - 知乎</a></li></ul><h2 id="python可执行文件"><a href="#python可执行文件" class="headerlink" title="python可执行文件"></a>python可执行文件</h2><ul><li><p>python文件可以被打包成可执行文件，默认图标长这样：</p><p><img src="/../images/image-20251005213749587.png" alt="图标"></p></li><li><p>对于此类问题，先使用<a href="https://github.com/extremecoders-re/pyinstxtractor">pyinstxtractor</a>解包程序（这里拿一个不知道哪里来的pythonexe文件举例）：</p><p><img src="/../images/image-20251005214956424.png" alt="解包"></p><p>pyinstxtractor会把可执行文件解包到带后缀extracted的一个文件夹里，除此之外可以看到，程序会给出可能的入口文件，以及可执行文件的python版本，然后就可以分析这些pyc文件了</p></li><li><p>python文件被打包的时候还可以指定加密参数，解密的时候根据打包的pyinstaller版本可以分为两种，大于4.0的和小于4.0的，可以使用下面的脚本解密：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python">//大于<span class="hljs-number">4.0</span>版本<br><span class="hljs-keyword">import</span> tinyaes<br><span class="hljs-keyword">import</span> zlib<br><br>CRYPT_BLOCK_SIZE=<span class="hljs-number">16</span><br><br>key = butes(<span class="hljs-string">&#x27;here_be_your_key&#x27;</span>,<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br>inf=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;here_be_your_file_name&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>)<br>outf=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;here_be_your_output_file&#x27;</span>,<span class="hljs-string">&#x27;wb&#x27;</span>)<br><br>iv=inf.read(CRYPT_BLOCK_SIZE)<br><br>cipher=tinyaes.AES(key,iv)<br><br>plaintext=zlib.decompress(cipher.CTR_xcrypt_buffer(inf.read()))<br><br>outf.write(<span class="hljs-string">b&#x27;\x55\x0d\x0d\x0a\0\0\0\0\0\0\0\0\0\0\0\0&#x27;</span>)<span class="hljs-comment">#here be your magic number from pyfile in the same dir,16bytes</span><br><br>outf.write(plaintext)<br><br>inf.close()<br>outf.close()<br><br>//小于<span class="hljs-number">4.0</span>版本<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">import</span> zlib<br><br>CRYPT_BLOCK_SIZE=<span class="hljs-number">16</span><br><br>key=<span class="hljs-string">b&#x27;here_be_your_key&#x27;</span><br><br>inf=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;here_be_your_cryptedfile_name&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>)<br>outf=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;here_be_your_output_file_name&#x27;</span>,<span class="hljs-string">&#x27;wb&#x27;</span>)<br><br>iv=inf.read(CRYPT_BLOCK_SIZE)<br><br>cipher-AES.new(key,AES.MODE_CFB,iv)<br><br>plaintext=zlib.decompress(cipher,hecrypt(inf.read()))<br> <br>outf.write(<span class="hljs-string">&#x27;here_be_your_magicnumber&#x27;</span>)<span class="hljs-comment">#8bytes</span><br><br>outf.write(plaintext)<br><br>inf.close()<br>outf.close()<br></code></pre></td></tr></table></figure><p>代码里面的key可以找可疑的pyc文件转成python代码查看，而版本可以通过查看pyimod01_archive.pyc导入的加密库来识别（上面两个版本的脚本导入的加密库分别是tinyaes和AES，是不一样的）</p></li></ul>]]></content>
    
    
    <summary type="html">pyc逆向，python可执行文件逆向</summary>
    
    
    
    <category term="Reverse学习笔记" scheme="https://sydzi.github.io/categories/Reverse%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="CTF" scheme="https://sydzi.github.io/tags/CTF/"/>
    
    <category term="Reverse" scheme="https://sydzi.github.io/tags/Reverse/"/>
    
  </entry>
  
  <entry>
    <title>week31-week34</title>
    <link href="https://sydzi.github.io/2025/10/05/week31-week34/"/>
    <id>https://sydzi.github.io/2025/10/05/week31-week34/</id>
    <published>2025-10-05T03:43:33.000Z</published>
    <updated>2026-02-15T15:23:13.868Z</updated>
    
    <content type="html"><![CDATA[<p>2025年10月篇</p><span id="more"></span><h2 id="week31-2025-9-29-2025-10-5"><a href="#week31-2025-9-29-2025-10-5" class="headerlink" title="week31 (2025.9.29-2025.10.5)"></a>week31 (2025.9.29-2025.10.5)</h2><ul><li>这周碰上国庆假期，趁着假期狠狠研究moectf的upx_revenge。花了两天时间琢磨出了.rsrc段应该有问题（之前不知道哪里找的工具给修复到程序能运行但是闪退了，后面拿正常加壳程序对比一下不同的地方在.rsrc段），然后把.rsrc段的ResourceDirectoryTable给修复的差不多了，剩一个Data一直对不上。没招了去找出题人交流，结果发现是upx特征段的问题🫠一个月了终于解出这道题了😭太好了，终于是ak过的人了😭</li><li>0xGame2025也是开打了，靠新生赛攒经验这一块(</li><li>想着接下来朝逆向开发这一块学学，发现这一类笔记应该归为开发而不是逆向🤔所以又开了一个新分类。</li><li>哈基米的，老是感觉自己懂得太少了，但是又不知道从哪里开始学这些知识😭</li></ul><h2 id="week32-2025-10-6-2025-10-12"><a href="#week32-2025-10-6-2025-10-12" class="headerlink" title="week32 (2025.10.6-2025.10.12)"></a>week32 (2025.10.6-2025.10.12)</h2><ul><li>这周好像没什么可以写的🫥一半放假一半上课的，有点割裂感</li><li>0xGameweek1和Moectf的WriteUP也是放上了。这周主要在做0xGame还有?CTF的题，周末有个羊城杯可以打，但是国庆玩过头了没报上名🫥还有个领航杯来着，这个截止的更早，9.29截止的，没注意看时间也错过了🫠</li><li>好想莫名其妙的哈几下气🫥</li></ul><h2 id="week33-2025-10-13-2025-10-19"><a href="#week33-2025-10-13-2025-10-19" class="headerlink" title="week33 (2025.10.13-2025.10.19)"></a>week33 (2025.10.13-2025.10.19)</h2><ul><li>这周还是主要做0xGame和?CTF的题。目前两个比赛week1week2的题目是都做出来了，但是借用了不属于自己的力量(</li><li>加密算法逆向和脚本这块还是得练啊🫠</li><li>周末打了强网杯，拼尽全力无法战胜，只做出了一道Re简单题，脚本还是AI梭的🫠</li></ul><h2 id="week34-2025-10-20-2025-10-26"><a href="#week34-2025-10-20-2025-10-26" class="headerlink" title="week34 (2025.10.20-2025.10.26)"></a>week34 (2025.10.20-2025.10.26)</h2><ul><li>这周掉状态了。0xGameweek3上难度了，差点没做完（Calamaity_Fortne因为数据提取错误没及时解出来😭），week4更是有点魔鬼（题目都好抽象</li><li>?CTFweek3开始没打了，节奏有点乱了，WP没有及时写积了好多（0xGameweek3和?CTFweek1、2），加上赛题难度开始上来了，所以实在忙不过来，更别说还有学业</li><li>😭😭🫠🫠🫥🫥</li></ul>]]></content>
    
    
    <summary type="html">2025年十月4篇周记</summary>
    
    
    
    <category term="周记" scheme="https://sydzi.github.io/categories/%E5%91%A8%E8%AE%B0/"/>
    
    
    <category term="周记" scheme="https://sydzi.github.io/tags/%E5%91%A8%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>湾区杯初赛WriteUp&amp;复现</title>
    <link href="https://sydzi.github.io/2025/10/03/%E6%B9%BE%E5%8C%BA%E6%9D%AF%E5%88%9D%E8%B5%9BWriteUp&amp;%E5%A4%8D%E7%8E%B0/"/>
    <id>https://sydzi.github.io/2025/10/03/%E6%B9%BE%E5%8C%BA%E6%9D%AF%E5%88%9D%E8%B5%9BWriteUp&amp;%E5%A4%8D%E7%8E%B0/</id>
    <published>2025-10-03T06:31:30.000Z</published>
    <updated>2026-02-15T15:23:13.912Z</updated>
    
    <content type="html"><![CDATA[<p>和X2c的nixware、Ky4niT3师傅参加了线上初赛，但是寄了。第一次组队参赛，还是太菜了。Re方向解了一道，然后和师傅们拼凑出了一道。基本就是签到题靠AI，难题没思路，见识还是太少了</p><span id="more"></span><h2 id="WriteUp"><a href="#WriteUp" class="headerlink" title="WriteUp"></a>WriteUp</h2><h3 id="hardtest"><a href="#hardtest" class="headerlink" title="hardtest"></a>hardtest</h3><ul><li><p>附件程序用IDA打开，shift+F12在字符串表通过关键字“flag:”可以找到main函数位置</p><p><img src="/../images/image-20251003142543591.png" alt="字符串表"></p></li><li><p>以下是优化后的main函数：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">char</span> **a2, <span class="hljs-type">char</span> **a3)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> seed; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">unsigned</span> __int64 scale1; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">void</span> *temp1; <span class="hljs-comment">// rsp</span><br>  <span class="hljs-type">unsigned</span> __int64 scale2; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">void</span> *temp2; <span class="hljs-comment">// rsp</span><br>  <span class="hljs-type">char</span> temp; <span class="hljs-comment">// al</span><br>  _QWORD buf[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+8h] [rbp-F0h] BYREF</span><br>  __int64 i_2; <span class="hljs-comment">// [rsp+18h] [rbp-E0h]</span><br>  __int64 v12; <span class="hljs-comment">// [rsp+20h] [rbp-D8h]</span><br>  <span class="hljs-type">char</span> input; <span class="hljs-comment">// [rsp+29h] [rbp-CFh] BYREF</span><br>  <span class="hljs-type">char</span> judge; <span class="hljs-comment">// [rsp+2Ah] [rbp-CEh]</span><br>  <span class="hljs-type">char</span> randNum; <span class="hljs-comment">// [rsp+2Bh] [rbp-CDh]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+2Ch] [rbp-CCh]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+30h] [rbp-C8h]</span><br>  <span class="hljs-type">int</span> length; <span class="hljs-comment">// [rsp+34h] [rbp-C4h]</span><br>  __int64 v19; <span class="hljs-comment">// [rsp+38h] [rbp-C0h]</span><br>  __int64 Buf; <span class="hljs-comment">// [rsp+40h] [rbp-B8h]</span><br>  __int64 v21; <span class="hljs-comment">// [rsp+48h] [rbp-B0h]</span><br>  _QWORD *Enc; <span class="hljs-comment">// [rsp+50h] [rbp-A8h]</span><br>  <span class="hljs-type">char</span> flag[<span class="hljs-number">104</span>]; <span class="hljs-comment">// [rsp+58h] [rbp-A0h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 v24; <span class="hljs-comment">// [rsp+C0h] [rbp-38h]</span><br><br>  v24 = __readfsqword(<span class="hljs-number">0x28u</span>);<br>  <span class="hljs-built_in">setbuf</span>(stdin, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-built_in">setbuf</span>(stdout, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-built_in">setbuf</span>(stderr, <span class="hljs-number">0LL</span>);<br>  seed = <span class="hljs-built_in">time</span>(<span class="hljs-number">0LL</span>);<br>  <span class="hljs-built_in">srand</span>(seed);<br>  randNum = <span class="hljs-built_in">rand</span>() % <span class="hljs-number">255</span> + <span class="hljs-number">1</span>;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;input your number(1-255): &quot;</span>);<br>  <span class="hljs-keyword">if</span> ( __isoc99_scanf(<span class="hljs-string">&quot;%d&quot;</span>, &amp;input) == <span class="hljs-number">1</span> &amp;&amp; randNum == input )<br>  &#123;<br>    <span class="hljs-keyword">while</span> ( <span class="hljs-built_in">getchar</span>() != <span class="hljs-number">10</span> )<br>      ;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;flag: &quot;</span>);<br>    <span class="hljs-built_in">fgets</span>(flag, <span class="hljs-number">100</span>, stdin);                    <span class="hljs-comment">// 获取flag输入</span><br>    flag[<span class="hljs-built_in">strcspn</span>(flag, <span class="hljs-string">&quot;\n&quot;</span>)] = <span class="hljs-number">0</span>;<br>    length = <span class="hljs-built_in">strlen</span>(flag);<br>    v19 = length - <span class="hljs-number">1LL</span>;<br>    i_2 = length;<br>    v12 = <span class="hljs-number">0LL</span>;<br>    buf[<span class="hljs-number">0</span>] = length;<br>    buf[<span class="hljs-number">1</span>] = <span class="hljs-number">0LL</span>;<br>    scale1 = <span class="hljs-number">16</span> * ((length + <span class="hljs-number">15LL</span>) / <span class="hljs-number">0x10uLL</span>);  <span class="hljs-comment">// 在动态分配栈上的内存</span><br>    <span class="hljs-keyword">while</span> ( buf != (buf - (scale1 &amp; <span class="hljs-number">0xFFFFFFFFFFFFF000LL</span>)) )<br>      ;<br>    temp1 = <span class="hljs-built_in">alloca</span>(scale1 &amp; <span class="hljs-number">0xFFF</span>);<br>    <span class="hljs-keyword">if</span> ( (scale1 &amp; <span class="hljs-number">0xFFF</span>) != <span class="hljs-number">0</span> )<br>      *(&amp;buf[<span class="hljs-number">-1</span>] + (scale1 &amp; <span class="hljs-number">0xFFF</span>)) = *(&amp;buf[<span class="hljs-number">-1</span>] + (scale1 &amp; <span class="hljs-number">0xFFF</span>));<br>    Buf = buf;                                  <span class="hljs-comment">// Buf指向分配的内存</span><br>    <span class="hljs-built_in">encrypt1</span>(flag, buf);                        <span class="hljs-comment">// 对flag进行加密，加密结果实际上由Buf记录，buf是一个通用的缓存空间</span><br>    v21 = length - <span class="hljs-number">1LL</span>;<br>    scale2 = <span class="hljs-number">16</span> * ((length + <span class="hljs-number">15LL</span>) / <span class="hljs-number">0x10uLL</span>);  <span class="hljs-comment">// 再次动态分配栈上的内存</span><br>    <span class="hljs-keyword">while</span> ( buf != (buf - (scale2 &amp; <span class="hljs-number">0xFFFFFFFFFFFFF000LL</span>)) )<br>      ;<br>    temp2 = <span class="hljs-built_in">alloca</span>(scale2 &amp; <span class="hljs-number">0xFFF</span>);<br>    <span class="hljs-keyword">if</span> ( (scale2 &amp; <span class="hljs-number">0xFFF</span>) != <span class="hljs-number">0</span> )<br>      *(&amp;buf[<span class="hljs-number">-1</span>] + (scale2 &amp; <span class="hljs-number">0xFFF</span>)) = *(&amp;buf[<span class="hljs-number">-1</span>] + (scale2 &amp; <span class="hljs-number">0xFFF</span>));<br>    Enc = buf;                                  <span class="hljs-comment">// Enc指向分配的内存</span><br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; length; ++i )<br>    &#123;<br>      temp = <span class="hljs-built_in">encrypt2</span>(*(Buf + i));              <span class="hljs-comment">// 对上一轮加密的结果再进行一次加密，加密结果由Enc记录</span><br>      *(Enc + i) = temp;<br>    &#125;<br>    judge = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt; length; ++j )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( *(Enc + j) != byte_2120[j] )         <span class="hljs-comment">// 判断加密结果是否正确</span><br>      &#123;<br>        judge = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">break</span>;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( judge )<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;right&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;error&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1LL</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-function">__int64 __fastcall <span class="hljs-title">encrypt1</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *flag, __int64 buf)</span></span><br><span class="hljs-function"></span>&#123;<br>  __int64 count; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+14h] [rbp-1Ch]</span><br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> length; <span class="hljs-comment">// [rsp+18h] [rbp-18h]</span><br><br>  length = <span class="hljs-built_in">strlen</span>(flag);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; ; ++i )<br>  &#123;<br>    count = i;<br>    <span class="hljs-keyword">if</span> ( i &gt;= length )<br>      <span class="hljs-keyword">break</span>;<br>    *(i + buf) = <span class="hljs-built_in">rol</span>(flag[i], (i % <span class="hljs-number">7</span>) + <span class="hljs-number">1</span>);     <span class="hljs-comment">// return (flag[i] &lt;&lt; ((i%7)+1)) | (flag[i] &gt;&gt; (8 - ((i%7)+1)))</span><br>  &#125;<br>  <span class="hljs-keyword">return</span> count;<br>&#125;<br><br><span class="hljs-function">__int64 __fastcall <span class="hljs-title">encrypt2</span><span class="hljs-params">(<span class="hljs-type">char</span> Buf_i)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">unsigned</span> __int8 v1; <span class="hljs-comment">// al</span><br>  <span class="hljs-type">unsigned</span> __int8 v3; <span class="hljs-comment">// [rsp+15h] [rbp-3h]</span><br><br>  v1 = <span class="hljs-built_in">rol</span>(Buf_i ^ <span class="hljs-number">0x5Au</span>, <span class="hljs-number">3</span>);                   <span class="hljs-comment">// return (a1^0x5Au &lt;&lt; 3) | (a1^0x5Au &gt;&gt; (8 - 3));</span><br>  v3 = <span class="hljs-built_in">sub_1313</span>((<span class="hljs-number">16</span> * ((<span class="hljs-number">3</span> * (v1 &gt;&gt; <span class="hljs-number">4</span>)) &amp; <span class="hljs-number">0xF</span>)) | (<span class="hljs-number">5</span> * (v1 &amp; <span class="hljs-number">0xF</span>)) &amp; <span class="hljs-number">0xFu</span>);<span class="hljs-comment">// AI说是模幂运算函数，计算a1^(255) mod 257</span><br>  <span class="hljs-keyword">return</span> byte_2020[<span class="hljs-built_in">ror</span>(v3, <span class="hljs-number">2</span>)];                 <span class="hljs-comment">// return (v3 &gt;&gt; 2) | (v3 &lt;&lt; (8 - 2));此处建立了映射关系</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>笔者加解密这一块太菜了，没有数学头脑，只能依靠AI解密了（因为涉及数论，笔者还没学过）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">rol</span>(<span class="hljs-params">b, n</span>):<br>    n %= <span class="hljs-number">8</span><br>    <span class="hljs-keyword">return</span> ((b &lt;&lt; n) | (b &gt;&gt; (<span class="hljs-number">8</span> - n))) &amp; <span class="hljs-number">0xFF</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ror</span>(<span class="hljs-params">b, n</span>):<br>    n %= <span class="hljs-number">8</span><br>    <span class="hljs-keyword">return</span> ((b &gt;&gt; n) | (b &lt;&lt; (<span class="hljs-number">8</span> - n))) &amp; <span class="hljs-number">0xFF</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">mod_inv</span>(<span class="hljs-params">a, mod=<span class="hljs-number">257</span></span>):<br>    <span class="hljs-comment"># 计算a在模257下的逆元，使用费马小定理</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">pow</span>(a, <span class="hljs-number">255</span>, mod)<br><br>byte_2020 = [<br>    <span class="hljs-number">0x63</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0x76</span>,<br>    <span class="hljs-number">0xCA</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0xFA</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0xAD</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0xC0</span>,<br>    <span class="hljs-number">0xB7</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0xCC</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x15</span>,<br>    <span class="hljs-number">0x04</span>, <span class="hljs-number">0xC7</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0x75</span>,<br>    <span class="hljs-number">0x09</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x3B</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0x84</span>,<br>    <span class="hljs-number">0x53</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0xCF</span>,<br>    <span class="hljs-number">0xD0</span>, <span class="hljs-number">0xEF</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0xA8</span>,<br>    <span class="hljs-number">0x51</span>, <span class="hljs-number">0xA3</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xF3</span>, <span class="hljs-number">0xD2</span>,<br>    <span class="hljs-number">0xCD</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x73</span>,<br>    <span class="hljs-number">0x60</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0xDB</span>,<br>    <span class="hljs-number">0xE0</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0xD3</span>, <span class="hljs-number">0xAC</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0x79</span>,<br>    <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0xAE</span>, <span class="hljs-number">0x08</span>,<br>    <span class="hljs-number">0xBA</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0xC6</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x4B</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x8A</span>,<br>    <span class="hljs-number">0x70</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0xB5</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x9E</span>,<br>    <span class="hljs-number">0xE1</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0xE9</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0xDF</span>,<br>    <span class="hljs-number">0x8C</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0x16</span><br>]<br><br><span class="hljs-comment"># 构建反向映射</span><br>rev_2020 = &#123;&#125;<br><span class="hljs-keyword">for</span> idx, val <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(byte_2020):<br>    rev_2020[val] = idx<br><br>enc_data = [<br>    <span class="hljs-number">0x97</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0xDA</span>,<br>    <span class="hljs-number">0x43</span>, <span class="hljs-number">0xCD</span>, <span class="hljs-number">0xD3</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0xCD</span>, <span class="hljs-number">0x71</span>,<br>    <span class="hljs-number">0xBD</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x1A</span><br>]<br><br><span class="hljs-comment"># 逆向encrypt2</span><br>enc1_out = []<br><span class="hljs-keyword">for</span> i, c <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(enc_data):<br>    idx = rev_2020[c]  <span class="hljs-comment"># 得到索引（即v3循环右移2位后的值）</span><br>    v3 = rol(idx, <span class="hljs-number">2</span>)   <span class="hljs-comment"># 循环左移2位得到v3（原循环右移2位的逆）</span><br>    <span class="hljs-comment"># 如果v3为0？但原代码中a1不为0才计算，这里假设v3不为0</span><br>    <span class="hljs-keyword">if</span> v3 == <span class="hljs-number">0</span>:<br>        x = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">else</span>:<br>        x = mod_inv(v3, <span class="hljs-number">257</span>)<br>    A = (x &gt;&gt; <span class="hljs-number">4</span>) &amp; <span class="hljs-number">0xF</span><br>    B = x &amp; <span class="hljs-number">0xF</span><br>    high = (<span class="hljs-number">11</span> * A) &amp; <span class="hljs-number">0xF</span><br>    low = (<span class="hljs-number">13</span> * B) &amp; <span class="hljs-number">0xF</span><br>    v1 = (high &lt;&lt; <span class="hljs-number">4</span>) | low<br>    tmp = ror(v1, <span class="hljs-number">3</span>)  <span class="hljs-comment"># 循环右移3位（原循环左移3位的逆）</span><br>    enc1_out.append(tmp ^ <span class="hljs-number">0x5A</span>)<br><br><span class="hljs-comment"># 逆向encrypt1</span><br>flag = []<br><span class="hljs-keyword">for</span> i, c <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(enc1_out):<br>    n = (i % <span class="hljs-number">7</span>) + <span class="hljs-number">1</span><br>    flag_char = ror(c, n)  <span class="hljs-comment"># 循环右移n位（原循环左移n位的逆）</span><br>    flag.append(flag_char)<br><br><span class="hljs-comment"># 转换为字符串</span><br>flag_str = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(b) <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> flag)<br><span class="hljs-built_in">print</span>(flag_str)<br></code></pre></td></tr></table></figure></li></ul><h3 id="minigame"><a href="#minigame" class="headerlink" title="minigame"></a>minigame</h3><ul><li><p>微信小程序逆向，第一次遇到这个类型的题</p></li><li><p>用<a href="https://github.com/biggerstar/wedecode">wedecode</a>解包附件，输出结果在wedecode-main&#x2F;OUTPUT&#x2F;default里</p><p><img src="/../images/image-20251003175458209.png" alt="解包结果"></p><p>没有这方面的经验，让AI分析项目，发现utils&#x2F;validator.wasm里有检验逻辑。wasm是一种二进制文件，可以转成wat阅读（类似汇编）。使用在线工具<a href="https://webassembly.github.io/wabt/demo/wasm2wat/">wasm2wat demo</a>把wasm转成wat:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs wat">(module<br>  (type $t0 (func (param i32) (result i32)))<br>  (type $t1 (func))<br>  (func $c (export &quot;c&quot;) (type $t0) (param $p0 i32) (result i32)<br>    (local $l1 i32) (local $l2 i32) (local $l3 i32) (local $l4 i32)<br>    (if $I6<br>      (i32.ne<br>        (block $B0 (result i32)<br>          (block $B1<br>            (block $B2<br>              (br_if $B2<br>                (i32.eqz<br>                  (i32.and<br>                    (local.tee $l3<br>                      (local.get $p0))<br>                    (i32.const 3))))<br>              (drop<br>                (br_if $B0<br>                  (i32.const 0)<br>                  (i32.eqz<br>                    (i32.load8_u<br>                      (local.get $p0)))))<br>              (loop $L3<br>                (br_if $B2<br>                  (i32.eqz<br>                    (i32.and<br>                      (local.tee $p0<br>                        (i32.add<br>                          (local.get $p0)<br>                          (i32.const 1)))<br>                      (i32.const 3))))<br>                (br_if $L3<br>                  (i32.load8_u<br>                    (local.get $p0))))<br>              (br $B1))<br>            (loop $L4<br>              (local.set $p0<br>                (i32.add<br>                  (local.tee $l1<br>                    (local.get $p0))<br>                  (i32.const 4)))<br>              (br_if $L4<br>                (i32.eq<br>                  (i32.and<br>                    (i32.or<br>                      (i32.sub<br>                        (i32.const 16843008)<br>                        (local.tee $l4<br>                          (i32.load<br>                            (local.get $l1))))<br>                      (local.get $l4))<br>                    (i32.const -2139062144))<br>                  (i32.const -2139062144))))<br>            (loop $L5<br>              (local.set $l1<br>                (i32.add<br>                  (local.tee $p0<br>                    (local.get $l1))<br>                  (i32.const 1)))<br>              (br_if $L5<br>                (i32.load8_u<br>                  (local.get $p0)))))<br>          (i32.sub<br>            (local.get $p0)<br>            (local.get $l3)))<br>        (i32.const 38))<br>      (then<br>        (return<br>          (i32.const 0))))<br>    (loop $L7<br>      (block $B8<br>        (local.set $l1<br>          (i32.eq<br>            (local.tee $p0<br>              (i32.xor<br>                (i32.load8_u offset=1024<br>                  (local.get $l2))<br>                (i32.load8_s<br>                  (i32.add<br>                    (local.get $l2)<br>                    (local.get $l3)))))<br>            (i32.const 153)))<br>        (br_if $B8<br>          (i32.ne<br>            (local.get $p0)<br>            (i32.const 153)))<br>        (br_if $L7<br>          (i32.ne<br>            (local.tee $l2<br>              (i32.add<br>                (local.get $l2)<br>                (i32.const 1)))<br>            (i32.const 38)))))<br>    (local.get $l1))<br>  (func $b (export &quot;b&quot;) (type $t1))<br>  (memory $a (export &quot;a&quot;) 258 258)<br>  (data $d0 (i32.const 1024) &quot;\ff\f5\f8\fe\e2\ff\f8\fc\a9\fb\ab\ae\fa\ad\ac\a8\fa\ae\ab\a1\a1\af\ae\f8\ac\af\ae\fc\a1\fa\a8\fb\fb\ad\fc\ac\aa\e4&quot;))<br><br></code></pre></td></tr></table></figure></li><li><p>由AI分析知，此处主要是把输入的内容与密文异或，异或的结果要等于153。等价于将输入的内容和153异或要等于密文。解密就是拿153异或密文。exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">enc = [<br>    <span class="hljs-number">0xff</span>, <span class="hljs-number">0xf5</span>, <span class="hljs-number">0xf8</span>, <span class="hljs-number">0xfe</span>, <span class="hljs-number">0xe2</span>, <span class="hljs-number">0xff</span>, <span class="hljs-number">0xf8</span>, <span class="hljs-number">0xfc</span>, <span class="hljs-number">0xa9</span>, <span class="hljs-number">0xfb</span>,<br>    <span class="hljs-number">0xab</span>, <span class="hljs-number">0xae</span>, <span class="hljs-number">0xfa</span>, <span class="hljs-number">0xad</span>, <span class="hljs-number">0xac</span>, <span class="hljs-number">0xa8</span>, <span class="hljs-number">0xfa</span>, <span class="hljs-number">0xae</span>, <span class="hljs-number">0xab</span>, <span class="hljs-number">0xa1</span>,<br>    <span class="hljs-number">0xa1</span>, <span class="hljs-number">0xaf</span>, <span class="hljs-number">0xae</span>, <span class="hljs-number">0xf8</span>, <span class="hljs-number">0xac</span>, <span class="hljs-number">0xaf</span>, <span class="hljs-number">0xae</span>, <span class="hljs-number">0xfc</span>, <span class="hljs-number">0xa1</span>, <span class="hljs-number">0xfa</span>,<br>    <span class="hljs-number">0xa8</span>, <span class="hljs-number">0xfb</span>, <span class="hljs-number">0xfb</span>, <span class="hljs-number">0xad</span>, <span class="hljs-number">0xfc</span>, <span class="hljs-number">0xac</span>, <span class="hljs-number">0xaa</span>, <span class="hljs-number">0xe4</span><br>]<br><br>flag = <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">chr</span>(data ^ <span class="hljs-number">153</span>) <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> enc])<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure></li></ul><h2 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h2><h3 id="strangapp"><a href="#strangapp" class="headerlink" title="strangapp"></a>strangapp</h3><ul><li><p>apk用JEB打开会发现MainActivity全是nop:</p><p><img src="/../images/image-20251105151416089.png" alt="MainActivity"></p></li><li><p>拖进GDA里看一下，会发现apk加了壳</p><p><img src="/../images/image-20251105150944165.png" alt="GDA分析"></p><p>所以第一步先脱壳</p></li><li><p>没辙了，题目环境卡的好死，配了一下午环境没配出能运行apk的，改天再试😡</p></li></ul>]]></content>
    
    
    <summary type="html">2025“湾区杯”网络安全大赛初赛Re方向WriteUp、复现</summary>
    
    
    
    <category term="WriteUp&amp;复现" scheme="https://sydzi.github.io/categories/WriteUp-%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="CTF" scheme="https://sydzi.github.io/tags/CTF/"/>
    
    <category term="WriteUp" scheme="https://sydzi.github.io/tags/WriteUp/"/>
    
    <category term="Reverse" scheme="https://sydzi.github.io/tags/Reverse/"/>
    
    <category term="复现" scheme="https://sydzi.github.io/tags/%E5%A4%8D%E7%8E%B0/"/>
    
  </entry>
  
  <entry>
    <title>week27-week30</title>
    <link href="https://sydzi.github.io/2025/09/08/week27-week30/"/>
    <id>https://sydzi.github.io/2025/09/08/week27-week30/</id>
    <published>2025-09-08T11:42:15.000Z</published>
    <updated>2026-02-15T15:23:13.867Z</updated>
    
    <content type="html"><![CDATA[<p>2025年9月篇</p><span id="more"></span><h2 id="week27-2025-9-1-2025-9-7"><a href="#week27-2025-9-1-2025-9-7" class="headerlink" title="week27 (2025.9.1-2025.9.7)"></a>week27 (2025.9.1-2025.9.7)</h2><ul><li>接下来打算把周记分成四周一篇了，每周照样更新，但是四周一篇文章</li><li>这周（其实是上周，这段是补的）把博客主题给换了。原先想着先配置完，到时候直接把文章移到新的博客文件里，但是进度太慢了。这周直接给原博客换皮😋还更了一篇博客,真好😋(虽然还是AI出力)</li><li>moe week4上新题了,但是week3甚至week2还有没写完的题</li><li>安卓这块的笔记还没更,开学了找找时间补上</li></ul><h2 id="week28-2025-9-8-2025-9-14"><a href="#week28-2025-9-8-2025-9-14" class="headerlink" title="week28 (2025.9.8-2025.9.14)"></a>week28 (2025.9.8-2025.9.14)</h2><ul><li>好的手忙脚乱的开学第一周，目前学习计划有待更新。</li><li>这周和X2c的新师傅们组队参加了湾区杯，独立解出了一道题，还是太菜了。考察方向还挺全面，pc端、安卓甚至微信小程序都有。</li></ul><h2 id="week29-2025-9-15-2025-9-21"><a href="#week29-2025-9-15-2025-9-21" class="headerlink" title="week29 (2025.9.15-2025.9.21)"></a>week29 (2025.9.15-2025.9.21)</h2><ul><li>这周有个长城杯（还有个铁人三项长城杯，这俩好像不是一个），只分web、AI安全、数据安全三个方向，没做出来，爆0了</li><li>开学了学习状态又开始不稳定了，老是偷懒不找时间学😖这学期好几门数学相关课，要燃尽了</li><li>给博客新开了数据结构分类，能不能更下去看造化了(</li></ul><h2 id="week30-2025-9-22-2025-9-28"><a href="#week30-2025-9-22-2025-9-28" class="headerlink" title="week30 (2025.9.22-2025.9.28)"></a>week30 (2025.9.22-2025.9.28)</h2><ul><li>这周又是没有新知识的一周</li><li>周六又干掉一道moectf的题，只剩最后一道week2的upx_revenge了，实在没招了😖</li><li>感觉还是没找到学业和比赛的平衡点，这样下去恐怕一学期学的都没有一个暑假多😖不得不吐槽为什么乱七八糟的课这么多啊😖</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;2025年9月篇&lt;/p&gt;</summary>
    
    
    
    <category term="周记" scheme="https://sydzi.github.io/categories/%E5%91%A8%E8%AE%B0/"/>
    
    
    <category term="周记" scheme="https://sydzi.github.io/tags/%E5%91%A8%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>icarus主题优化</title>
    <link href="https://sydzi.github.io/2025/09/02/icarus%E4%B8%BB%E9%A2%98%E4%BC%98%E5%8C%96/"/>
    <id>https://sydzi.github.io/2025/09/02/icarus%E4%B8%BB%E9%A2%98%E4%BC%98%E5%8C%96/</id>
    <published>2025-09-02T04:13:44.000Z</published>
    <updated>2026-02-15T15:23:13.857Z</updated>
    
    <content type="html"><![CDATA[<p>icarus主题复制功能重构（仿照next主题）、firebase统计阅读人数</p><span id="more"></span><h2 id="复制功能重构"><a href="#复制功能重构" class="headerlink" title="复制功能重构"></a>复制功能重构</h2><ul><li><p>icarus主题自带的复制功能是带文字选中的（如下图），个人感觉麻烦了点，于是考虑借鉴next的复制风格，一键复制</p><p><img src="/../images/image-20250902231901036.png" alt="官网指南截图"></p></li><li><p>实现：</p><p>hexo-theme-icarus&#x2F;source&#x2F;js&#x2F;main.js：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs diff">        if (clipboard) &#123;<br><span class="hljs-deletion">-           new ClipboardJS(&#x27;.highlight .copy&#x27;, &#123;</span><br><span class="hljs-deletion">-               target: function(trigger) &#123;</span><br><span class="hljs-deletion">-                   return trigger.parentNode.nextElementSibling;</span><br><span class="hljs-deletion">-               &#125;</span><br><span class="hljs-deletion">-           &#125;).on(&#x27;success&#x27;, function(e) &#123;</span><br><span class="hljs-deletion">-               e.clearSelection();</span><br><span class="hljs-deletion">-               const tmp = e.trigger.innerHTML;</span><br><span class="hljs-deletion">-               e.trigger.innerHTML = &#x27;&lt;i class=&quot;fas fa-check&quot;&gt;&lt;/i&gt;&#x27;;</span><br><span class="hljs-deletion">-               setTimeout(function() &#123;</span><br><span class="hljs-deletion">-                   e.trigger.innerHTML = tmp;</span><br><span class="hljs-deletion">-               &#125;, 2000);</span><br><span class="hljs-deletion">-           &#125;);</span><br><span class="hljs-addition">+           $(&#x27;figure.highlight&#x27;).each(function() &#123;</span><br><span class="hljs-addition">+               const target = $(this).find(&#x27;figcaption div.level-right&#x27;)[0];</span><br><span class="hljs-addition">+               if (target) &#123;</span><br><span class="hljs-addition">+                   registerCopyButton(target, this);</span><br><span class="hljs-addition">+               &#125;</span><br><span class="hljs-addition">+           &#125;);</span><br>        &#125;<br>        <br><span class="hljs-comment">----------------------------------------------------------------------------------</span><br><br>...<br><br>    $(&#x27;.article &gt; .content &gt; table&#x27;).each(function() &#123;<br>        if ($(this).width() &gt; $(this).parent().width()) &#123;<br>            $(this).wrap(&#x27;&lt;div class=&quot;table-overflow&quot;&gt;&lt;/div&gt;&#x27;);<br>        &#125;<br>    &#125;);<br><br><span class="hljs-addition">+    // 注册复制按钮功能，仿照Next主题实现</span><br><span class="hljs-addition">+    function registerCopyButton(target, element) &#123;</span><br><span class="hljs-addition">+        // 添加复制按钮</span><br><span class="hljs-addition">+        target.insertAdjacentHTML(&#x27;beforeend&#x27;, &#x27;&lt;a href=&quot;javascript:;&quot; class=&quot;copy&quot; title=&quot;Copy&quot;&gt;&lt;i class=&quot;fas fa-copy&quot;&gt;&lt;/i&gt;&lt;/a&gt;&#x27;);</span><br><span class="hljs-addition">+        const button = target.querySelector(&#x27;.copy&#x27;);</span><br><span class="hljs-addition">+        </span><br><span class="hljs-addition">+        button.addEventListener(&#x27;click&#x27;, function() &#123;</span><br><span class="hljs-addition">+            const code = element.querySelector(&#x27;.code&#x27;).innerText;</span><br><span class="hljs-addition">+            </span><br><span class="hljs-addition">+            if (navigator.clipboard) &#123;</span><br><span class="hljs-addition">+                // 使用现代的Clipboard API</span><br><span class="hljs-addition">+                navigator.clipboard.writeText(code).then(function() &#123;</span><br><span class="hljs-addition">+                    button.querySelector(&#x27;i&#x27;).className = &#x27;fas fa-check-circle&#x27;;</span><br><span class="hljs-addition">+                &#125;, function() &#123;</span><br><span class="hljs-addition">+                    button.querySelector(&#x27;i&#x27;).className = &#x27;fas fa-times-circle&#x27;;</span><br><span class="hljs-addition">+                &#125;);</span><br><span class="hljs-addition">+            &#125; else &#123;</span><br><span class="hljs-addition">+                // 兼容性回退方案</span><br><span class="hljs-addition">+                const ta = document.createElement(&#x27;textarea&#x27;);</span><br><span class="hljs-addition">+                ta.style.top = window.scrollY + &#x27;px&#x27;;</span><br><span class="hljs-addition">+                ta.style.position = &#x27;absolute&#x27;;</span><br><span class="hljs-addition">+                ta.style.opacity = &#x27;0&#x27;;</span><br><span class="hljs-addition">+                ta.readOnly = true;</span><br><span class="hljs-addition">+                ta.value = code;</span><br><span class="hljs-addition">+                document.body.append(ta);</span><br><span class="hljs-addition">+                ta.select();</span><br><span class="hljs-addition">+                ta.setSelectionRange(0, code.length);</span><br><span class="hljs-addition">+                ta.readOnly = false;</span><br><span class="hljs-addition">+                const result = document.execCommand(&#x27;copy&#x27;);</span><br><span class="hljs-addition">+                button.querySelector(&#x27;i&#x27;).className = result ? &#x27;fas fa-check-circle&#x27; : &#x27;fas fa-times-circle&#x27;;</span><br><span class="hljs-addition">+                ta.blur();</span><br><span class="hljs-addition">+                button.blur();</span><br><span class="hljs-addition">+                document.body.removeChild(ta);</span><br><span class="hljs-addition">+            &#125;</span><br><span class="hljs-addition">+        &#125;);</span><br><span class="hljs-addition">+        </span><br><span class="hljs-addition">+        // 鼠标离开300ms后恢复复制图标</span><br><span class="hljs-addition">+        element.addEventListener(&#x27;mouseleave&#x27;, function() &#123;</span><br><span class="hljs-addition">+            setTimeout(function() &#123;</span><br><span class="hljs-addition">+                const icon = button.querySelector(&#x27;i&#x27;);</span><br><span class="hljs-addition">+                if (icon) &#123;</span><br><span class="hljs-addition">+                    icon.className = &#x27;fas fa-copy&#x27;;</span><br><span class="hljs-addition">+                &#125;</span><br><span class="hljs-addition">+            &#125;, 300);</span><br><span class="hljs-addition">+        &#125;);</span><br><span class="hljs-addition">+    &#125;</span><br><br>    function adjustNavbar() &#123;<br>        const navbarWidth = $(&#x27;.navbar-main .navbar-start&#x27;).outerWidth() + $(&#x27;.navbar-main .navbar-end&#x27;).outerWidth();<br>        if ($(document).outerWidth() &lt; navbarWidth) &#123;<br>            $(&#x27;.navbar-main .navbar-menu&#x27;).addClass(&#x27;justify-content-start&#x27;);<br>        &#125; else &#123;<br>            $(&#x27;.navbar-main .navbar-menu&#x27;).removeClass(&#x27;justify-content-start&#x27;);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>hexo-theme-icarus&#x2F;layout&#x2F;common&#x2F;scripts.jsx</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs diff">           return &lt;Fragment&gt;<br>            &lt;script src=&#123;cdn(&#x27;jquery&#x27;, &#x27;3.3.1&#x27;, &#x27;dist/jquery.min.js&#x27;)&#125;&gt;&lt;/script&gt;<br>            &lt;script src=&#123;cdn(&#x27;moment&#x27;, &#x27;2.22.2&#x27;, &#x27;min/moment-with-locales.min.js&#x27;)&#125;&gt;&lt;/script&gt;<br>            &lt;script dangerouslySetInnerHTML=&#123;&#123; __html: `moment.locale(&quot;$&#123;language&#125;&quot;);` &#125;&#125;&gt;&lt;/script&gt;<br>            &lt;script dangerouslySetInnerHTML=&#123;&#123; __html: embeddedConfig &#125;&#125;&gt;&lt;/script&gt;<br>            &lt;script data-pjax src=&#123;url_for(&#x27;/js/column.js&#x27;)&#125;&gt;&lt;/script&gt;<br>            &lt;Plugins site=&#123;site&#125; config=&#123;config&#125; page=&#123;page&#125; helper=&#123;helper&#125; head=&#123;false&#125; /&gt;<br><span class="hljs-deletion">-           &#123;clipboard &amp;&amp; &lt;script src=&#123;cdn(&#x27;clipboard&#x27;, &#x27;2.0.4&#x27;, &#x27;dist/clipboard.min.js&#x27;)&#125; defer&gt;&lt;/script&gt;&#125;</span><br>            &lt;script data-pjax src=&#123;url_for(&#x27;/js/main.js&#x27;)&#125; defer&gt;&lt;/script&gt;<br>        &lt;/Fragment&gt;;<br></code></pre></td></tr></table></figure></li></ul><h2 id="使用firebase统计阅读人数"><a href="#使用firebase统计阅读人数" class="headerlink" title="使用firebase统计阅读人数"></a>使用firebase统计阅读人数</h2><h3 id="config文件添加配置"><a href="#config文件添加配置" class="headerlink" title="config文件添加配置"></a>config文件添加配置</h3><p>_config.icarus.yml</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-addition">+# Firebase Firestore 阅读人数统计</span><br><span class="hljs-addition">+services:</span><br><span class="hljs-addition">+    firebase:</span><br><span class="hljs-addition">+        enable: true</span><br><span class="hljs-addition">+        collection: articles # Firestore数据库中的集合名称</span><br><span class="hljs-addition">+        apiKey:  # 你的Firebase API Key</span><br><span class="hljs-addition">+        projectId:  # 你的Firebase项目ID</span><br></code></pre></td></tr></table></figure><h3 id="文章head增加人数统计"><a href="#文章head增加人数统计" class="headerlink" title="文章head增加人数统计"></a>文章head增加人数统计</h3><p>hexo-theme-icarus&#x2F;layout&#x2F;common&#x2F;articles.jsx</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs diff">                            &#123;/* Visitor counter */&#125;                            <br>                            &#123;!index &amp;&amp; plugins &amp;&amp; plugins.busuanzi <span class="hljs-comment">=== true ? &lt;span class=&quot;level-item&quot; id=&quot;busuanzi_container_page_pv&quot; dangerouslySetInnerHTML=&#123;&#123;</span><br>                                __html: _p(&#x27;plugin.visit_count&#x27;, &#x27;&lt;span id=&quot;busuanzi_value_page_pv&quot;&gt;0&lt;/span&gt;&#x27;)<br>                            &#125;&#125;&gt;&lt;/span&gt; : null&#125;<br><span class="hljs-addition">+                           &#123;/* Firebase Visitor counter */&#125;</span><br><span class="hljs-addition">+                           &#123;config.services &amp;&amp; config.services.firebase &amp;&amp; config.services.firebase.enable ? &lt;span class=&quot;level-item&quot;&gt;</span><br><span class="hljs-addition">+                               &lt;i class=&quot;far fa-eye mr-1&quot;&gt;&lt;/i&gt;</span><br><span class="hljs-addition">+                               &lt;span class=&quot;firestore-visitors-count&quot;&gt;0&lt;/span&gt;</span><br><span class="hljs-addition">+                           &lt;/span&gt; : null&#125;</span><br></code></pre></td></tr></table></figure><h3 id="基于firebase的统计功能实现"><a href="#基于firebase的统计功能实现" class="headerlink" title="基于firebase的统计功能实现"></a>基于firebase的统计功能实现</h3><p>source&#x2F;js&#x2F;firebase_counter.js（新建）</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-addition">+/* global IcarusThemeSettings, firebase */</span><br><span class="hljs-addition">+</span><br><span class="hljs-addition">+// Firebase Counter - 阅读量统计功能</span><br><span class="hljs-addition">+</span><br><span class="hljs-addition">+if (IcarusThemeSettings &amp;&amp; IcarusThemeSettings.services &amp;&amp; IcarusThemeSettings.services.firebase &amp;&amp; IcarusThemeSettings.services.firebase.enable) &#123;</span><br><span class="hljs-addition">+    </span><br><span class="hljs-addition">+    // 初始化Firebase</span><br><span class="hljs-addition">+    try &#123;</span><br><span class="hljs-addition">+        // 确保firebase对象存在</span><br><span class="hljs-addition">+        if (typeof firebase === &#x27;undefined&#x27;) &#123;</span><br><span class="hljs-addition">+            console.error(&#x27;Firebase library not loaded&#x27;);</span><br><span class="hljs-addition">+            // 如果Firebase库未加载，隐藏计数器元素</span><br><span class="hljs-addition">+            document.querySelectorAll(&#x27;.firestore-visitors-count&#x27;).forEach(el =&gt; &#123;</span><br><span class="hljs-addition">+                el.style.display = &#x27;none&#x27;;</span><br><span class="hljs-addition">+            &#125;);</span><br><span class="hljs-addition">+        &#125; else &#123;</span><br><span class="hljs-addition">+            </span><br><span class="hljs-addition">+            firebase.initializeApp(&#123;</span><br><span class="hljs-addition">+                apiKey: IcarusThemeSettings.services.firebase.apiKey,</span><br><span class="hljs-addition">+                projectId: IcarusThemeSettings.services.firebase.projectId</span><br><span class="hljs-addition">+            &#125;);</span><br><span class="hljs-addition">+            </span><br><span class="hljs-addition">+            // 开发环境检测</span><br><span class="hljs-addition">+            const isLocalhost = [&#x27;localhost&#x27;, &#x27;127.0.0.1&#x27;].includes(window.location.hostname);</span><br><span class="hljs-addition">+            const isDevelopment = isLocalhost || window.location.hostname.includes(&#x27;192.168.&#x27;);</span><br><span class="hljs-addition">+            </span><br><span class="hljs-addition">+            // 移除所有调试日志输出</span><br><span class="hljs-addition">+            </span><br><span class="hljs-addition">+            // 获取数据库引用</span><br><span class="hljs-addition">+            const db = firebase.firestore();</span><br><span class="hljs-addition">+            const articlesCollection = IcarusThemeSettings.services.firebase.collection || &#x27;articles&#x27;;</span><br><span class="hljs-addition">+            const articles = db.collection(articlesCollection);</span><br><span class="hljs-addition">+            </span><br><span class="hljs-addition">+            // 获取阅读次数函数</span><br><span class="hljs-addition">+            const getCount = (doc, increaseCount) =&gt; &#123;</span><br><span class="hljs-addition">+                // 获取文档数据</span><br><span class="hljs-addition">+                return doc.get().then(d =&gt; &#123;</span><br><span class="hljs-addition">+                    // 初始化计数</span><br><span class="hljs-addition">+                    let count = d.exists ? d.data().count : 0;</span><br><span class="hljs-addition">+                    </span><br><span class="hljs-addition">+                    // 如果需要增加计数（只在文章页面且未在同一会话访问过）</span><br><span class="hljs-addition">+                    if (increaseCount) &#123;</span><br><span class="hljs-addition">+                        // 增加计数</span><br><span class="hljs-addition">+                        count++;</span><br><span class="hljs-addition">+                        return doc.set(&#123; count &#125;).then(() =&gt; &#123;</span><br><span class="hljs-addition">+                            if (isDevelopment) console.log(&#x27;计数已更新:&#x27;, count);</span><br><span class="hljs-addition">+                            return count;</span><br><span class="hljs-addition">+                        &#125;).catch(error =&gt; &#123;</span><br><span class="hljs-addition">+                            console.error(&#x27;Error updating count:&#x27;, error);</span><br><span class="hljs-addition">+                            return count; // 返回增加前的计数</span><br><span class="hljs-addition">+                        &#125;);</span><br><span class="hljs-addition">+                    &#125;</span><br><span class="hljs-addition">+                    </span><br><span class="hljs-addition">+                    return count;</span><br><span class="hljs-addition">+                &#125;).catch(error =&gt; &#123;</span><br><span class="hljs-addition">+                    console.error(&#x27;Error getting count:&#x27;, error);</span><br><span class="hljs-addition">+                    // 出错时返回默认值0</span><br><span class="hljs-addition">+                    return 0;</span><br><span class="hljs-addition">+                &#125;);</span><br><span class="hljs-addition">+            &#125;;</span><br><span class="hljs-addition">+</span><br><span class="hljs-addition">+            // 处理阅读计数的函数</span><br><span class="hljs-addition">+            const handleViewCount = () =&gt; &#123;</span><br><span class="hljs-addition">+                // 获取当前URL路径</span><br><span class="hljs-addition">+                const currentPath = window.location.pathname;</span><br><span class="hljs-addition">+                </span><br><span class="hljs-addition">+                // 增强首页识别：使用多个可能的选择器</span><br><span class="hljs-addition">+                const isIndexPage = document.querySelector(&#x27;.article-list&#x27;) !== null ||</span><br><span class="hljs-addition">+                                   document.querySelector(&#x27;.article-card-list&#x27;) !== null ||</span><br><span class="hljs-addition">+                                   document.querySelectorAll(&#x27;.article-card&#x27;).length &gt; 0 || // 降低阈值以适应首页</span><br><span class="hljs-addition">+                                   (currentPath === &#x27;/&#x27; &amp;&amp; document.querySelector(&#x27;article.article&#x27;) !== null); // 特殊处理：根路径+article.article元素</span><br><span class="hljs-addition">+                </span><br><span class="hljs-addition">+                // 增强文章页面识别：使用更精确的选择器组合</span><br><span class="hljs-addition">+                // 重要：首页优先判断，且文章页判断要排除首页的情况，并增加特定的文章页特征</span><br><span class="hljs-addition">+                const isArticlePage = !isIndexPage &amp;&amp; (</span><br><span class="hljs-addition">+                    // 传统文章页选择器</span><br><span class="hljs-addition">+                    (document.querySelector(&#x27;.article-container&#x27;) !== null &amp;&amp; document.querySelector(&#x27;.article-content&#x27;) !== null) ||</span><br><span class="hljs-addition">+                    (document.querySelector(&#x27;article.post&#x27;) !== null &amp;&amp; document.querySelector(&#x27;.article-content&#x27;) !== null) ||</span><br><span class="hljs-addition">+                    document.querySelector(&#x27;[id=&quot;post-content&quot;]&#x27;) !== null ||</span><br><span class="hljs-addition">+                    // 针对hexo s环境的增强选择器，但需要确保不是首页</span><br><span class="hljs-addition">+                    (document.querySelector(&#x27;article.article&#x27;) !== null &amp;&amp; </span><br><span class="hljs-addition">+                     document.querySelector(&#x27;article.card-content.article&#x27;) !== null &amp;&amp;</span><br><span class="hljs-addition">+                     document.querySelectorAll(&#x27;.article-card&#x27;).length === 0 &amp;&amp;</span><br><span class="hljs-addition">+                     currentPath !== &#x27;/&#x27;)</span><br><span class="hljs-addition">+                );</span><br><span class="hljs-addition">+                                    </span><br><span class="hljs-addition">+                // 页面类型信息 - 仅在开发环境显示</span><br><span class="hljs-addition">+                if (isDevelopment) &#123;</span><br><span class="hljs-addition">+                    console.log(`[Firebase] 当前页面类型: $&#123;isArticlePage ? &#x27;文章页&#x27; : isIndexPage ? &#x27;首页&#x27; : &#x27;其他页面&#x27;&#125;`);</span><br><span class="hljs-addition">+                &#125;</span><br><span class="hljs-addition">+</span><br><span class="hljs-addition">+                if (isArticlePage) &#123;</span><br><span class="hljs-addition">+                    // 文章页面处理</span><br><span class="hljs-addition">+                    const titleElement = document.querySelector(&#x27;.title.is-3, .title.is-4-mobile&#x27;);</span><br><span class="hljs-addition">+                    const countElement = document.querySelector(&#x27;.firestore-visitors-count&#x27;);</span><br><span class="hljs-addition">+                    </span><br><span class="hljs-addition">+                    if (titleElement &amp;&amp; countElement) &#123;</span><br><span class="hljs-addition">+                        const title = titleElement.textContent.trim();</span><br><span class="hljs-addition">+                        const doc = articles.doc(title);</span><br><span class="hljs-addition">+                        </span><br><span class="hljs-addition">+                        // 确定是否增加计数：不在本地开发环境且同一会话未访问过</span><br><span class="hljs-addition">+                        let increaseCount = !isDevelopment;</span><br><span class="hljs-addition">+                        </span><br><span class="hljs-addition">+                        if (sessionStorage.getItem(title)) &#123;</span><br><span class="hljs-addition">+                            increaseCount = false;</span><br><span class="hljs-addition">+                        &#125; else &#123;</span><br><span class="hljs-addition">+                            // 标记为在当前会话中已访问</span><br><span class="hljs-addition">+                            sessionStorage.setItem(title, true);</span><br><span class="hljs-addition">+                        &#125;</span><br><span class="hljs-addition">+                        </span><br><span class="hljs-addition">+                        getCount(doc, increaseCount).then(count =&gt; &#123;</span><br><span class="hljs-addition">+                            countElement.innerText = count;</span><br><span class="hljs-addition">+                        &#125;).catch(e =&gt; &#123;</span><br><span class="hljs-addition">+                            // 移除错误日志</span><br><span class="hljs-addition">+                        &#125;);</span><br><span class="hljs-addition">+                    &#125; else &#123;</span><br><span class="hljs-addition">+                        // 静默处理：未找到文章标题或计数元素</span><br><span class="hljs-addition">+                    &#125;</span><br><span class="hljs-addition">+                &#125; else if (isIndexPage) &#123;</span><br><span class="hljs-addition">+                    // 首页文章列表处理</span><br><span class="hljs-addition">+                    // 修改选择器以匹配实际HTML结构</span><br><span class="hljs-addition">+                    // 首页文章结构: .card &gt; .card-content.article &gt; .title.is-3.is-size-4-mobile</span><br><span class="hljs-addition">+                    const titleElements = document.querySelectorAll(</span><br><span class="hljs-addition">+                        &#x27;.card .article .title.is-3, .card .article .title.is-4-mobile, &#x27; +</span><br><span class="hljs-addition">+                        &#x27;.card article .title.is-3, .card article .title.is-4-mobile, &#x27; +</span><br><span class="hljs-addition">+                        &#x27;.card .article p.title, .card article p.title&#x27;</span><br><span class="hljs-addition">+                    );</span><br><span class="hljs-addition">+                    const countElements = document.querySelectorAll(&#x27;.card .article .firestore-visitors-count, .card article .firestore-visitors-count&#x27;);</span><br><span class="hljs-addition">+                </span><br><span class="hljs-addition">+                // 移除首页元素检测日志</span><br><span class="hljs-addition">+                </span><br><span class="hljs-addition">+                if (titleElements.length &gt; 0 &amp;&amp; countElements.length &gt; 0) &#123;</span><br><span class="hljs-addition">+                    const promises = [...titleElements].map(element =&gt; &#123;</span><br><span class="hljs-addition">+                            const title = element.textContent.trim();</span><br><span class="hljs-addition">+                            const doc = articles.doc(title);</span><br><span class="hljs-addition">+                            // 首页只获取计数，不增加计数</span><br><span class="hljs-addition">+                            return getCount(doc, false).then(count =&gt; &#123;</span><br><span class="hljs-addition">+                                return count;</span><br><span class="hljs-addition">+                            &#125;);</span><br><span class="hljs-addition">+                        &#125;);</span><br><span class="hljs-addition">+                    </span><br><span class="hljs-addition">+                    Promise.all(promises).then(counts =&gt; &#123;</span><br><span class="hljs-addition">+                            counts.forEach((val, idx) =&gt; &#123;</span><br><span class="hljs-addition">+                                if (countElements[idx]) &#123;</span><br><span class="hljs-addition">+                                    countElements[idx].innerText = val;</span><br><span class="hljs-addition">+                                &#125;</span><br><span class="hljs-addition">+                            &#125;);</span><br><span class="hljs-addition">+                        &#125;).catch(e =&gt; &#123;</span><br><span class="hljs-addition">+                            // 错误处理：尝试显示一些默认值或替代文本</span><br><span class="hljs-addition">+                            countElements.forEach(el =&gt; &#123;</span><br><span class="hljs-addition">+                                if (el.innerText === &#x27;0&#x27;) &#123;</span><br><span class="hljs-addition">+                                    el.innerText = &#x27;加载中...&#x27;;</span><br><span class="hljs-addition">+                                &#125;</span><br><span class="hljs-addition">+                            &#125;);</span><br><span class="hljs-addition">+                        &#125;);</span><br><span class="hljs-addition">+                &#125; else &#123;</span><br><span class="hljs-addition">+                    // 尝试使用更通用的选择器</span><br><span class="hljs-addition">+                    const fallbackTitleElements = document.querySelectorAll(&#x27;.article-card a[href^=&quot;/&quot;]&#x27;);</span><br><span class="hljs-addition">+                    const fallbackCountElements = document.querySelectorAll(&#x27;.article-card .firestore-visitors-count&#x27;);</span><br><span class="hljs-addition">+                    </span><br><span class="hljs-addition">+                    if (fallbackTitleElements.length &gt; 0 &amp;&amp; fallbackCountElements.length &gt; 0) &#123;</span><br><span class="hljs-addition">+                        // 这里可以添加备选逻辑</span><br><span class="hljs-addition">+                    &#125;</span><br><span class="hljs-addition">+                &#125;</span><br><span class="hljs-addition">+                &#125; else &#123;</span><br><span class="hljs-addition">+                    // 静默处理：当前页面既不是文章页也不是首页</span><br><span class="hljs-addition">+                &#125;</span><br><span class="hljs-addition">+            &#125;;</span><br><span class="hljs-addition">++</span><br><span class="hljs-addition">+            // 监听传统页面加载完成事件</span><br><span class="hljs-addition">+            document.addEventListener(&#x27;DOMContentLoaded&#x27;, () =&gt; &#123;</span><br><span class="hljs-addition">+                handleViewCount();</span><br><span class="hljs-addition">+            &#125;);</span><br><span class="hljs-addition">+            </span><br><span class="hljs-addition">+            // 监听PJAX页面加载完成事件（适配Icarus主题的PJAX机制）</span><br><span class="hljs-addition">+            document.addEventListener(&#x27;page:loaded&#x27;, () =&gt; &#123;</span><br><span class="hljs-addition">+                handleViewCount();</span><br><span class="hljs-addition">+            &#125;);</span><br><span class="hljs-addition">+        &#125;</span><br><span class="hljs-addition">+    &#125; catch (error) &#123;</span><br><span class="hljs-addition">+        // 移除初始化失败日志</span><br><span class="hljs-addition">+        // 如果初始化失败，尝试隐藏计数器元素以避免显示为0</span><br><span class="hljs-addition">+        document.querySelectorAll(&#x27;.firestore-visitors-count&#x27;).forEach(el =&gt; &#123;</span><br><span class="hljs-addition">+            el.style.display = &#x27;none&#x27;;</span><br><span class="hljs-addition">+        &#125;);</span><br><span class="hljs-addition">+    &#125;</span><br><span class="hljs-addition">+&#125;</span><br></code></pre></td></tr></table></figure><h3 id="其他一些优化"><a href="#其他一些优化" class="headerlink" title="其他一些优化"></a>其他一些优化</h3><p>hexo-theme-icarus&#x2F;layout&#x2F;common&#x2F;scripts.jsx</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs diff">const &#123; Component, Fragment &#125; = require(&#x27;inferno&#x27;);<br>const &#123; toMomentLocale &#125; = require(&#x27;hexo/dist/plugins/helper/date&#x27;);<br>const Plugins = require(&#x27;./plugins&#x27;);<br><br>module.exports = class extends Component &#123;<br>    render() &#123;<br>        const &#123; site, config, helper, page &#125; = this.props;<br>        const &#123; url_for, cdn &#125; = helper;<br>        const &#123; article &#125; = config;<br>        const language = toMomentLocale(page.lang || page.language || config.language || &#x27;en&#x27;);<br><br>        let fold = &#x27;unfolded&#x27;;<br>        let clipboard = true;<br>        if (article &amp;&amp; article.highlight) &#123;<br>            if (typeof article.highlight.clipboard !== &#x27;undefined&#x27;) &#123;<br>                clipboard = !!article.highlight.clipboard;<br>            &#125;<br>            if (typeof article.highlight.fold <span class="hljs-comment">=== &#x27;string&#x27;) &#123;</span><br>                fold = article.highlight.fold;<br>            &#125;<br>        &#125;<br><br>        const embeddedConfig = `var IcarusThemeSettings = &#123;<br>            article: &#123;<br>                highlight: &#123;<br>                    clipboard: $&#123;clipboard&#125;,<br>                    fold: &#x27;$&#123;fold&#125;&#x27;<br>                &#125;<br><span class="hljs-addition">+           &#125;,</span><br><span class="hljs-addition">+           services: &#123;</span><br><span class="hljs-addition">+               firebase: $&#123;config.services &amp;&amp; config.services.firebase ? JSON.stringify(config.services.firebase) : &#x27;false&#x27;&#125;</span><br>            &#125;<br>        &#125;;`;<br><br>        return &lt;Fragment&gt;<br>            &lt;script src=&#123;cdn(&#x27;jquery&#x27;, &#x27;3.3.1&#x27;, &#x27;dist/jquery.min.js&#x27;)&#125;&gt;&lt;/script&gt;<br>            &lt;script src=&#123;cdn(&#x27;moment&#x27;, &#x27;2.22.2&#x27;, &#x27;min/moment-with-locales.min.js&#x27;)&#125;&gt;&lt;/script&gt;<br>            &lt;script dangerouslySetInnerHTML=&#123;&#123; __html: `moment.locale(&quot;$&#123;language&#125;&quot;);` &#125;&#125;&gt;&lt;/script&gt;<br>            &lt;script dangerouslySetInnerHTML=&#123;&#123; __html: embeddedConfig &#125;&#125;&gt;&lt;/script&gt;<br><span class="hljs-addition">+           &#123;/* Firebase Firestore */&#125;</span><br><span class="hljs-addition">+           &#123;config.services &amp;&amp; config.services.firebase &amp;&amp; config.services.firebase.enable ? (</span><br><span class="hljs-addition">+               &lt;Fragment&gt;</span><br><span class="hljs-addition">+                   &lt;script src=&quot;https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js&quot;&gt;&lt;/script&gt;</span><br><span class="hljs-addition">+                   &lt;script src=&quot;https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js&quot;&gt;&lt;/script&gt;</span><br><span class="hljs-addition">+               &lt;/Fragment&gt;</span><br><span class="hljs-addition">+           ) : null&#125;</span><br>            &lt;script data-pjax src=&#123;url_for(&#x27;/js/column.js&#x27;)&#125;&gt;&lt;/script&gt;<br>            &lt;Plugins site=&#123;site&#125; config=&#123;config&#125; page=&#123;page&#125; helper=&#123;helper&#125; head=&#123;false&#125; /&gt;<br>            &lt;script data-pjax src=&#123;url_for(&#x27;/js/main.js&#x27;)&#125; defer&gt;&lt;/script&gt;<br><span class="hljs-addition">+           &#123;/* Firebase counter script */&#125;</span><br><span class="hljs-addition">+           &#123;config.services &amp;&amp; config.services.firebase &amp;&amp; config.services.firebase.enable ? (</span><br><span class="hljs-addition">+               &lt;script data-pjax src=&#123;url_for(&#x27;/js/firebase_counter.js&#x27;)&#125; defer&gt;&lt;/script&gt;</span><br><span class="hljs-addition">+           ) : null&#125;</span><br>        &lt;/Fragment&gt;;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">重构icarus主题复制功能（仿照next主题）、icarus主题使用firebase统计阅读人数</summary>
    
    
    
    <category term="杂记" scheme="https://sydzi.github.io/categories/%E6%9D%82%E8%AE%B0/"/>
    
    
    <category term="blog" scheme="https://sydzi.github.io/tags/blog/"/>
    
    <category term="杂记" scheme="https://sydzi.github.io/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>Day16:Z3求解器</title>
    <link href="https://sydzi.github.io/2025/08/21/Day16-Z3/"/>
    <id>https://sydzi.github.io/2025/08/21/Day16-Z3/</id>
    <published>2025-08-21T04:04:22.000Z</published>
    <updated>2026-02-15T15:23:13.838Z</updated>
    
    <content type="html"><![CDATA[<p>z3求解器</p><span id="more"></span><h2 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h2><ul><li>Int：整数</li><li>BitVec：二进制数据（如BitVec(‘a’,8)：8个比特位的一个变量a）</li><li>Real：有理数</li><li>Bool：布尔值</li><li>Array：数组</li></ul><h2 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h2><h3 id="设变量"><a href="#设变量" class="headerlink" title="设变量"></a>设变量</h3><ul><li>使用基本数据类型来声明变量，如：x&#x3D;Int(‘x’)</li></ul><h3 id="创建求解器"><a href="#创建求解器" class="headerlink" title="创建求解器"></a>创建求解器</h3><ul><li>使用函数Solve()创建一个求解器：s&#x3D;Solver()</li></ul><h3 id="添加约束条件"><a href="#添加约束条件" class="headerlink" title="添加约束条件"></a>添加约束条件</h3><ul><li>使用函数add()添加约束条件：s.add(一个方程&#x2F;不等式)</li></ul><h3 id="判断是否有解"><a href="#判断是否有解" class="headerlink" title="判断是否有解"></a>判断是否有解</h3><ul><li>使用函数check()检查是否有解，有解返回’sat’，无解返回’unsat’</li></ul><h3 id="取解的交集"><a href="#取解的交集" class="headerlink" title="取解的交集"></a>取解的交集</h3><ul><li>使用函数model()取满足每个条件的解的交集，返回的是字典，用model[变量名]可以得到变量的解</li></ul><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>解方程{x,y|30x+15y&#x3D;675,12x+5y&#x3D;265}</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br><br>x=Int(<span class="hljs-string">&#x27;x&#x27;</span>)<br>y=Int(<span class="hljs-string">&#x27;y&#x27;</span>)<br><br>s=Solver()<br>s.add(<span class="hljs-number">30</span>*x+<span class="hljs-number">15</span>*y==<span class="hljs-number">675</span>)<br>s.add(<span class="hljs-number">12</span>*x+<span class="hljs-number">5</span>*y==<span class="hljs-number">265</span>)<br><span class="hljs-keyword">if</span> s.check()==sat:<br>    <span class="hljs-built_in">print</span>(s.model())<br><span class="hljs-comment">#得到解[x = 20, y = 5]</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">介绍Z3约束求解器在逆向工程和CTF中的应用，包括基本数据类型(Int、BitVec、Real等)、使用流程和实际案例分析。</summary>
    
    
    
    <category term="Reverse学习笔记" scheme="https://sydzi.github.io/categories/Reverse%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="CTF" scheme="https://sydzi.github.io/tags/CTF/"/>
    
    <category term="Reverse" scheme="https://sydzi.github.io/tags/Reverse/"/>
    
  </entry>
  
  <entry>
    <title>Day15:指令虚拟化</title>
    <link href="https://sydzi.github.io/2025/08/06/Day15-%E6%8C%87%E4%BB%A4%E8%99%9A%E6%8B%9F%E5%8C%96/"/>
    <id>https://sydzi.github.io/2025/08/06/Day15-%E6%8C%87%E4%BB%A4%E8%99%9A%E6%8B%9F%E5%8C%96/</id>
    <published>2025-08-06T07:41:01.000Z</published>
    <updated>2026-02-15T15:23:13.835Z</updated>
    
    <content type="html"><![CDATA[<p>指令虚拟化、实现一个小型虚拟机程序、VM逆向实践</p><span id="more"></span><h2 id="什么是指令虚拟化"><a href="#什么是指令虚拟化" class="headerlink" title="什么是指令虚拟化"></a>什么是指令虚拟化</h2><ul><li><p>CPU厂商在开发CPU前会制定一个规范，建立起数据和操作的对应关系（如x86-64规定0x30对应异或操作），而这个数据又可以根据操作命名出汇编指令（如0x30命名为xor），因此有了数据与操作的对应关系和汇编指令与操作的对应关系，称之为指令集。CPU可以视作一个解释器，负责读取数据或者汇编指令然后带动机器产生操作。</p></li><li><p>通俗的讲，指令虚拟化实际上就是自定义指令集并为自己的指令集构建解释器，用自定义的指令实现程序的过程。这个过程利用高级语言代码实现，也就是用软件来模拟硬件，类似于虚拟机，因此称之为指令虚拟化。</p></li><li><p>实现指令虚拟化，需要定义寄存器变量（至少需要一个EIP来指向运行的指令）、内存空间数组、解释器和指令数组。</p></li><li><p>实现自定义指令集的解释器，可以采用C语言的switch（其中code是自定义指令，通过循环输入）：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//解释器：1输出11111，2输出22222，3输出33333</span><br><span class="hljs-keyword">switch</span>(code):<br><span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;11111&quot;</span>);<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>print(<span class="hljs-string">&quot;22222&quot;</span>);<br><span class="hljs-keyword">break</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>print(<span class="hljs-string">&quot;33333&quot;</span>);<br><span class="hljs-keyword">break</span>;<br></code></pre></td></tr></table></figure></li></ul><h2 id="实现一个小型虚拟机程序"><a href="#实现一个小型虚拟机程序" class="headerlink" title="实现一个小型虚拟机程序"></a>实现一个小型虚拟机程序</h2><ul><li>尝试编写一个输入两个数，输出和的程序</li></ul><h3 id="声明虚拟硬件结构体"><a href="#声明虚拟硬件结构体" class="headerlink" title="声明虚拟硬件结构体"></a>声明虚拟硬件结构体</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span>&#123;</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r1;<span class="hljs-comment">//寄存器r1</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r2;<span class="hljs-comment">//寄存器r2</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> eip;<span class="hljs-comment">//寄存器eip</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> mem[<span class="hljs-number">256</span>];<span class="hljs-comment">//虚拟内存数组</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> code[<span class="hljs-number">1024</span>];<span class="hljs-comment">//指令数组</span><br>&#125; VM;<br></code></pre></td></tr></table></figure><h3 id="定义指令集"><a href="#定义指令集" class="headerlink" title="定义指令集"></a>定义指令集</h3><ul><li>使用op1、op2表示指令后面跟的操作数，寄存器作为隐式参数不会出现在code中</li></ul><table><thead><tr><th align="center">指令</th><th align="center">使用格式</th><th align="center">对应汇编指令&#x2F;伪代码</th><th align="center">操作解读</th></tr></thead><tbody><tr><td align="center">0x10</td><td align="center">0x10,op1</td><td align="center">mov r1,mem[op1]</td><td align="center">r1&#x3D;mem[op1]</td></tr><tr><td align="center">0x11</td><td align="center">0x11,op1</td><td align="center">mov r2,mem[op1]</td><td align="center">r2&#x3D;mem[op1]</td></tr><tr><td align="center">0x20</td><td align="center">0x20</td><td align="center">add r1,r2</td><td align="center">r1+&#x3D;r2</td></tr><tr><td align="center">0x30</td><td align="center">0x30,op1,op2</td><td align="center">scanf-&gt;mem[op1],mem[op2]</td><td align="center">输入给mem[op1]，mem[op2]</td></tr><tr><td align="center">0x40</td><td align="center">0x40</td><td align="center">printf r1</td><td align="center">输出r1的值</td></tr><tr><td align="center">0x50</td><td align="center">0x50</td><td align="center">ret</td><td align="center">return 1</td></tr></tbody></table><h3 id="编写解释器"><a href="#编写解释器" class="headerlink" title="编写解释器"></a>编写解释器</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">vm_run</span><span class="hljs-params">(VM* vm)</span> &#123;<br>    <span class="hljs-type">char</span> opcode;<span class="hljs-comment">//用来存放指令</span><br>    <span class="hljs-type">char</span> op1, op2;<span class="hljs-comment">//用来存放操作数</span><br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        opcode = vm-&gt;code[vm-&gt;eip];<span class="hljs-comment">//读取eip指向的指令</span><br><br>        <span class="hljs-keyword">switch</span> (opcode) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x10</span>:<br>            op1 = vm-&gt;code[vm-&gt;eip + <span class="hljs-number">1</span>];<span class="hljs-comment">//获取操作数</span><br>            vm-&gt;r1 = vm-&gt;mem[op1];<span class="hljs-comment">//r1=mem[op1]</span><br>            vm-&gt;eip += <span class="hljs-number">2</span>;<span class="hljs-comment">//跳转到下一条指令（指令+操作数占2个索引位）</span><br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x11</span>:<br>            op1 = vm-&gt;code[vm-&gt;eip + <span class="hljs-number">1</span>];<span class="hljs-comment">//获取操作数</span><br>            vm-&gt;r2 = vm-&gt;mem[op1];<span class="hljs-comment">//r2=mem[op1]</span><br>            vm-&gt;eip += <span class="hljs-number">2</span>;<span class="hljs-comment">//跳转到下一条指令（指令+操作数占2个索引位）</span><br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x20</span>:<br>            vm-&gt;r1 += vm-&gt;r2;<span class="hljs-comment">//r1+=r2</span><br>            vm-&gt;eip += <span class="hljs-number">1</span>;<span class="hljs-comment">//跳转到下一条指令（只有指令，占1个索引位）</span><br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x30</span>:<br>            op1 = vm-&gt;code[vm-&gt;eip + <span class="hljs-number">1</span>];<span class="hljs-comment">//获取操作数1</span><br>            op2 = vm-&gt;code[vm-&gt;eip + <span class="hljs-number">2</span>];<span class="hljs-comment">//获取操作数2</span><br>            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d %d&quot;</span>, &amp;vm-&gt;mem[op1], &amp;vm-&gt;mem[op2]);<span class="hljs-comment">//输入给mem[op1]，mem[op2]</span><br>            vm-&gt;eip += <span class="hljs-number">3</span>;<span class="hljs-comment">//跳转到下一条指令（指令+操作数占3个索引位）</span><br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x40</span>:<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d&quot;</span>, vm-&gt;r1);<span class="hljs-comment">//输出r1的值</span><br>            vm-&gt;eip += <span class="hljs-number">1</span>;<span class="hljs-comment">//跳转到下一条指令（只有指令，占1个索引位）</span><br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x50</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<span class="hljs-comment">//循环终止，函数返回，虚拟机关机</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="指令数组"><a href="#指令数组" class="headerlink" title="指令数组"></a>指令数组</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> code[]=&#123;<br><span class="hljs-number">0x30</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x1</span>,<span class="hljs-comment">//输入给mem[0]，mem[1]</span><br>    <span class="hljs-number">0x10</span>,<span class="hljs-number">0x0</span>,<span class="hljs-comment">//r1=mem[0]</span><br>    <span class="hljs-number">0x11</span>,<span class="hljs-number">0x1</span>,<span class="hljs-comment">//r2=mem[1]</span><br>    <span class="hljs-number">0x20</span>,<span class="hljs-comment">//r1+=r2</span><br>    <span class="hljs-number">0x40</span>,<span class="hljs-comment">//输出r1的值</span><br>    <span class="hljs-number">0x50</span><span class="hljs-comment">//虚拟机关机</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="完整程序"><a href="#完整程序" class="headerlink" title="完整程序"></a>完整程序</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;windows.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span>&#123;</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r1;<span class="hljs-comment">//寄存器r1</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r2;<span class="hljs-comment">//寄存器r2</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> eip;<span class="hljs-comment">//寄存器eip</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> mem[<span class="hljs-number">256</span>];<span class="hljs-comment">//虚拟内存数组</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> code[<span class="hljs-number">1024</span>];<span class="hljs-comment">//指令数组</span><br>&#125; VM;<br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> code[]=&#123;<br><span class="hljs-number">0x30</span>,<span class="hljs-number">0x0</span>,<span class="hljs-number">0x1</span>,<span class="hljs-comment">//输入给mem[0]，mem[1]</span><br>    <span class="hljs-number">0x10</span>,<span class="hljs-number">0x0</span>,<span class="hljs-comment">//r1=mem[0]</span><br>    <span class="hljs-number">0x11</span>,<span class="hljs-number">0x1</span>,<span class="hljs-comment">//r2=mem[1]</span><br>    <span class="hljs-number">0x20</span>,<span class="hljs-comment">//r1+=r2</span><br>    <span class="hljs-number">0x40</span>,<span class="hljs-comment">//输出r1的值</span><br>    <span class="hljs-number">0x50</span><span class="hljs-comment">//虚拟机关机</span><br>&#125;;<br><br>VM* <span class="hljs-title function_">vm_new</span><span class="hljs-params">()</span> &#123;<br>    VM* vm = (VM*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(VM));<span class="hljs-comment">//为虚拟硬件结构体申请空间</span><br>    <span class="hljs-built_in">memset</span>(vm, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(VM));<span class="hljs-comment">//初始化结构体</span><br>    <span class="hljs-built_in">memcpy</span>(vm-&gt;code, code, <span class="hljs-keyword">sizeof</span>(code));<span class="hljs-comment">//初始化code</span><br>    <span class="hljs-keyword">return</span> vm;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">vm_run</span><span class="hljs-params">(VM* vm)</span> &#123;<br>    <span class="hljs-type">char</span> opcode;<span class="hljs-comment">//用来存放指令</span><br>    <span class="hljs-type">char</span> op1, op2;<span class="hljs-comment">//用来存放操作数</span><br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        opcode = vm-&gt;code[vm-&gt;eip];<span class="hljs-comment">//读取eip指向的指令</span><br><br>        <span class="hljs-keyword">switch</span> (opcode) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x10</span>:<br>            op1 = vm-&gt;code[vm-&gt;eip + <span class="hljs-number">1</span>];<span class="hljs-comment">//获取操作数</span><br>            vm-&gt;r1 = vm-&gt;mem[op1];<span class="hljs-comment">//r1=mem[op1]</span><br>            vm-&gt;eip += <span class="hljs-number">2</span>;<span class="hljs-comment">//跳转到下一条指令（指令+操作数占2个索引位）</span><br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x11</span>:<br>            op1 = vm-&gt;code[vm-&gt;eip + <span class="hljs-number">1</span>];<span class="hljs-comment">//获取操作数</span><br>            vm-&gt;r2 = vm-&gt;mem[op1];<span class="hljs-comment">//r2=mem[op1]</span><br>            vm-&gt;eip += <span class="hljs-number">2</span>;<span class="hljs-comment">//跳转到下一条指令（指令+操作数占2个索引位）</span><br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x20</span>:<br>            vm-&gt;r1 += vm-&gt;r2;<span class="hljs-comment">//r1+=r2</span><br>            vm-&gt;eip += <span class="hljs-number">1</span>;<span class="hljs-comment">//跳转到下一条指令（只有指令，占1个索引位）</span><br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x30</span>:<br>            op1 = vm-&gt;code[vm-&gt;eip + <span class="hljs-number">1</span>];<span class="hljs-comment">//获取操作数1</span><br>            op2 = vm-&gt;code[vm-&gt;eip + <span class="hljs-number">2</span>];<span class="hljs-comment">//获取操作数2</span><br>            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d %d&quot;</span>, &amp;vm-&gt;mem[op1], &amp;vm-&gt;mem[op2]);<span class="hljs-comment">//输入给mem[op1]，mem[op2]</span><br>            vm-&gt;eip += <span class="hljs-number">3</span>;<span class="hljs-comment">//跳转到下一条指令（指令+操作数占3个索引位）</span><br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x40</span>:<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d&quot;</span>, vm-&gt;r1);<span class="hljs-comment">//输出r1的值</span><br>            vm-&gt;eip += <span class="hljs-number">1</span>;<span class="hljs-comment">//跳转到下一条指令（只有指令，占1个索引位）</span><br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x50</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<span class="hljs-comment">//循环终止，函数返回，虚拟机关机</span><br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    VM* vm = vm_new();<span class="hljs-comment">//生成一个虚拟机</span><br>    <span class="hljs-keyword">if</span> (vm_run(vm))<span class="hljs-comment">//运行虚拟机</span><br>        system(<span class="hljs-string">&quot;pause&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="简单示例的逆向"><a href="#简单示例的逆向" class="headerlink" title="简单示例的逆向"></a>简单示例的逆向</h2><ul><li><p>VM题最显著的特征应该就是虚拟硬件结构体的初始化和解释器了。解决这类问题，需要先复刻出一个解释器，通过在解释器中增加打印分析出的代码的操作，来得到去虚拟化的原程序，进而可以正常逆向分析</p></li><li><p>先来看main函数：</p><p><img src="/../images/image-20250806232124465.png" alt="main函数"></p><p>下面三个带字符串的函数可以看出是printf和system</p></li><li><p>看看v1&#x3D;后面的函数</p><p><img src="/../images/image-20250806232516529.png" alt="v1&#x3D;后面的函数"></p><p>目前没什么明显的VM特征</p></li><li><p>再看看if括号里的函数</p><p><img src="/../images/image-20250806232613438.png" alt="if括号里的函数"></p><p>看到出现switch了，开始推测是VM的解释器</p><p>回到上一个函数，发现确实和VM的初始化函数很像，最后面一个函数的第二个参数对应出来的是一堆数字，和初始化code对应上了</p><p><img src="/../images/image-20250806232947764.png" alt="一堆数字"></p></li><li><p>OK，那就对伪代码进行一点点优化，然后开始分析解释器</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//推测虚拟硬件结构体</span><br>__int64 __fastcall <span class="hljs-title function_">vm_run</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *vm)</span><br>&#123;<br>  sub_140001940(&amp;unk_1401150A2);<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-keyword">switch</span> ( *((_BYTE *)vm + vm[<span class="hljs-number">2</span>] + <span class="hljs-number">268</span>) )<span class="hljs-comment">//vm+268是code所在，结合下文分析，加上vm[2]就构成了code[eip]</span><br>    &#123;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x10</span>:<br>        *vm = *((<span class="hljs-type">char</span> *)vm + vm[<span class="hljs-number">2</span>] + <span class="hljs-number">269</span>);<span class="hljs-comment">//*vm=code[eip+1]，vm应该是一个寄存器，这句是mov r1,op1</span><br>        vm[<span class="hljs-number">2</span>] += <span class="hljs-number">2</span>;<span class="hljs-comment">//每个case都有，推测是eip。+=2，说明有一个操作数                            </span><br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x11</span>:<br>        vm[<span class="hljs-number">1</span>] = *((<span class="hljs-type">char</span> *)vm + vm[<span class="hljs-number">2</span>] + <span class="hljs-number">269</span>);<span class="hljs-comment">//vm[1]=code[eip+1]，vm[1]应该也是一个寄存器,这句是mov r2,op1</span><br>        vm[<span class="hljs-number">2</span>] += <span class="hljs-number">2</span>;<span class="hljs-comment">//有一个操作数</span><br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x20</span>:<br>        *((_BYTE *)vm + *((<span class="hljs-type">char</span> *)vm + vm[<span class="hljs-number">2</span>] + <span class="hljs-number">269</span>) + <span class="hljs-number">12</span>) = *((_BYTE *)vm + vm[<span class="hljs-number">2</span>] + <span class="hljs-number">270</span>);<br>            <span class="hljs-comment">//*((char *)vm + vm[2] + 269)是code[eip+1]，即op1，所以左边是vm+12+op1，推测vm+12是虚拟内存，刚好跨过三个连续的int型寄存器</span><br>            <span class="hljs-comment">//右边即vm+vm[2]+268+2即code[eip+2]，即op2</span><br>        vm[<span class="hljs-number">2</span>] += <span class="hljs-number">3</span>;<span class="hljs-comment">//有两个操作数</span><br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x30</span>:<br>        *((_BYTE *)vm + *vm + <span class="hljs-number">12</span>) ^= *((_BYTE *)vm + <span class="hljs-number">4</span>);<span class="hljs-comment">//mem[r1]^=r2</span><br>        ++vm[<span class="hljs-number">2</span>];<span class="hljs-comment">//无操作数</span><br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x40</span>:<br>        sub_140001610(&amp;unk_1400D74B0, vm + <span class="hljs-number">3</span>);<span class="hljs-comment">//unk这个是%5s，所以这是scanf。这里的vm是int，加三跳过了单个寄存器，是mem[0]</span><br>        ++vm[<span class="hljs-number">2</span>];<span class="hljs-comment">//无操作数</span><br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">0x50</span>:<br>        <span class="hljs-keyword">return</span> sub_1400D4430(vm + <span class="hljs-number">3</span>, (<span class="hljs-type">char</span> *)vm + *((<span class="hljs-type">char</span> *)vm + vm[<span class="hljs-number">2</span>] + <span class="hljs-number">269</span>) + <span class="hljs-number">12</span>, *((<span class="hljs-type">char</span> *)vm + vm[<span class="hljs-number">2</span>] + <span class="hljs-number">270</span>));<br>            <span class="hljs-comment">//三个参数分别为mem[0],mem[op1],op2，推测是memcmp（怎么没暗示操作数个数</span><br>      <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">continue</span>;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>推测虚拟硬件结构体如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span>&#123;</span><br>   <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r1;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r2;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> eip;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> mem[<span class="hljs-number">268</span><span class="hljs-number">-3</span>*<span class="hljs-number">4</span>=<span class="hljs-number">256</span>];<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> code[<span class="hljs-number">36</span>];<br>&#125; VM;<br></code></pre></td></tr></table></figure></li><li><p>带输出分析出来的代码的解释器如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">int</span> <span class="hljs-title function_">vm_run</span><span class="hljs-params">(VM* vm)</span> &#123;<br>    <span class="hljs-type">char</span> opcode;<br>    <span class="hljs-type">char</span> op1, op2;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        opcode = vm-&gt;code[vm-&gt;eip];<br><br>        <span class="hljs-keyword">switch</span> (opcode) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x10</span>:<br>            vm-&gt;r1 = code[vm-&gt;eip + <span class="hljs-number">1</span>];<br>            vm-&gt;eip += <span class="hljs-number">2</span>;<br>            <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;mov r1,&quot;</span> &lt;&lt; vm-&gt;r1 &lt;&lt; <span class="hljs-built_in">endl</span>;<br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x11</span>:<br>            vm-&gt;r2 = code[vm-&gt;eip + <span class="hljs-number">1</span>];<br>            vm-&gt;eip += <span class="hljs-number">2</span>;<br>            <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;mov r2,&quot;</span> &lt;&lt; vm-&gt;r2 &lt;&lt; <span class="hljs-built_in">endl</span>;<br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x20</span>:<br>            op1 = code[vm-&gt;eip + <span class="hljs-number">1</span>];<br>            op2 = code[vm-&gt;eip + <span class="hljs-number">2</span>];<br>            vm-&gt;mem[op1] = op2;<br>            vm-&gt;eip += <span class="hljs-number">3</span>;<br>            <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;mov mem[&quot;</span> &lt;&lt; (<span class="hljs-type">int</span>)op1 &lt;&lt; <span class="hljs-string">&quot;],&quot;</span> &lt;&lt; op2 &lt;&lt; <span class="hljs-built_in">endl</span>;<br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x30</span>:<br>            vm-&gt;mem[vm-&gt;r1] ^= vm-&gt;r2;<br>            ++vm-&gt;eip;<br>            <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;xor mem[&quot;</span> &lt;&lt; vm-&gt;r1 &lt;&lt; <span class="hljs-string">&quot;],&quot;</span> &lt;&lt; vm-&gt;r2 &lt;&lt; <span class="hljs-built_in">endl</span>;<br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x40</span>:<br>            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%5s&quot;</span>, &amp;vm-&gt;mem[<span class="hljs-number">0</span>]);<br>            ++vm-&gt;eip;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;scanf mem\n&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x50</span>:<br>            op1 = code[vm-&gt;eip + <span class="hljs-number">1</span>];<br>            op2 = code[vm-&gt;eip + <span class="hljs-number">2</span>];<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">memcmp</span>(&amp;vm-&gt;mem[<span class="hljs-number">0</span>], &amp;vm-&gt;mem[op1], op2);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>完整的脚本：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;windows.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br>using namespace <span class="hljs-built_in">std</span>;<br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r1;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r2;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> eip;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> mem[<span class="hljs-number">256</span>];<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> code[<span class="hljs-number">36</span>];<br>&#125; VM ;<br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> code[] = &#123;<br>    <span class="hljs-number">0x20</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x40</span>,<br>    <span class="hljs-number">0x11</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x04</span>,<br>    <span class="hljs-number">0x30</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x05</span><br>&#125;;<br><br>VM* <span class="hljs-title function_">vm_new</span><span class="hljs-params">()</span> &#123;<br>    VM* vm = (VM*)<span class="hljs-built_in">malloc</span>(<span class="hljs-keyword">sizeof</span>(VM));<br>    <span class="hljs-built_in">memset</span>(vm, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(VM));<br>    <span class="hljs-built_in">memcpy</span>(vm-&gt;code, code, <span class="hljs-keyword">sizeof</span>(code));<br>    <span class="hljs-keyword">return</span> vm;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">vm_run</span><span class="hljs-params">(VM* vm)</span> &#123;<br>    <span class="hljs-type">char</span> opcode;<br>    <span class="hljs-type">char</span> op1, op2;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        opcode = vm-&gt;code[vm-&gt;eip];<br><br>        <span class="hljs-keyword">switch</span> (opcode) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x10</span>:<br>            vm-&gt;r1 = code[vm-&gt;eip + <span class="hljs-number">1</span>];<br>            vm-&gt;eip += <span class="hljs-number">2</span>;<br>            <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;mov r1,&quot;</span> &lt;&lt; vm-&gt;r1 &lt;&lt; <span class="hljs-built_in">endl</span>;<br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x11</span>:<br>            vm-&gt;r2 = code[vm-&gt;eip + <span class="hljs-number">1</span>];<br>            vm-&gt;eip += <span class="hljs-number">2</span>;<br>            <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;mov r2,&quot;</span> &lt;&lt; vm-&gt;r2 &lt;&lt; <span class="hljs-built_in">endl</span>;<br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x20</span>:<br>            op1 = code[vm-&gt;eip + <span class="hljs-number">1</span>];<br>            op2 = code[vm-&gt;eip + <span class="hljs-number">2</span>];<br>            vm-&gt;mem[op1] = op2;<br>            vm-&gt;eip += <span class="hljs-number">3</span>;<br>            <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;mov mem[&quot;</span> &lt;&lt; (<span class="hljs-type">int</span>)op1 &lt;&lt; <span class="hljs-string">&quot;],&quot;</span> &lt;&lt; op2 &lt;&lt; <span class="hljs-built_in">endl</span>;<br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x30</span>:<br>            vm-&gt;mem[vm-&gt;r1] ^= vm-&gt;r2;<br>            ++vm-&gt;eip;<br>            <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;xor mem[&quot;</span> &lt;&lt; vm-&gt;r1 &lt;&lt; <span class="hljs-string">&quot;],&quot;</span> &lt;&lt; vm-&gt;r2 &lt;&lt; <span class="hljs-built_in">endl</span>;<br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x40</span>:<br>            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%5s&quot;</span>, &amp;vm-&gt;mem[<span class="hljs-number">0</span>]);<br>            ++vm-&gt;eip;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;scanf mem\n&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x50</span>:<br>            op1 = code[vm-&gt;eip + <span class="hljs-number">1</span>];<br>            op2 = code[vm-&gt;eip + <span class="hljs-number">2</span>];<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">memcmp</span>(&amp;vm-&gt;mem[<span class="hljs-number">0</span>], &amp;vm-&gt;mem[op1], op2);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    VM* vm = vm_new();<br>    <span class="hljs-keyword">if</span> (vm_run(vm))<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;failed\n&quot;</span>);<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;good\n&quot;</span>);<br>    <br>    system(<span class="hljs-string">&quot;pause&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>这样我们得到了原程序的汇编代码（参杂着奇怪的代码）</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-keyword">mov</span> mem[<span class="hljs-number">16</span>],H<br><span class="hljs-keyword">mov</span> mem[<span class="hljs-number">17</span>],e<br><span class="hljs-keyword">mov</span> mem[<span class="hljs-number">18</span>],l<br><span class="hljs-keyword">mov</span> mem[<span class="hljs-number">19</span>],l<br><span class="hljs-keyword">mov</span> mem[<span class="hljs-number">20</span>],o<br><span class="hljs-number">12345</span><br>scanf mem<br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">r2</span>,<span class="hljs-number">33</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">r1</span>,<span class="hljs-number">0</span><br><span class="hljs-keyword">xor</span> mem[<span class="hljs-number">0</span>],<span class="hljs-number">33</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">r1</span>,<span class="hljs-number">1</span><br><span class="hljs-keyword">xor</span> mem[<span class="hljs-number">1</span>],<span class="hljs-number">33</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">r1</span>,<span class="hljs-number">2</span><br><span class="hljs-keyword">xor</span> mem[<span class="hljs-number">2</span>],<span class="hljs-number">33</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">r1</span>,<span class="hljs-number">3</span><br><span class="hljs-keyword">xor</span> mem[<span class="hljs-number">3</span>],<span class="hljs-number">33</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">r1</span>,<span class="hljs-number">4</span><br><span class="hljs-keyword">xor</span> mem[<span class="hljs-number">4</span>],<span class="hljs-number">33</span><br>failed<br></code></pre></td></tr></table></figure></li><li><p>可以看到，程序先把”Hello”传给了mem的一片区域，然后获取输入，把输入的数与33异或，最后执行返回处的判断。返回处是对比mem[0]和mem[op1]，对比op2位，结合code最后几位，知道是对比mem[0]和mem[16]，对比5位。所以要求的输入是”Hello”逐位异或的结果（不可见字符，尝试输入失败）</p></li></ul>]]></content>
    
    
    <summary type="html">指令虚拟化、实现一个小型虚拟机程序、VM逆向实践</summary>
    
    
    
    <category term="Reverse学习笔记" scheme="https://sydzi.github.io/categories/Reverse%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="CTF" scheme="https://sydzi.github.io/tags/CTF/"/>
    
    <category term="Reverse" scheme="https://sydzi.github.io/tags/Reverse/"/>
    
  </entry>
  
  <entry>
    <title>Day14:IDApython与SMC</title>
    <link href="https://sydzi.github.io/2025/08/05/Day14-IDApython%E4%B8%8ESMC/"/>
    <id>https://sydzi.github.io/2025/08/05/Day14-IDApython%E4%B8%8ESMC/</id>
    <published>2025-08-05T01:53:56.000Z</published>
    <updated>2026-02-15T15:23:13.833Z</updated>
    
    <content type="html"><![CDATA[<p>IDApythonAPI、SMC自修改代码</p><span id="more"></span><h2 id="IDApython"><a href="#IDApython" class="headerlink" title="IDApython"></a>IDApython</h2><ul><li>先贴上官方文档： <a href="https://python.docs.hex-rays.com/index.html">https://python.docs.hex-rays.com/index.html</a></li></ul><h3 id="基础API"><a href="#基础API" class="headerlink" title="基础API"></a>基础API</h3><ul><li>idc.here() &#x2F; idc.get_screen_ea()：返回光标所在处的地址</li><li>idc.get_inf_attr(INF_MIN_EA) &#x2F; idc.get_inf_attr(INF_MAX_EA)：返回最小&#x2F;最大地址（没有随机化地址情况下）</li><li>idc.generate_disasm_line(ea,0)：返回ea所在处的汇编指令</li><li>idc.prev_head(ea)&#x2F;next_head(ea)：返回ea处上一条&#x2F;下一条指令地址</li><li>idc.print_insn_mnem(ea)：打印ea处的助记符（即mov,add什么的）</li><li>idc.print_operand(ea,n)：打印ea处第n个操作数（n&#x3D;0或者1）</li></ul><h3 id="段相关API"><a href="#段相关API" class="headerlink" title="段相关API"></a>段相关API</h3><ul><li>idautils.Segments()：返回段起始地址列表</li><li>idc.get_segm_name(ea)：返回ea所在段的名字</li><li>idc.get_segm_start(ea)&#x2F;get_segm_end(ea)：返回ea所在段的起始地址&#x2F;结束地址</li><li>idc.get_next_seg(ea)：返回ea所在段的下一个段的起始地址</li></ul><h3 id="函数相关API"><a href="#函数相关API" class="headerlink" title="函数相关API"></a>函数相关API</h3><ul><li>idautils.Functions(start_addr,end_addr)：返回地址间的函数对象（不写参数就是所有函数对象）</li><li>idautils.FuncItems(ea)：返回ea所在函数所有指令的地址（相当于地址列表）</li><li>idaapi.get_func(ea)：获得ea所在函数的对象（含有如start_ea、end_ea、size等属性）</li><li>idc.get_func_name(ea)：返回ea所在函数的名字</li><li>idc.get_func_attr(ea,FUNCATTR_START) &#x2F; idc.get_func_attr(ea,FUNCATTR_END)：返回ea所在函数的起始地址&#x2F;结束地址</li><li>idc.get_next_func(ea) &#x2F; idc.get_prev_func(ea)：返回ea所在函数的上一个&#x2F;下一个函数的起始地址</li></ul><h3 id="指令相关API"><a href="#指令相关API" class="headerlink" title="指令相关API"></a>指令相关API</h3><ul><li>ida_ua.insn_t()，返回一个空的指令对象（或者说创建一个空的指令对象），包含函数的一些属性</li><li>idaapi.decode_insn(out,ea)，解析ea所在处的指令，把解析的结果给out（out必须是一个指令对象）<ul><li>out.ea：指令的起始地址</li><li>out.size：指令占用的字节数</li><li>out.get_cannon_mnemonic()：指令的助记符</li><li>out.itype：助记符的十进制码</li></ul></li></ul><h3 id="操作数相关API"><a href="#操作数相关API" class="headerlink" title="操作数相关API"></a>操作数相关API</h3><ul><li>idc.get_operand_value(ea,n)：返回ea处第n个操作数的值</li><li>idc.get_operand_type(ea,n)：返回ea处第n个操作数的类型</li></ul><h3 id="数据读写相关API"><a href="#数据读写相关API" class="headerlink" title="数据读写相关API"></a>数据读写相关API</h3><ul><li>idc.get_bytes(ea,size)：返回ea处size大小的bytes</li><li>idc.patch_byte(ea,content)：修改ea处的1字节为content</li><li>idc.patch_word(ea,content)：修改ea处的2字节为content</li><li>idc.patch_dword(ea,content)：修改ea处的4字节为content</li><li>idc.patch_qword(ea,content)：修改ea处的8字节为content</li></ul><h3 id="调试相关API"><a href="#调试相关API" class="headerlink" title="调试相关API"></a>调试相关API</h3><ul><li><p>ida_dbg.load_debugger(“local”,0)：启动调试器</p></li><li><p>ida_dbg.add_bpt(ea)：在ea处下断点</p></li><li><p>ida_dbg.del_bpt(ea)：删除ea处断点</p></li><li><p>ida_dbg.start_process(path,args,sdir)：启动调试进程，参数对应路径、命令行参数、工作目录</p></li><li><p>ida_dbg.step_into()：单步步入</p></li><li><p>ida_dbg.step_over()：单步步过</p></li><li><p>ida_dbg.step_until_ret()：运行到返回</p></li><li><p>idc.get_reg_value(regname)：获取regname寄存器的值</p></li><li><p>idc.set_reg_value(value,regname)：设置regname寄存器的值</p></li></ul><h3 id="其他操作相关API"><a href="#其他操作相关API" class="headerlink" title="其他操作相关API"></a>其他操作相关API</h3><ul><li><p>idautils.XrefsFrom(ea)：返回ea处引用的对象（有属性frm、to、type）</p></li><li><p>idautils.XrefsTo(ea)：返回所有引用ea处的对象（有属性frm、to、type）（Ctrl+X）</p><p>示例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> idautils,idaapi<br><span class="hljs-keyword">for</span> xref <span class="hljs-keyword">in</span> idautils.XrefsTo(here()):<br>    <span class="hljs-built_in">print</span>(xref.to)<span class="hljs-comment">#here()</span><br>    <span class="hljs-built_in">print</span>(xref.frm)<span class="hljs-comment">#调用here()的函数地址</span><br><span class="hljs-keyword">for</span> xref <span class="hljs-keyword">in</span> idautils.XrefsFrom(here()):<br>    <span class="hljs-built_in">print</span>(xref.frm)<span class="hljs-comment">#here()</span><br>    <span class="hljs-built_in">print</span>(xref.to)<span class="hljs-comment">#here()引用的函数地址</span><br></code></pre></td></tr></table></figure></li><li><p>idautils.Strings()：返回包含所有字符串的对象（有属性ea、length、strtype）（shift+F12）</p></li><li><p>idc.get_strlit_contents(ea)：返回ea处的字符串</p><p>示例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> idc,idautils<br><span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> idautils.Strings():<br>    string=idc.get_strlit_contents(s.ea)<br>    <span class="hljs-built_in">print</span>(string)<br><span class="hljs-comment">#打印所有字符串</span><br></code></pre></td></tr></table></figure></li></ul><h2 id="自修改代码（SMC）"><a href="#自修改代码（SMC）" class="headerlink" title="自修改代码（SMC）"></a>自修改代码（SMC）</h2><ul><li><p>自修改代码（Self-Modifying-Code）指某部分代码以加密后的形式存在于程序中，程序执行到这部分代码的时候才会进行动态解密，和加壳有点异曲同工。常用来加密关键逻辑，使其不可直接静态分析</p></li><li><p>特征：</p><p>程序中存在对程序自身某部分的运算，一般还需要VirtualProtect() &#x2F; mprotect()来改变内存的属性以便将解密后的代码数据写入内存，或者使用VirtualAlloc把解密后的代码数据写入堆中执行（为了避免API暴露，还可能会新增一个有RWX属性的段来存放加密后的代码）。</p></li><li><p>应对方法有两种：一种是动态调试得到解密后的关键逻辑，另一种是使用脚本解密关键逻辑后再覆盖回去</p><ul><li><p>示例：2021-羊城杯-babysmc</p><p>PS：本来想要自己写一个简单程序试试手的，研究了半个下午没研究出来，程序修正到解密函数可以解密出正确代码了，但是调用关键逻辑check的时候莫名其妙跑飞了，在那个安全检查的位置，跳转后像是个畸形函数，不知道是不是改内存属性的时候影响到了，所以只能去找网上的题目了</p></li><li><p>这是优化后的主函数：</p><p><img src="/../images/image-20250805234429100.png" alt="主函数"></p><p>优化的来源就是，enc的位置是一团数字，而loc_7FF6BF081D00处开始是正常代码，加上对下面的decrypt函数的分析，可以确定enc就是被加密后的first_part</p></li><li><p>这是decrypt函数：</p><p><img src="/../images/image-20250805234728191.png" alt="decrypt函数"></p><p>非常明显地调用了VirtualProtect函数，解密逻辑很简单，就是ror后异或0x5a（ror查出来是循环右移，3就是右移的位数了，这点看汇编可能更清晰点）</p></li><li><p>下面就是今天的成果展示了（ror由DS协助实现），SMC解密脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> idautils,idc,idaapi<br><br>enc=idc.get_bytes(<span class="hljs-number">0x00007FF6BF081085</span>,<span class="hljs-number">0x00007FF6BF081D00</span>-<span class="hljs-number">0x00007FF6BF081085</span>)<br>loc=<span class="hljs-number">0x00007FF6BF081085</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ror</span>(<span class="hljs-params">value, shift, bits=<span class="hljs-number">8</span></span>):<br>    shift %= bits  <span class="hljs-comment"># 确保位移量在有效范围内</span><br>    <span class="hljs-keyword">return</span> (value &gt;&gt; shift) | ((value &lt;&lt; (bits - shift)) &amp; ((<span class="hljs-number">1</span> &lt;&lt; bits) - <span class="hljs-number">1</span>))<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> enc:<br>    idc.patch_byte(loc,(ror(i,<span class="hljs-number">3</span>)^<span class="hljs-number">0x5a</span>)&amp;<span class="hljs-number">0xff</span>)<br>    loc+=<span class="hljs-number">1</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;done&quot;</span>)<br></code></pre></td></tr></table></figure></li><li><p>本来是要写完的，但是first_part的函数解析完好几百行了，是我看不懂的加密🫠去找WP，发现是非常混淆的base64，还加了异或，但是我没看出逻辑，索性点到为止，改天把编码和密码的部分补上再说。</p></li><li><p>本来也尝试了动调解密，但是调着调着给我下起东西来了，虽然链接看着是微软的，但是还是有点怕，就舍弃这个方法了（下的是kernel.pdb好像，DS说是缺失符号文件🫠🫠）</p></li></ul></li></ul>]]></content>
    
    
    <summary type="html">IDApythonAPI、SMC自修改代码</summary>
    
    
    
    <category term="Reverse学习笔记" scheme="https://sydzi.github.io/categories/Reverse%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="CTF" scheme="https://sydzi.github.io/tags/CTF/"/>
    
    <category term="Reverse" scheme="https://sydzi.github.io/tags/Reverse/"/>
    
  </entry>
  
  <entry>
    <title>Day13:反调试（二）</title>
    <link href="https://sydzi.github.io/2025/08/03/Day13-%E5%8F%8D%E8%B0%83%E8%AF%95%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <id>https://sydzi.github.io/2025/08/03/Day13-%E5%8F%8D%E8%B0%83%E8%AF%95%EF%BC%88%E4%BA%8C%EF%BC%89/</id>
    <published>2025-08-03T00:38:55.000Z</published>
    <updated>2026-02-15T15:23:13.831Z</updated>
    
    <content type="html"><![CDATA[<p>时间差检测、断点检测</p><span id="more"></span><h2 id="时间差检测"><a href="#时间差检测" class="headerlink" title="时间差检测"></a>时间差检测</h2><ul><li>CPU的运行十分迅速，一段代码可能在几毫秒内就可以执行完毕，但是调试的时候，代码运行时间会显著地变慢，这就是时间差检测的原理。时间差检测主要通过计算时间差然后与预设的值比较实现。</li></ul><h3 id="RDTSC指令计算"><a href="#RDTSC指令计算" class="headerlink" title="RDTSC指令计算"></a>RDTSC指令计算</h3><ul><li><p>rdtsc是一个汇编指令，用于将时间读入edx:eax寄存器（高32位：低32位）。通过取两次时间把结果相减可以得到一个时间差。显著特征就是rdtsc指令</p></li><li><p>效果：</p><p><img src="/../images/image-20250803103503205.png" alt="IDA"></p><p><img src="/../images/image-20250803103510223.png" alt="XDbg"></p></li><li><p>应对方法：</p><p>根据程序的逻辑，可以在计算出时间差并比较之后改变比较结果。</p></li></ul><h3 id="GetTickCount计算"><a href="#GetTickCount计算" class="headerlink" title="GetTickCount计算"></a>GetTickCount计算</h3><ul><li><p>原理和RDTSC类似，只不过时间差采用GetTickCount计算。GetTickCount也是WINAPI，会有明显标记。</p></li><li><p>效果：</p><p><img src="/../images/image-20250803110132263.png" alt="IDA"></p><p><img src="/../images/image-20250803110151704.png" alt="XDbg"></p></li><li><p>应对方法：</p><p>修改比较结果即可</p></li></ul><h3 id="QueryPerformanceCounter计算"><a href="#QueryPerformanceCounter计算" class="headerlink" title="QueryPerformanceCounter计算"></a>QueryPerformanceCounter计算</h3><ul><li><p>原理类似，只是采用QueryPerformanceCounter计算，也是WINAPI，比较好识别</p></li><li><p>效果：</p><p><img src="/../images/image-20250803111252719.png" alt="IDA"></p><p><img src="/../images/image-20250803111302239.png" alt="XDbg"></p></li><li><p>应对方法：</p><p>修改比较结果即可</p></li></ul><h2 id="断点检测"><a href="#断点检测" class="headerlink" title="断点检测"></a>断点检测</h2><ul><li>断点是调试的一个显著特点。断点可以分为软件断点、硬件断点和内存断点。软件断点通过将目标代码修改为中断指令（X86\X64下一般为INT3\0xCC）实现；硬件断点通过将指令地址写入调试寄存器的DR0-DR3监控地址访问来实现；内存断点通过修改内存页（一片片内存区域）的访问权限实现。三者的实现方法都会触发异常让调试器捕获进而中断。反调试的断点检测主要利用软件断点和硬件断点，内存断点由于针对内存区域而非具体指令，精度太低，一般不考虑。</li></ul><h3 id="软件断点检测"><a href="#软件断点检测" class="headerlink" title="软件断点检测"></a>软件断点检测</h3><ul><li><p>常见手段是在内存区域搜索0xCC（使用汇编指令repnz scasb）</p></li><li><p>效果：</p><p><img src="/../images/image-20250803184326511.png" alt="IDA"></p><p><img src="/../images/image-20250803184332179.png" alt="XDbg"></p></li><li><p>因为进行了比较，所以修改比较结果即可绕过</p></li></ul><h3 id="硬件断点检测"><a href="#硬件断点检测" class="headerlink" title="硬件断点检测"></a>硬件断点检测</h3><ul><li><p>常见手段是获取DR寄存器的值并和0比较。特征是GetThreadContext函数（或者其他ThreadContext相关的函数）和与0的比较</p></li><li><p>效果：</p><p><img src="/../images/image-20250803190042096.png" alt="IDA"></p><p><img src="/../images/image-20250803190057497.png" alt="XDbg"></p></li><li><p>应对方法：</p><p>还是进行了比较，修改比较结果绕过</p></li></ul>]]></content>
    
    
    <summary type="html">时间差检测、断点检测</summary>
    
    
    
    <category term="Reverse学习笔记" scheme="https://sydzi.github.io/categories/Reverse%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="CTF" scheme="https://sydzi.github.io/tags/CTF/"/>
    
    <category term="Reverse" scheme="https://sydzi.github.io/tags/Reverse/"/>
    
  </entry>
  
</feed>
