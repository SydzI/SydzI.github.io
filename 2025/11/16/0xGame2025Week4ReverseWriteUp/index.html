<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>0xGame2025Week4WriteUp - SydzI&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="SydzI&#039;s Blog"><meta name="msapplication-TileImage" content="/img/Newspaper.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="SydzI&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="0xGame2025 Week4 Reverse方向全解&amp;amp;详解"><meta property="og:type" content="blog"><meta property="og:title" content="0xGame2025Week4WriteUp"><meta property="og:url" content="https://sydzi.github.io/2025/11/16/0xGame2025Week4ReverseWriteUp/"><meta property="og:site_name" content="SydzI&#039;s Blog"><meta property="og:description" content="0xGame2025 Week4 Reverse方向全解&amp;amp;详解"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://sydzi.github.io/images/image-20251029221337039.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251105204720304.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251105205201725.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251105210910030.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251105212443210.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251105213100678.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251105213705664.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251105220015560.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251105220511591.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251106193030935.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251106193216226.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251106193251339.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251106193416659.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251106195811100.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251106195827424.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251106195843505.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251107170326209.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251107171007199.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251107171139700.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251107171338976.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251107172247039.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251107172437327.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251107173258987.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251107173428095.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251112220409411.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251112220643619.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251113211300972.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251107211205450.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251107211234103.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251107212238679.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251107212753102.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251107212917688.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251107215116511.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251107215446744.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251107220443790.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251107220708346.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251107220805016.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251115195827438.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251118205855685.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251118205930373.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251118211132659.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251119154953693.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251118211217057.png"><meta property="og:image" content="https://sydzi.github.io/images/flag.bmp"><meta property="og:image" content="https://sydzi.github.io/images/image-20251119160128685.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251119160014085.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251119160735550.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251123115352743.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251123115421535.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251123115509065.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251123120534447.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251123121110864.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251123121217193.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251123121642123.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251123121901277.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251123121954674.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251123122045460.png"><meta property="article:published_time" content="2025-11-16T12:59:56.000Z"><meta property="article:modified_time" content="2025-11-23T13:13:03.986Z"><meta property="article:author" content="SydzI"><meta property="article:tag" content="CTF"><meta property="article:tag" content="WriteUp"><meta property="article:tag" content="Reverse"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://sydzi.github.io/images/image-20251029221337039.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://sydzi.github.io/2025/11/16/0xGame2025Week4ReverseWriteUp/"},"headline":"0xGame2025Week4WriteUp","image":["https://sydzi.github.io/images/image-20251029221337039.png","https://sydzi.github.io/images/image-20251105204720304.png","https://sydzi.github.io/images/image-20251105205201725.png","https://sydzi.github.io/images/image-20251105210910030.png","https://sydzi.github.io/images/image-20251105212443210.png","https://sydzi.github.io/images/image-20251105213100678.png","https://sydzi.github.io/images/image-20251105213705664.png","https://sydzi.github.io/images/image-20251105220015560.png","https://sydzi.github.io/images/image-20251105220511591.png","https://sydzi.github.io/images/image-20251106193030935.png","https://sydzi.github.io/images/image-20251106193216226.png","https://sydzi.github.io/images/image-20251106193251339.png","https://sydzi.github.io/images/image-20251106193416659.png","https://sydzi.github.io/images/image-20251106195811100.png","https://sydzi.github.io/images/image-20251106195827424.png","https://sydzi.github.io/images/image-20251106195843505.png","https://sydzi.github.io/images/image-20251107170326209.png","https://sydzi.github.io/images/image-20251107171007199.png","https://sydzi.github.io/images/image-20251107171139700.png","https://sydzi.github.io/images/image-20251107171338976.png","https://sydzi.github.io/images/image-20251107172247039.png","https://sydzi.github.io/images/image-20251107172437327.png","https://sydzi.github.io/images/image-20251107173258987.png","https://sydzi.github.io/images/image-20251107173428095.png","https://sydzi.github.io/images/image-20251112220409411.png","https://sydzi.github.io/images/image-20251112220643619.png","https://sydzi.github.io/images/image-20251113211300972.png","https://sydzi.github.io/images/image-20251107211205450.png","https://sydzi.github.io/images/image-20251107211234103.png","https://sydzi.github.io/images/image-20251107212238679.png","https://sydzi.github.io/images/image-20251107212753102.png","https://sydzi.github.io/images/image-20251107212917688.png","https://sydzi.github.io/images/image-20251107215116511.png","https://sydzi.github.io/images/image-20251107215446744.png","https://sydzi.github.io/images/image-20251107220443790.png","https://sydzi.github.io/images/image-20251107220708346.png","https://sydzi.github.io/images/image-20251107220805016.png","https://sydzi.github.io/images/image-20251115195827438.png","https://sydzi.github.io/images/image-20251118205855685.png","https://sydzi.github.io/images/image-20251118205930373.png","https://sydzi.github.io/images/image-20251118211132659.png","https://sydzi.github.io/images/image-20251119154953693.png","https://sydzi.github.io/images/image-20251118211217057.png","https://sydzi.github.io/images/image-20251119160128685.png","https://sydzi.github.io/images/image-20251119160014085.png","https://sydzi.github.io/images/image-20251119160735550.png","https://sydzi.github.io/images/image-20251123115352743.png","https://sydzi.github.io/images/image-20251123115421535.png","https://sydzi.github.io/images/image-20251123115509065.png","https://sydzi.github.io/images/image-20251123120534447.png","https://sydzi.github.io/images/image-20251123121110864.png","https://sydzi.github.io/images/image-20251123121217193.png","https://sydzi.github.io/images/image-20251123121642123.png","https://sydzi.github.io/images/image-20251123121901277.png","https://sydzi.github.io/images/image-20251123121954674.png","https://sydzi.github.io/images/image-20251123122045460.png"],"datePublished":"2025-11-16T12:59:56.000Z","dateModified":"2025-11-23T13:13:03.986Z","author":{"@type":"Person","name":"SydzI"},"publisher":{"@type":"Organization","name":"SydzI's Blog","logo":{"@type":"ImageObject"}},"description":"0xGame2025 Week4 Reverse方向全解&amp;详解"}</script><link rel="canonical" href="https://sydzi.github.io/2025/11/16/0xGame2025Week4ReverseWriteUp/"><link rel="icon" href="/img/Newspaper.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/xcode.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><meta name="msvalidate.01" content="9FE0F2242662A1EB82C139F80B4118F0"><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=upLteeXJeF0vtcEfQngBefAoRrZBdbYGiIdhlziWygs" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'upLteeXJeF0vtcEfQngBefAoRrZBdbYGiIdhlziWygs');</script><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="SydzI's Blog" type="application/atom+xml">
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">SydzI&#039;s Blog</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item night" id="night-nav" title="Change Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-9-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><span class="level-item"><i class="fas fa-calendar-alt mr-1"></i><time datetime="${date_xml(page.date)}" title="${new Date(page.date).toLocaleString()}">2025-11-16</time></span><span class="level-item"><i class="fas fa-sync-alt mr-1"></i><time datetime="${date_xml(page.updated)}" title="${new Date(page.updated).toLocaleString()}">2025-11-23</time></span><span class="level-item"><i class="far fa-folder-open mr-1"></i><a class="link-muted" href="/categories/WriteUp-%E5%A4%8D%E7%8E%B0/">WriteUp&amp;复现</a></span><span class="level-item"><i class="far fa-clock mr-1"></i>2 小时读完 (大约17121个字)</span><span class="level-item"><i class="far fa-eye mr-1"></i><span class="firestore-visitors-count">0</span></span></div></div><h1 class="title is-3 is-size-4-mobile">0xGame2025Week4WriteUp</h1><div class="content"><p>0xGame2025 Week4 Reverse方向全解&amp;详解</p>
<span id="more"></span>

<h2 id="镜渊折枝"><a href="#镜渊折枝" class="headerlink" title="镜渊折枝"></a>镜渊折枝</h2><blockquote>
<p>考点：native层逆向，AES</p>
</blockquote>
<ul>
<li><p>附件apk运行起来是这样：</p>
<p><img src="/../images/image-20251029221337039.png" alt="运行附件apk"></p>
</li>
<li><p>JEB打开，可以得到下面这些MainActivity和相关函数的内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.easynative;<br><br><span class="hljs-keyword">import</span> android.content.Context;<br><span class="hljs-keyword">import</span> android.os.Bundle;<br><span class="hljs-keyword">import</span> android.view.View;<br><span class="hljs-keyword">import</span> android.widget.Button;<br><span class="hljs-keyword">import</span> android.widget.EditText;<br><span class="hljs-keyword">import</span> android.widget.Toast;<br><span class="hljs-keyword">import</span> androidx.activity.ComponentActivity;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> kotlin.Metadata;<br><span class="hljs-keyword">import</span> kotlin.io.ByteStreamsKt;<br><span class="hljs-keyword">import</span> kotlin.jvm.internal.Intrinsics;<br><br><span class="hljs-meta">@Metadata(d1 = &#123;&quot;\u0000\u0018\n\u0002\u0018\u0002\n\u0002\u0018\u0002\n\u0002\b\u0002\n\u0002\u0010\u0002\n\u0000\n\u0002\u0018\u0002\n\u0000\b\u0007\u0018\u00002\u00020\u0001B\u0005¢\u0006\u0002\u0010\u0002J\u0012\u0010\u0003\u001A\u00020\u00042\b\u0010\u0005\u001A\u0004\u0018\u00010\u0006H\u0014¨\u0006\u0007&quot;&#125;, d2 = &#123;&quot;Lcom/example/easynative/MainActivity;&quot;, &quot;Landroidx/activity/ComponentActivity;&quot;, &quot;()V&quot;, &quot;onCreate&quot;, &quot;&quot;, &quot;savedInstanceState&quot;, &quot;Landroid/os/Bundle;&quot;, &quot;app_release&quot;&#125;, k = 1, mv = &#123;1, 9, 0&#125;, xi = 0x30)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ComponentActivity</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> $stable;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span>  <span class="hljs-comment">// androidx.activity.ComponentActivity</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle arg3)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(arg3);<br>        <span class="hljs-built_in">this</span>.setContentView(layout.activity_main);<br>        <span class="hljs-type">EditText</span> <span class="hljs-variable">v3</span> <span class="hljs-operator">=</span> (EditText)<span class="hljs-built_in">this</span>.findViewById(id.flagInput);<br>        ((Button)<span class="hljs-built_in">this</span>.findViewById(id.button)).setOnClickListener((View arg2) -&gt; MainActivity.onCreate$lambda$<span class="hljs-number">0</span>(v3, <span class="hljs-built_in">this</span>, arg2));<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> onCreate$lambda$<span class="hljs-number">0</span>(EditText arg2, MainActivity arg3, View arg4) &#123;<br>        Intrinsics.checkNotNullParameter(arg3, <span class="hljs-string">&quot;this$0&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">v2</span> <span class="hljs-operator">=</span> arg2.getText().toString();<br>        <span class="hljs-type">InputStream</span> <span class="hljs-variable">v4</span> <span class="hljs-operator">=</span> arg3.getAssets().open(<span class="hljs-string">&quot;secret.bin&quot;</span>);<br>        Intrinsics.checkNotNullExpressionValue(v4, <span class="hljs-string">&quot;open(...)&quot;</span>);<br>        <span class="hljs-type">byte</span>[] v4_1 = ByteStreamsKt.readBytes(v4);<br>        <span class="hljs-keyword">if</span>(((CharSequence)v2).length() &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-type">Context</span> <span class="hljs-variable">v1</span> <span class="hljs-operator">=</span> (Context)arg3;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FlagChecker</span>(v1, v2).check(v4_1)) &#123;  <span class="hljs-comment">// v4从secret.bin中被读取出来，读取的内容给了v4_1作为check的参数，输入的内容作为FlagChecker的第二个参数</span><br>                Toast.makeText(v1, ((CharSequence)arg3.getString(string.correct)), <span class="hljs-number">0</span>).show();<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br><br>            Toast.makeText(v1, ((CharSequence)arg3.getString(string.wrong)), <span class="hljs-number">0</span>).show();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">package</span> com.example.easynative;<br><br><span class="hljs-keyword">import</span> android.content.Context;<br><span class="hljs-keyword">import</span> java.security.Key;<br><span class="hljs-keyword">import</span> java.security.spec.AlgorithmParameterSpec;<br><span class="hljs-keyword">import</span> javax.crypto.Cipher;<br><span class="hljs-keyword">import</span> javax.crypto.spec.IvParameterSpec;<br><span class="hljs-keyword">import</span> javax.crypto.spec.SecretKeySpec;<br><span class="hljs-keyword">import</span> kotlin.Metadata;<br><span class="hljs-keyword">import</span> kotlin.jvm.internal.DefaultConstructorMarker;<br><span class="hljs-keyword">import</span> kotlin.jvm.internal.Intrinsics;<br><span class="hljs-keyword">import</span> kotlin.text.Charsets;<br><br><span class="hljs-meta">@Metadata(d1 = &#123;&quot;\u0000.\n\u0002\u0018\u0002\n\u0002\u0010\u0000\n\u0000\n\u0002\u0018\u0002\n\u0000\n\u0002\u0010\u000E\n\u0002\b\u0002\n\u0002\u0010\u000B\n\u0000\n\u0002\u0010\u0012\n\u0002\b\u0002\n\u0002\u0010\b\n\u0002\b\u0005\b\u0007\u0018\u0000 \u00112\u00020\u0001:\u0001\u0011B\u0015\u0012\u0006\u0010\u0002\u001A\u00020\u0003\u0012\u0006\u0010\u0004\u001A\u00020\u0005¢\u0006\u0002\u0010\u0006J\u000E\u0010\u0007\u001A\u00020\b2\u0006\u0010\t\u001A\u00020\nJ\u0019\u0010\u000B\u001A\u00020\b2\u0006\u0010\f\u001A\u00020\r2\u0006\u0010\u000E\u001A\u00020\nH\u0086 J\u001E\u0010\u000F\u001A\u00020\n2\u0006\u0010\u0004\u001A\u00020\u00052\u0006\u0010\u0010\u001A\u00020\n2\u0006\u0010\t\u001A\u00020\nR\u000E\u0010\u0002\u001A\u00020\u0003X\u0082\u0004¢\u0006\u0002\n\u0000R\u000E\u0010\u0004\u001A\u00020\u0005X\u0082\u0004¢\u0006\u0002\n\u0000¨\u0006\u0012&quot;&#125;, d2 = &#123;&quot;Lcom/example/easynative/FlagChecker;&quot;, &quot;&quot;, &quot;context&quot;, &quot;Landroid/content/Context;&quot;, &quot;plainText&quot;, &quot;&quot;, &quot;(Landroid/content/Context;Ljava/lang/String;)V&quot;, &quot;check&quot;, &quot;&quot;, &quot;iv&quot;, &quot;&quot;, &quot;compare&quot;, &quot;length&quot;, &quot;&quot;, &quot;data&quot;, &quot;encrypt&quot;, &quot;key&quot;, &quot;Companion&quot;, &quot;app_release&quot;&#125;, k = 1, mv = &#123;1, 9, 0&#125;, xi = 0x30)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlagChecker</span> &#123;<br>    <span class="hljs-meta">@Metadata(d1 = &#123;&quot;\u0000\f\n\u0002\u0018\u0002\n\u0002\u0010\u0000\n\u0002\b\u0002\b\u0086\u0003\u0018\u00002\u00020\u0001B\u0007\b\u0002¢\u0006\u0002\u0010\u0002¨\u0006\u0003&quot;&#125;, d2 = &#123;&quot;Lcom/example/easynative/FlagChecker$Companion;&quot;, &quot;&quot;, &quot;()V&quot;, &quot;app_release&quot;&#125;, k = 1, mv = &#123;1, 9, 0&#125;, xi = 0x30)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Companion</span> &#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-title function_">Companion</span><span class="hljs-params">()</span> &#123;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">Companion</span><span class="hljs-params">(DefaultConstructorMarker arg1)</span> &#123;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> $stable;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Companion Companion;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Context context;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String plainText;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        FlagChecker.Companion = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Companion</span>(<span class="hljs-literal">null</span>);<br>        FlagChecker.$stable = <span class="hljs-number">8</span>;<br>        System.loadLibrary(<span class="hljs-string">&quot;easynative&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">FlagChecker</span><span class="hljs-params">(Context arg2, String arg3)</span> &#123;<br>        Intrinsics.checkNotNullParameter(arg2, <span class="hljs-string">&quot;context&quot;</span>);<br>        Intrinsics.checkNotNullParameter(arg3, <span class="hljs-string">&quot;plainText&quot;</span>);<br>        <span class="hljs-built_in">super</span>();<br>        <span class="hljs-built_in">this</span>.context = arg2;<br>        <span class="hljs-built_in">this</span>.plainText = arg3;  <span class="hljs-comment">// 输入的内容被赋值给plaintext</span><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">check</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] arg4)</span> &#123;  <span class="hljs-comment">// 参数是从secret.bin读取的内容</span><br>        Intrinsics.checkNotNullParameter(((Object)arg4), <span class="hljs-string">&quot;iv&quot;</span>);  <span class="hljs-comment">// arg4即从secret.bin读取的内容被标识为iv</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">v0</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.context.getString(string.key);  <span class="hljs-comment">// v0为string.key</span><br>        Intrinsics.checkNotNullExpressionValue(v0, <span class="hljs-string">&quot;getString(...)&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">v1</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.plainText;  <span class="hljs-comment">// v1是输入的内容plaintext</span><br>        <span class="hljs-type">byte</span>[] v0_1 = v0.getBytes(Charsets.UTF_8);  <span class="hljs-comment">// v0读取为bytes</span><br>        Intrinsics.checkNotNullExpressionValue(((Object)v0_1), <span class="hljs-string">&quot;this as java.lang.String).getBytes(charset)&quot;</span>);<br>        <span class="hljs-type">byte</span>[] v4 = <span class="hljs-built_in">this</span>.encrypt(v1, v0_1, arg4);  <span class="hljs-comment">// 三个参数分别为：输入的plaintext，string.key，从secret.bin读取的iv</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.compare(v4.length, v4);  <span class="hljs-comment">// compare从native层easynative.so导入</span><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">native</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(<span class="hljs-type">int</span> arg1, <span class="hljs-type">byte</span>[] arg2)</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">byte</span>[] encrypt(String arg3, <span class="hljs-type">byte</span>[] arg4, <span class="hljs-type">byte</span>[] arg5) &#123;<br>        Intrinsics.checkNotNullParameter(arg3, <span class="hljs-string">&quot;plainText&quot;</span>);  <span class="hljs-comment">// 此处再次对参数进行了标识</span><br>        Intrinsics.checkNotNullParameter(((Object)arg4), <span class="hljs-string">&quot;key&quot;</span>);<br>        Intrinsics.checkNotNullParameter(((Object)arg5), <span class="hljs-string">&quot;iv&quot;</span>);<br>        <span class="hljs-type">SecretKeySpec</span> <span class="hljs-variable">v0</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(arg4, <span class="hljs-string">&quot;AES&quot;</span>);  <span class="hljs-comment">// 加密算法AES，CTR模式</span><br>        <span class="hljs-type">Cipher</span> <span class="hljs-variable">v4</span> <span class="hljs-operator">=</span> Cipher.getInstance(<span class="hljs-string">&quot;AES/CTR/NoPadding&quot;</span>);<br>        v4.init(<span class="hljs-number">1</span>, ((Key)v0), ((AlgorithmParameterSpec)<span class="hljs-keyword">new</span> <span class="hljs-title class_">IvParameterSpec</span>(arg5)));<br>        <span class="hljs-type">byte</span>[] v3 = arg3.getBytes(Charsets.UTF_8);<br>        Intrinsics.checkNotNullExpressionValue(((Object)v3), <span class="hljs-string">&quot;this as java.lang.String).getBytes(charset)&quot;</span>);<br>        <span class="hljs-type">byte</span>[] v3_1 = v4.doFinal(v3);<br>        Intrinsics.checkNotNull(((Object)v3_1));<br>        <span class="hljs-keyword">return</span> v3_1;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>可以看到Mainactivity使用了FlagChecker来校验，而FlagChecker对输入的内容进行了AES加密，然后用native层的compare函数来检验加密结果。下面是native层compare函数的内容(IDA中显示的函数名是check而非compare)：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">check</span><span class="hljs-params">(JNIEnv *a1, __int64 a2, <span class="hljs-type">int</span> a3, <span class="hljs-type">void</span> *a4)</span></span><br><span class="hljs-function"></span>&#123;<br>  __int64 v5; <span class="hljs-comment">// x0</span><br>  __int64 i; <span class="hljs-comment">// x9</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// w11</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// w10</span><br><br>  v5 = (__int64)(*a1)-&gt;<span class="hljs-built_in">GetByteArrayElements</span>(a1, a4, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-keyword">if</span> ( a3 != <span class="hljs-number">48</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0LL</span>; i != <span class="hljs-number">48</span>; ++i )<br>  &#123;<br>    v7 = (<span class="hljs-type">unsigned</span> __int8)byte_5A2[i];<br>    v8 = *(<span class="hljs-type">unsigned</span> __int8 *)(v5 + i) ^ (<span class="hljs-type">unsigned</span> __int8)i;<br>    <span class="hljs-keyword">if</span> ( v8 != v7 )<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>可以看到compare函数是先拿AES加密结果异或索引后才进行校验的，所以解密应该拿compare中的密文和索引异或得到AES加密的数据，然后找出key和iv进行AES解密。</p>
<p>脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><br>enc=[<span class="hljs-number">0x38</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0xF7</span>]<br><span class="hljs-comment">#先对数据进行异或还原</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    enc[i]=enc[i]^i<br><span class="hljs-comment">#提取AES相关参数</span><br>key=<span class="hljs-string">b&quot;0xgame-SecretKey&quot;</span><br>iv=<span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&quot;8A A5 61 0C 74 41 1B 11 A3 53 68 DE 56 BF 6A B3&quot;</span>)<br><span class="hljs-comment">#AES解密</span><br>cipher=AES.new(key, AES.MODE_CTR, nonce=<span class="hljs-string">b&#x27;&#x27;</span>, initial_value=iv)<br>flag=cipher.decrypt(<span class="hljs-built_in">bytes</span>(enc))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;flag: &quot;</span>,flag.decode())<br></code></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>flag：0xGame{Native_1s_also_1nt3r3st1ng_ef492d80a257c}</p>
</blockquote>
<h2 id="夜雀之歌"><a href="#夜雀之歌" class="headerlink" title="夜雀之歌"></a>夜雀之歌</h2><blockquote>
<p>考点：迷宫题，动态调试，反调试</p>
</blockquote>
<ul>
<li><p>附件程序运行起来是这样的：</p>
<p><img src="/../images/image-20251105204720304.png" alt="运行"></p>
<p>用IDA打开，通过Shift+F12字符串窗口可以找到一些信息定位main函数的位置</p>
<p><img src="/../images/image-20251105205201725.png" alt="字符串窗口的信息"></p>
<p>main函数有一大串的循环语句，结合上图终端输出的WASD可以推测这是一道迷宫逆向题。#是迷宫的墙，终端显示的是迷宫的一小部分，在终端按下WASD可以控制P移动。所以第一步要提取迷宫</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//main函数</span><br>__int64 <span class="hljs-title function_">sub_7FF6645A1D2B</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">int</span> v0; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v1; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v2; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// [rsp+2Ch] [rbp-4h]</span><br><br>  sub_7FF7EC581FC0();<br>  sub_7FF7EC581B30();<br>  sub_7FF7EC5815B6();<br>  v6 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">do</span><br>  &#123;<br>    sub_7FF7EC581C5F();<br>    sub_7FF7EC5815B6();<br>    <span class="hljs-built_in">puts</span>(&amp;aWasdEsc);<br>    v5 = getch();<br>    sub_7FF7EC583060(<span class="hljs-string">&quot;%c\n&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v5);<br><br>    <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">119</span> )<br>    &#123;<br>LABEL_19:<br>      sub_7FF7EC581BB7(<span class="hljs-number">0LL</span>, <span class="hljs-number">0xFFFFFFFFL</span>L);<br>      v0 = v6++;<br>      byte_7FF7EC58E0E0[v0] = <span class="hljs-number">119</span>;<br>      <span class="hljs-keyword">continue</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v5 &lt;= <span class="hljs-number">119</span> )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">115</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_22;<br>      <span class="hljs-keyword">if</span> ( v5 &lt;= <span class="hljs-number">115</span> )<br>      &#123;<br>        <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">100</span> )<br>          <span class="hljs-keyword">goto</span> LABEL_21;<br>        <span class="hljs-keyword">if</span> ( v5 &lt;= <span class="hljs-number">100</span> )<br>        &#123;<br>          <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">97</span> )<br>            <span class="hljs-keyword">goto</span> LABEL_20;<br>          <span class="hljs-keyword">if</span> ( v5 &lt;= <span class="hljs-number">97</span> )<br>          &#123;<br>            <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">87</span> )<br>              <span class="hljs-keyword">goto</span> LABEL_19;<br>            <span class="hljs-keyword">if</span> ( v5 &lt;= <span class="hljs-number">87</span> )<br>            &#123;<br>              <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">83</span> )<br>              &#123;<br>LABEL_22:<br>                sub_7FF7EC581BB7(<span class="hljs-number">0LL</span>, <span class="hljs-number">1LL</span>);<br>                v3 = v6++;<br>                byte_7FF7EC58E0E0[v3] = <span class="hljs-number">115</span>;<br>                <span class="hljs-keyword">continue</span>;<br>              &#125;<br>              <span class="hljs-keyword">if</span> ( v5 &lt;= <span class="hljs-number">83</span> )<br>              &#123;<br>                <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">68</span> )<br>                &#123;<br>LABEL_21:<br>                  sub_7FF7EC581BB7(<span class="hljs-number">1LL</span>, <span class="hljs-number">0LL</span>);<br>                  v2 = v6++;<br>                  byte_7FF7EC58E0E0[v2] = <span class="hljs-number">100</span>;<br>                  <span class="hljs-keyword">continue</span>;<br>                &#125;<br>                <span class="hljs-keyword">if</span> ( v5 &lt;= <span class="hljs-number">68</span> )<br>                &#123;<br>                  <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">27</span> )<br>                    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>                  <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">65</span> )<br>                  &#123;<br>LABEL_20:<br>                    sub_7FF7EC581BB7(<span class="hljs-number">0xFFFFFFFFL</span>L, <span class="hljs-number">0LL</span>);<br>                    v1 = v6++;<br>                    byte_7FF7EC58E0E0[v1] = <span class="hljs-number">97</span>;<br>                  &#125;<br>                &#125;<br>              &#125;<br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">while</span> ( dword_7FF7EC58E0C4 != dword_7FF7EC58E0D4 || dword_7FF7EC58E0C8 != dword_7FF7EC58E0D8 );<br>  sub_7FF7EC583060(<span class="hljs-string">&quot;Congratulations your flag is: 0xGame&#123;md5(your_path)&#125; (lowercase)&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>点进LABEL_19下的第一个函数可以看到一个比较逻辑</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">sub_7FF7EC581BB7</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2)</span><br>&#123;<br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// [rsp+24h] [rbp-Ch]</span><br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// [rsp+2Ch] [rbp-4h]</span><br><br>  v5 = dword_7FF7EC58E0C4 + a1;<br>  v4 = dword_7FF7EC58E0C8 + a2;<br>  v3 = dword_7FF7EC58E0C4 + a1 + <span class="hljs-number">101</span> * (dword_7FF7EC58E0C8 + a2);<br>  <span class="hljs-keyword">if</span> ( byte_7FF7EC589040[v3] == <span class="hljs-number">35</span> )<span class="hljs-comment">//比较逻辑</span><br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;不能移动到墙壁&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    byte_7FF7EC589040[<span class="hljs-number">101</span> * dword_7FF7EC58E0C8 + dword_7FF7EC58E0C4] = <span class="hljs-number">32</span>;<br>    dword_7FF7EC58E0C4 = v5;<br>    dword_7FF7EC58E0C8 = v4;<br>    byte_7FF7EC589040[v3] = <span class="hljs-number">80</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在Hex View跟随比较逻辑中的这个数组的地址(7FF7EC589040)可以看到迷宫：</p>
<p><img src="/../images/image-20251105210910030.png" alt="迷宫"></p>
<p>但是提取出迷宫会发现，这个迷宫和直接运行程序时终端显示的迷宫不一样</p>
<p>推测程序加了反调试。最直接的绕过方法就是用xdbg调试，用插件ScyllaHide直接绕过反调试检测。在转储找到相同的地址可以得到真正的迷宫</p>
<p><img src="/../images/image-20251105212443210.png" alt="真正的迷宫"></p>
<p>选中迷宫地图数据右键二进制保存到文件，把文件格式改为txt</p>
<p><img src="/../images/image-20251105213100678.png" alt="保存迷宫地图"></p>
<p>然后就可以让AI写个解迷宫脚本解出路径，按照程序的提示把路径进行MD5加密就可以得到flag了</p>
</li>
<li><p>解迷宫脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve_maze</span>(<span class="hljs-params">maze, start, end, wall=<span class="hljs-string">&#x27;#&#x27;</span>, free=<span class="hljs-string">&#x27; &#x27;</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Maze solver using BFS&quot;&quot;&quot;</span><br>    directions = &#123;<br>        (-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>): <span class="hljs-string">&#x27;w&#x27;</span>,  <span class="hljs-comment"># up</span><br>        (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>): <span class="hljs-string">&#x27;s&#x27;</span>,   <span class="hljs-comment"># down  </span><br>        (<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>): <span class="hljs-string">&#x27;a&#x27;</span>,  <span class="hljs-comment"># left</span><br>        (<span class="hljs-number">0</span>, <span class="hljs-number">1</span>): <span class="hljs-string">&#x27;d&#x27;</span>    <span class="hljs-comment"># right</span><br>    &#125;<br>    <br>    rows, cols = <span class="hljs-built_in">len</span>(maze), <span class="hljs-built_in">len</span>(maze[<span class="hljs-number">0</span>])<br>    visited = [[<span class="hljs-literal">False</span>] * cols <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(rows)]<br>    <br>    <span class="hljs-comment"># BFS</span><br>    queue = deque([(start[<span class="hljs-number">0</span>], start[<span class="hljs-number">1</span>], <span class="hljs-string">&quot;&quot;</span>)])<br>    visited[start[<span class="hljs-number">0</span>]][start[<span class="hljs-number">1</span>]] = <span class="hljs-literal">True</span><br>    <br>    <span class="hljs-keyword">while</span> queue:<br>        row, col, path = queue.popleft()<br>        <br>        <span class="hljs-keyword">if</span> (row, col) == end:<br>            <span class="hljs-keyword">return</span> path<br>        <br>        <span class="hljs-keyword">for</span> dr, dc <span class="hljs-keyword">in</span> directions.keys():<br>            new_row, new_col = row + dr, col + dc<br>            <br>            <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt;= new_row &lt; rows <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> &lt;= new_col &lt; cols <span class="hljs-keyword">and</span> <br>                <span class="hljs-keyword">not</span> visited[new_row][new_col] <span class="hljs-keyword">and</span> <br>                maze[new_row][new_col] != wall):<br>                <br>                visited[new_row][new_col] = <span class="hljs-literal">True</span><br>                new_path = path + directions[(dr, dc)]<br>                queue.append((new_row, new_col, new_path))<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><span class="hljs-comment"># Load maze and solve</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;final_maze.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    maze = [<span class="hljs-built_in">list</span>(line.strip()) <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f]<br><br>start = (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>end = (<span class="hljs-number">99</span>, <span class="hljs-number">99</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Maze size: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(maze)&#125;</span> x <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(maze[<span class="hljs-number">0</span>])&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Start: <span class="hljs-subst">&#123;start&#125;</span>, End: <span class="hljs-subst">&#123;end&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># Solve the maze</span><br>solution = solve_maze(maze, start, end, wall=<span class="hljs-string">&#x27;#&#x27;</span>, free=<span class="hljs-string">&#x27; &#x27;</span>)<br><br><span class="hljs-keyword">if</span> solution:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Solution found!&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Path length: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(solution)&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-comment"># Print FULL path</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nFULL PATH:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(solution)<br>    <br>    <span class="hljs-comment"># Save full path</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;maze_solution.txt&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(solution)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nFull path saved to maze_solution.txt&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;No solution found!&quot;</span>)<br></code></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>flag：0xGame{44fc4bc18c87b3992af1d7726185ed36}</p>
</blockquote>
<h2 id="绯想天则"><a href="#绯想天则" class="headerlink" title="绯想天则"></a>绯想天则</h2><blockquote>
<p>考点：unity逆向改游戏机制</p>
</blockquote>
<ul>
<li><p>附件是个unity游戏</p>
<p><img src="/../images/image-20251105213705664.png" alt="unity游戏"></p>
<p>boss血条很厚，怎么打都打不过，角色很容易死。所以考虑改游戏机制</p>
</li>
<li><p>参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/xianyu_yuan/article/details/140899803">从出题到做题——浅探Unity游戏逆向</a>，找到IWANNATENSHIFUMOのINESBATTLE\I WANNA TENSHI FUMOのFIGHT WITH INES_Data\Managed\Assembly-CSharp.dll，用dnspy打开进行修改。修改思路是给角色加上锁血和一击毙命buff，修改的类是CharacterStats，至于怎么修改可以把整个类的代码发给AI问怎么改锁血和一击毙命，因为附件程序工程比较大，没有上下文的话不好描述，此处省略修改方案了。修改方法是在类代码页右键选择编辑类</p>
<p><img src="/../images/image-20251105220015560.png" alt="右键编辑类"></p>
<p>修改完点击右下角的编译即可。此外，笔者在编译的时候遇到了一些报错：random’is anbiguous reference between ‘unityengine.random’and ‘system.random，此时把代码中所有的Random.Range都改成UnityEngine.Random.Range即可。</p>
<p>修改完成后，重新运行游戏就可以速通得到flag了</p>
<p><img src="/../images/image-20251105220511591.png" alt="速通"></p>
</li>
</ul>
<blockquote>
<p>flag：0xGame{TenshiSamaSaiko_IWANNATENSHIFUMO_INESBATTLE}</p>
</blockquote>
<h2 id="幻视调律"><a href="#幻视调律" class="headerlink" title="幻视调律"></a>幻视调律</h2><blockquote>
<p>考点：函数重写，RC4，TEA</p>
</blockquote>
<ul>
<li><p>附件程序运行起来是很常规的输入flag提示：</p>
<p><img src="/../images/image-20251106193030935.png" alt="常规"></p>
<p>用IDA打开，Shift+F12可以看到可疑字符串</p>
<p><img src="/../images/image-20251106193216226.png" alt="可疑字符串"></p>
<p>跟踪可疑字符串可以找到main函数</p>
<p><img src="/../images/image-20251106193251339.png" alt="main函数"></p>
<p>简单优化一下</p>
<p><img src="/../images/image-20251106193416659.png" alt="优化后的main函数"></p>
<p>可以看到函数对输入的内容进行了RC4加密后才校验。但是作为第四周的题目，这样子显然还是太直白了。动调一下可以发现，strcmp函数被重写了</p>
<p><img src="/../images/image-20251106195811100.png" alt="跟踪strcmp1"></p>
<p><img src="/../images/image-20251106195827424.png" alt="跟踪strcmp2"></p>
<p><img src="/../images/image-20251106195843505.png" alt="跟踪strcmp3"></p>
<p>可以看到，strcmp最后被导向了sub_140003000，函数反编译如下（经过优化），是个TEA加密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs C">_BOOL8 __fastcall <span class="hljs-title function_">sub_140003000</span><span class="hljs-params">(<span class="hljs-type">void</span> *a1, _DWORD *a2)</span><br>&#123;<br>  _DWORD Buf2[<span class="hljs-number">14</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-60h] BYREF</span><br>  _DWORD *key; <span class="hljs-comment">// [rsp+58h] [rbp-28h]</span><br>  <span class="hljs-type">void</span> *Buf1; <span class="hljs-comment">// [rsp+60h] [rbp-20h]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+6Ch] [rbp-14h]</span><br>  <span class="hljs-type">int</span> sum; <span class="hljs-comment">// [rsp+70h] [rbp-10h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> p2; <span class="hljs-comment">// [rsp+74h] [rbp-Ch]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> p1; <span class="hljs-comment">// [rsp+78h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+7Ch] [rbp-4h]</span><br><br>  Buf1 = a1;<br>  key = a2;<br>  Buf2[<span class="hljs-number">0</span>] = <span class="hljs-number">1111022553</span>;<br>  Buf2[<span class="hljs-number">1</span>] = <span class="hljs-number">987309029</span>;<br>  Buf2[<span class="hljs-number">2</span>] = <span class="hljs-number">-1041056711</span>;<br>  Buf2[<span class="hljs-number">3</span>] = <span class="hljs-number">979189025</span>;<br>  Buf2[<span class="hljs-number">4</span>] = <span class="hljs-number">189565873</span>;<br>  Buf2[<span class="hljs-number">5</span>] = <span class="hljs-number">173973774</span>;<br>  Buf2[<span class="hljs-number">6</span>] = <span class="hljs-number">1090109393</span>;<br>  Buf2[<span class="hljs-number">7</span>] = <span class="hljs-number">-591836169</span>;<br>  Buf2[<span class="hljs-number">8</span>] = <span class="hljs-number">-394857933</span>;<br>  Buf2[<span class="hljs-number">9</span>] = <span class="hljs-number">668605093</span>;<br>  Buf2[<span class="hljs-number">10</span>] = <span class="hljs-number">0xB952BACB</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">9</span>; ++i )<br>  &#123;<br>    sum = <span class="hljs-number">0</span>;<br>    p1 = *((_DWORD *)Buf1 + i);<br>    p2 = *((_DWORD *)Buf1 + i + <span class="hljs-number">1</span>);<br>    sum = <span class="hljs-number">0x9E3779B9</span>;<br>    <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">31</span>; ++j )<br>    &#123;<br>      p1 += (sum + p2) ^ (*key + <span class="hljs-number">16</span> * p2) ^ ((p2 &gt;&gt; <span class="hljs-number">5</span>) + key[<span class="hljs-number">1</span>]);<br>      sum -= <span class="hljs-number">0x61C88647</span>;<br>      p2 += (sum + p1) ^ (key[<span class="hljs-number">2</span>] + <span class="hljs-number">16</span> * p1) ^ ((p1 &gt;&gt; <span class="hljs-number">5</span>) + key[<span class="hljs-number">3</span>]);<br>    &#125;<br>    *((_DWORD *)Buf1 + i) = p1;<br>    *((_DWORD *)Buf1 + i + <span class="hljs-number">1</span>) = p2;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">memcmp</span>(Buf1, Buf2, <span class="hljs-number">0x2Cu</span>LL) != <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>所以，完整的加密流程是先RC4再TEA，TEA的key是main函数中strcmp的参数str2，密文是TEA最后面出现的Buf2。</p>
<p>还有一些需要关注的点：程序事实上进行了两次RC4加密，第一次是为了输出”input your flag:”，第二次才是加密输入的内容。所以，动调时在函数进行输出后、第二次RC4加密前才能提取出真的S盒</p>
<p>在反编译出来的函数的基础上可以写出解密脚本：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">RC4_decrypt</span><span class="hljs-params">(<span class="hljs-type">char</span> *a1, <span class="hljs-type">int</span> a2)</span> &#123;<br>    <span class="hljs-comment">//直接提取S盒</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> byte_140008060[<span class="hljs-number">256</span>] = &#123;<br>    <span class="hljs-number">0x99</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0x87</span>, <br>    <span class="hljs-number">0x2C</span>, <span class="hljs-number">0xB5</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0xC7</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x4E</span>, <br>    <span class="hljs-number">0x3E</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0xF3</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0xD3</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0x2D</span>, <br>    <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0xFA</span>, <span class="hljs-number">0xD0</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0xDF</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0xB4</span>, <br>    <span class="hljs-number">0x8C</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0xAD</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x77</span>, <br>    <span class="hljs-number">0x4B</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0xE1</span>, <br>    <span class="hljs-number">0xCD</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0xCA</span>, <br>    <span class="hljs-number">0x89</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0xEF</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0xC6</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0xA3</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0xEB</span>, <br>    <span class="hljs-number">0x3A</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0xC0</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0xE9</span>, <br>    <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0xDB</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x51</span>, <br>    <span class="hljs-number">0xFB</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0x7D</span>, <br>    <span class="hljs-number">0x7C</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0xAE</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x7A</span>, <br>    <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0xAC</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0xB1</span>, <br>    <span class="hljs-number">0xE6</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0xBA</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0x3B</span>, <br>    <span class="hljs-number">0x35</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x2B</span>, <br>    <span class="hljs-number">0xCC</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x9E</span><br>&#125;;<br>    <span class="hljs-type">unsigned</span> __int8 v3; <span class="hljs-comment">// [rsp+0h] [rbp-10h]</span><br>    <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+4h] [rbp-Ch]</span><br>    <span class="hljs-type">int</span> v5; <span class="hljs-comment">// [rsp+8h] [rbp-8h]</span><br>    <span class="hljs-type">int</span> v6; <span class="hljs-comment">// [rsp+Ch] [rbp-4h]</span><br><br>    v6 = <span class="hljs-number">0</span>;<br>    v5 = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; a2; ++i )<br>    &#123;<br>        v6 = (v6 + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>;<br>        v5 = (byte_140008060[v6] + v5) % <span class="hljs-number">256</span>;<br>        v3 = byte_140008060[v6];<br>        byte_140008060[v6] = byte_140008060[v5];<br>        byte_140008060[v5] = v3;<br>        *(<span class="hljs-type">char</span> *)(i + a1) = byte_140008060[(<span class="hljs-type">unsigned</span> __int8)(byte_140008060[v6] + byte_140008060[v5])] ^ *(<span class="hljs-type">char</span> *)(a1 + i);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>  	<span class="hljs-comment">//用作key的str2</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> Str2[<span class="hljs-number">44</span>] = &#123;<br>    <span class="hljs-number">0x9F</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0xC0</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x55</span>, <br>    <span class="hljs-number">0x80</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x25</span>, <br>    <span class="hljs-number">0x7B</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0xE9</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0xC7</span><br>    &#125;;<br>    <br>    <span class="hljs-comment">//下面是在反编译TEA的基础上改的，直接解密Buf2</span><br>    <span class="hljs-type">uint32_t</span> Buf2[<span class="hljs-number">14</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-60h] BYREF</span><br>    <span class="hljs-type">uint32_t</span> *key; <span class="hljs-comment">// [rsp+58h] [rbp-28h]</span><br>    <span class="hljs-comment">//void *Buf1; // [rsp+60h] [rbp-20h]</span><br>    <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+6Ch] [rbp-14h]</span><br>    <span class="hljs-type">int</span> sum; <span class="hljs-comment">// [rsp+70h] [rbp-10h]</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> p2; <span class="hljs-comment">// [rsp+74h] [rbp-Ch]</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> p1; <span class="hljs-comment">// [rsp+78h] [rbp-8h]</span><br>    <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+7Ch] [rbp-4h]</span><br><br>    <span class="hljs-comment">//Buf1 = a1;</span><br>    key = (<span class="hljs-type">uint32_t</span> *)Str2;<br>    Buf2[<span class="hljs-number">0</span>] = <span class="hljs-number">1111022553</span>;<br>    Buf2[<span class="hljs-number">1</span>] = <span class="hljs-number">987309029</span>;<br>    Buf2[<span class="hljs-number">2</span>] = <span class="hljs-number">-1041056711</span>;<br>    Buf2[<span class="hljs-number">3</span>] = <span class="hljs-number">979189025</span>;<br>    Buf2[<span class="hljs-number">4</span>] = <span class="hljs-number">189565873</span>;<br>    Buf2[<span class="hljs-number">5</span>] = <span class="hljs-number">173973774</span>;<br>    Buf2[<span class="hljs-number">6</span>] = <span class="hljs-number">1090109393</span>;<br>    Buf2[<span class="hljs-number">7</span>] = <span class="hljs-number">-591836169</span>;<br>    Buf2[<span class="hljs-number">8</span>] = <span class="hljs-number">-394857933</span>;<br>    Buf2[<span class="hljs-number">9</span>] = <span class="hljs-number">668605093</span>;<br>    Buf2[<span class="hljs-number">10</span>] = <span class="hljs-number">0xB952BACB</span>;<br>    <span class="hljs-comment">//这里原来是从&lt;Buf[0],Buf[1]&gt;到&lt;Buf[9],Buf[10]&gt;一对一对加密，现在反过来从&lt;Buf[9],Buf[10]&gt;开始到&lt;Buf[0],Buf[1]&gt;</span><br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">9</span>; i &gt;= <span class="hljs-number">0</span>; --i )<br>    &#123;<br>        sum = <span class="hljs-number">0</span>;<br>        p1 = *((<span class="hljs-type">uint32_t</span>*)Buf2 + i);<br>        p2 = *((<span class="hljs-type">uint32_t</span>*)Buf2 + i + <span class="hljs-number">1</span>);<br>        sum = <span class="hljs-number">0x9E3779B9</span>;<br>        <span class="hljs-comment">//模拟正向加密得到最后的sum值</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++)&#123;<br>            sum-=<span class="hljs-number">0x61C88647</span>;<br>        &#125;<br>        <span class="hljs-comment">//p1，p2的处理顺序调换，加减调换，sum加减调换</span><br>        <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">31</span>; ++j )<br>        &#123;<br>        p2 -= (sum + p1) ^ (key[<span class="hljs-number">2</span>] + <span class="hljs-number">16</span> * p1) ^ ((p1 &gt;&gt; <span class="hljs-number">5</span>) + key[<span class="hljs-number">3</span>]);<br>        sum += <span class="hljs-number">0x61C88647</span>;<br>        p1 -= (sum + p2) ^ (*key + <span class="hljs-number">16</span> * p2) ^ ((p2 &gt;&gt; <span class="hljs-number">5</span>) + key[<span class="hljs-number">1</span>]);<br>        &#125;<br>        *((<span class="hljs-type">uint32_t</span>*)Buf2 + i) = p1;<br>        *((<span class="hljs-type">uint32_t</span>*)Buf2 + i + <span class="hljs-number">1</span>) = p2;<br>    &#125;<br>    RC4_decrypt((<span class="hljs-type">char</span> *)Buf2,<span class="hljs-number">44</span>);<br>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">44</span>;i++)<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>,((<span class="hljs-type">char</span> *)Buf2)[i]);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>flag：0xGame{20994d4d-30ab-4918-b00a-5ca6ae138613}</p>
</blockquote>
<h2 id="花鸟风月"><a href="#花鸟风月" class="headerlink" title="花鸟风月"></a>花鸟风月</h2><blockquote>
<p>考点：花指令，魔改base64，异或，动态调试</p>
</blockquote>
<ul>
<li><p>附件程序运行起来是这样的：</p>
<p><img src="/../images/image-20251107170326209.png" alt="运行程序"></p>
<p>用IDA打开，Shift+F12在字符串窗口可以找到类似base64编码表的可疑字符串</p>
<p><img src="/../images/image-20251107171007199.png" alt="可疑的字符串"></p>
<p>随后可以跟踪到这样一个貌似base64编码的函数</p>
<p><img src="/../images/image-20251107171139700.png" alt="跟踪到一个类似base64编码的函数"></p>
<p>选中函数名按X回溯上层函数，会发现无法反编译了，栈帧报错</p>
<p><img src="/../images/image-20251107171338976.png" alt="栈帧报错"></p>
<p>在报错的附近可以看到反汇编失败的一堆数字，以及一个典型的jnz+jz花指令</p>
<p>选中上图中的loc_4012F2按U可以得到下图</p>
<p><img src="/../images/image-20251107172247039.png" alt="undefine"></p>
<p>此时只需要把jnz和jz以及后面的0E8h给nop掉即可，再选中unk_4012F3按C即可得到修正后的汇编代码</p>
<p><img src="/../images/image-20251107172437327.png" alt="修正后的汇编代码"></p>
<p>同样的花指令大概有3个，去除后可以在上文找到另一个报错</p>
<p><img src="/../images/image-20251107173258987.png" alt="另一个报错"></p>
<p>这里可以发现报错处的上一句是retn，所以把下面的loc_4012C0右键create function</p>
<p><img src="/../images/image-20251107173428095.png" alt="create function"></p>
<p>然后再回过头看这个报错，前面不远有一个很可疑的call $+5，显然是人为修改的</p>
<p><img src="/../images/image-20251112220409411.png" alt="可疑的call $+5"></p>
<p>仔细分析这段汇编代码会发现，这也是一个花指令</p>
<p><img src="/../images/image-20251112220643619.png" alt="分析汇编代码"></p>
<p>实际上程序在jz处不跳直接retn后，会回到xor eax,1这一行，原因是：call $+5即call 0x0040122D，又即push rip(0x0040122D)  jmp 0x0040122D，所以retn后程序回到栈上的rip(0x0040122D)处，即xor eax,1。IDA反编译会被这个retn给欺骗，误以为函数到此结束，其实后面还有一些内容。所以直接吧loc_401223这一整段nop掉，就可以得到完整的反编译代码</p>
<p><img src="/../images/image-20251113211300972.png" alt="完整的反编译代码"></p>
<p>优化一下这个函数和上文的类似base编码的函数的命名，可以得到。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">int</span> <span class="hljs-title function_">sub_4012C0</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">char</span> *v0; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v1; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v2; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v5; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v6; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v7; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v8; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [esp-4h] [ebp-ECh]</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [esp+10h] [ebp-D8h] BYREF</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// [esp+14h] [ebp-D4h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+18h] [ebp-D0h]</span><br>  _BYTE v13[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+1Ch] [ebp-CCh] BYREF</span><br>  _BYTE v14[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+80h] [ebp-68h] BYREF</span><br><br>  v11 = <span class="hljs-number">0x81428113</span>;<br>  v0 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_422054);<br>  sub_401670(v0);<br>  v1 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_422068);<br>  sub_4016B0(v1, (<span class="hljs-type">char</span>)&amp;v10);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i )<br>  &#123;<br>    v11 = <span class="hljs-number">21106755</span> * v11 + <span class="hljs-number">1126795285</span>;<br>    v11 ^= __ROL4__(<br>             v10,<br>             i * (byte_422007 + byte_422004)<br>           % (byte_422008<br>            + byte_422004<br>            + byte_422005 * byte_422008<br>            + byte_422AA0 * (byte_422002 + byte_422006 + byte_422003)<br>            - byte_422005 * byte_422005));<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v11 == <span class="hljs-number">0xA745DA5D</span> )<br>  &#123;<br>    v2 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_42206C);<br>    sub_401670(v2);<br>    v5 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_422094);<br>    sub_401670(v5);<br>    v6 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_4220A4);<br>    sub_4016B0(v6, (<span class="hljs-type">char</span>)v14);<br>    XORencrypt(v14, v10, byte_422004 + byte_422002 + byte_422008 * byte_422003);<br>    baseEncode((<span class="hljs-type">int</span>)v14, (<span class="hljs-type">int</span>)v13, byte_422005 + byte_422001 + byte_422008 * byte_422003);<br>    v9 = byte_422004 * byte_422003 * byte_422002;<br>    v7 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_4220A8);<br>    <span class="hljs-keyword">if</span> ( sub_40B460(v13, v7, v9) )<br>      v8 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_4220FC);<br>    <span class="hljs-keyword">else</span><br>      v8 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_4220E8);<br>    sub_401670(v8);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v3 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_422080);<br>    sub_401670(v3);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>其中byte_42200x的值都是x+1，所以可以进一步优化</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">int</span> <span class="hljs-title function_">sub_4012C0</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">char</span> *v0; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v1; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v2; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v5; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v6; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v7; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v8; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [esp-4h] [ebp-ECh]</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [esp+10h] [ebp-D8h] BYREF</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// [esp+14h] [ebp-D4h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+18h] [ebp-D0h]</span><br>  _BYTE v13[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+1Ch] [ebp-CCh] BYREF</span><br>  _BYTE v14[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+80h] [ebp-68h] BYREF</span><br><br>  v11 = <span class="hljs-number">0x81428113</span>;<br>  v0 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_422054);<br>  sub_401670(v0);<br>  v1 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_422068);<br>  sub_4016B0(v1, (<span class="hljs-type">char</span>)&amp;v10);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i )<br>  &#123;<br>    v11 = <span class="hljs-number">0x1421043</span> * v11 + <span class="hljs-number">0x43298815</span>;<br>    v11 ^= __ROL4__(v10, i * (<span class="hljs-number">8</span> + <span class="hljs-number">5</span>) % (<span class="hljs-number">9</span> + <span class="hljs-number">5</span> + <span class="hljs-number">6</span> * <span class="hljs-number">9</span> + <span class="hljs-number">0</span> * (<span class="hljs-number">3</span> + <span class="hljs-number">7</span> + <span class="hljs-number">4</span>) - <span class="hljs-number">6</span> * <span class="hljs-number">6</span>));<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v11 == <span class="hljs-number">0xA745DA5D</span> )<br>  &#123;<br>    v2 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_42206C);<br>    sub_401670(v2);<br>    v5 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_422094);<br>    sub_401670(v5);<br>    v6 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_4220A4);<br>    sub_4016B0(v6, (<span class="hljs-type">char</span>)v14);<br>    XORencrypt(v14, v10, <span class="hljs-number">5</span> + <span class="hljs-number">3</span> + <span class="hljs-number">9</span> * <span class="hljs-number">4</span>);<br>    baseEncode((<span class="hljs-type">int</span>)v14, (<span class="hljs-type">int</span>)v13, <span class="hljs-number">6</span> + <span class="hljs-number">2</span> + <span class="hljs-number">9</span> * <span class="hljs-number">4</span>);<br>    v9 = <span class="hljs-number">5</span> * <span class="hljs-number">4</span> * <span class="hljs-number">3</span>;<br>    v7 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_4220A8);<br>    <span class="hljs-keyword">if</span> ( sub_40B460(v13, v7, v9) )<br>      v8 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_4220FC);<br>    <span class="hljs-keyword">else</span><br>      v8 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_4220E8);<br>    sub_401670(v8);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v3 = sub_401000((<span class="hljs-type">int</span>)&amp;unk_422080);<br>    sub_401670(v3);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>动调可以发现程序的提示词是实时解密的，sub_401000是解密函数，sub_401670是输出函数，sub_4016B0是输入函数。下面是具体过程：</p>
<p>在函数的开头下断点，开始调试。程序停在了下图这个地方，可以看到随后有一些奇怪的数据，直接nop掉</p>
<p><img src="/../images/image-20251107211205450.png" alt="奇怪的数据"></p>
<p><img src="/../images/image-20251107211234103.png" alt="nop掉"></p>
<p>继续运行程序会发现执行过sub_7C1670（对应静态分析时的sub_401670，动态调试换基址了所以地址前两位有些不同）后程序会有提示输出，因此推断sub_7C1670是print</p>
<p><img src="/../images/image-20251107212238679.png" alt="提示输出"></p>
<p>而观察静态分析时的代码可以发现，sub_401000几乎和sub_401670是同时出现的，动态调试对应的sub_7C1000函数反编译如下</p>
<p><img src="/../images/image-20251107212753102.png" alt="sub_7C1000反编译"></p>
<p>同时可以发现byte_7E3440此时存储的正好是Input key (Hex) （此时已经步过这个函数了，所以byte_7E3440已经被处理过了）:</p>
<p><img src="/../images/image-20251107212917688.png" alt="byte_7E3440"></p>
<p>所以可以推测提示词是实时解密的，sub_401000是解密函数</p>
<p>接下来还有个sub_7C16B0，推测是scanf</p>
<p><img src="/../images/image-20251107215116511.png" alt="sub_7C16B0"></p>
<p>在动态调试随后的代码里，会发现还有花指令（有两处，不知道是不是静态分析时的去混淆没有保存）</p>
<p><img src="/../images/image-20251107215446744.png" alt="花指令"></p>
<p>同样的操作nop掉后，反编译得到</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">void</span> <span class="hljs-title function_">sub_7C12C0</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">char</span> *v0; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v1; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v2; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v4; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v5; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v6; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v7; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [esp-4h] [ebp-ECh]</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [esp+10h] [ebp-D8h] BYREF</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [esp+14h] [ebp-D4h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+18h] [ebp-D0h]</span><br>  _BYTE v12[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+1Ch] [ebp-CCh] BYREF</span><br>  _BYTE v13[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+80h] [ebp-68h] BYREF</span><br><br>  v10 = <span class="hljs-number">0x81428113</span>;<br>  v0 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E2054);<br>  print(v0);<br>  v1 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E2068);<br>  <span class="hljs-built_in">scanf</span>(v1, (<span class="hljs-type">char</span>)&amp;v9);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i )<br>  &#123;<br>    v10 = <span class="hljs-number">0x1421043</span> * v10 + <span class="hljs-number">0x43298815</span>;<br>    v10 ^= __ROL4__(v9, i * (<span class="hljs-number">8</span> + <span class="hljs-number">5</span>) % (<span class="hljs-number">9</span> + <span class="hljs-number">5</span> + <span class="hljs-number">6</span> * <span class="hljs-number">9</span> + <span class="hljs-number">0</span> * (<span class="hljs-number">3</span> + <span class="hljs-number">7</span> + <span class="hljs-number">4</span>) - <span class="hljs-number">6</span> * <span class="hljs-number">6</span>));<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v10 == <span class="hljs-number">0xA745DA5D</span> )<br>  &#123;<br>    v2 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E206C);<br>    print(v2);<br>    v4 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E2094);<br>    print(v4);<br>    v5 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E20A4);<br>    <span class="hljs-built_in">scanf</span>(v5, (<span class="hljs-type">char</span>)v13);<br>    XORencrypt((<span class="hljs-type">int</span>)v13, v9, <span class="hljs-number">5</span> + <span class="hljs-number">3</span> + <span class="hljs-number">9</span> * <span class="hljs-number">4</span>);<br>    baseEncode((<span class="hljs-type">int</span>)v13, (<span class="hljs-type">int</span>)v12, <span class="hljs-number">6</span> + <span class="hljs-number">2</span> + <span class="hljs-number">9</span> * <span class="hljs-number">4</span>);<br>    v8 = <span class="hljs-number">5</span> * <span class="hljs-number">4</span> * <span class="hljs-number">3</span>;<br>    v6 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E20A8);<br>    <span class="hljs-keyword">if</span> ( sub_7CB460(v12, v6, v8) )<br>      v7 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E20FC);<br>    <span class="hljs-keyword">else</span><br>      v7 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E20E8);<br>    print(v7);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v3 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E2080);<br>    print(v3);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>此时得到更加清晰的代码了，同时可以发现程序首先对输入的key进行了校验。</p>
<p>为了继续了解程序逻辑，这里选择修改if语句条件的判断结果来绕过key检验，只需要在cmp后修改ZF标志位，让jnz不成立即可</p>
<p><img src="/../images/image-20251107220443790.png" alt="绕过key检验"></p>
<p><img src="/../images/image-20251107220708346.png" alt="成功绕过key检验"></p>
<p>继续运行程序会有输入flag的提示</p>
<p><img src="/../images/image-20251107220805016.png" alt="输入flag的提示"></p>
<p>至此，可以猜出程序的大致逻辑：接收一个key并进行检验，检验成功则继续检验flag，同时需要注意key会作为flag检验的一个参数。下面是优化后的最终代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">void</span> <span class="hljs-title function_">sub_7C12C0</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">char</span> *v0; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v1; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v2; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v4; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v5; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *targetResult; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *v7; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [esp-4h] [ebp-ECh]</span><br>  <span class="hljs-type">int</span> key; <span class="hljs-comment">// [esp+10h] [ebp-D8h] BYREF</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [esp+14h] [ebp-D4h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+18h] [ebp-D0h]</span><br>  _BYTE encodedInput[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+1Ch] [ebp-CCh] BYREF</span><br>  _BYTE input[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+80h] [ebp-68h] BYREF</span><br><br>  v10 = <span class="hljs-number">0x81428113</span>;<br>  v0 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E2054);          <span class="hljs-comment">// input key</span><br>  print(v0);<br>  v1 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E2068);<br>  <span class="hljs-built_in">scanf</span>(v1, (<span class="hljs-type">char</span>)&amp;key);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i )<br>  &#123;<br>    v10 = <span class="hljs-number">0x1421043</span> * v10 + <span class="hljs-number">0x43298815</span>;<br>    v10 ^= __ROL4__(key, i * (<span class="hljs-number">8</span> + <span class="hljs-number">5</span>) % (<span class="hljs-number">9</span> + <span class="hljs-number">5</span> + <span class="hljs-number">6</span> * <span class="hljs-number">9</span> + <span class="hljs-number">0</span> * (<span class="hljs-number">3</span> + <span class="hljs-number">7</span> + <span class="hljs-number">4</span>) - <span class="hljs-number">6</span> * <span class="hljs-number">6</span>));<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v10 == <span class="hljs-number">0xA745DA5D</span> )<br>  &#123;<br>    v2 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E206C);        <span class="hljs-comment">// key is correct</span><br>    print(v2);<br>    v4 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E2094);        <span class="hljs-comment">// input flag</span><br>    print(v4);<br>    v5 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E20A4);<br>    <span class="hljs-built_in">scanf</span>(v5, (<span class="hljs-type">char</span>)input);<br>    XORencrypt((<span class="hljs-type">int</span>)input, key, <span class="hljs-number">5</span> + <span class="hljs-number">3</span> + <span class="hljs-number">9</span> * <span class="hljs-number">4</span>);<br>    baseEncode((<span class="hljs-type">int</span>)input, (<span class="hljs-type">int</span>)encodedInput, <span class="hljs-number">6</span> + <span class="hljs-number">2</span> + <span class="hljs-number">9</span> * <span class="hljs-number">4</span>);<br>    v8 = <span class="hljs-number">5</span> * <span class="hljs-number">4</span> * <span class="hljs-number">3</span>;<br>    targetResult = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E20A8);<span class="hljs-comment">// 此处解密的值被用来和输入值的加密结果进行比较了，所以推测是真正的flag密文</span><br>    <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strcmp</span>(encodedInput, targetResult, v8) )<br>      v7 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E20FC);<br>    <span class="hljs-keyword">else</span><br>      v7 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E20E8);<br>    print(v7);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v3 = decodeNotice((<span class="hljs-type">int</span>)&amp;unk_7E2080);<br>    print(v3);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>targetResult也是实时解密的结果，所以可以动调提取</p>
<p>程序的加密流程是先XORencrypt再baseEncode，所以解密要先baseDecode再XORenc。baseEncode优化后如下，可以发现不是标准的base64编码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">baseEncode</span><span class="hljs-params">(<span class="hljs-type">int</span> input, <span class="hljs-type">int</span> output, <span class="hljs-type">int</span> length)</span><br>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> code2; <span class="hljs-comment">// [esp+Ah] [ebp-56h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+Ch] [ebp-54h]</span><br>  <span class="hljs-type">char</span> code4; <span class="hljs-comment">// [esp+12h] [ebp-4Eh]</span><br>  <span class="hljs-type">char</span> code3; <span class="hljs-comment">// [esp+13h] [ebp-4Dh]</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [esp+14h] [ebp-4Ch]</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [esp+14h] [ebp-4Ch]</span><br>  <span class="hljs-type">char</span> baseTable[<span class="hljs-number">68</span>]; <span class="hljs-comment">// [esp+18h] [ebp-48h] BYREF</span><br><br>  v8 = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">strcpy</span>(baseTable, <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; length; i += <span class="hljs-number">3</span> )<br>  &#123;<br>    code3 = baseTable[((*(i + input + <span class="hljs-number">1</span>) &gt;&gt; <span class="hljs-number">4</span>) | (<span class="hljs-number">16</span> * *(i + input))) &amp; <span class="hljs-number">63</span>];<span class="hljs-comment">// baseTable[((input[i+1]&gt;&gt;4)|(input[i]&lt;&lt;4))&amp;63]</span><br>    <span class="hljs-keyword">if</span> ( i + <span class="hljs-number">1</span> &gt;= length )<br>      code3 = <span class="hljs-string">&#x27;=&#x27;</span>;<br>    <span class="hljs-keyword">else</span><br>      code2 = baseTable[((*(i + input + <span class="hljs-number">2</span>) &gt;&gt; <span class="hljs-number">6</span>) | (<span class="hljs-number">4</span> * *(i + input + <span class="hljs-number">1</span>))) &amp; <span class="hljs-number">63</span>];<span class="hljs-comment">// baseTable[((input[i+2]&gt;&gt;6)|(input[i+1]&lt;&lt;2))&amp;63]</span><br>    <span class="hljs-keyword">if</span> ( i + <span class="hljs-number">2</span> &gt;= length )<br>      code4 = <span class="hljs-string">&#x27;=&#x27;</span>;<br>    <span class="hljs-keyword">else</span><br>      code4 = baseTable[*(i + input + <span class="hljs-number">2</span>) &amp; <span class="hljs-number">63</span>]; <span class="hljs-comment">// baseTable[input[i+2]&amp;63]</span><br>    *(v8 + output) = baseTable[(*(i + input) &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">63</span>];<span class="hljs-comment">// baseTable[(input[i]&gt;&gt;2)&amp;63]</span><br>    v9 = v8 + <span class="hljs-number">1</span>;<br>    *(v9 + output) = code2;<br>    *(++v9 + output) = code3;<br>    *(++v9 + output) = code4;<br>    v8 = v9 + <span class="hljs-number">1</span>;<br>    result = i + <span class="hljs-number">3</span>;<br>  &#125;<br>  *(v8 + output) = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>标准base64编码是按照字符顺序，把3个8bit的char转成4个6bit，即</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs C">code1=baseTable[input[i]&gt;&gt;<span class="hljs-number">2</span>];<br>code2=baseTable[(input[i]&lt;&lt;<span class="hljs-number">6</span>)|(input[i+<span class="hljs-number">1</span>]&gt;&gt;<span class="hljs-number">4</span>)];<br>code3=baseTable[(input[i+<span class="hljs-number">1</span>]&lt;&lt;<span class="hljs-number">4</span>)|(input[i+<span class="hljs-number">2</span>]&gt;&gt;<span class="hljs-number">6</span>)];<br>code4=baseTable[input[i+<span class="hljs-number">2</span>]&lt;&lt;<span class="hljs-number">2</span>];<br></code></pre></td></tr></table></figure>

<p>而程序里code2和code3顺序反了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs C">code1=baseTable[(input[i]&gt;&gt;<span class="hljs-number">2</span>)&amp;<span class="hljs-number">63</span>];<br>code2=baseTable[((input[i+<span class="hljs-number">1</span>]&lt;&lt;<span class="hljs-number">2</span>)|(input[i+<span class="hljs-number">2</span>]&gt;&gt;<span class="hljs-number">6</span>))&amp;<span class="hljs-number">63</span>];<br>code3=baseTable[((input[i]&lt;&lt;<span class="hljs-number">4</span>)|(input[i+<span class="hljs-number">1</span>]&gt;&gt;<span class="hljs-number">4</span>))&amp;<span class="hljs-number">63</span>];<br>code4=baseTable[input[i+<span class="hljs-number">2</span>]&amp;<span class="hljs-number">63</span>];<br><span class="hljs-comment">//PS：这里因为&amp;了63，所以拼成8位的code被截掉了高2位，剩下6位</span><br></code></pre></td></tr></table></figure>

<p>也就是说，程序的魔改base64编码和标准base64编码的不同点在于，编码时置换了第2、3个字符。因此我们此处的解密就是把每4个字符的第2、3个字符互换位置，然后使用标准base64解码即可。下面是basedecode的脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><br>enc=[<span class="hljs-number">0x4D</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x3D</span>]<br>basedecoded=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(enc),<span class="hljs-number">4</span>):<br>    basedecoded+=<span class="hljs-built_in">chr</span>(enc[i])<br>    basedecoded+=<span class="hljs-built_in">chr</span>(enc[i+<span class="hljs-number">2</span>])<br>    basedecoded+=<span class="hljs-built_in">chr</span>(enc[i+<span class="hljs-number">1</span>])<br>    basedecoded+=<span class="hljs-built_in">chr</span>(enc[i+<span class="hljs-number">3</span>])<br><span class="hljs-built_in">print</span>(basedecoded)<br><span class="hljs-comment">#MPADcG3tP3Q4v3MpNbB1PGWxcHctvHx1NaV9JTPtaSc57iIlNu5xJWS5Imw=</span><br>xorencoded=base64.b64decode(basedecoded)<br></code></pre></td></tr></table></figure>

<p>接下来是XORdecrypt。首先需要得到密钥，既然程序给了密钥的检验算法，可以复现这个算法来爆破密钥。下面是爆破脚本：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> __ROL4__(x, y)   ((((x) <span class="hljs-string">&lt;&lt; (y)) | ((x) &gt;</span>&gt; (32 - (y))))&amp;0xFFFFFFFF)</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v9,key;<br>    <span class="hljs-keyword">for</span>(key=<span class="hljs-number">0</span>;key&lt;=<span class="hljs-number">0xFFFFFFFF</span>;key++)&#123;<br>        v9 = <span class="hljs-number">0x81428113</span>;<br>        <span class="hljs-keyword">for</span> ( <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i )<br>        &#123;<br>            v9 = <span class="hljs-number">0x1421043</span> * v9 + <span class="hljs-number">0x43298815</span>;<br>            v9 ^= __ROL4__(key, i * (<span class="hljs-number">8</span> + <span class="hljs-number">5</span>) % (<span class="hljs-number">9</span> + <span class="hljs-number">5</span> + <span class="hljs-number">6</span> * <span class="hljs-number">9</span> + <span class="hljs-number">0</span> * (<span class="hljs-number">3</span> + <span class="hljs-number">7</span> + <span class="hljs-number">4</span>) - <span class="hljs-number">6</span> * <span class="hljs-number">6</span>));<br>        &#125;<br>        <span class="hljs-keyword">if</span> ( v9 == <span class="hljs-number">0xA745DA5D</span> )<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;key: 0x%08x\n&quot;</span>,key);<br>        &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-comment">//key: 0x98bf3b77</span><br></code></pre></td></tr></table></figure>

<p>然后是XOR解密，由于异或过程中不涉及密文前后位，只是单纯使用key，所以只需要复现异或过程就行了。但是照抄也不是很对，XORencrypt使用key的时候是进行了取位操作，把key分成了四个部分的，所以这部分要单独拿出来处理。脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">XORdecrypt</span>(<span class="hljs-params">data, key</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">44</span>):<br>        key_byte=(key &gt;&gt; (<span class="hljs-number">8</span> * (i % <span class="hljs-number">4</span>)))&amp;<span class="hljs-number">0xff</span><span class="hljs-comment">#单独处理每次使用的key，每次只取四分之一，直接抄原代码没有&amp;0xff的话会解密失败。</span><br>        data[i]^=key_byte<br>        data[i]=data[i]&amp;<span class="hljs-number">0xff</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">44</span>):<br>        key_byte=(key &gt;&gt; (<span class="hljs-number">8</span> * (j % <span class="hljs-number">4</span>)))&amp;<span class="hljs-number">0xff</span><br>        data[j]^=((key_byte &gt;&gt; <span class="hljs-number">4</span>) | (<span class="hljs-number">16</span> * key_byte))<br>        data[j]=data[j]&amp;<span class="hljs-number">0xff</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(data)<br></code></pre></td></tr></table></figure>

<p>完整脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">XORdecrypt</span>(<span class="hljs-params">data, key</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">44</span>):<br>        key_byte=(key &gt;&gt; (<span class="hljs-number">8</span> * (i % <span class="hljs-number">4</span>)))&amp;<span class="hljs-number">0xff</span><br>        data[i]^=key_byte<br>        data[i]=data[i]&amp;<span class="hljs-number">0xff</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">44</span>):<br>        key_byte=(key &gt;&gt; (<span class="hljs-number">8</span> * (j % <span class="hljs-number">4</span>)))&amp;<span class="hljs-number">0xff</span><br>        data[j]^=((key_byte &gt;&gt; <span class="hljs-number">4</span>) | (<span class="hljs-number">16</span> * key_byte))<br>        data[j]=data[j]&amp;<span class="hljs-number">0xff</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(data)<br><br>enc=[<span class="hljs-number">0x4D</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x3D</span>]<br>basedecoded=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(enc),<span class="hljs-number">4</span>):<br>    basedecoded+=<span class="hljs-built_in">chr</span>(enc[i])<br>    basedecoded+=<span class="hljs-built_in">chr</span>(enc[i+<span class="hljs-number">2</span>])<br>    basedecoded+=<span class="hljs-built_in">chr</span>(enc[i+<span class="hljs-number">1</span>])<br>    basedecoded+=<span class="hljs-built_in">chr</span>(enc[i+<span class="hljs-number">3</span>])<br><span class="hljs-comment">#print(basedecoded)</span><br>xorencoded=base64.b64decode(basedecoded)<br><span class="hljs-comment">#print(len(xorencoded))</span><br>flag=XORdecrypt(<span class="hljs-built_in">list</span>(xorencoded),<span class="hljs-number">0x98bf3b77</span>)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>flag：0xGame{e8778581-e94f-48d5-943e-69ff46f54d1f}</p>
</blockquote>
<h2 id="云消雾散"><a href="#云消雾散" class="headerlink" title="云消雾散"></a>云消雾散</h2><blockquote>
<p>考点：复杂程序分析，魔改RC4</p>
<p>难点在于复杂，没有其他套路</p>
</blockquote>
<ul>
<li><p>附件给了一个img.exe和enc.bmp。bmp是一种图片格式，推测img.exe是bmp图片加密程序，enc.bmp是加密的图片，要求逆向加密程序进而解密图片</p>
</li>
<li><p>img.exe用IDA打开，shift+F12可以找到”enc.bmp”</p>
<p><img src="/../images/image-20251115195827438.png" alt="字符串表的enc.bmp"></p>
<p>跟踪可以到这样一个函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs C">__int64 __fastcall <span class="hljs-title function_">sub_140001936</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2)</span><br>&#123;<br>  <span class="hljs-type">int</span> v2; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v13; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v15; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v16; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v17; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v18; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v19; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v20; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v21; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v22; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v23; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v24; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v25; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v26; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v27; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v28; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v29; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v30; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v31; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v32; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v33; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v34; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v35; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v36; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v37; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v38; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v39; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v40; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v41; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v42; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v43; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v44; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v45; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v46; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v47; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v48; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v49; <span class="hljs-comment">// r9d</span><br>  __int64 v51; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v52; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v53; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v54; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v55; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v56; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v57; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v58; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v59; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v60; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v61; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v62; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v63; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v64; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v65; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v66; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v67; <span class="hljs-comment">// [rsp+10h] [rbp-70h]</span><br>  _BYTE v68[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-60h] BYREF</span><br>  _BYTE v69[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-40h] BYREF</span><br>  _BYTE v70[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+60h] [rbp-20h] BYREF</span><br>  _BYTE v71[<span class="hljs-number">44</span>]; <span class="hljs-comment">// [rsp+80h] [rbp+0h] BYREF</span><br>  <span class="hljs-type">char</span> v72; <span class="hljs-comment">// [rsp+ACh] [rbp+2Ch] BYREF</span><br>  <span class="hljs-type">char</span> v73; <span class="hljs-comment">// [rsp+ADh] [rbp+2Dh] BYREF</span><br>  <span class="hljs-type">char</span> v74; <span class="hljs-comment">// [rsp+AEh] [rbp+2Eh] BYREF</span><br>  <span class="hljs-type">char</span> v75; <span class="hljs-comment">// [rsp+AFh] [rbp+2Fh] BYREF</span><br>  _BYTE v76[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+B0h] [rbp+30h] BYREF</span><br>  _BYTE v77[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+D0h] [rbp+50h] BYREF</span><br>  _BYTE v78[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+F0h] [rbp+70h] BYREF</span><br>  _BYTE v79[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+110h] [rbp+90h] BYREF</span><br>  <span class="hljs-type">char</span> *v80; <span class="hljs-comment">// [rsp+130h] [rbp+B0h]</span><br>  <span class="hljs-type">char</span> *v81; <span class="hljs-comment">// [rsp+138h] [rbp+B8h]</span><br>  <span class="hljs-type">char</span> *v82; <span class="hljs-comment">// [rsp+140h] [rbp+C0h]</span><br>  <span class="hljs-type">char</span> *v83; <span class="hljs-comment">// [rsp+148h] [rbp+C8h]</span><br><br>  sub_140001D70();<br>  v83 = &amp;v72;<br>  sub_140004130(a1, a2, <span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025&quot;</span>, v71, &amp;v72, v2);<br>  sub_140003580(a1, a2, v3, &amp;v72, v4, v5);<br>  v82 = &amp;v73;<br>  sub_140004130(a1, a2, <span class="hljs-string">&quot;flag.bmp&quot;</span>, v70, &amp;v73, v6);<br>  sub_140003580(a1, a2, v7, &amp;v73, v8, v9);<br>  v81 = &amp;v74;<br>  sub_140004130(a1, a2, <span class="hljs-string">&quot;enc.bmp&quot;</span>, v69, &amp;v74, v10);<br>  sub_140003580(a1, a2, v11, &amp;v74, v12, v13);<br>  v80 = &amp;v75;<br>  sub_140004130(a1, a2, <span class="hljs-string">&quot;114514puiqneravcixpbhqn;afnv-92piwgspdifjv&quot;</span>, v68, &amp;v75, v14);<br>  sub_140003580(a1, a2, v15, &amp;v75, v16, v17);<br>  sub_140004670(a1, a2, v71, v77, <span class="hljs-string">&quot;\\&quot;</span>, v18, v51);<br>  sub_140004620(a1, a2, v77, v76, v70, v19, v52);<br>  sub_140004210(a1, a2, v76, v70, v20, v21, v53);<br>  sub_1400041E0(a1, a2, v22, v76, v23, v24, v54);<br>  sub_1400041E0(a1, a2, v25, v77, v26, v27, v55);<br>  sub_140004670(a1, a2, v71, v79, <span class="hljs-string">&quot;\\&quot;</span>, v28, v56);<br>  sub_140004620(a1, a2, v79, v78, v69, v29, v57);<br>  sub_140004210(a1, a2, v78, v69, v30, v31, v58);<br>  sub_1400041E0(a1, a2, v32, v78, v33, v34, v59);<br>  sub_1400041E0(a1, a2, v35, v79, v36, v37, v60);<br>  sub_14000164D(a1, a2, v69, v70, v68, <span class="hljs-number">1</span>, v61, v66, v67);<br>  sub_1400041E0(a1, a2, v38, v68, v39, v40, v62);<br>  sub_1400041E0(a1, a2, v41, v69, v42, v43, v63);<br>  sub_1400041E0(a1, a2, v44, v70, v45, v46, v64);<br>  sub_1400041E0(a1, a2, v47, v71, v48, v49, v65);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>借助AI可以优化得到：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs C">__int64 __fastcall <span class="hljs-title function_">sub_140001936</span><span class="hljs-params">(<span class="hljs-type">char</span> *input, <span class="hljs-type">char</span> *output)</span><br>&#123;<br>  <span class="hljs-type">int</span> v2; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v13; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v15; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v16; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v17; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v18; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v19; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v20; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v21; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v22; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v23; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v24; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v25; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v26; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v27; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v28; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v29; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v30; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v31; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v32; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v33; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v34; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v35; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v36; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v37; <span class="hljs-comment">// r9d</span><br>  _BYTE v39[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-60h] BYREF</span><br>  _BYTE outputFilename[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-40h] BYREF</span><br>  _BYTE v41[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+60h] [rbp-20h] BYREF</span><br>  _BYTE v42[<span class="hljs-number">44</span>]; <span class="hljs-comment">// [rsp+80h] [rbp+0h] BYREF</span><br>  <span class="hljs-type">char</span> v43; <span class="hljs-comment">// [rsp+ACh] [rbp+2Ch] BYREF</span><br>  <span class="hljs-type">char</span> v44; <span class="hljs-comment">// [rsp+ADh] [rbp+2Dh] BYREF</span><br>  <span class="hljs-type">char</span> v45; <span class="hljs-comment">// [rsp+AEh] [rbp+2Eh] BYREF</span><br>  <span class="hljs-type">char</span> v46; <span class="hljs-comment">// [rsp+AFh] [rbp+2Fh] BYREF</span><br>  _BYTE v47[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+B0h] [rbp+30h] BYREF</span><br>  _BYTE v48[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+D0h] [rbp+50h] BYREF</span><br>  _BYTE v49[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+F0h] [rbp+70h] BYREF</span><br>  _BYTE v50[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+110h] [rbp+90h] BYREF</span><br>  <span class="hljs-type">char</span> *v51; <span class="hljs-comment">// [rsp+130h] [rbp+B0h]</span><br>  <span class="hljs-type">char</span> *v52; <span class="hljs-comment">// [rsp+138h] [rbp+B8h]</span><br>  <span class="hljs-type">char</span> *v53; <span class="hljs-comment">// [rsp+140h] [rbp+C0h]</span><br>  <span class="hljs-type">char</span> *v54; <span class="hljs-comment">// [rsp+148h] [rbp+C8h]</span><br><br>  sub_140001D70();<br>  v54 = &amp;v43;<br>  constructString(input, output, <span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025&quot;</span>, v42, &amp;v43, v2);<br>  nothing();                                    <span class="hljs-comment">// 什么也没有的一个函数</span><br>  v53 = &amp;v44;<br>  constructString(input, output, <span class="hljs-string">&quot;flag.bmp&quot;</span>, v41, &amp;v44, v3);<br>  nothing();<br>  v52 = &amp;v45;<br>  constructString(input, output, <span class="hljs-string">&quot;enc.bmp&quot;</span>, outputFilename, &amp;v45, v4);<br>  nothing();<br>  v51 = &amp;v46;<br>  constructString(input, output, <span class="hljs-string">&quot;114514puiqneravcixpbhqn;afnv-92piwgspdifjv&quot;</span>, v39, &amp;v46, v5);<br>  nothing();<br>  makePath1(input, output, v42, v48, <span class="hljs-string">&quot;\\&quot;</span>, v6);<br>  makePath2(input, output, v48, v47, v41, v7);<br>  makePath3(input, output, v47, v41, v8, v9);<br>  clearup(input, output, v10, v47, v11, v12);<br>  clearup(input, output, v13, v48, v14, v15);<br>  makePath1(input, output, v42, v50, <span class="hljs-string">&quot;\\&quot;</span>, v16);<br>  makePath2(input, output, v50, v49, outputFilename, v17);<br>  makePath3(input, output, v49, outputFilename, v18, v19);<br>  clearup(input, output, v20, v49, v21, v22);<br>  clearup(input, output, v23, v50, v24, v25);<br>  encrypt(input, output, outputFilename, v41, v39, <span class="hljs-number">1</span>);<br>  clearup(input, output, v26, v39, v27, v28);<br>  clearup(input, output, v29, outputFilename, v30, v31);<br>  clearup(input, output, v32, v41, v33, v34);<br>  clearup(input, output, v35, v42, v36, v37);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这里实际上是在初始化文件相关的信息，程序应该是从E:\WorkSpace\Lab\0xGame 2025下获取flag.bmp，加密后输出为enc.bmp。那一串字符串应该是encrypt函数使用的密钥。encpyt函数优化后是这样的：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs C">__int64 __fastcall <span class="hljs-title function_">encrypt</span><span class="hljs-params">(</span><br><span class="hljs-params">        <span class="hljs-built_in">std</span>::istream *input,</span><br><span class="hljs-params">        <span class="hljs-type">char</span> *output,</span><br><span class="hljs-params">        __int64 outputFilename,</span><br><span class="hljs-params">        __int64 inputfilename,</span><br><span class="hljs-params">        __int64 a5,</span><br><span class="hljs-params">        <span class="hljs-type">char</span> a6)</span><br>&#123;<br>  __int64 v6; <span class="hljs-comment">// rdx</span><br>  __int64 v7; <span class="hljs-comment">// rdx</span><br>  __int64 v9; <span class="hljs-comment">// rax</span><br>  __int64 v10; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v11; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// eax</span><br>  __int64 v13; <span class="hljs-comment">// rdx</span><br>  __int64 v14; <span class="hljs-comment">// rdx</span><br>  __int64 v15; <span class="hljs-comment">// rdx</span><br>  __int64 v17; <span class="hljs-comment">// [rsp+20h] [rbp-60h] BYREF</span><br>  <span class="hljs-type">int</span> v18; <span class="hljs-comment">// [rsp+28h] [rbp-58h]</span><br>  <span class="hljs-type">unsigned</span> __int16 v19; <span class="hljs-comment">// [rsp+2Eh] [rbp-52h]</span><br>  __int64 v20; <span class="hljs-comment">// [rsp+52h] [rbp-2Eh] BYREF</span><br>  _BYTE output_file_buffer[<span class="hljs-number">224</span>]; <span class="hljs-comment">// [rsp+60h] [rbp-20h] BYREF</span><br>  __int64 v22; <span class="hljs-comment">// [rsp+140h] [rbp+C0h] BYREF</span><br>  _BYTE input_file_buffer[<span class="hljs-number">232</span>]; <span class="hljs-comment">// [rsp+250h] [rbp+1D0h] BYREF</span><br>  __int64 v24; <span class="hljs-comment">// [rsp+338h] [rbp+2B8h] BYREF</span><br>  __int64 outputBuffer; <span class="hljs-comment">// [rsp+448h] [rbp+3C8h]</span><br>  __int64 v26; <span class="hljs-comment">// [rsp+450h] [rbp+3D0h]</span><br>  <span class="hljs-type">int</span> v27; <span class="hljs-comment">// [rsp+45Ch] [rbp+3DCh]</span><br>  __int64 header_buffer; <span class="hljs-comment">// [rsp+460h] [rbp+3E0h]</span><br>  __int64 header_buffer_size; <span class="hljs-comment">// [rsp+468h] [rbp+3E8h]</span><br><br>  <span class="hljs-built_in">std</span>::ifstream::basic_ifstream(input, output, inputfilename, input_file_buffer, <span class="hljs-number">4LL</span>);<br>  <span class="hljs-built_in">std</span>::ofstream::basic_ofstream(input, output, outputFilename, output_file_buffer, <span class="hljs-number">4LL</span>);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">std</span>::ios::operator!(input, output, v6, &amp;v24) || <span class="hljs-built_in">std</span>::ios::operator!(input, output, v7, &amp;v22) )<br>  &#123;                                             <span class="hljs-comment">// 错误处理</span><br>    v9 = <span class="hljs-built_in">std</span>::operator&lt;&lt;&lt;<span class="hljs-built_in">std</span>::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(input, output, &amp;unk_7FF770D06000, &amp;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span>);<br>    <span class="hljs-built_in">std</span>::ostream::operator&lt;&lt;(input, output, &amp;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>&lt;<span class="hljs-type">char</span>,<span class="hljs-built_in">std</span>::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;, v9);<br>    v11 = <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    header_buffer_size = <span class="hljs-number">1024LL</span>;<br>    header_buffer = operator new[](input);<br>    <span class="hljs-built_in">std</span>::istream::read(input, output, &amp;v20);    <span class="hljs-comment">// 获取bitmap_file_header</span><br>    <span class="hljs-built_in">std</span>::istream::read(input, output, &amp;v17);    <span class="hljs-comment">// 获取bitmap_info_header</span><br>    <span class="hljs-built_in">std</span>::istream::read(input, output, header_buffer);<br>    <span class="hljs-built_in">std</span>::ostream::write(input, output, &amp;v20);<br>    <span class="hljs-built_in">std</span>::ostream::write(input, output, &amp;v17);<br>    <span class="hljs-built_in">std</span>::ostream::write(input, output, header_buffer);<br>    <span class="hljs-keyword">if</span> ( header_buffer )<br>      operator delete[](input);<br>    v12 = HIDWORD(v17) * v19 + <span class="hljs-number">31</span>;<br>    <span class="hljs-keyword">if</span> ( v12 &lt; <span class="hljs-number">0</span> )<br>      v12 = HIDWORD(v17) * v19 + <span class="hljs-number">62</span>;<br>    v27 = <span class="hljs-number">4</span> * (v12 &gt;&gt; <span class="hljs-number">5</span>);<br>    v26 = (v27 * abs32(v18));<br>    outputBuffer = operator new[](input);<br>    <span class="hljs-built_in">std</span>::istream::read(input, output, outputBuffer);<br>    <span class="hljs-built_in">std</span>::ifstream::close(input, output, v13, input_file_buffer);<br>    <span class="hljs-keyword">if</span> ( a6 )<br>      modifiedRC4(input, output, v26, outputBuffer, a5);<br>    <span class="hljs-built_in">std</span>::ostream::write(input, output, outputBuffer);<br>    <span class="hljs-built_in">std</span>::ofstream::close(input, output, v14, output_file_buffer);<br>    <span class="hljs-keyword">if</span> ( outputBuffer )<br>      operator delete[](input);<br>    v11 = <span class="hljs-number">1</span>;<br>  &#125;<br>  <span class="hljs-built_in">std</span>::ofstream::~ofstream(input, output, v10, output_file_buffer);<br>  <span class="hljs-built_in">std</span>::ifstream::~ifstream(input, output, v15, input_file_buffer);<br>  <span class="hljs-keyword">return</span> v11;<br>&#125;<br><br><span class="hljs-comment">//modifiedRC4</span><br>__int64 __fastcall <span class="hljs-title function_">modifiedRC4</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *a1, __int64 a2, <span class="hljs-type">int</span> numOfDataBytes, __int64 outputBuffer, __int64 a5)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> __int64 v5; <span class="hljs-comment">// rax</span><br>  _BYTE *v6; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v7; <span class="hljs-comment">// dl</span><br>  __int64 result; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+24h] [rbp-Ch]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+24h] [rbp-Ch]</span><br>  <span class="hljs-type">int</span> k; <span class="hljs-comment">// [rsp+24h] [rbp-Ch]</span><br>  <span class="hljs-type">int</span> j_sbox; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> j_; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> i_sbox; <span class="hljs-comment">// [rsp+2Ch] [rbp-4h]</span><br>  <span class="hljs-type">int</span> i_; <span class="hljs-comment">// [rsp+2Ch] [rbp-4h]</span><br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">255</span>; ++i )<br>    S[i] = i;<br>  i_sbox = <span class="hljs-number">0</span>;<br>  j_sbox = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">255</span>; ++j )<br>  &#123;<br>    i_sbox = (i_sbox + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>;<br>    a2 = S[i_sbox] + j_sbox;<br>    v5 = sub_7FF770D032B0(a1, a2, j_sbox, a5);<br>    v6 = sub_7FF770D033D0(a1, a2, i_sbox % v5, a5);<br>    v7 = a2 + *v6;<br>    LODWORD(v6) = ((a2 + *v6) &gt;&gt; <span class="hljs-number">31</span>) &gt;&gt; <span class="hljs-number">24</span>;<br>    j_sbox = (v6 + v7) - v6;<br>    swapbytes(a1, a2, &amp;S[j_sbox], &amp;S[i_sbox]);<br>  &#125;<br>  i_ = <span class="hljs-number">0</span>;<br>  j_ = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; ; ++k )<br>  &#123;<br>    result = ((numOfDataBytes / <span class="hljs-number">256</span>) &lt;&lt; <span class="hljs-number">8</span>);<br>    <span class="hljs-keyword">if</span> ( k &gt;= result )<br>      <span class="hljs-keyword">break</span>;<br>    i_ = (i_ + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>;<br>    j_ = (S[i_] + j_) % <span class="hljs-number">256</span>;<br>    swapbytes(a1, a2, &amp;S[j_], &amp;S[i_]);<br>    swapBytes(<br>      a1,<br>      a2,<br>      (((k / <span class="hljs-number">256</span>) &lt;&lt; <span class="hljs-number">8</span>) + j_ + outputBuffer),   <span class="hljs-comment">// outputBuffer[((k/256)&lt;&lt;8)+j_]</span><br>      (outputBuffer + ((k / <span class="hljs-number">256</span>) &lt;&lt; <span class="hljs-number">8</span>) + i_));  <span class="hljs-comment">// outputBuffer[((k/256)&lt;&lt;8)+i_]</span><br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>从IDA的反编译结果里可以得到一些大致的印象：encrypt函数刚开始对文件进行了三次读与写，采用的加密方式是类似RC4的算法，但是相较于标准RC4，此处只是单纯的置换，没有异或操作。为了进一步理解程序，接下来先研究读写文件的操作逻辑。</p>
<p>简单了解一下bmp文件格式，可以知道文件开头前0x36h是文件头，这一部分肯定是不会怎么变的，否则就会改变文件的格式了。在电脑里复刻一个一摸一样的路径，自己创建一个flag.bmp运行img.exe可以得到enc.bmp，此时用十六进制编辑器打开两个文件可以发现它们之间差了1024bytes，更准确的说，是加密后的文件比加密前多了1024bytes。</p>
<p>下面转用xdbg。对照IDA可以找到读写文件的位置，分析结果如下：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><code class="hljs X86asm">00007FF6077B164D | <span class="hljs-number">55</span>                  | <span class="hljs-keyword">PUSH</span> <span class="hljs-built_in">RBP</span>                                                 | encrypt<br>00007FF6077B164E | <span class="hljs-number">53</span>                  | <span class="hljs-keyword">PUSH</span> <span class="hljs-built_in">RBX</span>                                                 |<br>00007FF6077B164F | <span class="hljs-number">48</span>:81EC <span class="hljs-number">78040000</span>    | <span class="hljs-keyword">SUB</span> <span class="hljs-built_in">RSP</span>,<span class="hljs-number">478</span>                                              |<br>00007FF6077B1656 | <span class="hljs-number">48</span>:8DAC24 <span class="hljs-number">80000000</span>  | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RBP</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RSP</span>+<span class="hljs-number">80</span>]                            | [<span class="hljs-built_in">rsp</span>+<span class="hljs-number">80</span>]:_register_onexit_function+<span class="hljs-number">210</span><br>00007FF6077B165E | <span class="hljs-number">48</span>:<span class="hljs-number">898D</span> <span class="hljs-number">10040000</span>    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+<span class="hljs-number">410</span>],<span class="hljs-built_in">RCX</span>                           |<br>00007FF6077B1665 | <span class="hljs-number">48</span>:<span class="hljs-number">8995</span> <span class="hljs-number">18040000</span>    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+<span class="hljs-number">418</span>],<span class="hljs-built_in">RDX</span>                           |<br>00007FF6077B166C | 4C:<span class="hljs-number">8985</span> <span class="hljs-number">20040000</span>    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+<span class="hljs-number">420</span>],<span class="hljs-built_in">R8</span>                            |<br>00007FF6077B1673 | <span class="hljs-number">44</span>:89C8             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">R9D</span>                                              |<br>00007FF6077B1676 | <span class="hljs-number">8885</span> <span class="hljs-number">28040000</span>       | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">BYTE</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+<span class="hljs-number">428</span>],<span class="hljs-built_in">AL</span>                             |<br>00007FF6077B167C | <span class="hljs-number">48</span>:8B95 <span class="hljs-number">10040000</span>    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RDX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+<span class="hljs-number">410</span>]                           |<br>00007FF6077B1683 | <span class="hljs-number">48</span>:8D85 D0010000    | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+1D0]                           |<br>00007FF6077B168A | <span class="hljs-number">41</span>:B8 <span class="hljs-number">04000000</span>      | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">R8D</span>,<span class="hljs-number">4</span>                                                |<br>00007FF6077B1690 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B1693 | E8 E0050000         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;<span class="hljs-keyword">std</span>::basic_ifstream&lt;char, <span class="hljs-keyword">std</span>::char_traits&lt;<span class="hljs-number">ch</span> | 错误处理<br>00007FF6077B1698 | <span class="hljs-number">48</span>:8B95 <span class="hljs-number">18040000</span>    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RDX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+<span class="hljs-number">418</span>]                           |<br>00007FF6077B169F | <span class="hljs-number">48</span>:8D45 E0          | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>-<span class="hljs-number">20</span>]                            | [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">20</span>]:<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B16A3 | 41:B8 04000000      | MOV R8D,4                                                |</span><br><span class="hljs-string">00007FF6077B16A9 | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B16AC | E8 AF050000         | CALL &lt;JMP.&amp;std::basic_ofstream&lt;char, std::char_traits&lt;ch |</span><br><span class="hljs-string">00007FF6077B16B1 | 48:8D85 D0010000    | LEA RAX,QWORD PTR SS:[RBP+1D0]                           |</span><br><span class="hljs-string">00007FF6077B16B8 | 48:05 E8000000      | ADD RAX,E8                                               | rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B16BE | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B16C1 | E8 DA050000         | CALL &lt;JMP.&amp;std::basic_ios&lt;char, std::char_traits&lt;char&gt; &gt; |</span><br><span class="hljs-string">00007FF6077B16C6 | 84C0                | TEST AL,AL                                               |</span><br><span class="hljs-string">00007FF6077B16C8 | 75 16               | JNE img.7FF6077B16E0                                     |</span><br><span class="hljs-string">00007FF6077B16CA | 48:8D45 E0          | LEA RAX,QWORD PTR SS:[RBP-20]                            | [rbp-20]:&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;&quot;</span><br>00007FF6077B16CE | <span class="hljs-number">48</span>:<span class="hljs-number">05</span> E0000000      | <span class="hljs-keyword">ADD</span> <span class="hljs-built_in">RAX</span>,E0                                               | <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B16D4 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B16D7 | E8 C4050000         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;<span class="hljs-keyword">std</span>::basic_ios&lt;char, <span class="hljs-keyword">std</span>::char_traits&lt;char&gt; &gt; |<br>00007FF6077B16DC | 84C0                | <span class="hljs-keyword">TEST</span> <span class="hljs-built_in">AL</span>,<span class="hljs-built_in">AL</span>                                               |<br>00007FF6077B16DE | <span class="hljs-number">74</span> <span class="hljs-number">07</span>               | <span class="hljs-keyword">JE</span> img<span class="hljs-number">.</span>7FF6077B16E7                                      |<br>00007FF6077B16E0 | B8 <span class="hljs-number">01000000</span>         | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-number">1</span>                                                |<br>00007FF6077B16E5 | EB <span class="hljs-number">05</span>               | <span class="hljs-keyword">JMP</span> img<span class="hljs-number">.</span>7FF6077B16EC                                     |<br>00007FF6077B16E7 | B8 <span class="hljs-number">00000000</span>         | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-number">0</span>                                                |<br>00007FF6077B16EC | 84C0                | <span class="hljs-keyword">TEST</span> <span class="hljs-built_in">AL</span>,<span class="hljs-built_in">AL</span>                                               |<br>00007FF6077B16EE | <span class="hljs-number">74</span> <span class="hljs-number">32</span>               | <span class="hljs-keyword">JE</span> img<span class="hljs-number">.</span>7FF6077B1722                                      |<br>00007FF6077B16F0 | <span class="hljs-number">48</span>:8D15 <span class="hljs-number">09490000</span>    | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RDX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">DS</span>:[7FF6077B6000]                      | <span class="hljs-built_in">rdx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\enc.bmp&quot;</span>, 00007FF6077B6000:u8<span class="hljs-string">&quot;无法打开文件！&quot;</span>ame <span class="hljs-number">2025</span>\\enc<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B16F7 | 48:8B05 024F0000    | MOV RAX,QWORD PTR DS:[&lt;&amp;std::cerr&gt;]                      | rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B16FE | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1701 | E8 22050000         | CALL &lt;JMP.&amp;std::basic_ostream&lt;char, std::char_traits&lt;cha |</span><br><span class="hljs-string">00007FF6077B1706 | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1709 | 48:8B05 004F0000    | MOV RAX,QWORD PTR DS:[&lt;&amp;JMP.&amp;std::basic_ostream&lt;char, st | rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1710 | 48:89C2             | MOV RDX,RAX                                              | rdx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\enc<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1713 | E8 70050000         | CALL &lt;JMP.&amp;std::ostream::operator&lt;&lt;(std::ostream&amp; (*)(st |</span><br><span class="hljs-string">00007FF6077B1718 | BB 00000000         | MOV EBX,0                                                |</span><br><span class="hljs-string">00007FF6077B171D | E9 BD010000         | JMP img.7FF6077B18DF                                     |</span><br><span class="hljs-string">00007FF6077B1722 | 48:C785 E8030000 00 | MOV QWORD PTR SS:[RBP+3E8],400                           |</span><br><span class="hljs-string">00007FF6077B172D | B9 00040000         | MOV ECX,400                                              |</span><br><span class="hljs-string">00007FF6077B1732 | E8 D9040000         | CALL &lt;JMP.&amp;operator new[](unsigned long long)&gt;           |</span><br><span class="hljs-string">00007FF6077B1737 | 48:8985 E0030000    | MOV QWORD PTR SS:[RBP+3E0],RAX                           |</span><br><span class="hljs-string">00007FF6077B173E | 48:8D55 D2          | LEA RDX,QWORD PTR SS:[RBP-2E]                            | RBP-2E：输入流缓冲区1（存放header）</span><br><span class="hljs-string">00007FF6077B1742 | 48:8D85 D0010000    | LEA RAX,QWORD PTR SS:[RBP+1D0]                           |</span><br><span class="hljs-string">00007FF6077B1749 | 41:B8 0E000000      | MOV R8D,E                                                | 读取长度：Eh</span><br><span class="hljs-string">00007FF6077B174F | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1752 | E8 41050000         | CALL &lt;JMP.&amp;std::istream::read(char*, long long)&gt;         | 读入header</span><br><span class="hljs-string">00007FF6077B1757 | 48:8D55 A0          | LEA RDX,QWORD PTR SS:[RBP-60]                            | RBP-60：输入流缓冲区2（存放header info）</span><br><span class="hljs-string">00007FF6077B175B | 48:8D85 D0010000    | LEA RAX,QWORD PTR SS:[RBP+1D0]                           |</span><br><span class="hljs-string">00007FF6077B1762 | 41:B8 28000000      | MOV R8D,28                                               | 读取长度：28h</span><br><span class="hljs-string">00007FF6077B1768 | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B176B | E8 28050000         | CALL &lt;JMP.&amp;std::istream::read(char*, long long)&gt;         | 读入header info</span><br><span class="hljs-string">00007FF6077B1770 | 48:8B95 E0030000    | MOV RDX,QWORD PTR SS:[RBP+3E0]                           | [rbp-3E0]：输入流缓冲区3（存放文件头后的1024bytes)</span><br><span class="hljs-string">00007FF6077B1777 | 48:8D85 D0010000    | LEA RAX,QWORD PTR SS:[RBP+1D0]                           |</span><br><span class="hljs-string">00007FF6077B177E | 41:B8 00040000      | MOV R8D,400                                              | 读取长度：400h</span><br><span class="hljs-string">00007FF6077B1784 | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1787 | E8 0C050000         | CALL &lt;JMP.&amp;std::istream::read(char*, long long)&gt;         | 读入文件头后的1024bytes</span><br><span class="hljs-string">00007FF6077B178C | 48:8D55 D2          | LEA RDX,QWORD PTR SS:[RBP-2E]                            | [rbp-2E]：write参数（header）</span><br><span class="hljs-string">00007FF6077B1790 | 48:8D45 E0          | LEA RAX,QWORD PTR SS:[RBP-20]                            | [rbp-20]:&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;&quot;</span><br>00007FF6077B1794 | <span class="hljs-number">41</span>:B8 0E000000      | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">R8D</span>,E                                                |<br>00007FF6077B179A | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B179D | E8 EE040000         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;<span class="hljs-keyword">std</span>::ostream::write(char const*, long long)&gt;  | <br>00007FF6077B17A2 | <span class="hljs-number">48</span>:8D55 A0          | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RDX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>-<span class="hljs-number">60</span>]                            | [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">60</span>]:<span class="hljs-string">&quot;114514puiqneravcixpbhqn;afnv-92piwgspdifjv&quot;</span><br>00007FF6077B17A6 | <span class="hljs-number">48</span>:8D45 E0          | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>-<span class="hljs-number">20</span>]                            | [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">20</span>]:<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B17AA | 41:B8 28000000      | MOV R8D,28                                               | 28:&#x27;(&#x27;</span><br><span class="hljs-string">00007FF6077B17B0 | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B17B3 | E8 D8040000         | CALL &lt;JMP.&amp;std::ostream::write(char const*, long long)&gt;  |</span><br><span class="hljs-string">00007FF6077B17B8 | 48:8B95 E0030000    | MOV RDX,QWORD PTR SS:[RBP+3E0]                           |</span><br><span class="hljs-string">00007FF6077B17BF | 48:8D45 E0          | LEA RAX,QWORD PTR SS:[RBP-20]                            | [rbp-20]:&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;&quot;</span><br>00007FF6077B17C3 | <span class="hljs-number">41</span>:B8 <span class="hljs-number">00040000</span>      | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">R8D</span>,<span class="hljs-number">400</span>                                              |<br>00007FF6077B17C9 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B17CC | E8 BF040000         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;<span class="hljs-keyword">std</span>::ostream::write(char const*, long long)&gt;  |<br>00007FF6077B17D1 | <span class="hljs-number">48</span>:83BD E0030000 <span class="hljs-number">00</span> | <span class="hljs-keyword">CMP</span> <span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3E0],<span class="hljs-number">0</span>                             |<br>00007FF6077B17D9 | <span class="hljs-number">74</span> 0F               | <span class="hljs-keyword">JE</span> img<span class="hljs-number">.</span>7FF6077B17EA                                      |<br>00007FF6077B17DB | <span class="hljs-number">48</span>:8B85 E0030000    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3E0]                           |<br>00007FF6077B17E2 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B17E5 | E8 <span class="hljs-number">36040000</span>         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;operator delete[](void*)&gt;                     |<br>00007FF6077B17EA | 8B55 A4             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">EDX</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>-5C]                            |<br>00007FF6077B17ED | 0FB745 AE           | <span class="hljs-keyword">MOVZX</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">WORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>-<span class="hljs-number">52</span>]                           |<br>00007FF6077B17F1 | 0FB7C0              | <span class="hljs-keyword">MOVZX</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">AX</span>                                             |<br>00007FF6077B17F4 | 0FAFC2              | <span class="hljs-keyword">IMUL</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">EDX</span>                                             |<br>00007FF6077B17F7 | 83C0 1F             | <span class="hljs-keyword">ADD</span> <span class="hljs-built_in">EAX</span>,1F                                               |<br>00007FF6077B17FA | 8D50 1F             | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">EDX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">DS</span>:[<span class="hljs-built_in">RAX</span>+1F]                            |<br>00007FF6077B17FD | 85C0                | <span class="hljs-keyword">TEST</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">EAX</span>                                             |<br>00007FF6077B17FF | 0F48C2              | <span class="hljs-keyword">CMOVS</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">EDX</span>                                            |<br>00007FF6077B1802 | C1F8 <span class="hljs-number">05</span>             | <span class="hljs-keyword">SAR</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-number">5</span>                                                |<br>00007FF6077B1805 | C1E0 <span class="hljs-number">02</span>             | <span class="hljs-keyword">SHL</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-number">2</span>                                                |<br>00007FF6077B1808 | <span class="hljs-number">8985</span> DC030000       | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3DC],<span class="hljs-built_in">EAX</span>                           |<br>00007FF6077B180E | 8B45 A8             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>-<span class="hljs-number">58</span>]                            |<br>00007FF6077B1811 | <span class="hljs-number">99</span>                  | <span class="hljs-keyword">CDQ</span>                                                      |<br>00007FF6077B1812 | 31D0                | <span class="hljs-keyword">XOR</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">EDX</span>                                              |<br>00007FF6077B1814 | 29D0                | <span class="hljs-keyword">SUB</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">EDX</span>                                              |<br>00007FF6077B1816 | 0FAF85 DC030000     | <span class="hljs-keyword">IMUL</span> <span class="hljs-built_in">EAX</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3DC]                          |<br>00007FF6077B181D | <span class="hljs-number">48</span>:<span class="hljs-number">98</span>               | <span class="hljs-keyword">CDQE</span>                                                     |<br>00007FF6077B181F | <span class="hljs-number">48</span>:<span class="hljs-number">8985</span> D0030000    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3D0],<span class="hljs-built_in">RAX</span>                           |<br>00007FF6077B1826 | <span class="hljs-number">48</span>:8B85 D0030000    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3D0]                           |<br>00007FF6077B182D | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B1830 | E8 DB030000         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;operator new[](unsigned long long)&gt;           |<br>00007FF6077B1835 | <span class="hljs-number">48</span>:<span class="hljs-number">8985</span> C8030000    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3C8],<span class="hljs-built_in">RAX</span>                           | <span class="hljs-number">111</span><br>00007FF6077B183C | <span class="hljs-number">48</span>:8B8D D0030000    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3D0]                           |<br>00007FF6077B1843 | <span class="hljs-number">48</span>:8B95 C8030000    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RDX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3C8]                           | <span class="hljs-number">111</span><br>00007FF6077B184A | <span class="hljs-number">48</span>:8D85 D0010000    | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+1D0]                           |<br>00007FF6077B1851 | <span class="hljs-number">49</span>:89C8             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">R8</span>,<span class="hljs-built_in">RCX</span>                                               | <span class="hljs-built_in">r8</span>:&amp;<span class="hljs-string">&quot;114514puiqneravcixpbhqn;afnv-92piwgspdifjv&quot;</span>, <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1854 | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1857 | E8 3C040000         | CALL &lt;JMP.&amp;std::istream::read(char*, long long)&gt;         |</span><br><span class="hljs-string">00007FF6077B185C | 48:8D85 D0010000    | LEA RAX,QWORD PTR SS:[RBP+1D0]                           |</span><br><span class="hljs-string">00007FF6077B1863 | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1866 | E8 15040000         | CALL &lt;JMP.&amp;std::basic_ifstream&lt;char, std::char_traits&lt;ch |</span><br><span class="hljs-string">00007FF6077B186B | 80BD 28040000 00    | CMP BYTE PTR SS:[RBP+428],0                              |</span><br><span class="hljs-string">00007FF6077B1872 | 74 24               | JE img.7FF6077B1898                                      |</span><br><span class="hljs-string">00007FF6077B1874 | 48:8B85 D0030000    | MOV RAX,QWORD PTR SS:[RBP+3D0]                           |</span><br><span class="hljs-string">00007FF6077B187B | 89C1                | MOV ECX,EAX                                              |</span><br><span class="hljs-string">00007FF6077B187D | 48:8B95 20040000    | MOV RDX,QWORD PTR SS:[RBP+420]                           |</span><br><span class="hljs-string">00007FF6077B1884 | 48:8B85 C8030000    | MOV RAX,QWORD PTR SS:[RBP+3C8]                           | 关注此处[rbp+3C8]，疑似存放处理后的数据的缓冲区</span><br><span class="hljs-string">00007FF6077B188B | 49:89D0             | MOV R8,RDX                                               | r8:&amp;&quot;</span>114514puiqneravcixpbhqn<span class="hljs-comment">;afnv-92piwgspdifjv&quot;, rdx:&amp;&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\enc.bmp&quot;v&quot;</span><br>00007FF6077B188E | 89CA                | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">EDX</span>,<span class="hljs-built_in">ECX</span>                                              |<br>00007FF6077B1890 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B1893 | E8 A8FBFFFF         | <span class="hljs-keyword">CALL</span> img<span class="hljs-number">.</span>7FF6077B1440                                    | modifiedRC4<br>00007FF6077B1898 | <span class="hljs-number">48</span>:8B8D D0030000    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3D0]                           |<br>00007FF6077B189F | <span class="hljs-number">48</span>:8B95 C8030000    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RDX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3C8]                           | [<span class="hljs-built_in">rbp</span>+3C8]：输出的图像数据<br>00007FF6077B18A6 | <span class="hljs-number">48</span>:8D45 E0          | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>-<span class="hljs-number">20</span>]                            | [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">20</span>]:<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B18AA | 49:89C8             | MOV R8,RCX                                               | R8：数据长度</span><br><span class="hljs-string">00007FF6077B18AD | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B18B0 | E8 DB030000         | CALL &lt;JMP.&amp;std::ostream::write(char const*, long long)&gt;  | 写入加密后的数据</span><br><span class="hljs-string">00007FF6077B18B5 | 48:8D45 E0          | LEA RAX,QWORD PTR SS:[RBP-20]                            | [rbp-20]:&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;&quot;</span><br>00007FF6077B18B9 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B18BC | E8 A7030000         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;<span class="hljs-keyword">std</span>::basic_ofstream&lt;char, <span class="hljs-keyword">std</span>::char_traits&lt;<span class="hljs-number">ch</span> |<br>00007FF6077B18C1 | <span class="hljs-number">48</span>:83BD C8030000 <span class="hljs-number">00</span> | <span class="hljs-keyword">CMP</span> <span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3C8],<span class="hljs-number">0</span>                             |<br>00007FF6077B18C9 | <span class="hljs-number">74</span> 0F               | <span class="hljs-keyword">JE</span> img<span class="hljs-number">.</span>7FF6077B18DA                                      |<br>00007FF6077B18CB | <span class="hljs-number">48</span>:8B85 C8030000    | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+3C8]                           |<br>00007FF6077B18D2 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B18D5 | E8 <span class="hljs-number">46030000</span>         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;operator delete[](void*)&gt;                     | <br>00007FF6077B18DA | BB <span class="hljs-number">01000000</span>         | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">EBX</span>,<span class="hljs-number">1</span>                                                |<br>00007FF6077B18DF | <span class="hljs-number">48</span>:8D45 E0          | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>-<span class="hljs-number">20</span>]                            | [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">20</span>]:<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B18E3 | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B18E6 | E8 6D030000         | CALL &lt;JMP.&amp;std::basic_ofstream&lt;char, std::char_traits&lt;ch |</span><br><span class="hljs-string">00007FF6077B18EB | 48:8D85 D0010000    | LEA RAX,QWORD PTR SS:[RBP+1D0]                           |</span><br><span class="hljs-string">00007FF6077B18F2 | 48:89C1             | MOV RCX,RAX                                              | rcx:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;, rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B18F5 | E8 76030000         | CALL &lt;JMP.&amp;std::basic_ifstream&lt;char, std::char_traits&lt;ch |</span><br><span class="hljs-string">00007FF6077B18FA | 89D8                | MOV EAX,EBX                                              |</span><br><span class="hljs-string">00007FF6077B18FC | EB 2E               | JMP img.7FF6077B192C                                     |</span><br><span class="hljs-string">00007FF6077B18FE | 48:89C3             | MOV RBX,RAX                                              | rax:&amp;&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;</span><br><span class="hljs-string">00007FF6077B1901 | 48:8D45 E0          | LEA RAX,QWORD PTR SS:[RBP-20]                            | [rbp-20]:&quot;</span>E:\\WorkSpace\\Lab\\0xGame <span class="hljs-number">2025</span>\\flag<span class="hljs-number">.</span>bmp<span class="hljs-string">&quot;&quot;</span><br>00007FF6077B1905 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B1908 | E8 4B030000         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;<span class="hljs-keyword">std</span>::basic_ofstream&lt;char, <span class="hljs-keyword">std</span>::char_traits&lt;<span class="hljs-number">ch</span> |<br>00007FF6077B190D | EB <span class="hljs-number">03</span>               | <span class="hljs-keyword">JMP</span> img<span class="hljs-number">.</span>7FF6077B1912                                     |<br>00007FF6077B190F | <span class="hljs-number">48</span>:89C3             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RBX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B1912 | <span class="hljs-number">48</span>:8D85 D0010000    | <span class="hljs-keyword">LEA</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">QWORD</span> <span class="hljs-built_in">PTR</span> <span class="hljs-built_in">SS</span>:[<span class="hljs-built_in">RBP</span>+1D0]                           |<br>00007FF6077B1919 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B191C | E8 4F030000         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;<span class="hljs-keyword">std</span>::basic_ifstream&lt;char, <span class="hljs-keyword">std</span>::char_traits&lt;<span class="hljs-number">ch</span> |<br>00007FF6077B1921 | <span class="hljs-number">48</span>:89D8             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RAX</span>,<span class="hljs-built_in">RBX</span>                                              | <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B1924 | <span class="hljs-number">48</span>:89C1             | <span class="hljs-keyword">MOV</span> <span class="hljs-built_in">RCX</span>,<span class="hljs-built_in">RAX</span>                                              | <span class="hljs-built_in">rcx</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span>, <span class="hljs-built_in">rax</span>:&amp;<span class="hljs-string">&quot;E:\\WorkSpace\\Lab\\0xGame 2025\\flag.bmp&quot;</span><br>00007FF6077B1927 | E8 <span class="hljs-number">74140000</span>         | <span class="hljs-keyword">CALL</span> &lt;<span class="hljs-keyword">JMP</span>.&amp;_Unwind_Resume&gt;                               |<br>00007FF6077B192C | <span class="hljs-number">48</span>:81C4 <span class="hljs-number">78040000</span>    | <span class="hljs-keyword">ADD</span> <span class="hljs-built_in">RSP</span>,<span class="hljs-number">478</span>                                              |<br>00007FF6077B1933 | 5B                  | <span class="hljs-keyword">POP</span> <span class="hljs-built_in">RBX</span>                                                  |<br>00007FF6077B1934 | <span class="hljs-number">5D</span>                  | <span class="hljs-keyword">POP</span> <span class="hljs-built_in">RBP</span>                                                  |<br>00007FF6077B1935 | C3                  | <span class="hljs-keyword">RET</span>                                                      |<br></code></pre></td></tr></table></figure>

<p>通过跟踪三次read的参数（查看读入内存的数据）可以发现，程序除了读取文件头之外还读取了随后的1024bytes。这刚开始其实只是一个猜想，但是通过修改自己创建的flag.bmp文件头后的部分数据可以验证猜想</p>
<p><img src="/../images/image-20251118205855685.png" alt="修改文件数据"></p>
<p><img src="/../images/image-20251118205930373.png" alt="输入流缓冲区3读取的正是文件头后的1024bytes"></p>
<p>继续运行程序，可以发现生成的enc.bmp中保留了这一部分修改后的数据，于是猜想程序在加密结果中保留了输入流缓冲区3的1024bytes，可以通过扩大修改的数据范围来验证猜想（这里选择进一步修改flag.bmp里1024bytes的结尾，这样开头结尾都有被修改的特征了）</p>
<p><img src="/../images/image-20251118211132659.png" alt="进一步修改原文件文件头后1024bytes的结尾"></p>
<p><img src="/../images/image-20251119154953693.png" alt="加密结果文件头后1024bytes的开头"></p>
<p><img src="/../images/image-20251118211217057.png" alt="加密结果文件头后1024bytes的结尾"></p>
<p>于是加密结果中多出来的1024bytes来源就显而易见了。至此，程序读写文件的逻辑基本可以明确了：先保留文件头（0-0x36h）和文件头后的1024bytes，然后读取文件头之外的数据（0x36h-0x3589A9h）进行加密，加密完成后先向enc.bmp写入事先保留的文件头和1024bytes，再拼接上加密后的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">flag.bmp:文件头(大小0x36h)+图片数据(大小0x358974h)<br>enc.bmp:文件头(大小0x36h)+图片数据前1024bytes(大小0x400h)+加密后的图片数据(大小0x358974h)<br></code></pre></td></tr></table></figure>

<p>解决完文件读写逻辑分析后，接下来着手解决算法逆向。下面是modefiedRC4的详细分析</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs C">__int64 __fastcall <span class="hljs-title function_">modifiedRC4</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *input, __int64 a2, <span class="hljs-type">int</span> numOfDataBytes, __int64 outputBuffer, __int64 key)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> __int64 v5; <span class="hljs-comment">// rax</span><br>  _BYTE *v6; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v7; <span class="hljs-comment">// dl</span><br>  __int64 numOfEncBytes; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+24h] [rbp-Ch]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+24h] [rbp-Ch]</span><br>  <span class="hljs-type">int</span> k; <span class="hljs-comment">// [rsp+24h] [rbp-Ch]</span><br>  <span class="hljs-type">int</span> j_sbox; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> j_; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> i_sbox; <span class="hljs-comment">// [rsp+2Ch] [rbp-4h]</span><br>  <span class="hljs-type">int</span> i_; <span class="hljs-comment">// [rsp+2Ch] [rbp-4h]</span><br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">255</span>; ++i )<br>    S[i] = i;<br>  i_sbox = <span class="hljs-number">0</span>;<br>  j_sbox = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">255</span>; ++j )<br>  &#123;<br>    i_sbox = (i_sbox + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>;<br>    a2 = S[i_sbox] + j_sbox;<br>    v5 = sub_7FF7688232B0(input, a2, j_sbox, key);<span class="hljs-comment">// 实际上return key[8]，调试可以发现v5即key[8]是0x2A，对应密钥长度</span><br>    v6 = sub_7FF7688233D0(input, a2, i_sbox % v5, key);<span class="hljs-comment">// if(key_len &gt;= i_sbox%key_len ) return key[i_sbox%key_len]</span><br>    v7 = a2 + *v6;                              <span class="hljs-comment">// v7=S[i_sbox] + j_sbox + key[i_sbox%key_len]</span><br>    LODWORD(v6) = ((a2 + *v6) &gt;&gt; <span class="hljs-number">31</span>) &gt;&gt; <span class="hljs-number">24</span>;<br>    j_sbox = (v6 + v7) - v6;                    <span class="hljs-comment">// 这两步实际上等价为j_sbox = j_sboxv7%256</span><br>    swapbytes(input, a2, &amp;S[j_sbox], &amp;S[i_sbox]);<span class="hljs-comment">// 实际上是swapbytes(&amp;S[j_sbox],&amp;S[i_sbox])，前两个参数没有使用</span><br>  &#125;<br>  i_ = <span class="hljs-number">0</span>;<br>  j_ = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; ; ++k )<br>  &#123;<br>    numOfEncBytes = ((numOfDataBytes / <span class="hljs-number">256</span>) &lt;&lt; <span class="hljs-number">8</span>);<span class="hljs-comment">// 总数据量对256向下取整，保证加密数据量为256倍数</span><br>    <span class="hljs-keyword">if</span> ( k &gt;= numOfEncBytes )                   <span class="hljs-comment">// k从0开始直到最大加密数据量</span><br>      <span class="hljs-keyword">break</span>;<br>    i_ = (i_ + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>;<br>    j_ = (S[i_] + j_) % <span class="hljs-number">256</span>;<br>    swapbytes(input, a2, &amp;S[j_], &amp;S[i_]);<br>    swapBytes(<br>      input,<br>      a2,<br>      (((k / <span class="hljs-number">256</span>) &lt;&lt; <span class="hljs-number">8</span>) + j_ + outputBuffer),   <span class="hljs-comment">// outputBuffer[((k/256)&lt;&lt;8)+j_]，此处(k/256)&lt;&lt;8即取每块256bytes的基址，因此交换范围是当前所在的256bytes块</span><br>      (outputBuffer + ((k / <span class="hljs-number">256</span>) &lt;&lt; <span class="hljs-number">8</span>) + i_));  <span class="hljs-comment">// outputBuffer[((k/256)&lt;&lt;8)+i_]</span><br>  &#125;<br>  <span class="hljs-keyword">return</span> numOfEncBytes;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>算法中第一、二个循环在初始化S盒，没有对输出数据outputBuffer进行处理，第三个循环才利用S盒的数据来加密outputBuffer。加密outputBuffer的时候，记录了加密的数据量，加密轮数和加密数据量一致。每轮加密同步交换了 i_ 和 j_ 处的S盒数据以及outputBuffer数据，需要注意的是outputBuffer在交换的时候被分成了若干个256bytes块，交换在每个256bytes块内进行。最直观的解密算法是记录下每轮加密使用的 i_ 和 j_ ，然后逆序使用这些索引对交换数据。解密脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params"><span class="hljs-built_in">input</span>,output</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-built_in">input</span>,<span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        enc=f.read()<br><br>    bmp_header=enc[:<span class="hljs-number">0x36</span>]<span class="hljs-comment">#保留文件头</span><br>    enc_data=<span class="hljs-built_in">bytearray</span>(enc[<span class="hljs-number">0x436</span>:])<span class="hljs-comment">#加密数据为文件头+1024bytes后的数据，起始偏移即为0x436</span><br>    data_len=<span class="hljs-built_in">len</span>(enc_data)<br>    aligned_len=(data_len//<span class="hljs-number">256</span>)*<span class="hljs-number">256</span><span class="hljs-comment">#总数据量向下对256取整，即保证数据量为256的倍数</span><br><br>    key=<span class="hljs-string">&quot;114514puiqneravcixpbhqn;afnv-92piwgspdifjv&quot;</span><br>    key_len=<span class="hljs-built_in">len</span>(key)<br><br>    <span class="hljs-comment">#初始化S盒</span><br>    S=<span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>    j_sbox=<span class="hljs-number">0</span><br>    i_sbox=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        i_sbox=(i_sbox+<span class="hljs-number">1</span>)%<span class="hljs-number">256</span><br>        j_sbox=(j_sbox+S[i_sbox]+<span class="hljs-built_in">ord</span>(key[i_sbox%key_len]))%<span class="hljs-number">256</span><br>        S[i_sbox],S[j_sbox]=S[j_sbox],S[i_sbox]<br><br>    <span class="hljs-comment">#解密</span><br>    <span class="hljs-comment">#生成交换对</span><br>    i_=<span class="hljs-number">0</span><br>    j_=<span class="hljs-number">0</span><br>    swap_couples=[]<br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(aligned_len):<br>        i_=(i_+<span class="hljs-number">1</span>)%<span class="hljs-number">256</span><br>        j_=(j_+S[i_])%<span class="hljs-number">256</span><br>        S[i_],S[j_]=S[j_],S[i_]<br><br>        base=(k//<span class="hljs-number">256</span>)*<span class="hljs-number">256</span><span class="hljs-comment">#取每块256bytes的基址</span><br>        pos1=base+i_<br>        pos2=base+j_<br>        <span class="hljs-keyword">if</span> pos1&lt;aligned_len <span class="hljs-keyword">and</span> pos2&lt;aligned_len:<br>            swap_couples.append((pos1,pos2))<br><br>    <span class="hljs-comment">#逆序使用交换对，解密数据</span><br>    <span class="hljs-keyword">for</span> pos1,pos2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">reversed</span>(swap_couples):<br>        enc_data[pos1],enc_data[pos2]=enc_data[pos2],enc_data[pos1]<br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output,<span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(bmp_header)<br>        f.write(enc_data)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]decrypt done!&quot;</span>)<br><br>decrypt(<span class="hljs-string">&quot;enc.bmp&quot;</span>,<span class="hljs-string">&quot;flag.bmp&quot;</span>)<br><br></code></pre></td></tr></table></figure>

<p>解密可以得到下图（没有完全解密成功，但是不影响拿到flag）</p>
<p><img src="/../images/flag.bmp" alt="flag.bmp"></p>
</li>
</ul>
<blockquote>
<p>flag：0xGame{5d0e6f18-ebc0-4231-b0e6-a5821327aefd}</p>
</blockquote>
<h2 id="蔷薇地狱"><a href="#蔷薇地狱" class="headerlink" title="蔷薇地狱"></a>蔷薇地狱</h2><blockquote>
<p>考点：复杂程序分析，RSA解密</p>
<p>难点还是在于复杂</p>
</blockquote>
<ul>
<li><p>附件是一个Int.exe，一个流量包，还有两个enc文件。运行程序会显示connect failed然后打印一些数据后闪退，同时同一目录下的文件会被加密生成加密文件</p>
<p><img src="/../images/image-20251119160128685.png" alt="附件"></p>
<p><img src="/../images/image-20251119160014085.png" alt="运行程序显示"></p>
</li>
<li><p>用IDA打开程序，shift+F12可以在字符串窗口找到运行程序时显示的”connect failed”（以及其他一些看起来和网络通信有关的字符串，如”127.0.0.1”，”socket failed”）</p>
<p><img src="/../images/image-20251119160735550.png" alt="字符串窗口"></p>
<p>然后可以跟踪到下面这样一个很像网络通信的函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">sub_140003D46</span><span class="hljs-params">(__int64 a1, __int64 a2, u_short a3, <span class="hljs-type">int</span> a4)</span></span><br><span class="hljs-function"></span>&#123;<br>  __int64 v4; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> Error; <span class="hljs-comment">// eax</span><br>  __int64 v6; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v7; <span class="hljs-comment">// ebx</span><br>  __int64 v8; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v9; <span class="hljs-comment">// eax</span><br>  __int64 v10; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// r9d</span><br>  __int64 v13; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v14; <span class="hljs-comment">// eax</span><br>  __int64 v15; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v16; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v17; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v18; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v19; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-type">int</span> v20; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v21; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v22; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v23; <span class="hljs-comment">// rax</span><br>  __int64 v24; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v25; <span class="hljs-comment">// eax</span><br>  __int64 v26; <span class="hljs-comment">// rax</span><br>  __int64 v27; <span class="hljs-comment">// rax</span><br>  __int64 v28; <span class="hljs-comment">// rax</span><br>  __int64 v29; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v30; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v31; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v32; <span class="hljs-comment">// r9d</span><br>  __int64 v34[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-80h] BYREF</span><br>  _BYTE v35[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-60h] BYREF</span><br>  sockaddr name; <span class="hljs-comment">// [rsp+40h] [rbp-40h] BYREF</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v37; <span class="hljs-comment">// [rsp+1F4h] [rbp+174h]</span><br>  SOCKET s; <span class="hljs-comment">// [rsp+1F8h] [rbp+178h]</span><br><br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">WSAStartup</span>(<span class="hljs-number">0x202u</span>, (LPWSADATA)&amp;v34[<span class="hljs-number">10</span>]) )<br>  &#123;<br>    v4 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot;WSAStartup failed: &quot;</span>, &amp;std::cerr);<br>    Error = <span class="hljs-built_in">WSAGetLastError</span>();<br>    v6 = std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, a2, Error, v4);<br>    std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot;\n&quot;</span>, v6);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    s = <span class="hljs-built_in">socket</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> ( s == <span class="hljs-number">-1LL</span> )<br>    &#123;<br>      v8 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot;socket failed: &quot;</span>, &amp;std::cerr);<br>      v9 = <span class="hljs-built_in">WSAGetLastError</span>();<br>      v10 = std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, a2, v9, v8);<br>      std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot;\n&quot;</span>, v10);<br>      <span class="hljs-built_in">WSACleanup</span>();<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      name.sa_family = <span class="hljs-number">2</span>;<br>      *(_WORD *)name.sa_data = <span class="hljs-built_in">htons</span>(a3);<br>      *(_DWORD *)&amp;name.sa_data[<span class="hljs-number">2</span>] = <span class="hljs-built_in">inet_addr</span>(<span class="hljs-string">&quot;127.0.0.1&quot;</span>);<br>      <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">connect</span>(s, &amp;name, <span class="hljs-number">16</span>) == <span class="hljs-number">-1</span> )<br>      &#123;<br>        v13 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot;connect failed: &quot;</span>, &amp;std::cerr);<br>        v14 = <span class="hljs-built_in">WSAGetLastError</span>();<br>        v15 = std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, a2, v14, v13);<br>        std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot;\n&quot;</span>, v15);<br>        <span class="hljs-built_in">closesocket</span>(s);<br>        <span class="hljs-built_in">WSACleanup</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        <span class="hljs-built_in">sub_140001760</span>(a1, a2, a4, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v35, v11, v12, v34[<span class="hljs-number">0</span>], v34[<span class="hljs-number">1</span>]);<br>        v19 = <span class="hljs-built_in">sub_1400087B0</span>(a1, a2, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v35, v17, v18, v34[<span class="hljs-number">0</span>]);<br>        v23 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)<span class="hljs-built_in">sub_1400087F0</span>(a1, a2, v20, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v35, v21, v22, v34[<span class="hljs-number">0</span>]);<br>        v37 = <span class="hljs-built_in">send</span>(s, v23, v19, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span> ( v37 == <span class="hljs-number">-1</span> )<br>        &#123;<br>          v24 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot;send failed: &quot;</span>, &amp;std::cerr);<br>          v25 = <span class="hljs-built_in">WSAGetLastError</span>();<br>          v26 = std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, a2, v25, v24);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          v27 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot;Sent &quot;</span>, &amp;std::cout);<br>          v28 = std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, a2, v37, v27);<br>          v29 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot; bytes: &quot;</span>, v28);<br>          v26 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">char</span>&gt;(a1, a2, v35, v29);<br>        &#125;<br>        std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, a2, <span class="hljs-string">&quot;\n&quot;</span>, v26);<br>        <span class="hljs-built_in">closesocket</span>(s);<br>        <span class="hljs-built_in">WSACleanup</span>();<br>        v7 = <span class="hljs-number">0</span>;<br>        <span class="hljs-built_in">sub_14000B400</span>(a1, a2, v30, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v35, v31, v32, v34[<span class="hljs-number">0</span>]);<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> v7;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>回溯到上级函数，可以得到一个快700行代码的函数。代码量太大，人工分析很有难度，于是借助AI来分析大致逻辑。在关键地方加上注释后的函数如下</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">sub_140005769</span><span class="hljs-params">(__int64 a1, __int64 a2, _QWORD *a3, <span class="hljs-type">int</span> a4)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">char</span> v5; <span class="hljs-comment">// bl</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">char</span> v10; <span class="hljs-comment">// bl</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v13; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">char</span> v15; <span class="hljs-comment">// bl</span><br>  __int64 v16; <span class="hljs-comment">// rsi</span><br>  <span class="hljs-type">int</span> v17; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v18; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v19; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v20; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v21; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v22; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v23; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-type">int</span> v24; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v25; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v26; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v27; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v28; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v29; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v30; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v31; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v32; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v33; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v34; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v35; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v36; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v37; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v38; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v39; <span class="hljs-comment">// r9d</span><br>  __int64 v40; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v41; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v42; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v43; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v44; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v45; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v46; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v47; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v48; <span class="hljs-comment">// r9d</span><br>  __int64 v49; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v50; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v51; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v52; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v53; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v54; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v55; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v56; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v57; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v58; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v59; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v60; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v61; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v62; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v63; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v64; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v65; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v66; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v67; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v68; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v69; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v70; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v71; <span class="hljs-comment">// r9d</span><br>  __int64 v72; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">int</span> v73; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v74; <span class="hljs-comment">// r9d</span><br>  __int64 v75; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v76; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v77; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v78; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v79; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v80; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v81; <span class="hljs-comment">// r9d</span><br>  __int64 v82; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">int</span> v83; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v84; <span class="hljs-comment">// r9d</span><br>  __int64 v85; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v86; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v87; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v88; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v89; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v90; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v91; <span class="hljs-comment">// r9d</span><br>  __int64 v92; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">int</span> v93; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v94; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v95; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v96; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v97; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v98; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v99; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v100; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v101; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v102; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v103; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v104; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v105; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v106; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v107; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v108; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v109; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v110; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v111; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v112; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v113; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v114; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v115; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v116; <span class="hljs-comment">// r9d</span><br>  __int64 v117; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">int</span> v118; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v119; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v120; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v121; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v122; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">char</span> v123; <span class="hljs-comment">// r12</span><br>  <span class="hljs-type">char</span> v124; <span class="hljs-comment">// r13</span><br>  <span class="hljs-type">char</span> v125; <span class="hljs-comment">// r14</span><br>  <span class="hljs-type">char</span> v126; <span class="hljs-comment">// r15</span><br>  <span class="hljs-type">int</span> v127; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v128; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v129; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v130; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v131; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v132; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v133; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v134; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v135; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v136; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v137; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v138; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v139; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v140; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v141; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v142; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v143; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v144; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v145; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v146; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v147; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v148; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v149; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v150; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v151; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v152; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v153; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v154; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v155; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v156; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v157; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">char</span> v158; <span class="hljs-comment">// bl</span><br>  <span class="hljs-type">int</span> v159; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v160; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v161; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v162; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v163; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v164; <span class="hljs-comment">// r9d</span><br>  __int64 v165; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">int</span> v166; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v167; <span class="hljs-comment">// r9d</span><br>  __int64 v168; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v169; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v170; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v171; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v172; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v173; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v174; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v175; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v176; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v177; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v178; <span class="hljs-comment">// r9d</span><br>  __int64 v179; <span class="hljs-comment">// rdx</span><br>  __int64 v180; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">int</span> v181; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v182; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v183; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v184; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v185; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v186; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v187; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">char</span> v188; <span class="hljs-comment">// bl</span><br>  <span class="hljs-type">int</span> v189; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v190; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v191; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v192; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v193; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v194; <span class="hljs-comment">// r9d</span><br>  __int64 v195; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">int</span> v196; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v197; <span class="hljs-comment">// r9d</span><br>  __int64 v198; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v199; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v200; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v201; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v202; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v203; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v204; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v205; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v206; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v207; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v208; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v209; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v210; <span class="hljs-comment">// r9d</span><br>  __int64 v211; <span class="hljs-comment">// rdx</span><br>  __int64 v212; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">int</span> v213; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v214; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v215; <span class="hljs-comment">// r9d</span><br>  __int64 v216; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">int</span> v217; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v218; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v219; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v220; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v221; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v222; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v223; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v224; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v225; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v226; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v227; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v228; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v229; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v230; <span class="hljs-comment">// r9d</span><br>  __int64 v232; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v233; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v234; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v235; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v236; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v237; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v238; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v239; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v240; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v241; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v242; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v243; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v244; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v245; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v246; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v247; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v248; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v249; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v250; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v251; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v252; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v253; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v254; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v255; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v256; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v257; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v258; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v259; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v260; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v261; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v262; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v263; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v264; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v265; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v266; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v267; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v268; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v269; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v270; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v271; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v272; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v273; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v274; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v275; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v276; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v277; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v278; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v279; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v280; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v281; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v282; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v283; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  HCRYPTKEY v284; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v285; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v286; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v287; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v288; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v289; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v290; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v291; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v292; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v293; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v294; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v295; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  HCRYPTKEY v296; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v297; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v298; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v299; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v300; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v301; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v302; <span class="hljs-comment">// [rsp+0h] [rbp-80h]</span><br>  __int64 v303; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v304; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v305; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v306; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v307; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v308; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v309; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v310; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v311; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v312; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v313; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v314; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v315; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v316; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v317; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v318; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v319; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v320; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v321; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v322; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v323; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v324; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v325; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v326; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v327; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v328; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v329; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v330; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v331; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v332; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v333; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v334; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v335; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v336; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v337; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v338; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  __int64 v339; <span class="hljs-comment">// [rsp+8h] [rbp-78h]</span><br>  <span class="hljs-type">int</span> v340; <span class="hljs-comment">// [rsp+10h] [rbp-70h]</span><br>  <span class="hljs-type">int</span> v341; <span class="hljs-comment">// [rsp+10h] [rbp-70h]</span><br>  __int64 v342; <span class="hljs-comment">// [rsp+10h] [rbp-70h]</span><br>  <span class="hljs-type">int</span> v343; <span class="hljs-comment">// [rsp+10h] [rbp-70h]</span><br>  <span class="hljs-type">int</span> v344; <span class="hljs-comment">// [rsp+10h] [rbp-70h]</span><br>  __int64 v345; <span class="hljs-comment">// [rsp+10h] [rbp-70h]</span><br>  <span class="hljs-type">char</span> v346; <span class="hljs-comment">// [rsp+30h] [rbp-50h]</span><br>  <span class="hljs-type">char</span> v347; <span class="hljs-comment">// [rsp+38h] [rbp-48h]</span><br>  _BYTE v348[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-40h] BYREF</span><br>  _BYTE v349[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+70h] [rbp-10h] BYREF</span><br>  <span class="hljs-type">int</span> v350[<span class="hljs-number">124</span>]; <span class="hljs-comment">// [rsp+A0h] [rbp+20h] BYREF</span><br>  <span class="hljs-type">int</span> v351[<span class="hljs-number">124</span>]; <span class="hljs-comment">// [rsp+290h] [rbp+210h] BYREF</span><br>  _BYTE v352[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+480h] [rbp+400h] BYREF</span><br>  _BYTE v353[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+490h] [rbp+410h] BYREF</span><br>  BYTE v354[<span class="hljs-number">28</span>]; <span class="hljs-comment">// [rsp+4A0h] [rbp+420h] BYREF</span><br>  BYTE v355[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+4BCh] [rbp+43Ch] BYREF</span><br>  BYTE pbData[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+4C0h] [rbp+440h] BYREF</span><br>  __int16 v357; <span class="hljs-comment">// [rsp+4C2h] [rbp+442h]</span><br>  <span class="hljs-type">int</span> v358; <span class="hljs-comment">// [rsp+4C4h] [rbp+444h]</span><br>  <span class="hljs-type">int</span> v359; <span class="hljs-comment">// [rsp+4C8h] [rbp+448h]</span><br>  __int64 v360; <span class="hljs-comment">// [rsp+4CCh] [rbp+44Ch]</span><br>  __int64 v361; <span class="hljs-comment">// [rsp+4D4h] [rbp+454h]</span><br>  __int64 v362; <span class="hljs-comment">// [rsp+4DCh] [rbp+45Ch]</span><br>  __int64 v363; <span class="hljs-comment">// [rsp+4E4h] [rbp+464h]</span><br>  _BYTE IV[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+4F0h] [rbp+470h] BYREF IV</span><br>  _BYTE key[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+510h] [rbp+490h] BYREF 密钥</span><br>  BYTE MODE[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+530h] [rbp+4B0h] BYREF 模式参数</span><br>  BYTE v367[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+550h] [rbp+4D0h] BYREF</span><br>  BYTE pbBuffer[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+560h] [rbp+4E0h] BYREF</span><br>  __int64 v369; <span class="hljs-comment">// [rsp+568h] [rbp+4E8h]</span><br>  __int64 v370; <span class="hljs-comment">// [rsp+570h] [rbp+4F0h]</span><br>  __int64 v371; <span class="hljs-comment">// [rsp+578h] [rbp+4F8h]</span><br>  HCRYPTKEY hKey; <span class="hljs-comment">// [rsp+588h] [rbp+508h] BYREF</span><br>  HCRYPTPROV phProv; <span class="hljs-comment">// [rsp+590h] [rbp+510h] BYREF</span><br>  <span class="hljs-type">char</span> v374; <span class="hljs-comment">// [rsp+59Ah] [rbp+51Ah] BYREF</span><br>  <span class="hljs-type">char</span> v375; <span class="hljs-comment">// [rsp+59Bh] [rbp+51Bh] BYREF</span><br>  <span class="hljs-type">char</span> v376; <span class="hljs-comment">// [rsp+59Ch] [rbp+51Ch] BYREF</span><br>  <span class="hljs-type">char</span> v377; <span class="hljs-comment">// [rsp+59Dh] [rbp+51Dh] BYREF</span><br>  <span class="hljs-type">char</span> v378; <span class="hljs-comment">// [rsp+59Eh] [rbp+51Eh] BYREF</span><br>  <span class="hljs-type">char</span> v379; <span class="hljs-comment">// [rsp+59Fh] [rbp+51Fh] BYREF</span><br>  _BYTE v380[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+5A0h] [rbp+520h] BYREF</span><br>  _BYTE v381[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+5C0h] [rbp+540h] BYREF</span><br>  _BYTE v382[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+5E0h] [rbp+560h] BYREF</span><br>  _BYTE v383[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+600h] [rbp+580h] BYREF</span><br>  _BYTE v384[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+610h] [rbp+590h] BYREF</span><br>  _BYTE v385[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+630h] [rbp+5B0h] BYREF</span><br>  _BYTE v386[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+640h] [rbp+5C0h] BYREF</span><br>  _BYTE v387[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+650h] [rbp+5D0h] BYREF</span><br>  _BYTE v388[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+660h] [rbp+5E0h] BYREF</span><br>  _BYTE v389[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+670h] [rbp+5F0h] BYREF</span><br>  _BYTE v390[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+680h] [rbp+600h] BYREF</span><br>  _BYTE v391[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+6A0h] [rbp+620h] BYREF</span><br>  _BYTE v392[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+6B0h] [rbp+630h] BYREF</span><br>  _BYTE v393[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+6D0h] [rbp+650h] BYREF</span><br>  _BYTE v394[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+6E0h] [rbp+660h] BYREF</span><br>  _BYTE v395[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+710h] [rbp+690h] BYREF</span><br>  _BYTE v396[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+720h] [rbp+6A0h] BYREF</span><br>  _BYTE v397[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+730h] [rbp+6B0h] BYREF</span><br>  _BYTE v398[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+750h] [rbp+6D0h] BYREF</span><br>  _BYTE v399[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+780h] [rbp+700h] BYREF</span><br>  _BYTE v400[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+7A0h] [rbp+720h] BYREF</span><br>  _BYTE v401[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+7D0h] [rbp+750h] BYREF</span><br>  _BYTE v402[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+7F0h] [rbp+770h] BYREF</span><br>  _BYTE v403[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+820h] [rbp+7A0h] BYREF</span><br>  _BYTE v404[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+840h] [rbp+7C0h] BYREF</span><br>  _BYTE v405[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+870h] [rbp+7F0h] BYREF</span><br>  _BYTE v406[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+890h] [rbp+810h] BYREF</span><br>  _BYTE v407[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+8C0h] [rbp+840h] BYREF</span><br>  _BYTE v408[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+8E0h] [rbp+860h] BYREF</span><br>  _BYTE v409[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+900h] [rbp+880h] BYREF</span><br>  _BYTE v410[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+930h] [rbp+8B0h] BYREF</span><br>  _BYTE v411[<span class="hljs-number">40</span>]; <span class="hljs-comment">// [rsp+950h] [rbp+8D0h] BYREF</span><br>  <span class="hljs-type">char</span> *v412; <span class="hljs-comment">// [rsp+978h] [rbp+8F8h]</span><br>  <span class="hljs-type">char</span> *v413; <span class="hljs-comment">// [rsp+980h] [rbp+900h]</span><br>  <span class="hljs-type">char</span> *v414; <span class="hljs-comment">// [rsp+988h] [rbp+908h]</span><br>  <span class="hljs-type">char</span> *v415; <span class="hljs-comment">// [rsp+990h] [rbp+910h]</span><br>  <span class="hljs-type">char</span> *v416; <span class="hljs-comment">// [rsp+998h] [rbp+918h]</span><br>  <span class="hljs-type">char</span> *v417; <span class="hljs-comment">// [rsp+9A0h] [rbp+920h]</span><br>  __int64 v418; <span class="hljs-comment">// [rsp+9A8h] [rbp+928h]</span><br>  BYTE *v419; <span class="hljs-comment">// [rsp+9B0h] [rbp+930h]</span><br>  <span class="hljs-type">char</span> v420; <span class="hljs-comment">// [rsp+9BFh] [rbp+93Fh]</span><br><br>  <span class="hljs-built_in">sub_140006CC0</span>();<br>  v420 = <span class="hljs-number">0</span>;<br>  v5 = <span class="hljs-number">0</span>;<br>  v6 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> ( a4 &lt;= <span class="hljs-number">1</span> )                                <span class="hljs-comment">// 此处开始解析命令行参数，这是第一个参数的处理</span><br>  &#123;<br>    v416 = &amp;v375;<br>    v6 = <span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">sub_14000B350</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;unk_<span class="hljs-number">14000E1</span>D0, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)MODE, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v375, v4);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v417 = &amp;v374;<br>    v5 = <span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">sub_14000B350</span>(a1, <span class="hljs-number">0</span>, a3[<span class="hljs-number">1</span>], (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)MODE, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v374, v4);<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( (_BYTE)v6 )<br>    <span class="hljs-built_in">sub_140009C30</span>(a1, v6, v7, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v375, v8, v9);<br>  <span class="hljs-keyword">if</span> ( v5 )<br>    <span class="hljs-built_in">sub_140009C30</span>(a1, v6, v7, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v374, v8, v9);<br>  v10 = <span class="hljs-number">0</span>;<br>  v11 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> ( a4 &lt;= <span class="hljs-number">2</span> )                                <span class="hljs-comment">// 这是第二个参数的处理</span><br>  &#123;<br>    v414 = &amp;v377;<br>    v11 = <span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">sub_14000B350</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;unk_<span class="hljs-number">14000E1</span>D0, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)key, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v377, v9);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v415 = &amp;v376;<br>    v10 = <span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">sub_14000B350</span>(a1, <span class="hljs-number">0</span>, a3[<span class="hljs-number">2</span>], (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)key, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v376, v9);<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( (_BYTE)v11 )<br>    <span class="hljs-built_in">sub_140009C30</span>(a1, v11, v12, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v377, v13, v14);<br>  <span class="hljs-keyword">if</span> ( v10 )<br>    <span class="hljs-built_in">sub_140009C30</span>(a1, v11, v12, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v376, v13, v14);<br>  v15 = <span class="hljs-number">0</span>;<br>  v16 = <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( a4 &lt;= <span class="hljs-number">3</span> )                                <span class="hljs-comment">// 这是第三个参数的处理</span><br>  &#123;<br>    v412 = &amp;v379;<br>    v16 = <span class="hljs-number">1LL</span>;<br>    <span class="hljs-built_in">sub_14000B350</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;unk_<span class="hljs-number">14000E1</span>D0, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)IV, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v379, v14);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v413 = &amp;v378;<br>    v15 = <span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">sub_14000B350</span>(a1, <span class="hljs-number">0</span>, a3[<span class="hljs-number">3</span>], (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)IV, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v378, v14);<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( (_BYTE)v16 )<br>    <span class="hljs-built_in">sub_140009C30</span>(a1, v16, v17, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v379, v18, v19);<br>  <span class="hljs-keyword">if</span> ( v15 )<br>    <span class="hljs-built_in">sub_140009C30</span>(a1, v16, v17, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v378, v18, v19);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">CryptAcquireContextA</span>(&amp;phProv, <span class="hljs-number">0LL</span>, <span class="hljs-number">0LL</span>, <span class="hljs-number">0x18u</span>, <span class="hljs-number">0xF0000000</span>) )<span class="hljs-comment">// 使用Microsoft CryptoAPI，0X18表示PROV_RSA_AES，程序使用RSA加密密钥和IV发送到服务器</span><br>  &#123;<br>    <span class="hljs-keyword">if</span> ( a4 &lt;= <span class="hljs-number">3</span> )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">CryptGenRandom</span>(phProv, <span class="hljs-number">0x20u</span>, pbBuffer) )<span class="hljs-comment">// 生成32字节随机密钥</span><br>      &#123;<br>        v23 = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">goto</span> LABEL_63;<br>      &#125;<br>      <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">CryptGenRandom</span>(phProv, <span class="hljs-number">0x10u</span>, v367) )<span class="hljs-comment">// 生成16字节随机IV</span><br>      &#123;<br>        v23 = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">goto</span> LABEL_63;<br>      &#125;<br>      <span class="hljs-built_in">sub_1400028FE</span>(a1, v16, (__int64)pbBuffer, (__int64)v387, <span class="hljs-number">32</span>);<br>      <span class="hljs-built_in">sub_140005071</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v387, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v386, v56, v57, v232, v308);<span class="hljs-comment">// 疑似加密函数</span><br>      <span class="hljs-built_in">sub_140003D46</span>(a1, v16, <span class="hljs-number">0x1F90u</span>, (<span class="hljs-type">int</span>)v386);<span class="hljs-comment">// 疑似网络通信的函数</span><br>      <span class="hljs-built_in">sub_1400029A2</span>(a1, v16, v58, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v386, v59, v60, v243);<br>      <span class="hljs-built_in">sub_1400029A2</span>(a1, v16, v61, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v387, v62, v63, v244);<br>      <span class="hljs-built_in">sub_1400028FE</span>(a1, v16, (__int64)v367, (__int64)v389, <span class="hljs-number">16</span>);<br>      <span class="hljs-built_in">sub_140005071</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v389, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v388, v64, v65, v245, v309);<br>      <span class="hljs-built_in">sub_140003D46</span>(a1, v16, <span class="hljs-number">0x1F90u</span>, (<span class="hljs-type">int</span>)v388);<br>      <span class="hljs-built_in">sub_1400029A2</span>(a1, v16, v66, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v388, v67, v68, v246);<br>      <span class="hljs-built_in">sub_1400029A2</span>(a1, v16, v69, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v389, v70, v71, v247);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">sub_14000C650</span>(a1, v16, (<span class="hljs-type">int</span>)<span class="hljs-string">&quot;-d&quot;</span>, (<span class="hljs-type">int</span>)MODE, v21, v22) )<br>        v420 = <span class="hljs-number">1</span>;                               <span class="hljs-comment">// 命令行参数包含&quot;-d&quot;的时候，v449被设为1，进入解密模式</span><br>      <span class="hljs-built_in">sub_14000B130</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)key, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v380, v24, v25, v232, v303);<span class="hljs-comment">// 从命令行获取key</span><br>      <span class="hljs-built_in">sub_1400051EC</span>(a1, v16, (__int64)pbBuffer, (<span class="hljs-type">int</span>)v380, v26, v27);<span class="hljs-comment">// 处理key</span><br>      <span class="hljs-built_in">sub_14000B400</span>(a1, v16, v28, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v380, v29, v30, v233);<br>      <span class="hljs-built_in">sub_14000B130</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)IV, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v381, v31, v32, v234, v304);<span class="hljs-comment">// 从命令行获取IV</span><br>      <span class="hljs-built_in">sub_1400051EC</span>(a1, v16, (__int64)v367, (<span class="hljs-type">int</span>)v381, v33, v34);<span class="hljs-comment">// 处理IV</span><br>      <span class="hljs-built_in">sub_14000B400</span>(a1, v16, v35, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v381, v36, v37, v235);<br>      <span class="hljs-built_in">sub_1400028FE</span>(a1, v16, (__int64)pbBuffer, (__int64)v383, <span class="hljs-number">32</span>);<br>      <span class="hljs-built_in">sub_140001534</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v383, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v382, v38, v39, v236, v305);<br>      v40 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">char</span>&gt;(a1, v16, v382, &amp;std::cout);<br>      std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, v16, &amp;std::endl&lt;<span class="hljs-type">char</span>,std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;, v40);<br>      <span class="hljs-built_in">sub_14000B400</span>(a1, v16, v41, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v382, v42, v43, v237);<br>      <span class="hljs-built_in">sub_1400029A2</span>(a1, v16, v44, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v383, v45, v46, v238);<br>      <span class="hljs-built_in">sub_1400028FE</span>(a1, v16, (__int64)v367, (__int64)v385, <span class="hljs-number">16</span>);<br>      <span class="hljs-built_in">sub_140001534</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v385, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v384, v47, v48, v239, v306);<br>      v49 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">char</span>&gt;(a1, v16, v384, &amp;std::cout);<br>      std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, v16, &amp;std::endl&lt;<span class="hljs-type">char</span>,std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;, v49);<br>      <span class="hljs-built_in">sub_14000B400</span>(a1, v16, v50, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v384, v51, v52, v240);<br>      <span class="hljs-built_in">sub_1400029A2</span>(a1, v16, v53, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v385, v54, v55, v241);<br>    &#125;<br>    v72 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, v16, <span class="hljs-string">&quot;Key: &quot;</span>, &amp;std::cout);<br>    <span class="hljs-built_in">sub_1400028FE</span>(a1, v16, (__int64)pbBuffer, (__int64)v391, <span class="hljs-number">32</span>);<br>    <span class="hljs-built_in">sub_140001534</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v391, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v390, v73, v74, v242, v307);<br>    v75 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">char</span>&gt;(a1, v16, v390, v72);<br>    std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, v16, &amp;std::endl&lt;<span class="hljs-type">char</span>,std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;, v75);<br>    <span class="hljs-built_in">sub_14000B400</span>(a1, v16, v76, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v390, v77, v78, v248);<br>    <span class="hljs-built_in">sub_1400029A2</span>(a1, v16, v79, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v391, v80, v81, v249);<br>    v82 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;(a1, v16, <span class="hljs-string">&quot;IV: &quot;</span>, &amp;std::cout);<br>    <span class="hljs-built_in">sub_1400028FE</span>(a1, v16, (__int64)v367, (__int64)v393, <span class="hljs-number">16</span>);<br>    <span class="hljs-built_in">sub_140001534</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v393, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v392, v83, v84, v250, v310);<br>    v85 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">char</span>&gt;(a1, v16, v392, v82);<br>    std::ostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, v16, &amp;std::endl&lt;<span class="hljs-type">char</span>,std::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;, v85);<br>    <span class="hljs-built_in">sub_14000B400</span>(a1, v16, v86, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v392, v87, v88, v251);<br>    <span class="hljs-built_in">sub_1400029A2</span>(a1, v16, v89, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v393, v90, v91, v252);<br>    pbData[<span class="hljs-number">0</span>] = <span class="hljs-number">8</span>;<br>    pbData[<span class="hljs-number">1</span>] = <span class="hljs-number">2</span>;<br>    v357 = <span class="hljs-number">0</span>;<br>    v358 = <span class="hljs-number">26128</span>;<br>    v359 = <span class="hljs-number">32</span>;<br>    v360 = *(_QWORD *)pbBuffer;<br>    v361 = v369;<br>    v362 = v370;<br>    v363 = v371;<br>    *(_DWORD *)v355 = <span class="hljs-number">2</span>;<br>    <span class="hljs-built_in">CryptImportKey</span>(phProv, pbData, <span class="hljs-number">0x2Cu</span>, <span class="hljs-number">0LL</span>, <span class="hljs-number">0</span>, &amp;hKey);<span class="hljs-comment">// 导入密钥</span><br>    <span class="hljs-built_in">CryptSetKeyParam</span>(hKey, <span class="hljs-number">4u</span>, v355, <span class="hljs-number">0</span>);        <span class="hljs-comment">// 设置密钥参数</span><br>    <span class="hljs-built_in">CryptSetKeyParam</span>(hKey, <span class="hljs-number">1u</span>, v367, <span class="hljs-number">0</span>);        <span class="hljs-comment">// 设置IV</span><br>    std::filesystem::current_path[abi:cxx11](a1, v16, v92, v394);<span class="hljs-comment">// 获取当前路径</span><br>    <span class="hljs-built_in">sub_140008E50</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v394, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v354, v93, v94, v253, v311);<br>    v419 = v354;<br>    <span class="hljs-built_in">sub_1400091B0</span>(a1, v16, v95, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v394, v96, v97, v254);<br>    <span class="hljs-built_in">sub_140008E90</span>(a1, v16, (_DWORD)v419, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v395, v98, v99, v255, v312);<br>    <span class="hljs-built_in">sub_140009230</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v395, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v353, v100, v101, v256, v313);<br>    <span class="hljs-built_in">sub_140008EE0</span>(a1, v16, v102, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v395, v103, v104, v257);<br>    <span class="hljs-built_in">sub_140008E90</span>(a1, v16, (_DWORD)v419, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v396, v105, v106, v258, v314);<br>    <span class="hljs-built_in">sub_140008F00</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v396, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v352, v107, v108, v259, v315);<br>    <span class="hljs-built_in">sub_140008EE0</span>(a1, v16, v109, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v396, v110, v111, v260);<br>    <span class="hljs-keyword">while</span> ( (<span class="hljs-type">unsigned</span> __int8)<span class="hljs-built_in">sub_1400092E0</span>(a1, v16, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v352, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v353, v112, v113, v261, v316) )<span class="hljs-comment">// 遍历当前路径下的所有文件</span><br>    &#123;<br>      v418 = std::filesystem::__cxx11::directory_iterator::<span class="hljs-keyword">operator</span>*(a1, v16, v216, v353);<br>      <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int8)<span class="hljs-built_in">sub_1400082F0</span>(a1, v16, v114, v418, v115, v116, v298) == <span class="hljs-number">1</span> )<br>      &#123;<br>        v120 = <span class="hljs-built_in">sub_140008320</span>(a1, v16, v117, v418, v118, v119, v261);<br>        <span class="hljs-built_in">sub_140009030</span>(a1, v16, v120, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, v121, v122, v262, v316);<br>        a1 = <span class="hljs-number">0LL</span>;<br>        v123 = <span class="hljs-number">0</span>;<br>        v124 = <span class="hljs-number">0</span>;<br>        v125 = <span class="hljs-number">0</span>;<br>        v126 = <span class="hljs-number">0</span>;<br>        v347 = <span class="hljs-number">0</span>;<br>        <span class="hljs-built_in">sub_140008440</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v398, v127, v128, v263, v317);<br>        <span class="hljs-built_in">sub_1400083D0</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v398, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v397, v129, v130, v264, v318);<br>        v16 = <span class="hljs-number">1LL</span>;<br>        <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int8)<span class="hljs-built_in">sub_14000C6D0</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">L&quot;.exe&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v397, v131, v132, v265, v319) )<span class="hljs-comment">// 跳过exe文件</span><br>          <span class="hljs-keyword">goto</span> LABEL_39;<br>        <span class="hljs-built_in">sub_140008440</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v400, v134, v135, v266, v316);<br>        a1 = <span class="hljs-number">1LL</span>;<br>        <span class="hljs-built_in">sub_1400083D0</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v400, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v399, v136, v137, v267, v320);<br>        v123 = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int8)<span class="hljs-built_in">sub_14000C6D0</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">&quot;.&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v399, v138, v139, v268, v321) )<br>          <span class="hljs-keyword">goto</span> LABEL_39;<br>        <span class="hljs-built_in">sub_140008440</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v402, v134, v135, v266, v316);<br>        v124 = <span class="hljs-number">1</span>;<br>        <span class="hljs-built_in">sub_1400083D0</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v402, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v401, v140, v141, v269, v322);<br>        v125 = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int8)<span class="hljs-built_in">sub_14000C6D0</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">L&quot;.dec&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v401, v142, v143, v270, v323)<span class="hljs-comment">// 跳过dec文件</span><br>          || (<span class="hljs-built_in">sub_140008440</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v404, v134, v135, v266, v316),<br>              v126 = <span class="hljs-number">1</span>,<br>              <span class="hljs-built_in">sub_1400083D0</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v404, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v403, v144, v145, v271, v324),<br>              v347 = <span class="hljs-number">1</span>,<br>              (<span class="hljs-type">unsigned</span> __int8)<span class="hljs-built_in">sub_14000C6D0</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">&quot;.&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v403, v146, v147, v272, v325)) )<span class="hljs-comment">// 跳过当前目录的.文件</span><br>        &#123;<br>LABEL_39:<br>          v346 = <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          v346 = <span class="hljs-number">0</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> ( v347 )<br>          <span class="hljs-built_in">sub_14000C290</span>(a1, <span class="hljs-number">1</span>, v133, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v403, v134, v135, v266);<br>        <span class="hljs-keyword">if</span> ( v126 )<br>          <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v133, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v404, v134, v135, v266);<br>        <span class="hljs-keyword">if</span> ( v125 )<br>          <span class="hljs-built_in">sub_14000C290</span>(a1, <span class="hljs-number">1</span>, v133, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v401, v134, v135, v266);<br>        <span class="hljs-keyword">if</span> ( v124 )<br>          <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v133, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v402, v134, v135, v266);<br>        <span class="hljs-keyword">if</span> ( v123 )<br>          <span class="hljs-built_in">sub_14000C290</span>(a1, <span class="hljs-number">1</span>, v133, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v399, v134, v135, v266);<br>        <span class="hljs-keyword">if</span> ( (_BYTE)a1 )<br>          <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v133, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v400, v134, v135, v266);<br>        <span class="hljs-built_in">sub_14000C290</span>(a1, <span class="hljs-number">1</span>, v133, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v397, v134, v135, v266);<br>        <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v148, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v398, v149, v150, v273);<br>        <span class="hljs-keyword">if</span> ( !v346 )<br>        &#123;<br>          <span class="hljs-keyword">if</span> ( v420 != <span class="hljs-number">1</span> )                      <span class="hljs-comment">// 加密模式</span><br>          &#123;<br>            <span class="hljs-built_in">sub_140008440</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v406, v152, v153, v274, v316);<br>            <span class="hljs-built_in">sub_1400083D0</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v406, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v405, v154, v155, v275, v326);<br>            v158 = <span class="hljs-built_in">sub_14000C6D0</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">&quot;.&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v405, v156, v157, v276, v327);<br>            <span class="hljs-built_in">sub_14000C290</span>(a1, <span class="hljs-number">1</span>, v159, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v405, v160, v161, v277);<br>            <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v162, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v406, v163, v164, v278);<br>            <span class="hljs-keyword">if</span> ( !v158 )<br>            &#123;<br>              v165 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">wchar_t</span>,std::char_traits&lt;<span class="hljs-type">wchar_t</span>&gt;&gt;(a1, <span class="hljs-number">1LL</span>, <span class="hljs-string">L&quot;Encrypting file: &quot;</span>, &amp;std::wcout);<br>              <span class="hljs-built_in">sub_1400083D0</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v407, v166, v167, v274, v316);<br>              v168 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">wchar_t</span>&gt;(a1, <span class="hljs-number">1LL</span>, v407, v165);<br>              std::wostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, <span class="hljs-number">1LL</span>, &amp;std::endl&lt;<span class="hljs-type">wchar_t</span>,std::char_traits&lt;<span class="hljs-type">wchar_t</span>&gt;&gt;, v168);<br>              <span class="hljs-built_in">sub_14000C290</span>(a1, <span class="hljs-number">1</span>, v169, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v407, v170, v171, v279);<br>              <span class="hljs-built_in">sub_140009030</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v349, v172, v173, v280, v328);<br>              <span class="hljs-built_in">sub_1400091E0</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">&quot;.&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v349, v174, v175, v281, v329);<br>              <span class="hljs-built_in">sub_140009B20</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v351, <span class="hljs-number">4</span>, v176, v282, v330, v340);<span class="hljs-comment">// 读取输入文件</span><br>              <span class="hljs-built_in">sub_140009B60</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v349, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v350, <span class="hljs-number">4</span>, v177, v283, v331, v341);<span class="hljs-comment">// 准备输出文件</span><br>              <span class="hljs-built_in">sub_1400052D0</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">int</span>)v351, hKey, (<span class="hljs-type">int</span>)v350, v178, v284, v332, v342);<span class="hljs-comment">// 执行加密</span><br>              std::ofstream::~<span class="hljs-built_in">ofstream</span>(a1, <span class="hljs-number">1LL</span>, v179, v350);<br>              std::ifstream::~ifstream(a1, <span class="hljs-number">1LL</span>, v180, v351);<br>              <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v181, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v349, v182, v183, v285);<br>            &#125;<br>          &#125;<br>          <span class="hljs-keyword">else</span>                                  <span class="hljs-comment">// 解密模式</span><br>          &#123;<br>            <span class="hljs-built_in">sub_140008440</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v409, v152, v153, v274, v316);<br>            <span class="hljs-built_in">sub_1400083D0</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v409, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v408, v184, v185, v286, v333);<br>            v188 = <span class="hljs-built_in">sub_14000C750</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">&quot;.&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v408, v186, v187, v287, v334);<br>            <span class="hljs-built_in">sub_14000C290</span>(a1, <span class="hljs-number">1</span>, v189, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v408, v190, v191, v288);<br>            <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v192, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v409, v193, v194, v289);<br>            <span class="hljs-keyword">if</span> ( !v188 )<br>            &#123;<br>              v195 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">wchar_t</span>,std::char_traits&lt;<span class="hljs-type">wchar_t</span>&gt;&gt;(a1, <span class="hljs-number">1LL</span>, <span class="hljs-string">L&quot;Decrypting file: &quot;</span>, &amp;std::wcout);<br>              <span class="hljs-built_in">sub_1400083D0</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v410, v196, v197, v274, v316);<br>              v198 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">wchar_t</span>&gt;(a1, <span class="hljs-number">1LL</span>, v410, v195);<br>              std::wostream::<span class="hljs-keyword">operator</span>&lt;&lt;(a1, <span class="hljs-number">1LL</span>, &amp;std::endl&lt;<span class="hljs-type">wchar_t</span>,std::char_traits&lt;<span class="hljs-type">wchar_t</span>&gt;&gt;, v198);<br>              <span class="hljs-built_in">sub_14000C290</span>(a1, <span class="hljs-number">1</span>, v199, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v410, v200, v201, v290);<br>              <span class="hljs-built_in">sub_140009030</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v349, v202, v203, v291, v335);<br>              <span class="hljs-built_in">sub_1400090C0</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">L&quot;dec&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v411, <span class="hljs-number">2</span>, v204, v292, v336, v340);<br>              std::filesystem::__cxx11::path::<span class="hljs-built_in">replace_extension</span>(<br>                (std::filesystem::__cxx11::path *)a1,<br>                (<span class="hljs-type">const</span> std::filesystem::__cxx11::path *)<span class="hljs-number">1</span>);<br>              <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v205, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v411, v206, v207, v293);<br>              <span class="hljs-built_in">sub_140009B20</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v351, <span class="hljs-number">4</span>, v208, v294, v337, v343);<span class="hljs-comment">// 读取加密文件</span><br>              <span class="hljs-built_in">sub_140009B60</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v349, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v350, <span class="hljs-number">4</span>, v209, v295, v338, v344);<span class="hljs-comment">// 准备输出文件</span><br>              <span class="hljs-built_in">sub_140005522</span>(a1, <span class="hljs-number">1</span>, (<span class="hljs-type">int</span>)v351, hKey, (<span class="hljs-type">int</span>)v350, v210, v296, v339, v345);<span class="hljs-comment">// 执行解密</span><br>              std::ofstream::~<span class="hljs-built_in">ofstream</span>(a1, <span class="hljs-number">1LL</span>, v211, v350);<br>              std::ifstream::~ifstream(a1, <span class="hljs-number">1LL</span>, v212, v351);<br>              <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v213, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v349, v214, v215, v297);<br>            &#125;<br>          &#125;<br>        &#125;<br>        <span class="hljs-built_in">sub_1400091B0</span>(a1, <span class="hljs-number">1</span>, v151, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v348, v152, v153, v274);<br>      &#125;<br>      std::filesystem::__cxx11::directory_iterator::<span class="hljs-keyword">operator</span>++(a1, v16, v117, v353);<br>    &#125;<br>    <span class="hljs-built_in">sub_140008EE0</span>(a1, v16, v216, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v352, v217, v218, v298);<br>    <span class="hljs-built_in">sub_140008EE0</span>(a1, v16, v219, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v353, v220, v221, v299);<br>    <span class="hljs-built_in">sub_140008EE0</span>(a1, v16, v222, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v354, v223, v224, v300);<br>    <span class="hljs-built_in">CryptDestroyKey</span>(hKey);<br>    <span class="hljs-built_in">CryptReleaseContext</span>(phProv, <span class="hljs-number">0</span>);<br>    v23 = <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v23 = <span class="hljs-number">1</span>;<br>  &#125;<br>LABEL_63:<br>  <span class="hljs-built_in">sub_14000B400</span>(a1, v16, v20, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)IV, v21, v22, v232);<br>  <span class="hljs-built_in">sub_14000B400</span>(a1, v16, v225, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)key, v226, v227, v301);<br>  <span class="hljs-built_in">sub_14000B400</span>(a1, v16, v228, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)MODE, v229, v230, v302);<br>  <span class="hljs-keyword">return</span> v23;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>下面是疑似的加密函数的内容</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">sub_140005071</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2, <span class="hljs-type">int</span> a3, __int64 a4, __int64 a5, <span class="hljs-type">int</span> a6)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v13; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v15; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v16; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v17; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v18; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v19; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v20; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v21; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v22; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v23; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v24; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v25; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> v26; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v27; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v28; <span class="hljs-comment">// r9d</span><br>  __int64 v30; <span class="hljs-comment">// [rsp+0h] [rbp-B0h] BYREF</span><br>  __int64 v31; <span class="hljs-comment">// [rsp+8h] [rbp-A8h]</span><br>  __int64 v32; <span class="hljs-comment">// [rsp+10h] [rbp-A0h]</span><br>  __int64 v33; <span class="hljs-comment">// [rsp+18h] [rbp-98h]</span><br>  _BYTE v34[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-90h] BYREF</span><br>  _BYTE v35[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-80h] BYREF</span><br>  _BYTE v36[<span class="hljs-number">47</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-70h] BYREF</span><br>  <span class="hljs-type">char</span> v37; <span class="hljs-comment">// [rsp+6Fh] [rbp-41h] BYREF</span><br>  _BYTE v38[<span class="hljs-number">47</span>]; <span class="hljs-comment">// [rsp+70h] [rbp-40h] BYREF</span><br>  <span class="hljs-type">char</span> v39; <span class="hljs-comment">// [rsp+9Fh] [rbp-11h] BYREF</span><br>  <span class="hljs-type">char</span> *v40; <span class="hljs-comment">// [rsp+A0h] [rbp-10h]</span><br>  <span class="hljs-type">char</span> *v41; <span class="hljs-comment">// [rsp+A8h] [rbp-8h]</span><br><br>  v41 = (<span class="hljs-type">char</span> *)&amp;v30 + <span class="hljs-number">111</span>;<br>  <span class="hljs-built_in">sub_14000B350</span>(<br>    a1,<br>    a2,<br>    (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">&quot;1294787702630841806287693875819503767329411267154281759595683996937344294354199&quot;</span>,<br>    (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(&amp;v30 - <span class="hljs-number">14</span>) + <span class="hljs-number">176</span>,<br>    (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v30 - <span class="hljs-number">65</span> + <span class="hljs-number">176</span>,<br>    a6);<br>  <span class="hljs-built_in">sub_1400024EE</span>(a1, a2, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v36, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v35, v6, v7, v30, v31);<br>  <span class="hljs-built_in">sub_14000B400</span>(a1, a2, v8, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v36, v9, v10, v30);<br>  <span class="hljs-built_in">sub_140009C30</span>(a1, a2, v11, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v37, v12, v13);<br>  v40 = &amp;v39;<br>  <span class="hljs-built_in">sub_14000B350</span>(a1, a2, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-string">&quot;65537&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v38, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v39, v14);<span class="hljs-comment">// 65537是典型RSA加密的特征，因此推测此函数为RSA加密</span><br>  <span class="hljs-built_in">sub_1400024EE</span>(a1, a2, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v38, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v34, v15, v16, v30, v31);<br>  <span class="hljs-built_in">sub_14000B400</span>(a1, a2, v17, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v38, v18, v19, v30);<br>  <span class="hljs-built_in">sub_140009C30</span>(a1, a2, v20, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;v39, v21, v22);<br>  <span class="hljs-built_in">sub_1400031A0</span>(a1, a2, a3, a4, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v34, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v35, v30, v31, v32, v33);<br>  <span class="hljs-built_in">sub_1400029A2</span>(a1, a2, v23, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v34, v24, v25, v30);<br>  <span class="hljs-built_in">sub_1400029A2</span>(a1, a2, v26, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v35, v27, v28, v30);<br>  <span class="hljs-keyword">return</span> a4;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>可以得到如下的印象点：</p>
<ul>
<li>程序通过参数个数判断使用加密模式还是解密模式；</li>
<li>程序在加密模式下会遍历同一路径下的文件并进行加密，输出.enc文件，同时程序会将加密使用的key和IV进行RSA加密后发送到服务器（此外由于网络通信函数出现了127.0.0.1，推测是本地服务器）；</li>
<li>程序在解密模式下只需要使用Int.exe -d key IV就可以解密文件。</li>
</ul>
<p>结合附件的形式（附件包含一个流量包），可以推测本题的突破口在于分析流量包提取出RSA加密后的key和IV，然后就可以解密出key和IV，使用程序自带的解密功能解密文件。</p>
<p>安全起见，第一步先验证猜想。借助AI搭建一个本地服务器来接收程序的通信数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 本地服务器脚本</span><br><span class="hljs-comment"># fake_server.py</span><br><span class="hljs-keyword">import</span> socket<br>sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>sock.bind((<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-number">8080</span>))<br>sock.listen(<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Listening on 127.0.0.1:8080...&quot;</span>)<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    conn, addr = sock.accept()<br>    data = conn.recv(<span class="hljs-number">1024</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Received <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(data)&#125;</span> bytes: <span class="hljs-subst">&#123;data.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br>    conn.close()<br></code></pre></td></tr></table></figure>

<p>启用服务器后，通过命令行运行Int.exe可以看到本次加密使用的key和IV，以及发送的十进制数据</p>
<p><img src="/../images/image-20251123115352743.png" alt="运行Int.exe"></p>
<p>服务器会接收到如下数据（服务器接收的数据是发送的数据的十六进制形式）</p>
<p><img src="/../images/image-20251123115421535.png" alt="服务器接收到的数据"></p>
<p><img src="/../images/image-20251123115509065.png" alt="服务器接收的第一个数据hex解码后和发送的第一个数据对应上了"></p>
<p>然后参考<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/people/166049.html">RSA加密解密原理深度剖析</a>可以写出一个脚本来解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-comment">#求解d</span><br>p =gmpy2.mpz(<span class="hljs-number">973424135910675582062565817184635606523</span>)<br>q =gmpy2.mpz( <span class="hljs-number">1330137249390799512563582841814876337813</span>)<br>e =gmpy2.mpz(<span class="hljs-number">65537</span>)<br>phi_n= (p - <span class="hljs-number">1</span>) * (q - <span class="hljs-number">1</span>)<br>d = gmpy2.invert(e, phi_n)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;d is:&quot;</span>)<br><span class="hljs-built_in">print</span> (d)<br><br><span class="hljs-comment">#解密key和IV</span><br>n = gmpy2.mpz(<span class="hljs-number">1294787702630841806287693875819503767329411267154281759595683996937344294354199</span>)<br><span class="hljs-comment">#key_raw是服务器接收的第一个数据，即key加密数据的十六进制数据流</span><br>key_raw=<span class="hljs-string">&quot;31323532333634383535303738343134373534303233363633363831313039303038333936313636303538303434333331323331383735303239343634393636353236373133353939343233363539&quot;</span><br><span class="hljs-comment">#iv_raw是服务器接收的第二个数据，即iv加密数据的十六进制数据流</span><br>iv_raw=<span class="hljs-string">&quot;393235323537333232303933353132333132353838343232323434353732343930303235353236393838363134393132323438313237363234363634333434323034333234353839393230383333&quot;</span><br><span class="hljs-comment">#十六进制解码</span><br>key_hexdec=<span class="hljs-built_in">bytes</span>.fromhex(key_raw)<br>iv_hexdec=<span class="hljs-built_in">bytes</span>.fromhex(iv_raw)<br><br>key_enc = gmpy2.mpz(key_hexdec)<br>IV_enc = gmpy2.mpz(iv_hexdec)<br><br><span class="hljs-comment">#RSA解密</span><br>key_dec = <span class="hljs-built_in">pow</span>(key_enc, d, n)<br>IV_dec = <span class="hljs-built_in">pow</span>(IV_enc, d, n)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;key (hex):&quot;</span>, <span class="hljs-built_in">hex</span>(key_dec))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;IV (hex):&quot;</span>, <span class="hljs-built_in">hex</span>(IV_dec))<br></code></pre></td></tr></table></figure>

<p>运行解密脚本得到如下，key和iv与Int.exe的输出一致</p>
<p><img src="/../images/image-20251123120534447.png" alt="运行解密脚本"></p>
<p>至此，可以确定发送的数据为key和IV的RSA加密结果，服务器接收的数据是加密结果的十六进制编码数据。</p>
<p>接下来分析流量包提取加密数据流（需要用到WireShark）。由于程序将数据发送到本地8080端口，且数据长度大约为78bytes，根据这个特征可以筛选出key和IV的流量</p>
<p><img src="/../images/image-20251123121110864.png" alt="key的流量"></p>
<p><img src="/../images/image-20251123121217193.png" alt="IV的流量"></p>
<p>将找到的两串数据复制到脚本的key_raw和iv_raw，可以解密出key和IV</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-comment">#求解d</span><br>p =gmpy2.mpz(<span class="hljs-number">973424135910675582062565817184635606523</span>)<br>q =gmpy2.mpz( <span class="hljs-number">1330137249390799512563582841814876337813</span>)<br>e =gmpy2.mpz(<span class="hljs-number">65537</span>)<br>phi_n= (p - <span class="hljs-number">1</span>) * (q - <span class="hljs-number">1</span>)<br>d = gmpy2.invert(e, phi_n)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;d is:&quot;</span>)<br><span class="hljs-built_in">print</span> (d)<br><br><span class="hljs-comment">#解密key和IV</span><br>n = gmpy2.mpz(<span class="hljs-number">1294787702630841806287693875819503767329411267154281759595683996937344294354199</span>)<br><span class="hljs-comment">#key_raw是服务器接收的第一个数据，即key加密数据的十六进制数据流</span><br>key_raw=<span class="hljs-string">&quot;393430353632303933303434363731383332313634363031353936303437303036303837353338373330383137373132363136313931393431323130333436353936333530353534323336333632&quot;</span><br><span class="hljs-comment">#iv_raw是服务器接收的第二个数据，即iv加密数据的十六进制数据流</span><br>iv_raw=<span class="hljs-string">&quot;323636373435303139343936383836343938363534323735373736393036303037343539343139323635373931333033373337353137333038363234343631363938313438363430393939363639&quot;</span><br><span class="hljs-comment">#十六进制解码</span><br>key_hexdec=<span class="hljs-built_in">bytes</span>.fromhex(key_raw)<br>iv_hexdec=<span class="hljs-built_in">bytes</span>.fromhex(iv_raw)<br><br>key_enc = gmpy2.mpz(key_hexdec)<br>IV_enc = gmpy2.mpz(iv_hexdec)<br><br><span class="hljs-comment">#RSA解密</span><br>key_dec = <span class="hljs-built_in">pow</span>(key_enc, d, n)<br>IV_dec = <span class="hljs-built_in">pow</span>(IV_enc, d, n)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;key (hex):&quot;</span>, <span class="hljs-built_in">hex</span>(key_dec))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;IV (hex):&quot;</span>, <span class="hljs-built_in">hex</span>(IV_dec))<br></code></pre></td></tr></table></figure>

<p><img src="/../images/image-20251123121642123.png" alt="解密结果"></p>
<p>然后就可以使用Int.exe -d key iv解密文件了（注意key和IV不要带0x）</p>
<p><img src="/../images/image-20251123121901277.png" alt="使用解密模式"></p>
<p><img src="/../images/image-20251123121954674.png" alt="解密出来的文件"></p>
<p>打开txt.dec文件就可以找到flag了</p>
<p><img src="/../images/image-20251123122045460.png" alt="txt.dec文件"></p>
</li>
</ul>
<blockquote>
<p>flag：0xGame{I_4m_3o_S1eepy_(´～&#96;)zzZ_zzZ_zzZ_zzZ}</p>
</blockquote>
</div><div class="article-licensing box"><div class="licensing-title"><p>0xGame2025Week4WriteUp</p><p><a href="https://sydzi.github.io/2025/11/16/0xGame2025Week4ReverseWriteUp/">https://sydzi.github.io/2025/11/16/0xGame2025Week4ReverseWriteUp/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>SydzI</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2025-11-16</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2025-11-23</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/CTF/">CTF</a><a class="link-muted mr-2" rel="tag" href="/tags/WriteUp/">WriteUp</a><a class="link-muted mr-2" rel="tag" href="/tags/Reverse/">Reverse</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=68b654c479868da1c7122aa1&amp;product=inline-share-buttons" defer></script><nav class="post-navigation mt-4 mb-2 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2025/12/07/week40-week44/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">week40-week44</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2025/11/03/week35-week39/"><span class="level-item">week35-week39</span><i class="level-item fas fa-chevron-right"></i></a></div></nav></article></div><!--!--><div class="card" id="comments"><div class="card-content"><h3 class="title is-5">评论</h3><script src="https://utteranc.es/client.js" repo="sydzi/sydzi.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script></div></div></div><div class="column column-left is-4-tablet is-3-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.jpg" alt="SydzI"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">SydzI</p><p class="is-size-6 is-block">Action over inaction</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Nanjing, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives/"><p class="title">33</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories/"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags/"><p class="title">7</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/SydzI" target="_blank" rel="me noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/SydzI"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#镜渊折枝"><span class="level-left"><span class="level-item">1</span><span class="level-item">镜渊折枝</span></span></a></li><li><a class="level is-mobile" href="#夜雀之歌"><span class="level-left"><span class="level-item">2</span><span class="level-item">夜雀之歌</span></span></a></li><li><a class="level is-mobile" href="#绯想天则"><span class="level-left"><span class="level-item">3</span><span class="level-item">绯想天则</span></span></a></li><li><a class="level is-mobile" href="#幻视调律"><span class="level-left"><span class="level-item">4</span><span class="level-item">幻视调律</span></span></a></li><li><a class="level is-mobile" href="#花鸟风月"><span class="level-left"><span class="level-item">5</span><span class="level-item">花鸟风月</span></span></a></li><li><a class="level is-mobile" href="#云消雾散"><span class="level-left"><span class="level-item">6</span><span class="level-item">云消雾散</span></span></a></li><li><a class="level is-mobile" href="#蔷薇地狱"><span class="level-left"><span class="level-item">7</span><span class="level-item">蔷薇地狱</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">SydzI&#039;s Blog</a><p class="is-size-7"><span>&copy; 2026 SydzI</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            },
            services: {
                firebase: {"enable":true,"collection":"articles","apiKey":"AIzaSyCL4X3DgCuPZ09mSUIYiIzwCrbKdVcf_jY","projectId":"sydzi-s-blog-counter"}
            }
        };</script><script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/js/pjax.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><script data-pjax src="/js/firebase_counter.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"css":false});</script></body></html>