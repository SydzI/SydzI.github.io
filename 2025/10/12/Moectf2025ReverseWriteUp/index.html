<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Moectf2025ReverseWriteUp - SydzI&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="SydzI&#039;s Blog"><meta name="msapplication-TileImage" content="/img/Newspaper.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="SydzI&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Moectf2025 Reverse WriteUp"><meta property="og:type" content="blog"><meta property="og:title" content="Moectf2025ReverseWriteUp"><meta property="og:url" content="https://sydzi.github.io/2025/10/12/Moectf2025ReverseWriteUp/"><meta property="og:site_name" content="SydzI&#039;s Blog"><meta property="og:description" content="Moectf2025 Reverse WriteUp"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://sydzi.github.io/images/image-20250828230432945-1760193218428-1.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250828230606530-1760193218428-2.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250828230727951-1760193218429-4.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250828231133499-1760193218429-8.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250828231234644-1760193218428-3.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250829121800223-1760193218429-5.png"><meta property="og:image" content="https://sydzi.github.io/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-29%20121722-1760193218429-7.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250829122250848-1760193218429-6.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250829130321938-1760193218429-9.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250829133142939-1760193218429-10.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250829140959636-1760193218429-11.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250829141054207-1760193218429-12.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250829141947673-1760193218429-13.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250829115915331-1760193218429-15.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250829104220942-1760193218429-14.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250821000019398-1760193218429-16.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250828214030322-1760193218429-17.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250828214156948-1760193218429-19.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250828215740728-1760193218429-18.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250828215832225-1760193218429-20.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251003124237857-1760193218429-23.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251003124409938-1760193218429-22.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251003124456921-1760193218429-21.png"><meta property="og:image" content="https://sydzi.github.io/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-03%20124610-1760193218429-24.png"><meta property="og:image" content="https://sydzi.github.io/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-03%20124713-1760193218429-26.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251003125528890-1760193218429-25.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251003125621022-1760193218429-29.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251003131740100-1760193218429-28.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251003131847409-1760193218429-31.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251003132216493-1760193218429-27.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251003132623642-1760193218429-30.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20251003134212864-1760193218429-34.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250828184625164-1760193218429-35.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250828184701147-1760193218429-32.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250907190954175-1760193218429-33.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250907191116300-1760193218429-36.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250907191353142-1760193218429-37.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250907193423247-1760193218429-39.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250907193656681-1760193218429-40.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250910112618179-1760193218429-38.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250910112549164-1760193218429-42.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250910112516212-1760193218429-41.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250907203522833-1760193218429-43.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250907203551932-1760193218429-44.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250907212718438-1760193218429-45.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250907220527950-1760193218429-47.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250909145857318-1760193218429-48.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250909150500077-1760193218429-49.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250909195444724-1760193218429-46.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250909195828121-1760193218429-50.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250927191149395-1760193218429-51.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250927191413499-1760193218429-52.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250927191650957-1760193218429-54.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250927192543291-1760193218429-53.png"><meta property="og:image" content="https://sydzi.github.io/images/image-20250927194329834-1760193218429-55.png"><meta property="article:published_time" content="2025-10-11T16:00:01.000Z"><meta property="article:modified_time" content="2025-10-29T14:10:00.359Z"><meta property="article:author" content="SydzI"><meta property="article:tag" content="CTF"><meta property="article:tag" content="WriteUp"><meta property="article:tag" content="Reverse"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://sydzi.github.io/images/image-20250828230432945-1760193218428-1.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://sydzi.github.io/2025/10/12/Moectf2025ReverseWriteUp/"},"headline":"Moectf2025ReverseWriteUp","image":["https://sydzi.github.io/images/image-20250828230432945-1760193218428-1.png","https://sydzi.github.io/images/image-20250828230606530-1760193218428-2.png","https://sydzi.github.io/images/image-20250828230727951-1760193218429-4.png","https://sydzi.github.io/images/image-20250828231133499-1760193218429-8.png","https://sydzi.github.io/images/image-20250828231234644-1760193218428-3.png","https://sydzi.github.io/images/image-20250829121800223-1760193218429-5.png","https://sydzi.github.io/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-29%20121722-1760193218429-7.png","https://sydzi.github.io/images/image-20250829122250848-1760193218429-6.png","https://sydzi.github.io/images/image-20250829130321938-1760193218429-9.png","https://sydzi.github.io/images/image-20250829133142939-1760193218429-10.png","https://sydzi.github.io/images/image-20250829140959636-1760193218429-11.png","https://sydzi.github.io/images/image-20250829141054207-1760193218429-12.png","https://sydzi.github.io/images/image-20250829141947673-1760193218429-13.png","https://sydzi.github.io/images/image-20250829115915331-1760193218429-15.png","https://sydzi.github.io/images/image-20250829104220942-1760193218429-14.png","https://sydzi.github.io/images/image-20250821000019398-1760193218429-16.png","https://sydzi.github.io/images/image-20250828214030322-1760193218429-17.png","https://sydzi.github.io/images/image-20250828214156948-1760193218429-19.png","https://sydzi.github.io/images/image-20250828215740728-1760193218429-18.png","https://sydzi.github.io/images/image-20250828215832225-1760193218429-20.png","https://sydzi.github.io/images/image-20251003124237857-1760193218429-23.png","https://sydzi.github.io/images/image-20251003124409938-1760193218429-22.png","https://sydzi.github.io/images/image-20251003124456921-1760193218429-21.png","https://sydzi.github.io/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-03%20124610-1760193218429-24.png","https://sydzi.github.io/images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-03%20124713-1760193218429-26.png","https://sydzi.github.io/images/image-20251003125528890-1760193218429-25.png","https://sydzi.github.io/images/image-20251003125621022-1760193218429-29.png","https://sydzi.github.io/images/image-20251003131740100-1760193218429-28.png","https://sydzi.github.io/images/image-20251003131847409-1760193218429-31.png","https://sydzi.github.io/images/image-20251003132216493-1760193218429-27.png","https://sydzi.github.io/images/image-20251003132623642-1760193218429-30.png","https://sydzi.github.io/images/image-20251003134212864-1760193218429-34.png","https://sydzi.github.io/images/image-20250828184625164-1760193218429-35.png","https://sydzi.github.io/images/image-20250828184701147-1760193218429-32.png","https://sydzi.github.io/images/image-20250907190954175-1760193218429-33.png","https://sydzi.github.io/images/image-20250907191116300-1760193218429-36.png","https://sydzi.github.io/images/image-20250907191353142-1760193218429-37.png","https://sydzi.github.io/images/image-20250907193423247-1760193218429-39.png","https://sydzi.github.io/images/image-20250907193656681-1760193218429-40.png","https://sydzi.github.io/images/image-20250910112618179-1760193218429-38.png","https://sydzi.github.io/images/image-20250910112549164-1760193218429-42.png","https://sydzi.github.io/images/image-20250910112516212-1760193218429-41.png","https://sydzi.github.io/images/image-20250907203522833-1760193218429-43.png","https://sydzi.github.io/images/image-20250907203551932-1760193218429-44.png","https://sydzi.github.io/images/image-20250907212718438-1760193218429-45.png","https://sydzi.github.io/images/image-20250907220527950-1760193218429-47.png","https://sydzi.github.io/images/image-20250909145857318-1760193218429-48.png","https://sydzi.github.io/images/image-20250909150500077-1760193218429-49.png","https://sydzi.github.io/images/image-20250909195444724-1760193218429-46.png","https://sydzi.github.io/images/image-20250909195828121-1760193218429-50.png","https://sydzi.github.io/images/image-20250927191149395-1760193218429-51.png","https://sydzi.github.io/images/image-20250927191413499-1760193218429-52.png","https://sydzi.github.io/images/image-20250927191650957-1760193218429-54.png","https://sydzi.github.io/images/image-20250927192543291-1760193218429-53.png","https://sydzi.github.io/images/image-20250927194329834-1760193218429-55.png"],"datePublished":"2025-10-11T16:00:01.000Z","dateModified":"2025-10-29T14:10:00.359Z","author":{"@type":"Person","name":"SydzI"},"publisher":{"@type":"Organization","name":"SydzI's Blog","logo":{"@type":"ImageObject"}},"description":"Moectf2025 Reverse WriteUp"}</script><link rel="canonical" href="https://sydzi.github.io/2025/10/12/Moectf2025ReverseWriteUp/"><link rel="icon" href="/img/Newspaper.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/xcode.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><meta name="msvalidate.01" content="9FE0F2242662A1EB82C139F80B4118F0"><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=upLteeXJeF0vtcEfQngBefAoRrZBdbYGiIdhlziWygs" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'upLteeXJeF0vtcEfQngBefAoRrZBdbYGiIdhlziWygs');</script><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="SydzI's Blog" type="application/atom+xml">
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">SydzI&#039;s Blog</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item night" id="night-nav" title="Change Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-9-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 level is-mobile"><div class="level-left"><span class="level-item"><i class="fas fa-calendar-alt mr-1"></i><time datetime="${date_xml(page.date)}" title="${new Date(page.date).toLocaleString()}">2025-10-12</time></span><span class="level-item"><i class="fas fa-sync-alt mr-1"></i><time datetime="${date_xml(page.updated)}" title="${new Date(page.updated).toLocaleString()}">2025-10-29</time></span><span class="level-item"><i class="far fa-folder-open mr-1"></i><a class="link-muted" href="/categories/WriteUp-%E5%A4%8D%E7%8E%B0/">WriteUp&amp;复现</a></span><span class="level-item"><i class="far fa-clock mr-1"></i>2 小时读完 (大约14353个字)</span><span class="level-item"><i class="far fa-eye mr-1"></i><span class="firestore-visitors-count">0</span></span></div></div><h1 class="title is-3 is-size-4-mobile">Moectf2025ReverseWriteUp</h1><div class="content"><p>Moectf2025 Reverse方向全解&amp;详解</p>
<span id="more"></span>

<h2 id="week1"><a href="#week1" class="headerlink" title="week1"></a>week1</h2><h3 id="upx"><a href="#upx" class="headerlink" title="upx"></a>upx</h3><ul>
<li><p>附件程序用010editor打开，可以看到upx版本，可以找对应版本upx程序脱壳，也可以手动脱壳（采用内存镜像法）：</p>
<p>用x64dbg打开程序，先移除预设断点</p>
<p><img src="/../images/image-20250828230432945-1760193218428-1.png" alt="移除预设断点"></p>
<p>在“内存映射”窗口给程序的.rsrc段下一次性内存访问断点，F9运行</p>
<p><img src="/../images/image-20250828230606530-1760193218428-2.png" alt="下一次性读取断点"></p>
<p>然后在UPX0段或者UPX1段下一次性内存写入断点，F9运行</p>
<p><img src="/../images/image-20250828230727951-1760193218429-4.png" alt="下一次性内存写入断点"></p>
<p>回到“CPU”窗口，可以看到在RIP不远处有一个大跳（RIP在0x00007FF7BB887423处)</p>
<p><img src="/../images/image-20250828231133499-1760193218429-8.png" alt="大跳"></p>
<p>跟进去，还有个跳转表，继续跟进，可以看到程序的OEP了</p>
<p><img src="/../images/image-20250828231234644-1760193218428-3.png" alt="OEP"></p>
<p>然后在此处使用scylla dump出程序，并且修复IAT，得到upx_dump_SCY.exe，可以分析了</p>
</li>
<li><p>分析main函数，发现每个输入的字符异或了0x21，而非末位字符还异或了原来的下一位。由于异或有交换律，所以解密逻辑可以是：先对每个处理完的字符异或0x21，然后再从倒数第二位开始和下一位异或，这样就恢复了复原出了flag（但是给的密文少了最后一位，即字符串的结束符。根据最后一位和倒数第二位的关系0x56&#x3D;125 ^ 0x21 ^ 末位 得出：末位&#x3D;10，所以末位^0x21&#x3D;43，将密文补充完整）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//main函数</span><br>__int64 <span class="hljs-title function_">sub_7FF6FC2718A0</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">char</span> *v0; <span class="hljs-comment">// rdi</span><br>  __int64 i; <span class="hljs-comment">// rcx</span><br>  FILE *Stream; <span class="hljs-comment">// rax</span><br>  _BYTE v4[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-20h] BYREF</span><br>  <span class="hljs-type">char</span> v5; <span class="hljs-comment">// [rsp+20h] [rbp+0h] BYREF</span><br>  _DWORD cipher[<span class="hljs-number">44</span>]; <span class="hljs-comment">// [rsp+30h] [rbp+10h]</span><br>  <span class="hljs-type">char</span> flag[<span class="hljs-number">132</span>]; <span class="hljs-comment">// [rsp+E0h] [rbp+C0h] BYREF</span><br>  <span class="hljs-type">int</span> length; <span class="hljs-comment">// [rsp+164h] [rbp+144h]</span><br>  _BYTE v9[<span class="hljs-number">60</span>]; <span class="hljs-comment">// [rsp+188h] [rbp+168h]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+1C4h] [rbp+1A4h]</span><br>  <span class="hljs-type">int</span> Char; <span class="hljs-comment">// [rsp+1E4h] [rbp+1C4h]</span><br>  <span class="hljs-type">int</span> k; <span class="hljs-comment">// [rsp+204h] [rbp+1E4h]</span><br><br>  v0 = &amp;v5;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">130LL</span>; i; --i )<br>  &#123;<br>    *(_DWORD *)v0 = <span class="hljs-number">-858993460</span>;<br>    v0 += <span class="hljs-number">4</span>;<br>  &#125;<br>  sub_7FF6FC271375((__int64)&amp;word_7FF6FC28200E);<br>  cipher[<span class="hljs-number">0</span>] = <span class="hljs-number">35</span>;<br>  cipher[<span class="hljs-number">1</span>] = <span class="hljs-number">43</span>;<br>  cipher[<span class="hljs-number">2</span>] = <span class="hljs-number">39</span>;<br>  cipher[<span class="hljs-number">3</span>] = <span class="hljs-number">54</span>;<br>  cipher[<span class="hljs-number">4</span>] = <span class="hljs-number">51</span>;<br>  cipher[<span class="hljs-number">5</span>] = <span class="hljs-number">60</span>;<br>  cipher[<span class="hljs-number">6</span>] = <span class="hljs-number">3</span>;<br>  cipher[<span class="hljs-number">7</span>] = <span class="hljs-number">72</span>;<br>  cipher[<span class="hljs-number">8</span>] = <span class="hljs-number">100</span>;<br>  cipher[<span class="hljs-number">9</span>] = <span class="hljs-number">11</span>;<br>  cipher[<span class="hljs-number">10</span>] = <span class="hljs-number">29</span>;<br>  cipher[<span class="hljs-number">11</span>] = <span class="hljs-number">118</span>;<br>  cipher[<span class="hljs-number">12</span>] = <span class="hljs-number">123</span>;<br>  cipher[<span class="hljs-number">13</span>] = <span class="hljs-number">16</span>;<br>  cipher[<span class="hljs-number">14</span>] = <span class="hljs-number">11</span>;<br>  cipher[<span class="hljs-number">15</span>] = <span class="hljs-number">58</span>;<br>  cipher[<span class="hljs-number">16</span>] = <span class="hljs-number">63</span>;<br>  cipher[<span class="hljs-number">17</span>] = <span class="hljs-number">101</span>;<br>  cipher[<span class="hljs-number">18</span>] = <span class="hljs-number">118</span>;<br>  cipher[<span class="hljs-number">19</span>] = <span class="hljs-number">41</span>;<br>  cipher[<span class="hljs-number">20</span>] = <span class="hljs-number">21</span>;<br>  cipher[<span class="hljs-number">21</span>] = <span class="hljs-number">55</span>;<br>  cipher[<span class="hljs-number">22</span>] = <span class="hljs-number">28</span>;<br>  cipher[<span class="hljs-number">23</span>] = <span class="hljs-number">10</span>;<br>  cipher[<span class="hljs-number">24</span>] = <span class="hljs-number">8</span>;<br>  cipher[<span class="hljs-number">25</span>] = <span class="hljs-number">33</span>;<br>  cipher[<span class="hljs-number">26</span>] = <span class="hljs-number">62</span>;<br>  cipher[<span class="hljs-number">27</span>] = <span class="hljs-number">60</span>;<br>  cipher[<span class="hljs-number">28</span>] = <span class="hljs-number">61</span>;<br>  cipher[<span class="hljs-number">29</span>] = <span class="hljs-number">22</span>;<br>  cipher[<span class="hljs-number">30</span>] = <span class="hljs-number">11</span>;<br>  cipher[<span class="hljs-number">31</span>] = <span class="hljs-number">36</span>;<br>  cipher[<span class="hljs-number">32</span>] = <span class="hljs-number">41</span>;<br>  cipher[<span class="hljs-number">33</span>] = <span class="hljs-number">36</span>;<br>  cipher[<span class="hljs-number">34</span>] = <span class="hljs-number">86</span>;<br>  sub_7FF6FC27119F((__int64)aPleaseInputYou);   <span class="hljs-comment">// &quot;please input your flag: &quot;</span><br>  Stream = _acrt_iob_func(<span class="hljs-number">0</span>);<br>  fgets(flag, <span class="hljs-number">100</span>, Stream);<br>  length = j_strlen(flag);<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt; length; ++j )<br>  &#123;<br>    Char = flag[j] ^ <span class="hljs-number">0x21</span>;<br>    <span class="hljs-keyword">if</span> ( j &lt; length - <span class="hljs-number">1</span> )<br>      Char ^= flag[j + <span class="hljs-number">1</span>];<br>    v9[j] = Char;<br>  &#125;<br>  <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">35</span>; ++k )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( (<span class="hljs-type">char</span>)v9[k] != cipher[k] )<br>    &#123;<br>      sub_7FF6FC27119F((__int64)aYouWillNeverGe);<span class="hljs-comment">// &quot;you will never get the flag!!!!\n&quot;</span><br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>  &#125;<br>  sub_7FF6FC271311(v4, qword_7FF6FC27AD00);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>解密脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">enc=[<br>    <span class="hljs-number">0x23</span>, <span class="hljs-number">0x2b</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x3c</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x48</span>,<br>    <span class="hljs-number">0x64</span>, <span class="hljs-number">0x0b</span>, <span class="hljs-number">0x1d</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x7b</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x0b</span>, <span class="hljs-number">0x3a</span>,<br>    <span class="hljs-number">0x3f</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x1c</span>, <span class="hljs-number">0x0a</span>,<br>    <span class="hljs-number">0x08</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x3e</span>, <span class="hljs-number">0x3c</span>, <span class="hljs-number">0x3d</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x0b</span>, <span class="hljs-number">0x24</span>,<br>    <span class="hljs-number">0x29</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">43</span>			<br>]<br>xored=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>    xored.append(enc[i]^<span class="hljs-number">0x21</span>)<br><span class="hljs-comment">#print(xored)</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(xored)-<span class="hljs-number">2</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>    xored[i]=xored[i]^xored[i+<span class="hljs-number">1</span>]<br>flag=<span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xored)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="maze"><a href="#maze" class="headerlink" title="maze"></a>maze</h3><ul>
<li><p>附件程序main函数逻辑如下，wasd迷宫题，迷宫在函数maze_init中</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> __int64 count; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// ebx</span><br>  __int64 index; <span class="hljs-comment">// r9</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// r11d</span><br>  <span class="hljs-type">unsigned</span> __int64 y; <span class="hljs-comment">// r8</span><br>  __int64 x; <span class="hljs-comment">// r10</span><br>  <span class="hljs-type">unsigned</span> __int64 n0x37_1; <span class="hljs-comment">// rdi</span><br>  <span class="hljs-type">char</span> *Format; <span class="hljs-comment">// rcx</span><br>  _BYTE flag[<span class="hljs-number">1008</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-408h]</span><br><br>  maze_init();<br>  <span class="hljs-built_in">printf</span>(asc_140004138);<br>  <span class="hljs-built_in">printf</span>(&amp;Format_);<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>LABEL_2:<br>    <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>    &#123;<br>      <span class="hljs-built_in">printf</span>(asc_140004190);<br>      <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>);<br>      count = <span class="hljs-number">-1LL</span>;<br>      <span class="hljs-keyword">do</span><br>        ++count;<br>      <span class="hljs-keyword">while</span> ( flag[count] );<br>      <span class="hljs-keyword">if</span> ( count &lt;= <span class="hljs-number">999</span> )<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-built_in">printf</span>(&amp;Format__0);<br>    &#125;<br>    v4 = <span class="hljs-number">1</span>;<br>    index = <span class="hljs-number">0LL</span>;<br>    v6 = <span class="hljs-number">1</span>;<br>    y = <span class="hljs-number">1LL</span>;<span class="hljs-comment">// 起点y</span><br>    x = <span class="hljs-number">1LL</span>;<span class="hljs-comment">// 起点x</span><br>    <span class="hljs-keyword">if</span> ( (<span class="hljs-type">int</span>)count &gt; <span class="hljs-number">0</span> )<br>      <span class="hljs-keyword">break</span>;<br>LABEL_19:<br>    Format = (<span class="hljs-type">char</span> *)&amp;byte_140004118;<br>LABEL_20:<br>    <span class="hljs-built_in">printf</span>(Format);<br>    <span class="hljs-built_in">printf</span>(&amp;Format__1);<br>  &#125;<br>  n0x37_1 = <span class="hljs-number">1LL</span>;<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-keyword">switch</span> ( flag[index] )<br>    &#123;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;A&#x27;</span>:<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;a&#x27;</span>:<br>        --v4;<br>        --x;<br>        --n0x37_1;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;D&#x27;</span>:<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;d&#x27;</span>:<br>        ++v4;<br>        ++x;<br>        ++n0x37_1;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;S&#x27;</span>:<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;s&#x27;</span>:<br>        ++v6;<br>        ++y;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;W&#x27;</span>:<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;w&#x27;</span>:<br>        --v6;<br>        --y;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">default</span>:<br>        <span class="hljs-built_in">printf</span>(&amp;Format__2);<br>        <span class="hljs-built_in">printf</span>(&amp;Format__1);<br>        <span class="hljs-keyword">goto</span> LABEL_2;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( y &gt; <span class="hljs-number">0x37</span> || n0x37_1 &gt; <span class="hljs-number">0x37</span> )<br>    &#123;<br>      Format = (<span class="hljs-type">char</span> *)&amp;unk_1400040D8;<br>      <span class="hljs-keyword">goto</span> LABEL_20;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( byte_140005660[<span class="hljs-number">56</span> * y + x] == <span class="hljs-number">49</span> )<br>    &#123;<br>      Format = (<span class="hljs-type">char</span> *)&amp;unk_1400040F8;<br>      <span class="hljs-keyword">goto</span> LABEL_20;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( y == <span class="hljs-number">15</span> &amp;&amp; x == <span class="hljs-number">32</span> )<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">if</span> ( ++index &gt;= (<span class="hljs-type">int</span>)count )<br>      <span class="hljs-keyword">goto</span> LABEL_19;<br>  &#125;<br>  <span class="hljs-built_in">printf</span>(asc_1400041E0);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;moectf&#123;%s&#125;\n&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>maze_init函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 <span class="hljs-title function_">maze_init</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *all_1; <span class="hljs-comment">// r9</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> **v1; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">int</span> n56_2; <span class="hljs-comment">// r11d</span><br>  __int64 v3; <span class="hljs-comment">// r10</span><br>  __int64 n56; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// r8d</span><br>  __int64 i; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v7; <span class="hljs-comment">// dl</span><br>  __int64 v8; <span class="hljs-comment">// rcx</span><br>  _QWORD v9[<span class="hljs-number">56</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-E0h] BYREF</span><br><br>  v9[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;10100000000000000010000011011101011111111101011100000111&quot;</span>;<br>  all_1 = <span class="hljs-string">&quot;11111111111111111111111111111111111111111111111111111111&quot;</span>;<br>  v9[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;11111111111111111111111111111111111111111111111111111111&quot;</span>;<br>  v9[<span class="hljs-number">2</span>] = <span class="hljs-string">&quot;10111010111111111010111011000001000001000001000101110111&quot;</span>;<br>  v9[<span class="hljs-number">3</span>] = <span class="hljs-string">&quot;10000010000010000010001011011111111101110111011101110111&quot;</span>;<br>  v9[<span class="hljs-number">4</span>] = <span class="hljs-string">&quot;10111111111011101110111011010000000000010100010001110111&quot;</span>;<br>  v9[<span class="hljs-number">5</span>] = <span class="hljs-string">&quot;10100000001000101000100011010101111111011101110101110111&quot;</span>;<br>  v9[<span class="hljs-number">6</span>] = <span class="hljs-string">&quot;10101011111110111011101011010101000001000000010101110111&quot;</span>;<br>  v9[<span class="hljs-number">7</span>] = <span class="hljs-string">&quot;10101010000010100000101011110101110101111101111111110111&quot;</span>;<br>  v9[<span class="hljs-number">8</span>] = <span class="hljs-string">&quot;10111010111010101111101011100101000100000101000101110111&quot;</span>;<br>  v9[<span class="hljs-number">9</span>] = <span class="hljs-string">&quot;10000010001010001000001011001111011111010101011101110111&quot;</span>;<br>  v9[<span class="hljs-number">10</span>] = <span class="hljs-string">&quot;11111011101011111011111111101000100000101100101001110111&quot;</span>;<br>  v9[<span class="hljs-number">11</span>] = <span class="hljs-string">&quot;10001010001000100010000010001010011000100010010011000001&quot;</span>;<br>  v9[<span class="hljs-number">12</span>] = <span class="hljs-string">&quot;10111010111110101010111011011001011111010101011101011101&quot;</span>;<br>  v9[<span class="hljs-number">13</span>] = <span class="hljs-string">&quot;10001010001000001010001011000101000100000101000101011101&quot;</span>;<br>  v9[<span class="hljs-number">14</span>] = <span class="hljs-string">&quot;11101011101111111011101011110101110111111101110101011101&quot;</span>;<br>  v9[<span class="hljs-number">15</span>] = <span class="hljs-string">&quot;10001000101000001010001011000100010100000101000101011101&quot;</span>;<br>  v9[<span class="hljs-number">16</span>] = <span class="hljs-string">&quot;10111111101011101110111011011111110101110111011101011101&quot;</span>;<br>  v9[<span class="hljs-number">17</span>] = <span class="hljs-string">&quot;10001000001000100000001011000100000100010000000101011001&quot;</span>;<br>  v9[<span class="hljs-number">18</span>] = <span class="hljs-string">&quot;11101011111011111111101011110101111101111111110101011011&quot;</span>;<br>  v9[<span class="hljs-number">19</span>] = <span class="hljs-string">&quot;10101000000010001000101011010100000001000100010101011011&quot;</span>;<br>  v9[<span class="hljs-number">20</span>] = <span class="hljs-string">&quot;10101111111110101010101011010111111111010101010101011011&quot;</span>;<br>  v9[<span class="hljs-number">21</span>] = <span class="hljs-string">&quot;10100000000000100010101011010000000000010001010101011011&quot;</span>;<br>  v9[<span class="hljs-number">22</span>] = <span class="hljs-string">&quot;10111111111111111110111011011111111111111111011101011011&quot;</span>;<br>  v9[<span class="hljs-number">23</span>] = <span class="hljs-string">&quot;10000000001111000000000011110111010000111100011111011011&quot;</span>;<br>  v9[<span class="hljs-number">24</span>] = <span class="hljs-string">&quot;11101111100000011011011111111010110111011101100001011011&quot;</span>;<br>  v9[<span class="hljs-number">25</span>] = <span class="hljs-string">&quot;11101111111111111011011111111101110111101101100001011011&quot;</span>;<br>  v9[<span class="hljs-number">26</span>] = <span class="hljs-string">&quot;10001000111111000010000011111010110111011101100001011011&quot;</span>;<br>  v9[<span class="hljs-number">27</span>] = <span class="hljs-string">&quot;10111010111111111010111011110111010000111101100001010011&quot;</span>;<br>  v9[<span class="hljs-number">28</span>] = <span class="hljs-string">&quot;10000010000010000010001011111111111111111101100001010111&quot;</span>;<br>  v9[<span class="hljs-number">29</span>] = <span class="hljs-string">&quot;10111111111011101110111011110001000110001101100001010001&quot;</span>;<br>  v9[<span class="hljs-number">30</span>] = <span class="hljs-string">&quot;10100000001000101000100011110111011101111101100001011101&quot;</span>;<br>  v9[<span class="hljs-number">31</span>] = <span class="hljs-string">&quot;10101011111110111011101011110001000101111101100001011101&quot;</span>;<br>  v9[<span class="hljs-number">32</span>] = <span class="hljs-string">&quot;10101010000010100000101011111101011101111101100001011101&quot;</span>;<br>  v9[<span class="hljs-number">33</span>] = <span class="hljs-string">&quot;10111010111010101111101011110001000110001101100001011101&quot;</span>;<br>  v9[<span class="hljs-number">34</span>] = <span class="hljs-string">&quot;10000010001010101000001011111111111111111101100001011101&quot;</span>;<br>  v9[<span class="hljs-number">35</span>] = <span class="hljs-string">&quot;11111011101011111011111110000000000000001101100001011101&quot;</span>;<br>  v9[<span class="hljs-number">36</span>] = <span class="hljs-string">&quot;10001010001000100010000011111111111111111100110011011101&quot;</span>;<br>  v9[<span class="hljs-number">37</span>] = <span class="hljs-string">&quot;10111010111110101010111010010000000011111110001111011101&quot;</span>;<br>  v9[<span class="hljs-number">38</span>] = <span class="hljs-string">&quot;10001010001000001010001010110111000001111110100101011101&quot;</span>;<br>  v9[<span class="hljs-number">39</span>] = <span class="hljs-string">&quot;11101011101111111011101000110011001111111100110111011101&quot;</span>;<br>  v9[<span class="hljs-number">40</span>] = <span class="hljs-string">&quot;10001000101000001010001011111111111111111111110111010001&quot;</span>;<br>  v1 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> **)v9;<br>  v9[<span class="hljs-number">55</span>] = <span class="hljs-string">&quot;11111111111111111111111111111111111111111111111111111111&quot;</span>;<br>  v9[<span class="hljs-number">41</span>] = <span class="hljs-string">&quot;10111111101011101110111010100001001100000000000011011011&quot;</span>;<br>  n56_2 = <span class="hljs-number">0</span>;<br>  v9[<span class="hljs-number">42</span>] = <span class="hljs-string">&quot;10001000001000100000001011111111111101011101111001011011&quot;</span>;<br>  v3 = <span class="hljs-number">0LL</span>;<br>  v9[<span class="hljs-number">43</span>] = <span class="hljs-string">&quot;10101011111011111111101011000000000001000100010111011011&quot;</span>;<br>  v9[<span class="hljs-number">44</span>] = <span class="hljs-string">&quot;10101000000010001000101010010111111111111111111111011011&quot;</span>;<br>  v9[<span class="hljs-number">45</span>] = <span class="hljs-string">&quot;10101111111110101010101010110111111111111111111101011011&quot;</span>;<br>  v9[<span class="hljs-number">46</span>] = <span class="hljs-string">&quot;10100000000000100010101011100000000000000000000011011011&quot;</span>;<br>  v9[<span class="hljs-number">47</span>] = <span class="hljs-string">&quot;10111111111111111110011011111111111111111111111011011011&quot;</span>;<br>  v9[<span class="hljs-number">48</span>] = <span class="hljs-string">&quot;10000011111111111111000010000000000000000000000000011001&quot;</span>;<br>  v9[<span class="hljs-number">49</span>] = <span class="hljs-string">&quot;11111011111111111111111111111111111111111111111111111101&quot;</span>;<br>  v9[<span class="hljs-number">50</span>] = <span class="hljs-string">&quot;11111011100001100110110111000000000000000000000111111101&quot;</span>;<br>  v9[<span class="hljs-number">51</span>] = <span class="hljs-string">&quot;11111011101111011010000111011111111111111111110111111101&quot;</span>;<br>  v9[<span class="hljs-number">52</span>] = <span class="hljs-string">&quot;11111011100001000010110110000111111111111111110000000001&quot;</span>;<br>  v9[<span class="hljs-number">53</span>] = <span class="hljs-string">&quot;11111011101111011010110111101111111111111111111111111111&quot;</span>;<br>  v9[<span class="hljs-number">54</span>] = <span class="hljs-string">&quot;11110000000000011000110000000000000000000000000000000011&quot;</span>;<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    n56 = <span class="hljs-number">-1LL</span>;<br>    <span class="hljs-keyword">do</span><br>      ++n56;<br>    <span class="hljs-keyword">while</span> ( all_1[n56] );<br>    <span class="hljs-keyword">if</span> ( n56 != <span class="hljs-number">56</span> )<br>    &#123;<br>      <span class="hljs-built_in">printf</span>((<span class="hljs-type">char</span> *)&amp;Format__3);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    v5 = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0LL</span>; i &lt; <span class="hljs-number">56</span>; ++i )<br>    &#123;<br>      v7 = all_1[i];<br>      <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int8)(v7 - <span class="hljs-number">48</span>) &gt; <span class="hljs-number">1u</span> )<br>      &#123;<br>        <span class="hljs-built_in">printf</span>((<span class="hljs-type">char</span> *)&amp;Format__4);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>      &#125;<br>      v8 = v3 + i;<br>      ++v5;<br>      byte_140005660[v8] = v7;<br>    &#125;<br>    ++n56_2;<br>    ++v1;<br>    v3 += <span class="hljs-number">56LL</span>;<br>    <span class="hljs-keyword">if</span> ( n56_2 &gt;= <span class="hljs-number">56</span> )<br>      <span class="hljs-keyword">break</span>;<br>    all_1 = *v1;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( n48 != <span class="hljs-number">48</span> )<br>  &#123;<br>    <span class="hljs-built_in">printf</span>((<span class="hljs-type">char</span> *)&amp;Format);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( n48_0 != <span class="hljs-number">48</span> )<br>  &#123;<br>    <span class="hljs-built_in">printf</span>((<span class="hljs-type">char</span> *)&amp;Format__5);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> i;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>使用神奇妙妙工具得到迷宫路径：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> mycode <span class="hljs-keyword">import</span> maze<br>Maze = [<br>    <span class="hljs-string">&quot;11111111111111111111111111111111111111111111111111111111&quot;</span>,<br>    <span class="hljs-string">&quot;10100000000000000010000011011101011111111101011100000111&quot;</span>,<br>    <span class="hljs-string">&quot;10111010111111111010111011000001000001000001000101110111&quot;</span>,<br>    <span class="hljs-string">&quot;10000010000010000010001011011111111101110111011101110111&quot;</span>,<br>    <span class="hljs-string">&quot;10111111111011101110111011010000000000010100010001110111&quot;</span>,<br>    <span class="hljs-string">&quot;10100000001000101000100011010101111111011101110101110111&quot;</span>,<br>    <span class="hljs-string">&quot;10101011111110111011101011010101000001000000010101110111&quot;</span>,<br>    <span class="hljs-string">&quot;10101010000010100000101011110101110101111101111111110111&quot;</span>,<br>    <span class="hljs-string">&quot;10111010111010101111101011100101000100000101000101110111&quot;</span>,<br>    <span class="hljs-string">&quot;10000010001010001000001011001111011111010101011101110111&quot;</span>,<br>    <span class="hljs-string">&quot;11111011101011111011111111101000100000101100101001110111&quot;</span>,<br>    <span class="hljs-string">&quot;10001010001000100010000010001010011000100010010011000001&quot;</span>,<br>    <span class="hljs-string">&quot;10111010111110101010111011011001011111010101011101011101&quot;</span>,<br>    <span class="hljs-string">&quot;10001010001000001010001011000101000100000101000101011101&quot;</span>,<br>    <span class="hljs-string">&quot;11101011101111111011101011110101110111111101110101011101&quot;</span>,<br>    <span class="hljs-string">&quot;10001000101000001010001011000100010100000101000101011101&quot;</span>,<br>    <span class="hljs-string">&quot;10111111101011101110111011011111110101110111011101011101&quot;</span>,<br>    <span class="hljs-string">&quot;10001000001000100000001011000100000100010000000101011001&quot;</span>,<br>    <span class="hljs-string">&quot;11101011111011111111101011110101111101111111110101011011&quot;</span>,<br>    <span class="hljs-string">&quot;10101000000010001000101011010100000001000100010101011011&quot;</span>,<br>    <span class="hljs-string">&quot;10101111111110101010101011010111111111010101010101011011&quot;</span>,<br>    <span class="hljs-string">&quot;10100000000000100010101011010000000000010001010101011011&quot;</span>,<br>    <span class="hljs-string">&quot;10111111111111111110111011011111111111111111011101011011&quot;</span>,<br>    <span class="hljs-string">&quot;10000000001111000000000011110111010000111100011111011011&quot;</span>,<br>    <span class="hljs-string">&quot;11101111100000011011011111111010110111011101100001011011&quot;</span>,<br>    <span class="hljs-string">&quot;11101111111111111011011111111101110111101101100001011011&quot;</span>,<br>    <span class="hljs-string">&quot;10001000111111000010000011111010110111011101100001011011&quot;</span>,<br>    <span class="hljs-string">&quot;10111010111111111010111011110111010000111101100001010011&quot;</span>,<br>    <span class="hljs-string">&quot;10000010000010000010001011111111111111111101100001010111&quot;</span>,<br>    <span class="hljs-string">&quot;10111111111011101110111011110001000110001101100001010001&quot;</span>,<br>    <span class="hljs-string">&quot;10100000001000101000100011110111011101111101100001011101&quot;</span>,<br>    <span class="hljs-string">&quot;10101011111110111011101011110001000101111101100001011101&quot;</span>,<br>    <span class="hljs-string">&quot;10101010000010100000101011111101011101111101100001011101&quot;</span>,<br>    <span class="hljs-string">&quot;10111010111010101111101011110001000110001101100001011101&quot;</span>,<br>    <span class="hljs-string">&quot;10000010001010101000001011111111111111111101100001011101&quot;</span>,<br>    <span class="hljs-string">&quot;11111011101011111011111110000000000000001101100001011101&quot;</span>,<br>    <span class="hljs-string">&quot;10001010001000100010000011111111111111111100110011011101&quot;</span>,<br>    <span class="hljs-string">&quot;10111010111110101010111010010000000011111110001111011101&quot;</span>,<br>    <span class="hljs-string">&quot;10001010001000001010001010110111000001111110100101011101&quot;</span>,<br>    <span class="hljs-string">&quot;11101011101111111011101000110011001111111100110111011101&quot;</span>,<br>    <span class="hljs-string">&quot;10001000101000001010001011111111111111111111110111010001&quot;</span>,<br>    <span class="hljs-string">&quot;10111111101011101110111010100001001100000000000011011011&quot;</span>,<br>    <span class="hljs-string">&quot;10001000001000100000001011111111111101011101111001011011&quot;</span>,<br>    <span class="hljs-string">&quot;10101011111011111111101011000000000001000100010111011011&quot;</span>,<br>    <span class="hljs-string">&quot;10101000000010001000101010010111111111111111111111011011&quot;</span>,<br>    <span class="hljs-string">&quot;10101111111110101010101010110111111111111111111101011011&quot;</span>,<br>    <span class="hljs-string">&quot;10100000000000100010101011100000000000000000000011011011&quot;</span>,<br>    <span class="hljs-string">&quot;10111111111111111110011011111111111111111111111011011011&quot;</span>,<br>    <span class="hljs-string">&quot;10000011111111111111000010000000000000000000000000011001&quot;</span>,<br>    <span class="hljs-string">&quot;11111011111111111111111111111111111111111111111111111101&quot;</span>,<br>    <span class="hljs-string">&quot;11111011100001100110110111000000000000000000000111111101&quot;</span>,<br>    <span class="hljs-string">&quot;11111011101111011010000111011111111111111111110111111101&quot;</span>,<br>    <span class="hljs-string">&quot;11111011100001000010110110000111111111111111110000000001&quot;</span>,<br>    <span class="hljs-string">&quot;11111011101111011010110111101111111111111111111111111111&quot;</span>,<br>    <span class="hljs-string">&quot;11110000000000011000110000000000000000000000000000000011&quot;</span>,<br>    <span class="hljs-string">&quot;11111111111111111111111111111111111111111111111111111111&quot;</span><br>]<br>start=(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)<br>end=(<span class="hljs-number">15</span>,<span class="hljs-number">32</span>)<br>path=maze.solve(Maze,start,end)<br><span class="hljs-built_in">print</span>(path)<br><br><br><span class="hljs-comment">#mycode.maze:</span><br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve</span>(<span class="hljs-params">maze, start, end, directions=<span class="hljs-literal">None</span>, wall=<span class="hljs-string">&#x27;1&#x27;</span>, free=<span class="hljs-string">&#x27;0&#x27;</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    参数:</span><br><span class="hljs-string">        maze: 二维字符串列表</span><br><span class="hljs-string">        start: 起点坐标 (row, col)</span><br><span class="hljs-string">        end: 终点坐标 (row, col)</span><br><span class="hljs-string">        directions: 自定义方向指令 (默认WASD)</span><br><span class="hljs-string">        wall: 墙字符 (默认&#x27;1&#x27;)</span><br><span class="hljs-string">        free: 通路字符 (默认&#x27;0&#x27;)</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    返回:</span><br><span class="hljs-string">        移动指令字符串 或 None(无解)</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> directions <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        directions = &#123;<br>            <span class="hljs-string">&#x27;W&#x27;</span>: (-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>),  <span class="hljs-comment"># 上</span><br>            <span class="hljs-string">&#x27;A&#x27;</span>: (<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>),   <span class="hljs-comment"># 左</span><br>            <span class="hljs-string">&#x27;S&#x27;</span>: (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>),    <span class="hljs-comment"># 下</span><br>            <span class="hljs-string">&#x27;D&#x27;</span>: (<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)     <span class="hljs-comment"># 右</span><br>        &#125;<br>    <br>    rows, cols = <span class="hljs-built_in">len</span>(maze), <span class="hljs-built_in">len</span>(maze[<span class="hljs-number">0</span>])<br>    <br>    <span class="hljs-comment"># 坐标验证</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">is_valid</span>(<span class="hljs-params">pos</span>):<br>        r, c = pos<br>        <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span> &lt;= r &lt; rows <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> &lt;= c &lt; cols <span class="hljs-keyword">and</span> maze[r][c] == free)<br>    <br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> is_valid(start):<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f&quot;无效起点 <span class="hljs-subst">&#123;start&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> is_valid(end):<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f&quot;无效终点 <span class="hljs-subst">&#123;end&#125;</span>&quot;</span>)<br><br>    <span class="hljs-comment"># BFS核心（修复了变量名冲突）</span><br>    queue = deque([(start[<span class="hljs-number">0</span>], start[<span class="hljs-number">1</span>], <span class="hljs-string">&quot;&quot;</span>)])<br>    visited = <span class="hljs-built_in">set</span>([(start[<span class="hljs-number">0</span>], start[<span class="hljs-number">1</span>])])<br>    <br>    <span class="hljs-keyword">while</span> queue:<br>        row, col, current_path = queue.popleft()  <span class="hljs-comment"># 改名为 current_path</span><br>        <br>        <span class="hljs-keyword">if</span> (row, col) == end:<br>            <span class="hljs-keyword">return</span> current_path<br>        <br>        <span class="hljs-keyword">for</span> move, (dr, dc) <span class="hljs-keyword">in</span> directions.items():<br>            new_row, new_col = row + dr, col + dc<br>            <br>            <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &lt;= new_row &lt; rows <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> &lt;= new_col &lt; cols <span class="hljs-keyword">and</span> <br>                maze[new_row][new_col] == free <span class="hljs-keyword">and</span>  <span class="hljs-comment"># 使用通路字符 free</span><br>                (new_row, new_col) <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> visited):<br>                <br>                visited.add((new_row, new_col))<br>                queue.append((new_row, new_col, current_path + move))  <span class="hljs-comment"># 使用 current_path</span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>  <span class="hljs-comment"># 无解</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="flower"><a href="#flower" class="headerlink" title="flower"></a>flower</h3><ul>
<li><p>附件程序用IDA打开，在汇编界面上下滑动可以找到花指令引起的红色栈帧报错。打开IDA工具栏的“Options”选项的“General”，勾选“Stackpointer”，可以看到栈帧信息</p>
<p><img src="/../images/image-20250829121800223-1760193218429-5.png" alt="General"></p>
<p><img src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-08-29%20121722-1760193218429-7.png" alt="Stackpointer"></p>
<p>可以看到红色报错的函数栈帧超过了1000，有点反常，找到栈帧发生突变的地方，发现用sub rsp,1000h改变了栈帧，把这条指令nop掉。本题这个类型的花指令占绝大多数，需要耐心的一个一个nop掉。（还有sub rsp,400h的，主要留意栈帧大于100）</p>
<p><img src="/../images/image-20250829122250848-1760193218429-6.png" alt="nop花指令"></p>
<p>还有另一种花指令：</p>
<p><img src="/../images/image-20250829130321938-1760193218429-9.png" alt="第二种花指令"></p>
<p>图中Label+1是0x004048EF，被0x004048EE处的指令覆盖住了，所以undefine一下，IDA就会自动纠错。把没用的指令nop掉</p>
<p><img src="/../images/image-20250829133142939-1760193218429-10.png" alt="自动纠错"></p>
<p>接下来要做的修改有2点。首先可以看到0x004048E5处有一个恒跳花指令，这个要nop掉。</p>
<p><img src="/../images/image-20250829140959636-1760193218429-11.png" alt="nop掉恒跳"></p>
<p>然后是call loc_4048EF，由于call是会占用栈帧的，更何况call一个标签没有ret恢复栈帧，后面栈帧还是会报错（这里有一个试错过程，不把call改成jmp的话，函数undefine+code+create function后依旧反编译不了）。做法就是工具栏edit-&gt;patch program-&gt;change byte，把十六进制码E8改成E9</p>
<p><img src="/../images/image-20250829141054207-1760193218429-12.png" alt="call改jmp"></p>
<p>然后就是选中函数名undefine+code+create function了，就可以正常反编译了</p>
</li>
<li><p>main函数逻辑主要是把flag掐头去尾，中间部分加密后比对</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 __fastcall <span class="hljs-title function_">solve</span><span class="hljs-params">(_QWORD *flag)</span><br>&#123;<br>  <span class="hljs-type">char</span> v1; <span class="hljs-comment">// bl</span><br>  <span class="hljs-type">bool</span> v2; <span class="hljs-comment">// r12</span><br>  __int64 v3; <span class="hljs-comment">// rax</span><br>  __int64 v4; <span class="hljs-comment">// rbx</span><br>  __int64 v5; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> *flag[i]; <span class="hljs-comment">// rax</span><br>  __int64 v7; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v9; <span class="hljs-comment">// [rsp+17h] [rbp-59h] BYREF</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+18h] [rbp-58h]</span><br>  <span class="hljs-type">int</span> len; <span class="hljs-comment">// [rsp+1Ch] [rbp-54h]</span><br>  __int64 flag_start; <span class="hljs-comment">// [rsp+20h] [rbp-50h] BYREF</span><br>  __int64 flag_end; <span class="hljs-comment">// [rsp+28h] [rbp-48h] BYREF</span><br>  <span class="hljs-type">void</span> *fl4g[<span class="hljs-number">5</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-40h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 v15; <span class="hljs-comment">// [rsp+58h] [rbp-18h]</span><br>  __int64 savedregs; <span class="hljs-comment">// [rsp+70h] [rbp+0h] BYREF</span><br><br>  v15 = __readfsqword(<span class="hljs-number">0x28u</span>);<br>  v1 = <span class="hljs-number">0</span>;<br>  v2 = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int64)length((__int64)flag) &gt; <span class="hljs-number">7</span> )<br>  &#123;<br>    substr(fl4g, flag, <span class="hljs-number">0LL</span>, <span class="hljs-number">7uLL</span>);<br>    v1 = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> ( !(<span class="hljs-type">unsigned</span> __int8)cmp((__int64)fl4g, (__int64)<span class="hljs-string">&quot;moectf&#123;&quot;</span>) &amp;&amp; *(_BYTE *)get_last_str(flag) == <span class="hljs-number">125</span> )<br>      v2 = <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v1 )<br>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>(fl4g);<br>  <span class="hljs-keyword">if</span> ( v2 )<br>  &#123;<br>    v3 = <span class="hljs-built_in">cout</span>((<span class="hljs-built_in">std</span>::ostream *)&amp;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>);<br>    out(v3, (__int64 (*)(<span class="hljs-type">void</span>))<span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>&lt;<span class="hljs-type">char</span>,<span class="hljs-built_in">std</span>::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">std</span>::allocator&lt;<span class="hljs-type">char</span>&gt;::allocator((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)&amp;savedregs - <span class="hljs-number">89</span>);<br>    flag_end = getEnd(flag);<br>    v4 = cutTail(&amp;flag_end, <span class="hljs-number">1LL</span>);<br>    flag_start = getStart((__int64)flag);<br>    v5 = cutHead(&amp;flag_start, <span class="hljs-number">7LL</span>);<br>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::basic_string&lt;__gnu_cxx::__normal_iterator&lt;<span class="hljs-type">char</span> *,<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;,<span class="hljs-type">void</span>&gt;(fl4g, v5, v4, (__int64)&amp;v9);<span class="hljs-comment">// 掐头去尾</span><br>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::operator=(flag, fl4g);<br>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>(fl4g);<br>    <span class="hljs-built_in">std</span>::allocator&lt;<span class="hljs-type">char</span>&gt;::~allocator();<br>    len = length((__int64)flag);<br>    <span class="hljs-keyword">if</span> ( len == <span class="hljs-number">32</span> )<br>    &#123;<br>      <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; len; ++i )<br>      &#123;<br>        flag[i] = (<span class="hljs-type">char</span> *)toList(flag, i);      <span class="hljs-comment">// flag[i]</span><br>        <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)encode(*flag[i]) != enc[i] )<br>          <span class="hljs-keyword">break</span>;<br>      &#125;<br>    &#125;<br>    v7 = <span class="hljs-built_in">cout</span>((<span class="hljs-built_in">std</span>::ostream *)&amp;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>);<br>    out(v7, (__int64 (*)(<span class="hljs-type">void</span>))<span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>&lt;<span class="hljs-type">char</span>,<span class="hljs-built_in">std</span>::char_traits&lt;<span class="hljs-type">char</span>&gt;&gt;);<br>  &#125;<br>  <span class="hljs-keyword">return</span> v15 - __readfsqword(<span class="hljs-number">0x28u</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>加密函数encode如下，就是把flag[i]和key异或，key会递增。需要注意的是，静态分析下得到的key是不正确的（静态分析得到的key是0x23，但是动态调试会发现程序运行到此处key变成0x29），动调得到的key才能解密出flag</p>
<p><img src="/../images/image-20250829141947673-1760193218429-13.png" alt="encode函数"></p>
</li>
<li><p>解密脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">data = [<br>    <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x7E</span>,<br>    <span class="hljs-number">0x44</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x52</span>,<br>    <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x2B</span><br>]<br>key=<span class="hljs-number">0x29</span><br>result=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(data)):<br>    plaintext=(data[i]^key)&amp;<span class="hljs-number">0xff</span><br>    key+=<span class="hljs-number">1</span><br>    result.append(plaintext)<br>flag=<span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> result)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="tea"><a href="#tea" class="headerlink" title="tea"></a>tea</h3><ul>
<li><p>IDA打开附件程序，main函数逻辑是将输入的flag分成10份，每次取两份进行加密，加密出来的数据和enc比较。key和enc已经给定</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//main函数</span><br><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">char</span> *v3; <span class="hljs-comment">// rdi</span><br>  __int64 i; <span class="hljs-comment">// rcx</span><br>  _BYTE v6[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-20h] BYREF</span><br>  <span class="hljs-type">char</span> v7; <span class="hljs-comment">// [rsp+20h] [rbp+0h] BYREF</span><br>  _DWORD key[<span class="hljs-number">12</span>]; <span class="hljs-comment">// [rsp+28h] [rbp+8h] BYREF</span><br>  _DWORD enc[<span class="hljs-number">20</span>]; <span class="hljs-comment">// [rsp+58h] [rbp+38h]</span><br>  _DWORD fl4g[<span class="hljs-number">20</span>]; <span class="hljs-comment">// [rsp+A8h] [rbp+88h] BYREF</span><br>  _DWORD Flag[<span class="hljs-number">20</span>]; <span class="hljs-comment">// [rsp+F8h] [rbp+D8h] BYREF</span><br>  <span class="hljs-type">char</span> flag[<span class="hljs-number">64</span>]; <span class="hljs-comment">// [rsp+148h] [rbp+128h] BYREF</span><br>  <span class="hljs-type">size_t</span> length; <span class="hljs-comment">// [rsp+188h] [rbp+168h]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+1A4h] [rbp+184h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> part1; <span class="hljs-comment">// [rsp+1C8h] [rbp+1A8h] BYREF</span><br>  <span class="hljs-type">int</span> part2; <span class="hljs-comment">// [rsp+1CCh] [rbp+1ACh]</span><br>  <span class="hljs-type">int</span> v17; <span class="hljs-comment">// [rsp+1E4h] [rbp+1C4h]</span><br>  <span class="hljs-type">int</span> k; <span class="hljs-comment">// [rsp+204h] [rbp+1E4h]</span><br><br>  v3 = &amp;v7;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">130LL</span>; i; --i )<br>  &#123;<br>    *(_DWORD *)v3 = <span class="hljs-number">-858993460</span>;<br>    v3 += <span class="hljs-number">4</span>;<br>  &#125;<br>  sub_7FF6DAA21384(byte_7FF6DAA33015);<br>  key[<span class="hljs-number">0</span>] = <span class="hljs-number">289739801</span>;<br>  key[<span class="hljs-number">1</span>] = <span class="hljs-number">427884820</span>;<br>  key[<span class="hljs-number">2</span>] = <span class="hljs-number">1363251608</span>;<br>  key[<span class="hljs-number">3</span>] = <span class="hljs-number">269567252</span>;<br>  enc[<span class="hljs-number">0</span>] = <span class="hljs-number">2026214571</span>;<br>  enc[<span class="hljs-number">1</span>] = <span class="hljs-number">578894681</span>;<br>  enc[<span class="hljs-number">2</span>] = <span class="hljs-number">1193947460</span>;<br>  enc[<span class="hljs-number">3</span>] = <span class="hljs-number">-229306230</span>;<br>  enc[<span class="hljs-number">4</span>] = <span class="hljs-number">73202484</span>;<br>  enc[<span class="hljs-number">5</span>] = <span class="hljs-number">961145356</span>;<br>  enc[<span class="hljs-number">6</span>] = <span class="hljs-number">-881456792</span>;<br>  enc[<span class="hljs-number">7</span>] = <span class="hljs-number">358205817</span>;<br>  enc[<span class="hljs-number">8</span>] = <span class="hljs-number">-554069347</span>;<br>  enc[<span class="hljs-number">9</span>] = <span class="hljs-number">119347883</span>;<br>  enc[<span class="hljs-number">10</span>] = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">memset</span>(fl4g, <span class="hljs-number">0</span>, <span class="hljs-number">44uLL</span>);<br>  <span class="hljs-built_in">memset</span>(Flag, <span class="hljs-number">0</span>, <span class="hljs-number">44uLL</span>);<br>  <span class="hljs-built_in">printf</span>(&amp;You_are_wrong___);<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, flag);<br>  length = j_strlen(flag);<br>  j_memcpy(fl4g, flag, length);<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">5</span>; ++j )<br>  &#123;<br>    part1 = fl4g[<span class="hljs-number">2</span> * j];<br>    part2 = fl4g[<span class="hljs-number">2</span> * j + <span class="hljs-number">1</span>];<br>    tea(&amp;part1, key);<span class="hljs-comment">// 这里传的是地址，tea内可以通过part1的地址得到part2</span><br>    Flag[<span class="hljs-number">2</span> * j] = part1;<br>    Flag[<span class="hljs-number">2</span> * j + <span class="hljs-number">1</span>] = part2;<br>  &#125;<br>  v17 = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">for</span> ( k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">11</span>; ++k )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( Flag[k] != enc[k] )<br>    &#123;<br>      v17 = <span class="hljs-number">0</span>;<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;You are wrong!!&quot;</span>);<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v17 == <span class="hljs-number">1</span> )<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Congratulations!!!!&quot;</span>);<br>  sub_7FF6DAA21320(v6, &amp;unk_7FF6DAA2AE60);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>加密函数是改动的tea加密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">Tea</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *part1, _DWORD *key)</span><br>&#123;<br>  __int64 n4; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> delta; <span class="hljs-comment">// [rsp+24h] [rbp+4h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> p1; <span class="hljs-comment">// [rsp+44h] [rbp+24h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> p2; <span class="hljs-comment">// [rsp+64h] [rbp+44h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+A4h] [rbp+84h]</span><br><br>  sub_7FF6DAA21384((__int64)&amp;byte_7FF6DAA33015);<br>  delta = <span class="hljs-number">0</span>;<br>  p1 = *part1;<br>  p2 = part1[<span class="hljs-number">1</span>];<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; ++i )<br>  &#123;<br>    delta += <span class="hljs-number">1131796</span>;<br>    p1 += (key[<span class="hljs-number">1</span>] + (p2 &gt;&gt; <span class="hljs-number">5</span>)) ^ (delta + p2) ^ (*key + <span class="hljs-number">16</span> * p2);<br>    p2 += (key[<span class="hljs-number">3</span>] + (p1 &gt;&gt; <span class="hljs-number">5</span>)) ^ (delta + p1) ^ (key[<span class="hljs-number">2</span>] + <span class="hljs-number">16</span> * p1);<br>  &#125;<br>  *part1 = p1;<br>  n4 = <span class="hljs-number">4LL</span>;<br>  part1[<span class="hljs-number">1</span>] = p2;<br>  <span class="hljs-keyword">return</span> n4;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>解密逻辑：将tea内的p1 p2位置对调，”+”改成”-“，然后delta从最后一轮的值往回递减就可以了。解密脚本：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">tea_decrypt</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> *a,<span class="hljs-type">uint32_t</span> *k)</span> &#123;<br>	<span class="hljs-type">uint32_t</span> delta = <span class="hljs-number">1131796</span> * <span class="hljs-number">32</span>;<br>	<span class="hljs-type">uint32_t</span> p1 = *a;<br>	<span class="hljs-type">uint32_t</span> p2 = *(a + <span class="hljs-number">1</span>);<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) &#123;<br>		p2 -= ((k[<span class="hljs-number">3</span>] + (p1 &gt;&gt; <span class="hljs-number">5</span>)) ^ (delta + p1) ^ (k[<span class="hljs-number">2</span>] + <span class="hljs-number">16</span> * p1));<br>		p1 -= ((k[<span class="hljs-number">1</span>] + (p2 &gt;&gt; <span class="hljs-number">5</span>)) ^ (delta + p2) ^ (*k + <span class="hljs-number">16</span> * p2));<br>		delta -= <span class="hljs-number">1131796</span>;<br>	&#125;<br>	*a = p1;<br>	*(a+<span class="hljs-number">1</span>)= p2;<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>	<span class="hljs-type">uint32_t</span> key[<span class="hljs-number">4</span>];<br>	<span class="hljs-type">uint32_t</span> enc[<span class="hljs-number">11</span>];<br>	key[<span class="hljs-number">0</span>] = <span class="hljs-number">289739801</span>;<br>	key[<span class="hljs-number">1</span>] = <span class="hljs-number">427884820</span>;<br>	key[<span class="hljs-number">2</span>] = <span class="hljs-number">1363251608</span>;<br>	key[<span class="hljs-number">3</span>] = <span class="hljs-number">269567252</span>;<br>	enc[<span class="hljs-number">0</span>] = <span class="hljs-number">2026214571</span>;<br>	enc[<span class="hljs-number">1</span>] = <span class="hljs-number">578894681</span>;<br>	enc[<span class="hljs-number">2</span>] = <span class="hljs-number">1193947460</span>;<br>	enc[<span class="hljs-number">3</span>] = <span class="hljs-number">-229306230</span>;<br>	enc[<span class="hljs-number">4</span>] = <span class="hljs-number">73202484</span>;<br>	enc[<span class="hljs-number">5</span>] = <span class="hljs-number">961145356</span>;<br>	enc[<span class="hljs-number">6</span>] = <span class="hljs-number">-881456792</span>;<br>	enc[<span class="hljs-number">7</span>] = <span class="hljs-number">358205817</span>;<br>	enc[<span class="hljs-number">8</span>] = <span class="hljs-number">-554069347</span>;<br>	enc[<span class="hljs-number">9</span>] = <span class="hljs-number">119347883</span>;<br>	enc[<span class="hljs-number">10</span>] = <span class="hljs-number">0</span>;<br>	<span class="hljs-type">char</span> flag[<span class="hljs-number">45</span>] = &#123; <span class="hljs-number">0</span> &#125;;<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>		<span class="hljs-type">uint32_t</span> block[<span class="hljs-number">2</span>] = &#123;enc[<span class="hljs-number">2</span>*i],enc[<span class="hljs-number">2</span>*i+<span class="hljs-number">1</span>]&#125;;<br>		tea_decrypt(block, key);<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">4</span>; j++) &#123;<br>			flag[<span class="hljs-number">8</span> * i + j] = (block[<span class="hljs-number">0</span>] &gt;&gt; (j * <span class="hljs-number">8</span>)) &amp; <span class="hljs-number">0xff</span>;<span class="hljs-comment">//右移j个字符，然后取最后一个</span><br>			flag[<span class="hljs-number">8</span> * i + j + <span class="hljs-number">4</span>] = (block[<span class="hljs-number">1</span>] &gt;&gt; (j * <span class="hljs-number">8</span>)) &amp; <span class="hljs-number">0xff</span>;<br>		&#125;<br>	&#125;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, flag);<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="ez3"><a href="#ez3" class="headerlink" title="ez3"></a>ez3</h3><ul>
<li><p>附件程序main函数逻辑主要是获取flag，然后掐头去尾，对中间部分进行check。main函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">char</span> v3; <span class="hljs-comment">// bl</span><br>  <span class="hljs-type">bool</span> v4; <span class="hljs-comment">// r12</span><br>  __int64 v5; <span class="hljs-comment">// rbx</span><br>  __int64 v6; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v8; <span class="hljs-comment">// [rsp+Fh] [rbp-71h] BYREF</span><br>  __int64 Start; <span class="hljs-comment">// [rsp+10h] [rbp-70h] BYREF</span><br>  __int64 end; <span class="hljs-comment">// [rsp+18h] [rbp-68h] BYREF</span><br>  _BYTE flag[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-60h] BYREF</span><br>  _QWORD fl4g[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-40h] BYREF</span><br><br>  fl4g[<span class="hljs-number">5</span>] = __readfsqword(<span class="hljs-number">0x28u</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Input your flag:\n&gt; &quot;</span>, argv, envp);<br>  fflush(<span class="hljs-built_in">stdout</span>);<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::basic_string(flag);<br>  <span class="hljs-built_in">cin</span>(&amp;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cin</span>);<br>  <span class="hljs-keyword">if</span> ( length(flag) == <span class="hljs-number">42</span> )<br>  &#123;<br>    v3 = <span class="hljs-number">0</span>;<br>    v4 = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> ( length(flag) &gt; <span class="hljs-number">7</span> )<br>    &#123;<br>      substr(fl4g, flag, <span class="hljs-number">0LL</span>, <span class="hljs-number">7LL</span>);<br>      v3 = <span class="hljs-number">1</span>;<br>      <span class="hljs-keyword">if</span> ( !cmp(fl4g, <span class="hljs-string">&quot;moectf&#123;&quot;</span>) &amp;&amp; *get_last_str(flag) == <span class="hljs-number">125</span> )<br>        v4 = <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v3 )<br>      <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>(fl4g);<br>    <span class="hljs-keyword">if</span> ( v4 )<br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;FORMAT ERROR!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-built_in">std</span>::allocator&lt;<span class="hljs-type">char</span>&gt;::allocator(&amp;v8);<br>      end = getEnd(flag);<br>      v5 = cutTail(&amp;end, <span class="hljs-number">1LL</span>);<br>      Start = getStart(flag);<br>      v6 = cutHead(&amp;Start, <span class="hljs-number">7LL</span>);<br>      <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::basic_string&lt;__gnu_cxx::__normal_iterator&lt;<span class="hljs-type">char</span> *,<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;,<span class="hljs-type">void</span>&gt;(fl4g, v6, v5, &amp;v8);<br>      strcopy(flag, fl4g);<br>      <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>(fl4g);<br>      <span class="hljs-built_in">std</span>::allocator&lt;<span class="hljs-type">char</span>&gt;::~allocator(&amp;v8);<br>      <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::basic_string(fl4g, flag);<br>      LOBYTE(v5) = check(fl4g);<br>      <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>(fl4g);<br>      <span class="hljs-keyword">if</span> ( v5 )<br>      &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;OK&quot;</span>);<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;But I don&#x27;t know what the true flag is&quot;</span>);<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;try again~&quot;</span>);<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Length error!&quot;</span>);<br>  &#125;<br>  <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::~<span class="hljs-built_in">string</span>(flag);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>check函数：</p>
<p><img src="/../images/image-20250829115915331-1760193218429-15.png" alt="check函数"></p>
<p>题目提示了z3，所以使用z3约束求解。思路就是复现check函数逻辑，爆破出flag</p>
</li>
<li><p>脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br><br>enc = [<br>    <span class="hljs-number">0x0B1B0</span>, <span class="hljs-number">0x5678</span>, <span class="hljs-number">0x7FF2</span>, <span class="hljs-number">0xA332</span>, <span class="hljs-number">0xA0E8</span>, <span class="hljs-number">0x364C</span>, <span class="hljs-number">0x2BD4</span>,<br>    <span class="hljs-number">0xC8FE</span>, <span class="hljs-number">0x4A7C</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x2BE4</span>, <span class="hljs-number">0x4144</span>, <span class="hljs-number">0x3BA6</span>, <span class="hljs-number">0xBE8C</span>, <span class="hljs-number">0x8F7E</span>,<br>    <span class="hljs-number">0x35F8</span>, <span class="hljs-number">0x61AA</span>, <span class="hljs-number">0x2B4A</span>, <span class="hljs-number">0x6828</span>, <span class="hljs-number">0xB39E</span>, <span class="hljs-number">0xB542</span>, <span class="hljs-number">0x33EC</span>, <span class="hljs-number">0xC7D8</span>,<br>    <span class="hljs-number">0x448C</span>, <span class="hljs-number">0x9310</span>, <span class="hljs-number">0x8808</span>, <span class="hljs-number">0xADD4</span>, <span class="hljs-number">0x3CC2</span>, <span class="hljs-number">0x796</span>, <span class="hljs-number">0xC940</span>, <span class="hljs-number">0x4E32</span>,<br>    <span class="hljs-number">0x4E2E</span>, <span class="hljs-number">0x924A</span>, <span class="hljs-number">0x5B5C</span><br>]<br><br>s=Solver()<br>flag=[BitVec(<span class="hljs-string">f&#x27;flag_<span class="hljs-subst">&#123;i&#125;</span>&#x27;</span>,<span class="hljs-number">32</span>)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">34</span>)]<br>b=[BitVec(<span class="hljs-string">f&#x27;b_<span class="hljs-subst">&#123;i&#125;</span>&#x27;</span>,<span class="hljs-number">32</span>)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">34</span>)]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">34</span>):<br>    s.add(flag[i]&gt;=<span class="hljs-number">32</span>,flag[i]&lt;=<span class="hljs-number">126</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">34</span>):<br>    <span class="hljs-keyword">if</span> i==<span class="hljs-number">0</span>:<br>        s.add(b[<span class="hljs-number">0</span>]==(<span class="hljs-number">47806</span>*flag[<span class="hljs-number">0</span>])%<span class="hljs-number">51966</span>)<br>    <span class="hljs-keyword">else</span>:<br>        b_value=<span class="hljs-number">47806</span>*(flag[i]+i)<br>        b_xored=b_value^(b[i-<span class="hljs-number">1</span>]^<span class="hljs-number">0x114514</span>)<br>        s.add(b[i]==b_xored%<span class="hljs-number">51966</span>)<br>    s.add(b[i]==enc[i])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;solutions found:&quot;</span>)<br><span class="hljs-keyword">while</span> s.check()==sat:<br>    model=s.model()<br>    solution=<span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">chr</span>(model[flag[i]].as_long())<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">34</span>)])<br>    <span class="hljs-built_in">print</span>(solution)<br>    exception=Or([flag[i]!=model[flag[i]]<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">34</span>)])<span class="hljs-comment">#避免重复情况</span><br>    s.add(exception)<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="逆向工程入门指北"><a href="#逆向工程入门指北" class="headerlink" title="逆向工程入门指北"></a>逆向工程入门指北</h3><ul>
<li><p>IDA打开附件程序，在字符串窗口可以直接看到flag</p>
<p><img src="/../images/image-20250829104220942-1760193218429-14.png" alt="字符串窗口"></p>
</li>
</ul>
<h2 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h2><h3 id="base"><a href="#base" class="headerlink" title="base"></a>base</h3><ul>
<li><p>运行附件程序，直接让输入flag。IDA打开分析main函数，发现使用了标准base64加密，并且密文直接给了。cyberchef一把梭</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//main函数</span><br><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  FILE *Stream; <span class="hljs-comment">// rax</span><br>  __int64 v4; <span class="hljs-comment">// rdx</span><br>  __int64 length; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> __int64 n; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> *Str1; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *Format; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">char</span> v11[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-98h] BYREF</span><br>  <span class="hljs-type">char</span> flag[<span class="hljs-number">112</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-88h] BYREF</span><br><br>  <span class="hljs-built_in">printf</span>(::Format);<br>  <span class="hljs-built_in">printf</span>((<span class="hljs-type">char</span> *)&amp;Format_);<br>  Stream = _acrt_iob_func(<span class="hljs-number">0</span>);<br>  fgets(flag, <span class="hljs-number">100</span>, Stream);<br>  v4 = <span class="hljs-number">-1LL</span>;<br>  length = <span class="hljs-number">-1LL</span>;<br>  <span class="hljs-keyword">do</span><br>    ++length;<br>  <span class="hljs-keyword">while</span> ( flag[length] );<br>  <span class="hljs-keyword">if</span> ( length &amp;&amp; v11[length + <span class="hljs-number">15</span>] == <span class="hljs-number">10</span> )<br>  &#123;<br>    n = length - <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> ( n &gt;= <span class="hljs-number">0x64</span> )<br>      _report_securityfailure_(flag);<br>    flag[n] = <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">do</span><br>    ++v4;<br>  <span class="hljs-keyword">while</span> ( flag[v4] );<br>  Str1 = (<span class="hljs-type">char</span> *)baseEncode(flag, v4, v11);<span class="hljs-comment">// 标准base64加密</span><br>  v8 = <span class="hljs-built_in">strcmp</span>(Str1, <span class="hljs-string">&quot;bW9lY3Rme1kwdV9DNG5fRzAwZF9BdF9CNDVlNjQhIX0=&quot;</span>);<br>  Format = (<span class="hljs-type">char</span> *)&amp;unk_140003300;<br>  <span class="hljs-keyword">if</span> ( v8 )<br>    Format = (<span class="hljs-type">char</span> *)&amp;byte_140003318;<br>  <span class="hljs-built_in">printf</span>(Format);<br>  <span class="hljs-built_in">free</span>(Str1);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/../images/image-20250821000019398-1760193218429-16.png" alt="cyberchef一把梭"></p>
</li>
</ul>
<h3 id="speed"><a href="#speed" class="headerlink" title="speed"></a>speed</h3><ul>
<li><p>附件程序运行出现一道黑影，看不清。IDA分析main函数，发现使用了WNDCLASSA结构体（详细信息见：<a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/windows/win32/api/winuser/ns-winuser-wndclassa">WNDCLASSA （winuser.h） - Win32 apps | Microsoft Learn</a>），主要逻辑是创建窗口，关键部分是窗口结构体变量lpfnWndProc，它指向了窗口的逻辑（即代码中的WndProc函数）</p>
<p><img src="/../images/image-20250828214030322-1760193218429-17.png" alt="main函数"></p>
</li>
<li><p>分析WndProc函数发现，窗口似乎直接输出flag。于是下断点，动态调试</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//WndProc函数</span><br>LRESULT __fastcall <span class="hljs-title function_">WndProc</span><span class="hljs-params">(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam)</span><br>&#123;<br>  tagPAINTSTRUCT Paint; <span class="hljs-comment">// [rsp+30h] [rbp-50h] BYREF</span><br>  <span class="hljs-type">char</span> Destination[<span class="hljs-number">14</span>]; <span class="hljs-comment">// [rsp+80h] [rbp+0h] BYREF</span><br>  __int16 v7; <span class="hljs-comment">// [rsp+8Eh] [rbp+Eh]</span><br>  __int64 v8; <span class="hljs-comment">// [rsp+90h] [rbp+10h]</span><br>  __int64 v9; <span class="hljs-comment">// [rsp+98h] [rbp+18h]</span><br>  __int64 v10; <span class="hljs-comment">// [rsp+A0h] [rbp+20h]</span><br>  __int64 v11; <span class="hljs-comment">// [rsp+A8h] [rbp+28h]</span><br>  __int64 v12; <span class="hljs-comment">// [rsp+B0h] [rbp+30h]</span><br>  __int64 v13; <span class="hljs-comment">// [rsp+B8h] [rbp+38h]</span><br>  __int64 v14; <span class="hljs-comment">// [rsp+C0h] [rbp+40h]</span><br>  __int64 v15; <span class="hljs-comment">// [rsp+C8h] [rbp+48h]</span><br>  __int64 v16; <span class="hljs-comment">// [rsp+D0h] [rbp+50h]</span><br>  __int64 v17; <span class="hljs-comment">// [rsp+D8h] [rbp+58h]</span><br>  __int64 v18; <span class="hljs-comment">// [rsp+E0h] [rbp+60h]</span><br>  __int64 v19; <span class="hljs-comment">// [rsp+E8h] [rbp+68h]</span><br>  __int64 v20; <span class="hljs-comment">// [rsp+F0h] [rbp+70h]</span><br>  __int64 v21; <span class="hljs-comment">// [rsp+F8h] [rbp+78h]</span><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tagRECT</span> <span class="hljs-title">Rect</span>;</span> <span class="hljs-comment">// [rsp+100h] [rbp+80h] BYREF</span><br>  <span class="hljs-type">char</span> mylittlepony[<span class="hljs-number">13</span>]; <span class="hljs-comment">// [rsp+113h] [rbp+93h] BYREF</span><br>  <span class="hljs-type">char</span> Source[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+120h] [rbp+A0h] BYREF</span><br>  __int64 v25; <span class="hljs-comment">// [rsp+128h] [rbp+A8h]</span><br>  _QWORD v26[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+130h] [rbp+B0h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+140h] [rbp+C0h]</span><br>  <span class="hljs-type">int</span> n12; <span class="hljs-comment">// [rsp+144h] [rbp+C4h]</span><br>  HDC hdc; <span class="hljs-comment">// [rsp+148h] [rbp+C8h]</span><br><br>  <span class="hljs-keyword">if</span> ( Msg == <span class="hljs-number">2</span> )<br>  &#123;<br>    PostQuitMessage(<span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( Msg == <span class="hljs-number">15</span> )<br>  &#123;<br>    hdc = BeginPaint(hWnd, &amp;Paint);<br>    <span class="hljs-built_in">strcpy</span>(Destination, <span class="hljs-string">&quot;Your flag is &quot;</span>);<br>    v7 = <span class="hljs-number">0</span>;<br>    v8 = <span class="hljs-number">0LL</span>;<br>    v9 = <span class="hljs-number">0LL</span>;<br>    v10 = <span class="hljs-number">0LL</span>;<br>    v11 = <span class="hljs-number">0LL</span>;<br>    v12 = <span class="hljs-number">0LL</span>;<br>    v13 = <span class="hljs-number">0LL</span>;<br>    v14 = <span class="hljs-number">0LL</span>;<br>    v15 = <span class="hljs-number">0LL</span>;<br>    v16 = <span class="hljs-number">0LL</span>;<br>    v17 = <span class="hljs-number">0LL</span>;<br>    v18 = <span class="hljs-number">0LL</span>;<br>    v19 = <span class="hljs-number">0LL</span>;<br>    v20 = <span class="hljs-number">0LL</span>;<br>    v21 = <span class="hljs-number">0LL</span>;<br>    *(_QWORD *)Source = <span class="hljs-number">0x7F1B3E885EF9160L</span>L;<br>    v25 = <span class="hljs-number">0x2CD336BCB0464A89L</span>L;<br>    v26[<span class="hljs-number">0</span>] = <span class="hljs-number">0xEF5FC91642917EE1u</span>LL;<br>    *(_QWORD *)((<span class="hljs-type">char</span> *)v26 + <span class="hljs-number">6</span>) = <span class="hljs-number">0x739D40A4E356EF5FL</span>L;<br>    <span class="hljs-built_in">strcpy</span>(mylittlepony, <span class="hljs-string">&quot;mylittlepony&quot;</span>);<br>    n12 = <span class="hljs-number">12</span>;<br>    i = <span class="hljs-built_in">strlen</span>(Source);<br>    RC4Crypt((<span class="hljs-type">unsigned</span> __int8 *)Source, i, (<span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> __int8 *)mylittlepony, <span class="hljs-number">12</span>);<br>    <span class="hljs-built_in">strcat</span>(Destination, Source);<br>    GetClientRect(hWnd, &amp;Rect);<br>    DrawTextA(hdc, Destination, <span class="hljs-number">-1</span>, &amp;Rect, <span class="hljs-number">0x40005u</span>);<br>    EndPaint(hWnd, &amp;Paint);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-keyword">return</span> DefWindowProcA(hWnd, Msg, wParam, lParam);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>动态调试结果如图：</p>
<p><img src="/../images/image-20250828214156948-1760193218429-19.png" alt="动态调试"></p>
</li>
</ul>
<h3 id="ezpy"><a href="#ezpy" class="headerlink" title="ezpy"></a>ezpy</h3><ul>
<li><p>使用decompyle3反编译得到：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">caesar_cipher_encrypt</span>(<span class="hljs-params">text, shift</span>):<br>    result = []<br>    <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> text:<br>        <span class="hljs-keyword">if</span> char.isalpha():<br>            <span class="hljs-keyword">if</span> char.islower():<br>                new_char = <span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(char) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;a&quot;</span>) + shift) % <span class="hljs-number">26</span> + <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;a&quot;</span>))<br>            <span class="hljs-keyword">elif</span> char.isupper():<br>                new_char = <span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(char) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;A&quot;</span>) + shift) % <span class="hljs-number">26</span> + <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;A&quot;</span>))<br>            result.append(new_char)<br>        <span class="hljs-keyword">else</span>:<br>            result.append(char)<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>.join(result)<br><br><br>user_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;please input your flag：&quot;</span>)<br>a = <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> a != <span class="hljs-number">1</span>:<br>    plaintext = user_input<br>    shift = <span class="hljs-number">114514</span><br>    encrypted_text = caesar_cipher_encrypt(plaintext, shift)<br>    <span class="hljs-keyword">if</span> encrypted_text == <span class="hljs-string">&quot;wyomdp&#123;I0e_Ux0G_zim&#125;&quot;</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Correct!!!!&quot;</span>)<br></code></pre></td></tr></table></figure>
</li>
<li><p>可以看出实现了一个凯撒加密，分析逻辑可以看出实际上是给每个字母移位了10（ascii码+10），所以给字母减10就ok了，可以基于源码进行微小改动得到解密脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">caesar_cipher_decrypt</span>(<span class="hljs-params">text, shift</span>):<br>    result = []<br>    <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> text:<br>        <span class="hljs-keyword">if</span> char.isalpha():<br>            <span class="hljs-keyword">if</span> char.islower():<br>                new_char = <span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(char) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;a&quot;</span>) - shift) % <span class="hljs-number">26</span> + <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;a&quot;</span>))<span class="hljs-comment">#&#x27;+&#x27;改为-&quot;</span><br>            <span class="hljs-keyword">elif</span> char.isupper():<br>                new_char = <span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(char) - <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;A&quot;</span>) - shift) % <span class="hljs-number">26</span> + <span class="hljs-built_in">ord</span>(<span class="hljs-string">&quot;A&quot;</span>))<br>            result.append(new_char)<br>        <span class="hljs-keyword">else</span>:<br>            result.append(char)<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>.join(result)<br>enc=<span class="hljs-string">&quot;wyomdp&#123;I0e_Ux0G_zim&#125;&quot;</span><br>flag=caesar_cipher_decrypt(enc,<span class="hljs-number">114514</span>)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="catch"><a href="#catch" class="headerlink" title="catch"></a>catch</h3><ul>
<li><p>先看main函数反编译结果，发现只有简单的两个函数，其中solve函数有更复杂的逻辑：</p>
<p><img src="/../images/image-20250828215740728-1760193218429-18.png" alt="main函数"></p>
</li>
<li><p>然而solve函数并不能看出什么有用的逻辑出来，sub_114514出现了flag字样，但是动调发现没有用处</p>
<p><img src="/../images/image-20250828215832225-1760193218429-20.png" alt="solve函数"></p>
</li>
<li><p>结合题目提示try catch不能被正确反编译，于是直接查看汇编代码。在汇编代码里看到一个类似flag格式的字符串，分析后续逻辑发现对这个字符串进行了处理，分析发现处理结果就是flag</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-symbol">.text:</span>00000001400014D6 <span class="hljs-comment">; =============== S U B R O U T I N E =======================================</span><br><span class="hljs-symbol">.text:</span>00000001400014D6<br><span class="hljs-symbol">.text:</span>00000001400014D6 <span class="hljs-comment">; Attributes: bp-based frame fpd=10h</span><br><span class="hljs-symbol">.text:</span>00000001400014D6<br><span class="hljs-symbol">.text:</span>00000001400014D6 <span class="hljs-comment">; void __noreturn solve(void)</span><br><span class="hljs-symbol">.text:</span>00000001400014D6                 <span class="hljs-meta">public</span> _Z5solvev<br><span class="hljs-symbol">.text:</span>00000001400014D6 _Z5solvev       proc <span class="hljs-built_in">near</span>               <span class="hljs-comment">; CODE XREF: main+D↓p</span><br><span class="hljs-symbol">.text:</span>00000001400014D6                                         <span class="hljs-comment">; DATA XREF: .pdata:000000014002D078↓o ...</span><br><span class="hljs-symbol">.text:</span>00000001400014D6<br><span class="hljs-symbol">.text:</span>00000001400014D6 length          = <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> -<span class="hljs-number">1Ch</span><br><span class="hljs-symbol">.text:</span>00000001400014D6 C               = <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> -<span class="hljs-number">18h</span><br><span class="hljs-symbol">.text:</span>00000001400014D6 count           = <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> -<span class="hljs-number">14h</span><br><span class="hljs-symbol">.text:</span>00000001400014D6<br><span class="hljs-symbol">.text:</span>00000001400014D6 <span class="hljs-comment">; __unwind &#123; // __gxx_personality_seh0</span><br><span class="hljs-symbol">.text:</span>00000001400014D6                 <span class="hljs-keyword">push</span>    <span class="hljs-built_in">rbp</span><br><span class="hljs-symbol">.text:</span>00000001400014D7                 <span class="hljs-keyword">push</span>    <span class="hljs-built_in">rsi</span><br><span class="hljs-symbol">.text:</span>00000001400014D8                 <span class="hljs-keyword">push</span>    <span class="hljs-built_in">rbx</span><br><span class="hljs-symbol">.text:</span>00000001400014D9                 <span class="hljs-keyword">sub</span>     <span class="hljs-built_in">rsp</span>, <span class="hljs-number">30h</span><br><span class="hljs-symbol">.text:</span>00000001400014<span class="hljs-built_in">DD</span>                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rbp</span>, [<span class="hljs-built_in">rsp</span>+<span class="hljs-number">30h</span>]<br><span class="hljs-symbol">.text:</span>00000001400014E2                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rax</span>, aMyFlagIsHidden <span class="hljs-comment">; &quot;my flag is hidden in this program. Can &quot;...</span><br><span class="hljs-symbol">.text:</span>00000001400014E9                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rcx</span>, <span class="hljs-built_in">rax</span>        <span class="hljs-comment">; char *</span><br><span class="hljs-symbol">.text:</span>00000001400014EC                 <span class="hljs-keyword">call</span>    print<br><span class="hljs-symbol">.text:</span>00000001400014F1 <span class="hljs-comment">;   try &#123;</span><br><span class="hljs-symbol">.text:</span>00000001400014F1                 <span class="hljs-keyword">call</span>    _Z10sub_114514v <span class="hljs-comment">; sub_114514(void)</span><br><span class="hljs-symbol">.text:</span>00000001400014F1 <span class="hljs-comment">;   &#125; // starts at 1400014F1</span><br><span class="hljs-symbol">.text:</span>00000001400014F6                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-number">10h</span>        <span class="hljs-comment">; thrown_size</span><br><span class="hljs-symbol">.text:</span>00000001400014FB                 <span class="hljs-keyword">call</span>    __cxa_allocate_exception<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001500</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rbx</span>, <span class="hljs-built_in">rax</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001503</span>                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rax</span>, aNothingButErro <span class="hljs-comment">; &quot;nothing but error&quot;</span><br><span class="hljs-symbol">.text:</span>000000014000150A                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rdx</span>, <span class="hljs-built_in">rax</span>        <span class="hljs-comment">; char *</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">000000014000150D</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rcx</span>, <span class="hljs-built_in">rbx</span>        <span class="hljs-comment">; this</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001510</span> <span class="hljs-comment">;   try &#123;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001510</span>                 <span class="hljs-keyword">call</span>    _ZNSt11logic_errorC1EPKc <span class="hljs-comment">; std::logic_error::logic_error(char const*)</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001510</span> <span class="hljs-comment">;   &#125; // starts at 140001510</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001515</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">r8</span>, <span class="hljs-built_in">cs</span>:_refptr__ZNSt11logic_errorD1Ev <span class="hljs-comment">; void (*)(void *)</span><br><span class="hljs-symbol">.text:</span>000000014000151C                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rax</span>, _ZTISt11logic_error <span class="hljs-comment">; `typeinfo for&#x27;std::logic_error</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001523</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rdx</span>, <span class="hljs-built_in">rax</span>        <span class="hljs-comment">; lptinfo</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001526</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rcx</span>, <span class="hljs-built_in">rbx</span>        <span class="hljs-comment">; void *</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001529</span> <span class="hljs-comment">;   try &#123;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001529</span>                 <span class="hljs-keyword">call</span>    __cxa_throw<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001529</span> <span class="hljs-comment">;   &#125; // starts at 140001529</span><br><span class="hljs-symbol">.text:</span>000000014000152E <span class="hljs-comment">; ---------------------------------------------------------------------------</span><br><span class="hljs-symbol">.text:</span>000000014000152E <span class="hljs-comment">;   cleanup() // owned by 140001510</span><br><span class="hljs-symbol">.text:</span>000000014000152E                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rsi</span>, <span class="hljs-built_in">rax</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001531</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rcx</span>, <span class="hljs-built_in">rbx</span>        <span class="hljs-comment">; void *</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001534</span>                 <span class="hljs-keyword">call</span>    __cxa_free_exception<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001539</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rax</span>, <span class="hljs-built_in">rsi</span><br><span class="hljs-symbol">.text:</span>000000014000153C                 <span class="hljs-keyword">jmp</span>     short $+<span class="hljs-number">2</span><br><span class="hljs-symbol">.text:</span>000000014000153E <span class="hljs-comment">; ---------------------------------------------------------------------------</span><br><span class="hljs-symbol">.text:</span>000000014000153E<br><span class="hljs-symbol">.text:</span>000000014000153E loc_14000153E:                          <span class="hljs-comment">; CODE XREF: solve(void)+66↑j</span><br><span class="hljs-symbol">.text:</span>000000014000153E <span class="hljs-comment">;   catch(...) // owned by 1400014F1    ; void *</span><br><span class="hljs-symbol">.text:</span>000000014000153E <span class="hljs-comment">;   catch(...) // owned by 140001529</span><br><span class="hljs-symbol">.text:</span>000000014000153E                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rcx</span>, <span class="hljs-built_in">rax</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001541</span>                 <span class="hljs-keyword">call</span>    __cxa_begin_catch<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001546</span>                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rax</span>, enc        <span class="hljs-comment">; &quot;zbrpgs&#123;F4z3_Ge1px_jvgu_@sybjre_qrfhjn&#125;&quot;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">000000014000154D</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rcx</span>, <span class="hljs-built_in">rax</span>        <span class="hljs-comment">; Str</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001550</span>                 <span class="hljs-keyword">call</span>    strlen<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001555</span>                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+length], <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001558</span>                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+count], <span class="hljs-number">0</span><br><span class="hljs-symbol">.text:</span>000000014000155F                 <span class="hljs-keyword">jmp</span>     loc_14000160E<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001564</span> <span class="hljs-comment">; ---------------------------------------------------------------------------</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001564</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001564</span> loc_140001564:                          <span class="hljs-comment">; CODE XREF: solve(void)+13E↓j</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001564</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+count]<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001567</span>                 <span class="hljs-keyword">cdqe</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001569</span>                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdx</span>, enc        <span class="hljs-comment">; &quot;zbrpgs&#123;F4z3_Ge1px_jvgu_@sybjre_qrfhjn&#125;&quot;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001570</span>                 <span class="hljs-keyword">movzx</span>   <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">byte</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">rax</span>+<span class="hljs-built_in">rdx</span>]<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001574</span>                 <span class="hljs-keyword">movzx</span>   <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">al</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001577</span>                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+C], <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span>000000014000157A                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+C]<br><span class="hljs-symbol">.text:</span><span class="hljs-number">000000014000157D</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-built_in">eax</span>        <span class="hljs-comment">; C</span><br><span class="hljs-symbol">.text:</span>000000014000157F                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rax</span>, <span class="hljs-built_in">cs</span>:__imp_islower<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001586</span>                 <span class="hljs-keyword">call</span>    <span class="hljs-built_in">rax</span> <span class="hljs-comment">; __imp_islower ; 判断字母大小写</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001588</span>                 <span class="hljs-keyword">test</span>    <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span>000000014000158A                 <span class="hljs-keyword">jz</span>      short loc_1400015B9 <span class="hljs-comment">; 大写字母跳转</span><br><span class="hljs-symbol">.text:</span>000000014000158C                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+C] <span class="hljs-comment">; enc[count]</span><br><span class="hljs-symbol">.text:</span>000000014000158F                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">edx</span>, [<span class="hljs-built_in">rax</span>-<span class="hljs-number">54h</span>]  <span class="hljs-comment">; enc[count]-0x54</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001592</span>                 <span class="hljs-keyword">movsxd</span>  <span class="hljs-built_in">rax</span>, <span class="hljs-built_in">edx</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001595</span>                 <span class="hljs-keyword">imul</span>    <span class="hljs-built_in">rax</span>, <span class="hljs-number">4EC4EC4Fh</span>  <span class="hljs-comment">; 从这里开始</span><br><span class="hljs-symbol">.text:</span>000000014000159C                 <span class="hljs-keyword">shr</span>     <span class="hljs-built_in">rax</span>, <span class="hljs-number">20h</span><br><span class="hljs-symbol">.text:</span>00000001400015A0                 <span class="hljs-keyword">sar</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-number">3</span><br><span class="hljs-symbol">.text:</span>00000001400015A3                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-built_in">edx</span><br><span class="hljs-symbol">.text:</span>00000001400015A5                 <span class="hljs-keyword">sar</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-number">1Fh</span><br><span class="hljs-symbol">.text:</span>00000001400015A8                 <span class="hljs-keyword">sub</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">ecx</span><br><span class="hljs-symbol">.text:</span>00000001400015AA                 <span class="hljs-keyword">imul</span>    <span class="hljs-built_in">ecx</span>, <span class="hljs-built_in">eax</span>, <span class="hljs-number">1Ah</span><br><span class="hljs-symbol">.text:</span>00000001400015AD                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">edx</span><br><span class="hljs-symbol">.text:</span>00000001400015AF                 <span class="hljs-keyword">sub</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">ecx</span>        <span class="hljs-comment">; 到这里结束，实现的是除以26</span><br><span class="hljs-symbol">.text:</span>00000001400015B1                 <span class="hljs-keyword">add</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-number">61h</span> <span class="hljs-comment">; &#x27;a&#x27;  ; 加上0x61</span><br><span class="hljs-symbol">.text:</span>00000001400015B4                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+C], <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span>00000001400015B7                 <span class="hljs-keyword">jmp</span>     short loc_1400015F6<br><span class="hljs-symbol">.text:</span>00000001400015B9 <span class="hljs-comment">; ---------------------------------------------------------------------------</span><br><span class="hljs-symbol">.text:</span>00000001400015B9<br><span class="hljs-symbol">.text:</span>00000001400015B9 loc_1400015B9:                          <span class="hljs-comment">; CODE XREF: solve(void)+B4↑j</span><br><span class="hljs-symbol">.text:</span>00000001400015B9                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+C]<br><span class="hljs-symbol">.text:</span>00000001400015BC                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-built_in">eax</span>        <span class="hljs-comment">; C</span><br><span class="hljs-symbol">.text:</span>00000001400015BE                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rax</span>, <span class="hljs-built_in">cs</span>:__imp_isupper<br><span class="hljs-symbol">.text:</span>00000001400015C5                 <span class="hljs-keyword">call</span>    <span class="hljs-built_in">rax</span> <span class="hljs-comment">; __imp_isupper ; 判断字母大小写</span><br><span class="hljs-symbol">.text:</span>00000001400015C7                 <span class="hljs-keyword">test</span>    <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span>00000001400015C9                 <span class="hljs-keyword">jz</span>      short loc_1400015F6 <span class="hljs-comment">; 非字母跳转</span><br><span class="hljs-symbol">.text:</span>00000001400015CB                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+C] <span class="hljs-comment">; enc[count]</span><br><span class="hljs-symbol">.text:</span>00000001400015CE                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">edx</span>, [<span class="hljs-built_in">rax</span>-<span class="hljs-number">34h</span>]  <span class="hljs-comment">; enc[count]-0x34</span><br><span class="hljs-symbol">.text:</span>00000001400015D1                 <span class="hljs-keyword">movsxd</span>  <span class="hljs-built_in">rax</span>, <span class="hljs-built_in">edx</span><br><span class="hljs-symbol">.text:</span>00000001400015D4                 <span class="hljs-keyword">imul</span>    <span class="hljs-built_in">rax</span>, <span class="hljs-number">4EC4EC4Fh</span>  <span class="hljs-comment">; 从这里开始</span><br><span class="hljs-symbol">.text:</span>00000001400015<span class="hljs-built_in">DB</span>                 <span class="hljs-keyword">shr</span>     <span class="hljs-built_in">rax</span>, <span class="hljs-number">20h</span><br><span class="hljs-symbol">.text:</span>00000001400015DF                 <span class="hljs-keyword">sar</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-number">3</span><br><span class="hljs-symbol">.text:</span>00000001400015E2                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-built_in">edx</span><br><span class="hljs-symbol">.text:</span>00000001400015E4                 <span class="hljs-keyword">sar</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-number">1Fh</span><br><span class="hljs-symbol">.text:</span>00000001400015E7                 <span class="hljs-keyword">sub</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">ecx</span><br><span class="hljs-symbol">.text:</span>00000001400015E9                 <span class="hljs-keyword">imul</span>    <span class="hljs-built_in">ecx</span>, <span class="hljs-built_in">eax</span>, <span class="hljs-number">1Ah</span><br><span class="hljs-symbol">.text:</span>00000001400015EC                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">edx</span><br><span class="hljs-symbol">.text:</span>00000001400015EE                 <span class="hljs-keyword">sub</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">ecx</span>        <span class="hljs-comment">; 到这里结束，实现的是除以26</span><br><span class="hljs-symbol">.text:</span>00000001400015F0                 <span class="hljs-keyword">add</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-number">41h</span> <span class="hljs-comment">; &#x27;A&#x27;  ; 加上0x41</span><br><span class="hljs-symbol">.text:</span>00000001400015F3                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+C], <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span>00000001400015F6<br><span class="hljs-symbol">.text:</span>00000001400015F6 loc_1400015F6:                          <span class="hljs-comment">; CODE XREF: solve(void)+E1↑j</span><br><span class="hljs-symbol">.text:</span>00000001400015F6                                         <span class="hljs-comment">; solve(void)+F3↑j</span><br><span class="hljs-symbol">.text:</span>00000001400015F6                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+C]<br><span class="hljs-symbol">.text:</span>00000001400015F9                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-built_in">eax</span><br><span class="hljs-symbol">.text:</span>00000001400015FB                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+count]<br><span class="hljs-symbol">.text:</span>00000001400015FE                 <span class="hljs-keyword">cdqe</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001600</span>                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rdx</span>, enc        <span class="hljs-comment">; &quot;zbrpgs&#123;F4z3_Ge1px_jvgu_@sybjre_qrfhjn&#125;&quot;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001607</span>                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rax</span>+<span class="hljs-built_in">rdx</span>], <span class="hljs-built_in">cl</span><br><span class="hljs-symbol">.text:</span>000000014000160A                 <span class="hljs-keyword">add</span>     [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+count], <span class="hljs-number">1</span><br><span class="hljs-symbol">.text:</span>000000014000160E<br><span class="hljs-symbol">.text:</span>000000014000160E loc_14000160E:                          <span class="hljs-comment">; CODE XREF: solve(void)+89↑j</span><br><span class="hljs-symbol">.text:</span>000000014000160E                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+count]<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001611</span>                 <span class="hljs-keyword">cmp</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">rbp</span>+<span class="hljs-number">10h</span>+length]<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001614</span>                 <span class="hljs-keyword">jl</span>      loc_140001564<br><span class="hljs-symbol">.text:</span>000000014000161A                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rax</span>, aSoYouDidnTCatc <span class="hljs-comment">; &quot;so you didn&#x27;t catch me?\n&quot;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001621</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rcx</span>, <span class="hljs-built_in">rax</span>        <span class="hljs-comment">; char *</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001624</span> <span class="hljs-comment">;   try &#123;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001624</span>                 <span class="hljs-keyword">call</span>    print<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001624</span> <span class="hljs-comment">;   &#125; // starts at 140001624</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001629</span>                 <span class="hljs-keyword">call</span>    __cxa_end_catch<br><span class="hljs-symbol">.text:</span>000000014000162E                 <span class="hljs-keyword">jmp</span>     short loc_140001644<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001630</span> <span class="hljs-comment">; ---------------------------------------------------------------------------</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001630</span> <span class="hljs-comment">;   cleanup() // owned by 140001624</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001630</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rbx</span>, <span class="hljs-built_in">rax</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001633</span>                 <span class="hljs-keyword">call</span>    __cxa_end_catch<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001638</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rax</span>, <span class="hljs-built_in">rbx</span><br><span class="hljs-symbol">.text:</span>000000014000163B                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rcx</span>, <span class="hljs-built_in">rax</span>        <span class="hljs-comment">; gcc_exc</span><br><span class="hljs-symbol">.text:</span>000000014000163E                 <span class="hljs-keyword">call</span>    _Unwind_Resume<br><span class="hljs-symbol">.text:</span>000000014000163E <span class="hljs-comment">; ---------------------------------------------------------------------------</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001643</span>                 <span class="hljs-meta">align</span> <span class="hljs-number">4</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001644</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001644</span> loc_140001644:                          <span class="hljs-comment">; CODE XREF: solve(void)+158↑j</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001644</span>                 <span class="hljs-keyword">add</span>     <span class="hljs-built_in">rsp</span>, <span class="hljs-number">30h</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001648</span>                 <span class="hljs-keyword">pop</span>     <span class="hljs-built_in">rbx</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000140001649</span>                 <span class="hljs-keyword">pop</span>     <span class="hljs-built_in">rsi</span><br><span class="hljs-symbol">.text:</span>000000014000164A                 <span class="hljs-keyword">pop</span>     <span class="hljs-built_in">rbp</span><br><span class="hljs-symbol">.text:</span>000000014000164B                 <span class="hljs-keyword">retn</span><br><span class="hljs-symbol">.text:</span>000000014000164B <span class="hljs-comment">; &#125; // starts at 1400014D6</span><br><span class="hljs-symbol">.text:</span>000000014000164B _Z5solvev       endp<br></code></pre></td></tr></table></figure>
</li>
<li><p>解密脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode</span>(<span class="hljs-params">s</span>):<br>    result = []<br>    <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> s:<br>        <span class="hljs-comment">#小写字母</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;a&#x27;</span> &lt;= char &lt;= <span class="hljs-string">&#x27;z&#x27;</span>:<br>            new_char = <span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(char) - <span class="hljs-number">0x54</span>) % <span class="hljs-number">26</span> + <span class="hljs-number">0x61</span>)<br>            result.append(new_char)<br>        <span class="hljs-comment">#大写字母</span><br>        <span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;A&#x27;</span> &lt;= char &lt;= <span class="hljs-string">&#x27;Z&#x27;</span>:<br>            new_char = <span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(char) - <span class="hljs-number">0x34</span>) % <span class="hljs-number">26</span> + <span class="hljs-number">0x41</span>)<br>            result.append(new_char)<br>        <span class="hljs-comment">#非字母</span><br>        <span class="hljs-keyword">else</span>:<br>            result.append(char)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(result)<br><br>enc = <span class="hljs-string">&quot;zbrpgs&#123;F4z3_Ge1px_jvgu_@sybjre_qrfhjn&#125;&quot;</span><br>flag = decode(enc)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="upx-revenge"><a href="#upx-revenge" class="headerlink" title="upx_revenge"></a>upx_revenge</h3><ul>
<li><p>附件程序运行不了，如图：</p>
<p><img src="/../images/image-20251003124237857-1760193218429-23.png" alt="运行报错"></p>
<p>题目提示upx特征段魔改，但是自己尝试后发现魔改特征段不会导致程序运行不了</p>
<p>后来琢磨了半天，拷打<del>(bushi</del>了一下出题人，才发现这个程序缺了bytes（看了官方WriteUp，发现这确实是一个考点😭，我真傻，真的，我单知道upx魔改会改特征段数据，我不知道还可以删数据😭）</p>
<p><img src="/../images/image-20251003124409938-1760193218429-22.png" alt="这是week1_upx的结尾"></p>
<p><img src="/../images/image-20251003124456921-1760193218429-21.png" alt="这是本题程序的结尾"></p>
<p>缺少的地方在upx特征段，可以发现upx1段开头的四个字节错位了，错位到upx特征段上了，所以要给特征段插入四个字节</p>
<p><img src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-03%20124610-1760193218429-24.png" alt="这是week1_upx的特征段"></p>
<p><img src="/../images/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-10-03%20124713-1760193218429-26.png" alt="这是本题程序的特征段"></p>
<p>用010editor在49 01 00 C3后面按Ctrl+shift+I插入4bytes（默认填充为0），会发现程序可以运行了</p>
<p><img src="/../images/image-20251003125528890-1760193218429-25.png" alt="插入4字节"></p>
<p><img src="/../images/image-20251003125621022-1760193218429-29.png" alt="程序可以运行了"></p>
</li>
<li><p>采用手动脱壳的办法。具体操作可以参考week1_upx的解法或者看看<a href="http://sydzi.github.io/2025/07/29/Day9-%E5%A3%B3/">Day9:壳与脱壳（一）</a>和<a href="http://sydzi.github.io/2025/07/30/Day10-%E5%A3%B3%E4%B8%8E%E8%84%B1%E5%A3%B3%EF%BC%88%E4%BA%8C%EF%BC%89/">Day10:壳与脱壳（二）</a><del>（王婆卖瓜这一块</del>，这里从找到OEP开始：</p>
<p><img src="/../images/image-20251003131740100-1760193218429-28.png" alt="OEP"></p>
<p>下断点F9运行到上图这个大跳，然后F7步入</p>
<p><img src="/../images/image-20251003131847409-1760193218429-31.png" alt="OEP位置"></p>
<p>RIP指向此处时，打开scylla进行转储和IAT重建修复转储。这里需要注意，IAT搜索出来的结果里有一个损坏的导入，需要把它删掉</p>
<p><img src="/../images/image-20251003132216493-1760193218429-27.png" alt="删除无效导入结点"></p>
<p>脱壳后的_dump_SCY.exe文件就可以用IDA打开正常分析了</p>
</li>
<li><p>首先查看字符串表，可以发现可疑的的提示”correct”</p>
<p><img src="/../images/image-20251003132623642-1760193218429-30.png" alt="可疑的提示"></p>
</li>
<li><p>跟踪correct可以找到main函数。下面是优化后的main函数和相关的函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// Hidden C++ exception states: #wind=5</span><br><span class="hljs-function"><span class="hljs-type">int</span> __fastcall <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  __int64 v3; <span class="hljs-comment">// rax</span><br>  __int64 v4; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">unsigned</span> __int8 v5; <span class="hljs-comment">// al</span><br>  __int64 v6; <span class="hljs-comment">// r8</span><br>  <span class="hljs-type">void</span> **v7; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">void</span> **v8; <span class="hljs-comment">// rsi</span><br>  <span class="hljs-type">size_t</span> length; <span class="hljs-comment">// rdi</span><br>  <span class="hljs-type">void</span> *v10; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">void</span> *v11; <span class="hljs-comment">// rcx</span><br>  _QWORD *newBuffer; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> *v13; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">char</span> *enc; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> *v15; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">void</span> **encryptedFlag; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">int</span> v17; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> *outString; <span class="hljs-comment">// rdx</span><br>  __int64 v19; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">void</span> *v20; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">void</span> *v21; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">void</span> *v22; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">void</span> *v23; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">void</span> *CopiedFlag[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+28h] [rbp-51h] BYREF</span><br>  <span class="hljs-type">char</span> *bufferEnd; <span class="hljs-comment">// [rsp+38h] [rbp-41h]</span><br>  <span class="hljs-type">void</span> *flag[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-39h] BYREF</span><br>  __m128i si128; <span class="hljs-comment">// [rsp+50h] [rbp-29h]</span><br>  <span class="hljs-type">void</span> *encodeResult[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+60h] [rbp-19h] BYREF</span><br>  <span class="hljs-type">size_t</span> Size; <span class="hljs-comment">// [rsp+70h] [rbp-9h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v31; <span class="hljs-comment">// [rsp+78h] [rbp-1h]</span><br>  <span class="hljs-type">void</span> *modifiedBaseTable[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+80h] [rbp+7h] BYREF</span><br>  __m128i v33; <span class="hljs-comment">// [rsp+90h] [rbp+17h]</span><br>  __int128 v34; <span class="hljs-comment">// [rsp+A0h] [rbp+27h]</span><br>  __int64 v35; <span class="hljs-comment">// [rsp+B0h] [rbp+37h]</span><br>  __int64 v36; <span class="hljs-comment">// [rsp+B8h] [rbp+3Fh]</span><br><br>  v3 = <span class="hljs-built_in">output</span>(std::cout, pleaseEnterYourFlag);<br>  std::istream::<span class="hljs-keyword">operator</span>&gt;&gt;(v3, out_flush);<br>  *flag = <span class="hljs-number">0LL</span>;<br>  si128 = _mm_load_si128(&amp;xmmword_7FF7420B44B0);<br>  <span class="hljs-built_in">LOBYTE</span>(flag[<span class="hljs-number">0</span>]) = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">LOBYTE</span>(v4) = <span class="hljs-number">10</span>;<br>  v5 = std::ios::<span class="hljs-built_in">widen</span>(&amp;std::cin + *(std::cin + <span class="hljs-number">4LL</span>), v4);<br>  <span class="hljs-built_in">input</span>(std::cin, flag, v5);<br>  v7 = flag;<br>  <span class="hljs-keyword">if</span> ( si<span class="hljs-number">128.</span>m128i_i64[<span class="hljs-number">1</span>] &gt; <span class="hljs-number">0xFuLL</span> )            <span class="hljs-comment">// si128.m128i_i64[1]是输入的flag的长度</span><br>    v7 = flag[<span class="hljs-number">0</span>];<br>  v8 = flag;<br>  <span class="hljs-keyword">if</span> ( si<span class="hljs-number">128.</span>m128i_i64[<span class="hljs-number">1</span>] &gt; <span class="hljs-number">0xFuLL</span> )<br>    v8 = flag[<span class="hljs-number">0</span>];<br>  *CopiedFlag = <span class="hljs-number">0LL</span>;<br>  bufferEnd = <span class="hljs-number">0LL</span>;<br>  length = v7 + si<span class="hljs-number">128.</span>m128i_i64[<span class="hljs-number">0</span>] - v8;<br>  <span class="hljs-keyword">if</span> ( length )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( length &gt; <span class="hljs-number">0x7FFFFFFFFFFFFFFFLL</span> )<br>      <span class="hljs-built_in">lengthError</span>();<br>    <span class="hljs-keyword">if</span> ( length &lt; <span class="hljs-number">0x1000</span> )<br>    &#123;<br>      newBuffer = <span class="hljs-keyword">operator</span> <span class="hljs-built_in">new</span>(length);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-keyword">if</span> ( length + <span class="hljs-number">39</span> &lt; length )<br>        <span class="hljs-built_in">sub_7FF7420B1170</span>();<br>      v10 = <span class="hljs-keyword">operator</span> <span class="hljs-built_in">new</span>(length + <span class="hljs-number">39</span>);<br>      v11 = v10;<br>      <span class="hljs-keyword">if</span> ( !v10 )<br>LABEL_31:<br>        <span class="hljs-built_in">invalid_parameter_noinfo_noreturn</span>();<br>      newBuffer = ((v10 + <span class="hljs-number">39</span>) &amp; <span class="hljs-number">0xFFFFFFFFFFFFFFE0uLL</span>);<br>      *(newBuffer - <span class="hljs-number">1</span>) = v11;<br>    &#125;<br>    CopiedFlag[<span class="hljs-number">0</span>] = newBuffer;<br>    v13 = newBuffer + length;<br>    bufferEnd = newBuffer + length;<br>    <span class="hljs-built_in">memmove</span>(newBuffer, v8, length);<br>    CopiedFlag[<span class="hljs-number">1</span>] = v13;<br>  &#125;<br>  <span class="hljs-built_in">XORencrypt</span>(modifiedBaseTable, v7, v6);        <span class="hljs-comment">// 魔改base64的编码表</span><br>  <span class="hljs-built_in">baseEncode</span>(encodeResult, CopiedFlag, modifiedBaseTable);<span class="hljs-comment">// base64编码</span><br>  v34 = <span class="hljs-number">0LL</span>;<br>  enc = <span class="hljs-keyword">operator</span> <span class="hljs-built_in">new</span>(<span class="hljs-number">0x30uLL</span>);<br>  v15 = enc;<br>  *&amp;v34 = enc;<br>  v35 = <span class="hljs-number">44LL</span>;<br>  v36 = <span class="hljs-number">47LL</span>;<br>  <span class="hljs-built_in">strcpy</span>(enc, <span class="hljs-string">&quot;lY7bW=\\ck?eyjX7]TZ\\&#125;CVbh\\tOyTH6&gt;jH7XmFifG]H7&quot;</span>);<br>  encryptedFlag = encodeResult;<br>  <span class="hljs-keyword">if</span> ( v31 &gt; <span class="hljs-number">0xF</span> )<br>    encryptedFlag = encodeResult[<span class="hljs-number">0</span>];<br>  <span class="hljs-keyword">if</span> ( Size != <span class="hljs-number">44</span> || (v17 = <span class="hljs-built_in">memcmp</span>(encryptedFlag, enc, <span class="hljs-number">0x2CuLL</span>), outString = aCorrect, v17) )<br>    outString = aWrong;<br>  v19 = <span class="hljs-built_in">output</span>(std::cout, outString);<br>  std::istream::<span class="hljs-keyword">operator</span>&gt;&gt;(v19, out_flush);<br>  <span class="hljs-built_in">j_j_free</span>(v15);<br>  <span class="hljs-keyword">if</span> ( v31 &gt; <span class="hljs-number">0xF</span> )<br>  &#123;<br>    v20 = encodeResult[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">if</span> ( v31 + <span class="hljs-number">1</span> &gt;= <span class="hljs-number">0x1000</span> )<br>    &#123;<br>      v20 = *(encodeResult[<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>);<br>      <span class="hljs-keyword">if</span> ( (encodeResult[<span class="hljs-number">0</span>] - v20 - <span class="hljs-number">8</span>) &gt; <span class="hljs-number">0x1F</span> )<br>        <span class="hljs-built_in">invalid_parameter_noinfo_noreturn</span>();<br>    &#125;<br>    <span class="hljs-built_in">j_j_free</span>(v20);<br>  &#125;<br>  Size = <span class="hljs-number">0LL</span>;<br>  v31 = <span class="hljs-number">15LL</span>;<br>  <span class="hljs-built_in">LOBYTE</span>(encodeResult[<span class="hljs-number">0</span>]) = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> ( v<span class="hljs-number">33.</span>m128i_i64[<span class="hljs-number">1</span>] &gt; <span class="hljs-number">0xFuLL</span> )<br>  &#123;<br>    v21 = modifiedBaseTable[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">if</span> ( (v<span class="hljs-number">33.</span>m128i_i64[<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>) &gt;= <span class="hljs-number">0x1000</span> )<br>    &#123;<br>      v21 = *(modifiedBaseTable[<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>);<br>      <span class="hljs-keyword">if</span> ( (modifiedBaseTable[<span class="hljs-number">0</span>] - v21 - <span class="hljs-number">8</span>) &gt; <span class="hljs-number">0x1F</span> )<br>        <span class="hljs-built_in">invalid_parameter_noinfo_noreturn</span>();<br>    &#125;<br>    <span class="hljs-built_in">j_j_free</span>(v21);<br>  &#125;<br>  v33 = _mm_load_si128(&amp;xmmword_7FF7420B44B0);<br>  <span class="hljs-built_in">LOBYTE</span>(modifiedBaseTable[<span class="hljs-number">0</span>]) = <span class="hljs-number">0</span>;<br>  v22 = CopiedFlag[<span class="hljs-number">0</span>];<br>  <span class="hljs-keyword">if</span> ( CopiedFlag[<span class="hljs-number">0</span>] )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( (bufferEnd - CopiedFlag[<span class="hljs-number">0</span>]) &gt;= <span class="hljs-number">0x1000</span> )<br>    &#123;<br>      v22 = *(CopiedFlag[<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>);<br>      <span class="hljs-keyword">if</span> ( (CopiedFlag[<span class="hljs-number">0</span>] - v22 - <span class="hljs-number">8</span>) &gt; <span class="hljs-number">0x1F</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_31;<br>    &#125;<br>    <span class="hljs-built_in">j_j_free</span>(v22);<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( si<span class="hljs-number">128.</span>m128i_i64[<span class="hljs-number">1</span>] &gt; <span class="hljs-number">0xFuLL</span> )<br>  &#123;<br>    v23 = flag[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">if</span> ( (si<span class="hljs-number">128.</span>m128i_i64[<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>) &gt;= <span class="hljs-number">0x1000</span> )<br>    &#123;<br>      v23 = *(flag[<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>);<br>      <span class="hljs-keyword">if</span> ( (flag[<span class="hljs-number">0</span>] - v23 - <span class="hljs-number">8</span>) &gt; <span class="hljs-number">0x1F</span> )<br>        <span class="hljs-built_in">invalid_parameter_noinfo_noreturn</span>();<br>    &#125;<br>    <span class="hljs-built_in">j_j_free</span>(v23);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// Hidden C++ exception states: #wind=5</span><br><span class="hljs-function">_QWORD *__fastcall <span class="hljs-title">XORencrypt</span><span class="hljs-params">(_QWORD *modifiedTable, __int64 a2, __int64 a3)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">void</span> **pTableStart; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">void</span> **pCurrentPos; <span class="hljs-comment">// rdi</span><br>  <span class="hljs-type">void</span> **i; <span class="hljs-comment">// rsi</span><br>  <span class="hljs-type">char</span> xored; <span class="hljs-comment">// r9</span><br>  <span class="hljs-type">unsigned</span> __int64 cucrrentSize; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">unsigned</span> __int64 capacity; <span class="hljs-comment">// rdx</span><br>  _QWORD *Table; <span class="hljs-comment">// rax</span><br><br>  *modifiedTable = <span class="hljs-number">0LL</span>;<br>  modifiedTable[<span class="hljs-number">2</span>] = <span class="hljs-number">0LL</span>;<br>  modifiedTable[<span class="hljs-number">3</span>] = <span class="hljs-number">15LL</span>;<br>  *modifiedTable = <span class="hljs-number">0</span>;<br>  pTableStart = &amp;oriTable;<br>  pCurrentPos = &amp;oriTable;<br>  <span class="hljs-keyword">if</span> ( *(&amp;xmmword_7FF7420B6760 + <span class="hljs-number">1</span>) &gt; <span class="hljs-number">0xFuLL</span> )<br>  &#123;<br>    pCurrentPos = oriTable;                     <span class="hljs-comment">// oriTable是原始的base64编码表</span><br>    pTableStart = oriTable;<br>  &#125;<br>  <span class="hljs-keyword">for</span> ( i = (pTableStart + xmmword_7FF7420B6760); pCurrentPos != i; pCurrentPos = (pCurrentPos + <span class="hljs-number">1</span>) )<br>  &#123;<br>    xored = *pCurrentPos ^ <span class="hljs-number">0xE</span>;                 <span class="hljs-comment">// 遍历Table并异或0xE，创建一个魔改的编码表</span><br>    cucrrentSize = modifiedTable[<span class="hljs-number">2</span>];<br>    capacity = modifiedTable[<span class="hljs-number">3</span>];<br>    <span class="hljs-keyword">if</span> ( cucrrentSize &gt;= capacity )<br>    &#123;<br>      <span class="hljs-built_in">needExpand</span>(modifiedTable, capacity, a3, xored);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      modifiedTable[<span class="hljs-number">2</span>] = cucrrentSize + <span class="hljs-number">1</span>;      <span class="hljs-comment">// 此处开始写入xor处理后的table字符</span><br>      Table = modifiedTable;<br>      <span class="hljs-keyword">if</span> ( capacity &gt; <span class="hljs-number">0xF</span> )<br>        Table = *modifiedTable;<br>      *(Table + cucrrentSize) = xored;<br>      *(Table + cucrrentSize + <span class="hljs-number">1</span>) = <span class="hljs-number">0</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> modifiedTable;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>可以看出逻辑就是先魔改base64的编码表，然后再用魔改的编码表对flag进行base64编码，最后和给定的密文比较。可以先对enc进行异或，然后再base64解码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">enc = <span class="hljs-string">&quot;lY7bW=\\ck?eyjX7]TZ\\&#125;CVbh\\tOyTH6&gt;jH7XmFifG]H7&quot;</span><br>data = <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> enc:<br>    data += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(char) ^ <span class="hljs-number">0xE</span>)<br><span class="hljs-built_in">print</span>(data)<br><span class="hljs-comment">#bW9lY3Rme1kwdV9SZTRsMXlfRzAwZF80dF9VcHghISF9</span><br></code></pre></td></tr></table></figure>

<p><img src="/../images/image-20251003134212864-1760193218429-34.png" alt="base64解码"></p>
</li>
</ul>
<h3 id="Two-cups-of-tea"><a href="#Two-cups-of-tea" class="headerlink" title="Two cups of tea"></a>Two cups of tea</h3><ul>
<li><p>反编译的代码分析优化后大概是这样：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//main函数部分</span><br><span class="hljs-function"><span class="hljs-type">int</span> __fastcall <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  __int64 n; <span class="hljs-comment">// rbx</span><br>  FILE *Stream; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">size_t</span> length; <span class="hljs-comment">// rax</span><br>  __int64 v6; <span class="hljs-comment">// rdx</span><br>  __int64 count; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> __int64 tmp4key; <span class="hljs-comment">// [rsp+20h] [rbp-E0h] BYREF</span><br>  <span class="hljs-type">char</span> key_2; <span class="hljs-comment">// [rsp+28h] [rbp-D8h]</span><br>  __int64 key_1; <span class="hljs-comment">// [rsp+30h] [rbp-D0h] BYREF</span><br>  <span class="hljs-type">int</span> key_3; <span class="hljs-comment">// [rsp+38h] [rbp-C8h]</span><br>  <span class="hljs-type">int</span> key_4; <span class="hljs-comment">// [rsp+3Ch] [rbp-C4h]</span><br>  _DWORD enc[<span class="hljs-number">10</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-C0h]</span><br>  _OWORD flag[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+68h] [rbp-98h] BYREF</span><br>  __int64 v16; <span class="hljs-comment">// [rsp+88h] [rbp-78h]</span><br>  <span class="hljs-type">char</span> Buffer[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+90h] [rbp-70h] BYREF</span><br>  __int128 v18; <span class="hljs-comment">// [rsp+A0h] [rbp-60h]</span><br>  __int64 v19; <span class="hljs-comment">// [rsp+B0h] [rbp-50h]</span><br><br>  n = <span class="hljs-number">0LL</span>;<br>  key_1 = <span class="hljs-number">2LL</span>;<br>  key_2 = <span class="hljs-number">0</span>;<br>  key_3 = <span class="hljs-number">2</span>;<br>  key_4 = <span class="hljs-number">5</span>;<br>  enc[<span class="hljs-number">0</span>] = <span class="hljs-number">0x5D624C34</span>;<br>  enc[<span class="hljs-number">1</span>] = <span class="hljs-number">0x8629FEAD</span>;<br>  enc[<span class="hljs-number">2</span>] = <span class="hljs-number">0x9D11379B</span>;<br>  enc[<span class="hljs-number">3</span>] = <span class="hljs-number">0xFCD53211</span>;<br>  enc[<span class="hljs-number">4</span>] = <span class="hljs-number">0x460F63CE</span>;<br>  enc[<span class="hljs-number">5</span>] = <span class="hljs-number">0xC5816E68</span>;<br>  enc[<span class="hljs-number">6</span>] = <span class="hljs-number">0xFE5300AD</span>;<br>  enc[<span class="hljs-number">7</span>] = <span class="hljs-number">0xA0015EE</span>;<br>  enc[<span class="hljs-number">8</span>] = <span class="hljs-number">0x9806DBBB</span>;<br>  enc[<span class="hljs-number">9</span>] = <span class="hljs-number">0xEF4A2648</span>;<br>  tmp4key = <span class="hljs-number">0xD0FCC6A7B8941CAFuLL</span>;<br>  <span class="hljs-built_in">key_init</span>(*&amp;argc, &amp;tmp4key, &amp;key_1);<span class="hljs-comment">// 这里初始化了key,不必理会具体实现，可以动调得到结果</span><br>  <span class="hljs-built_in">printf</span>(&amp;pleaseEnterYourFlag);<br>  Stream = _acrt_iob_func(<span class="hljs-number">0</span>);<br>  <span class="hljs-built_in">fgets</span>(Buffer, <span class="hljs-number">100</span>, Stream);<br>  length = <span class="hljs-built_in">strcspn</span>(Buffer, <span class="hljs-string">&quot;\n&quot;</span>);<span class="hljs-comment">// 获取flag的长度</span><br>  <span class="hljs-keyword">if</span> ( length &gt;= <span class="hljs-number">0x64</span> )<br>    _report_securityfailure_();<br>  Buffer[length] = <span class="hljs-number">0</span>;<br>  flag[<span class="hljs-number">0</span>] = *Buffer;<br>  key_1 = tmp4key;<br>  v16 = v19;<br>  flag[<span class="hljs-number">1</span>] = v18;<br>  key_3 = <span class="hljs-number">0x12345678</span>;<br>  key_4 = <span class="hljs-number">0x9ABCDEF0</span>;<br>  <span class="hljs-built_in">modefiedTea</span>(flag, v6, &amp;key_1);<span class="hljs-comment">// 魔改的tea，加密flag以便比对验证</span><br>  count = <span class="hljs-number">-1LL</span>;<br>  <span class="hljs-keyword">do</span><br>    ++count;<br>  <span class="hljs-keyword">while</span> ( Buffer[count] );<span class="hljs-comment">// 确认flag长度</span><br>  <span class="hljs-keyword">if</span> ( count == <span class="hljs-number">40</span> )<br>  &#123;<br>    <span class="hljs-keyword">while</span> ( *(flag + n * <span class="hljs-number">4</span>) == enc[n] )<span class="hljs-comment">// 比对验证</span><br>    &#123;<br>      <span class="hljs-keyword">if</span> ( ++n &gt;= <span class="hljs-number">10</span> )<br>      &#123;<br>        <span class="hljs-built_in">printf</span>(right);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>      &#125;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(wrong);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">printf</span>(Format_0);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><br><span class="hljs-comment">//魔改tea部分</span><br><span class="hljs-function">__int64 __fastcall <span class="hljs-title">modefiedTea</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *flag, __int64 a2, __int64 key)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_9; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> delta; <span class="hljs-comment">// r11d</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_eight; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_1; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_2; <span class="hljs-comment">// ebp</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_3; <span class="hljs-comment">// r14d</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_4; <span class="hljs-comment">// r15d</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_5; <span class="hljs-comment">// r12d</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_6; <span class="hljs-comment">// r13d</span><br>  <span class="hljs-type">int</span> flag_o; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_7; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">int</span> key_0; <span class="hljs-comment">// edi</span><br>  <span class="hljs-type">int</span> key_1; <span class="hljs-comment">// ebx</span><br>  __int64 key_3; <span class="hljs-comment">// r10</span><br>  <span class="hljs-type">int</span> key_2; <span class="hljs-comment">// r11d</span><br>  <span class="hljs-type">int</span> v18; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">bool</span> Count; <span class="hljs-comment">// zf</span><br>  __int64 flag_seven; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_0; <span class="hljs-comment">// [rsp+0h] [rbp-58h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_nine; <span class="hljs-comment">// [rsp+4h] [rbp-54h]</span><br>  <span class="hljs-type">int</span> count; <span class="hljs-comment">// [rsp+8h] [rbp-50h]</span><br>  <span class="hljs-type">int</span> delta_1; <span class="hljs-comment">// [rsp+68h] [rbp+10h]</span><br>  __int64 Key; <span class="hljs-comment">// [rsp+70h] [rbp+18h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flag_8; <span class="hljs-comment">// [rsp+78h] [rbp+20h]</span><br><br>  Key = key;<br>  flag_9 = flag[<span class="hljs-number">9</span>];<br>  delta = <span class="hljs-number">0</span>;<br>  flag_eight = flag[<span class="hljs-number">8</span>];<br>  flag_1 = flag[<span class="hljs-number">1</span>];<br>  flag_2 = flag[<span class="hljs-number">2</span>];<br>  flag_3 = flag[<span class="hljs-number">3</span>];<br>  flag_4 = flag[<span class="hljs-number">4</span>];<br>  flag_5 = flag[<span class="hljs-number">5</span>];<br>  flag_6 = flag[<span class="hljs-number">6</span>];<br>  flag_o = *flag;<br>  flag_7 = flag[<span class="hljs-number">7</span>];<br>  flag_8 = flag_eight;<br>  flag_nine = flag_9;<br>  count = <span class="hljs-number">11</span>;<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    delta_1 = delta - <span class="hljs-number">1640531527</span>;<br>    key_0 = *(key + <span class="hljs-number">4LL</span> * (((delta - <span class="hljs-number">1640531527</span>) &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>));<br>    flag_0 = flag_o<br>           + ((((<span class="hljs-number">16</span> * flag_9) ^ (flag_1 &gt;&gt; <span class="hljs-number">3</span>)) + ((flag_9 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_1))) ^ (((delta - <span class="hljs-number">1640531527</span>) ^ flag_1)<br>                                                                                  + (key_0 ^ flag_9)));<br>    key_1 = *(Key + <span class="hljs-number">4</span> * (((delta - <span class="hljs-number">1640531527</span>) &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span> ^ <span class="hljs-number">1LL</span>));<br>    flag_1 += ((flag_0 ^ key_1) + ((delta - <span class="hljs-number">1640531527</span>) ^ flag_2)) ^ (((<span class="hljs-number">16</span> * flag_0) ^ (flag_2 &gt;&gt; <span class="hljs-number">3</span>))<br>                                                                    + ((flag_0 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_2)));<br>    key_3 = ((delta - <span class="hljs-number">1640531527</span>) &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span> ^ <span class="hljs-number">3LL</span>;<br>    key_2 = *(Key + <span class="hljs-number">4</span> * (((delta - <span class="hljs-number">1640531527</span>) &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span> ^ <span class="hljs-number">2LL</span>));<br>    flag_2 += ((flag_1 ^ key_2) + (delta_1 ^ flag_3)) ^ (((<span class="hljs-number">16</span> * flag_1) ^ (flag_3 &gt;&gt; <span class="hljs-number">3</span>)) + ((flag_1 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_3)));<br>    flag_3 += ((delta_1 ^ flag_4) + (flag_2 ^ *(Key + <span class="hljs-number">4</span> * key_3))) ^ (((<span class="hljs-number">16</span> * flag_2) ^ (flag_4 &gt;&gt; <span class="hljs-number">3</span>))<br>                                                                    + ((flag_2 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_4)));<br>    flag_4 += ((flag_3 ^ key_0) + (delta_1 ^ flag_5)) ^ (((<span class="hljs-number">16</span> * flag_3) ^ (flag_5 &gt;&gt; <span class="hljs-number">3</span>)) + ((flag_3 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_5)));<br>    flag_5 += ((flag_4 ^ key_1) + (delta_1 ^ flag_6)) ^ (((<span class="hljs-number">16</span> * flag_4) ^ (flag_6 &gt;&gt; <span class="hljs-number">3</span>)) + ((flag_4 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_6)));<br>    v18 = (flag_5 ^ key_2) + (delta_1 ^ flag_7);<br>    delta = delta_1;<br>    flag_6 += v18 ^ (((<span class="hljs-number">16</span> * flag_5) ^ (flag_7 &gt;&gt; <span class="hljs-number">3</span>)) + ((flag_5 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_7)));<br>    flag_7 += ((flag_6 ^ *(Key + <span class="hljs-number">4</span> * key_3)) + (delta_1 ^ flag_8)) ^ (((<span class="hljs-number">16</span> * flag_6) ^ (flag_8 &gt;&gt; <span class="hljs-number">3</span>))<br>                                                                    + ((flag_6 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_8)));<br>    flag_8 += ((flag_7 ^ key_0) + (delta_1 ^ flag_nine)) ^ (((<span class="hljs-number">16</span> * flag_7) ^ (flag_nine &gt;&gt; <span class="hljs-number">3</span>))<br>                                                          + ((flag_7 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_nine)));<br>    flag_9 = (((flag_8 ^ key_1) + (delta_1 ^ flag_0)) ^ (((<span class="hljs-number">16</span> * flag_8) ^ (flag_0 &gt;&gt; <span class="hljs-number">3</span>)) + ((flag_8 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag_0))))<br>           + flag_nine;<br>    key = Key;<br>    Count = count-- == <span class="hljs-number">1</span>;<br>    flag_nine = flag_9;<br>    <span class="hljs-keyword">if</span> ( Count )<br>      <span class="hljs-keyword">break</span>;<br>    flag_o = flag_0;<br>  &#125;<br>  flag_seven = flag_7;<br>  flag[<span class="hljs-number">1</span>] = flag_1;<br>  flag[<span class="hljs-number">2</span>] = flag_2;<br>  flag[<span class="hljs-number">3</span>] = flag_3;<br>  flag[<span class="hljs-number">4</span>] = flag_4;<br>  flag[<span class="hljs-number">5</span>] = flag_5;<br>  flag[<span class="hljs-number">6</span>] = flag_6;<br>  flag[<span class="hljs-number">7</span>] = flag_7;<br>  flag[<span class="hljs-number">8</span>] = flag_8;<br>  flag[<span class="hljs-number">9</span>] = flag_9;<br>  *flag = flag_0;<br>  <span class="hljs-keyword">return</span> flag_seven;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>由于加密主要依赖的是异或，只要复原出加密时的环境（相关变量），就可以再次加密实现复原。下图是AI给的加密逻辑分析。首先每轮加密的密钥不同，其次每个字符块的加密都依赖前一块和后一块。突破口：对于flag9而言，它的前一块和后一块都是经过本轮加密的，也就是说在最后一轮，flag9依赖的是最终密文的flag0和flag8，可以利用最终密文直接解密。解密出最后一轮的未加密flag9后，就可以往回解密flag8-flag0，就这样11轮解密回去。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">┌─────────────────────────────────────────────────────────────────────────┐<br>│               修改版TEA加密（10块Feistel结构，11轮）                        │<br>└─────────────────────────────────────────────────────────────────────────┘<br><br>输入: flag[0]...flag[9] (10个32位字), key[0]...key[3] (128位密钥)<br><br>初始化:<br>   delta = 0<br>   count = 11<br><br>开始循环（11轮）:<br>   delta_1 = delta - 0x61C88647  (无符号减法，1640531527的十六进制)<br><br>   密钥调度:<br>        k0 = key[(delta_1&gt;&gt;2) &amp; 3]<br>        k1 = key[((delta_1&gt;&gt;2) &amp; 3) ^ 1]<br>        k2 = key[((delta_1&gt;&gt;2) &amp; 3) ^ 2]<br>        k3 = key[((delta_1&gt;&gt;2) &amp; 3) ^ 3]<br><br>   加密链（每轮更新所有10个字，顺序依赖）:<br>        flag0 += F(flag9, flag1, delta_1, k0)<br>        flag1 += F(flag0, flag2, delta_1, k1)<br>        flag2 += F(flag1, flag3, delta_1, k2)<br>        flag3 += F(flag2, flag4, delta_1, k3)<br>        flag4 += F(flag3, flag5, delta_1, k0)<br>        flag5 += F(flag4, flag6, delta_1, k1)<br>        flag6 += F(flag5, flag7, delta_1, k2)<br>        flag7 += F(flag6, flag8, delta_1, k3)<br>        flag8 += F(flag7, flag9, delta_1, k0)<br>        flag9 += F(flag8, flag0, delta_1, k1)<br><br>   其中 F(a, b, delta, k) = <br>        ((16*a) ^ (b&gt;&gt;3)) + ((a&gt;&gt;5) ^ (4*b))) ^ ( (delta ^ b) + (k ^ a) )<br><br>   更新delta = delta_1<br><br>循环结束（count减至1）<br><br>输出: 加密后的flag[0]...flag[9]<br></code></pre></td></tr></table></figure>
</li>
<li><p>解密脚本：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modefiedTea_decrypt</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span>* flag, <span class="hljs-type">uint32_t</span>* key)</span> </span>&#123;<br>    <span class="hljs-type">int32_t</span> deltas[<span class="hljs-number">11</span>];<br>    <span class="hljs-type">int32_t</span> delta = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">11</span>; i++) &#123;<br>        delta -= <span class="hljs-number">1640531527</span>; <br>        deltas[i] = delta;<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> round = <span class="hljs-number">10</span>; round &gt;= <span class="hljs-number">0</span>; round--) &#123;<br>        <span class="hljs-type">uint32_t</span> delta_1 = deltas[round];<br><br>        <span class="hljs-type">uint32_t</span> k0 = key[((delta_1 &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>)];<br>        <span class="hljs-type">uint32_t</span> k1 = key[((delta_1 &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>) ^ <span class="hljs-number">1</span>];<br>        <span class="hljs-type">uint32_t</span> k2 = key[((delta_1 &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>) ^ <span class="hljs-number">2</span>];<br>        <span class="hljs-type">uint32_t</span> k3 = key[((delta_1 &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>) ^ <span class="hljs-number">3</span>];<br><br>        flag[<span class="hljs-number">9</span>] -= ((flag[<span class="hljs-number">8</span>] ^ k1) + (delta_1 ^ flag[<span class="hljs-number">0</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">8</span>]) ^ (flag[<span class="hljs-number">0</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">8</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">0</span>])));<br>        flag[<span class="hljs-number">8</span>] -= ((flag[<span class="hljs-number">7</span>] ^ k0) + (delta_1 ^ flag[<span class="hljs-number">9</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">7</span>]) ^ (flag[<span class="hljs-number">9</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">7</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">9</span>])));<br>        flag[<span class="hljs-number">7</span>] -= ((flag[<span class="hljs-number">6</span>] ^ k3) + (delta_1 ^ flag[<span class="hljs-number">8</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">6</span>]) ^ (flag[<span class="hljs-number">8</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">6</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">8</span>])));<br>        flag[<span class="hljs-number">6</span>] -= ((flag[<span class="hljs-number">5</span>] ^ k2) + (delta_1 ^ flag[<span class="hljs-number">7</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">5</span>]) ^ (flag[<span class="hljs-number">7</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">5</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">7</span>])));<br>        flag[<span class="hljs-number">5</span>] -= ((flag[<span class="hljs-number">4</span>] ^ k1) + (delta_1 ^ flag[<span class="hljs-number">6</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">4</span>]) ^ (flag[<span class="hljs-number">6</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">4</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">6</span>])));<br>        flag[<span class="hljs-number">4</span>] -= ((flag[<span class="hljs-number">3</span>] ^ k0) + (delta_1 ^ flag[<span class="hljs-number">5</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">3</span>]) ^ (flag[<span class="hljs-number">5</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">3</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">5</span>])));<br>        flag[<span class="hljs-number">3</span>] -= ((flag[<span class="hljs-number">2</span>] ^ k3) + (delta_1 ^ flag[<span class="hljs-number">4</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">2</span>]) ^ (flag[<span class="hljs-number">4</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">2</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">4</span>])));<br>        flag[<span class="hljs-number">2</span>] -= ((flag[<span class="hljs-number">1</span>] ^ k2) + (delta_1 ^ flag[<span class="hljs-number">3</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">1</span>]) ^ (flag[<span class="hljs-number">3</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">3</span>])));<br>        flag[<span class="hljs-number">1</span>] -= ((flag[<span class="hljs-number">0</span>] ^ k1) + (delta_1 ^ flag[<span class="hljs-number">2</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">0</span>]) ^ (flag[<span class="hljs-number">2</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">0</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">2</span>])));<br>        flag[<span class="hljs-number">0</span>] -= ((flag[<span class="hljs-number">9</span>] ^ k0) + (delta_1 ^ flag[<span class="hljs-number">1</span>])) ^ (((<span class="hljs-number">16</span> * flag[<span class="hljs-number">9</span>]) ^ (flag[<span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">3</span>)) + ((flag[<span class="hljs-number">9</span>] &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">4</span> * flag[<span class="hljs-number">1</span>])));<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">uint32_t</span> enc[<span class="hljs-number">10</span>] = &#123;<br>        <span class="hljs-number">0x5D624C34</span>, <span class="hljs-number">0x8629FEAD</span>, <span class="hljs-number">0x9D11379B</span>, <span class="hljs-number">0xFCD53211</span>,<br>        <span class="hljs-number">0x460F63CE</span>, <span class="hljs-number">0xC5816E68</span>, <span class="hljs-number">0xFE5300AD</span>, <span class="hljs-number">0x0A0015EE</span>,<br>        <span class="hljs-number">0x9806DBBB</span>, <span class="hljs-number">0xEF4A2648</span><br>    &#125;;<br>    <span class="hljs-type">uint32_t</span> key[<span class="hljs-number">4</span>] = &#123;<br>        <span class="hljs-number">0x63656F6D</span>, <span class="hljs-number">0x21216674</span>, <span class="hljs-number">0x12345678</span>, <span class="hljs-number">0x9ABCDEF0</span><br>    &#125;;<br><br>    <span class="hljs-built_in">modefiedTea_decrypt</span>(enc, key);<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* flag_str = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>*)enc;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i++) &#123;<br>        <span class="hljs-keyword">if</span> (flag_str[i] &gt;= <span class="hljs-number">32</span> &amp;&amp; flag_str[i] &lt;= <span class="hljs-number">126</span>) &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, flag_str[i]);<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\\x%02X&quot;</span>, flag_str[i]);<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="week3"><a href="#week3" class="headerlink" title="week3"></a>week3</h2><h3 id="have-fun"><a href="#have-fun" class="headerlink" title="have_fun"></a>have_fun</h3><ul>
<li><p>附件是一个Windows GUI程序，界面如图。工具栏的“交互”实现flag的验证。</p>
<p><img src="/../images/image-20250828184625164-1760193218429-35.png" alt="界面"></p>
</li>
<li><p>main函数主要实现的是创建窗口，涉及到WNDCLASSEXW结构体（详细信息见：<a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/windows/win32/api/winuser/ns-winuser-wndclassexw">WNDCLASSEXW （winuser.h） - Win32 apps | Microsoft Learn</a>）。其中，结构体变量lpfnWndProc涉及窗口过程的实现，所以flag验证的相关逻辑在lpfnWndProc指向的函数中查看（图中重命名为ToolBar）</p>
<p><img src="/../images/image-20250828184701147-1760193218429-32.png" alt="main函数"></p>
</li>
<li><p>ToolBar中，实现了工具栏三个选项的交互逻辑，其中，DialogBoxParamW实现的是”交互“选项（因为参数DialogFunc看着最复杂，最像flag验证逻辑）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//ToolBar函数</span><br>LRESULT __fastcall <span class="hljs-title function_">ToolBar</span><span class="hljs-params">(HWND hWnd, UINT Msg, WPARAM wParam, LPARAM lParam)</span><br>&#123;<br>  HDC hdc; <span class="hljs-comment">// rsi</span><br>  HFONT FontW; <span class="hljs-comment">// rdi</span><br>  HGDIOBJ h; <span class="hljs-comment">// rbx</span><br>  tagPAINTSTRUCT Paint; <span class="hljs-comment">// [rsp+70h] [rbp-88h] BYREF</span><br><br>  <span class="hljs-keyword">switch</span> ( Msg )<br>  &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">2u</span>:<br>      PostQuitMessage(<span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">0xFu</span>:<br>      hdc = BeginPaint(hWnd, &amp;Paint);<br>      SetTextColor(hdc, <span class="hljs-number">0xFFu</span>);<br>      SetBkMode(hdc, <span class="hljs-number">1</span>);<br>      FontW = CreateFontW(<span class="hljs-number">36</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">700</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1u</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0x20u</span>, &amp;pszFaceName);<br>      h = SelectObject(hdc, FontW);<br>      TextOutW(hdc, <span class="hljs-number">500</span>, <span class="hljs-number">160</span>, &amp;String, <span class="hljs-number">15</span>);<br>      TextOutW(hdc, <span class="hljs-number">500</span>, <span class="hljs-number">200</span>, &amp;word_7FF6D7EA3350, <span class="hljs-number">10</span>);<br>      SelectObject(hdc, h);<br>      DeleteObject(FontW);<br>      EndPaint(hWnd, &amp;Paint);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">0x111u</span>:<br>      <span class="hljs-keyword">switch</span> ( wParam )<br>      &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x68u</span>:<br>          DialogBoxParamW(hInstance, <span class="hljs-number">0x67</span>, hWnd, sub_7FF6D7EA1420, <span class="hljs-number">0LL</span>);<br>          <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x69u</span>:<br>          DestroyWindow(hWnd);<br>          <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0x9C42u</span>:<br>          DialogBoxParamW(hInstance, <span class="hljs-number">0x66</span>, hWnd, DialogFunc, <span class="hljs-number">0LL</span>);<span class="hljs-comment">//“交互”选项</span><br>          <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>          <span class="hljs-keyword">return</span> DefWindowProcW(hWnd, Msg, wParam, lParam);<br>      &#125;<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>      <span class="hljs-keyword">return</span> DefWindowProcW(hWnd, Msg, wParam, lParam);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>DialogFunc函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs c">INT_PTR __fastcall <span class="hljs-title function_">DialogFunc</span><span class="hljs-params">(HWND hDlg, <span class="hljs-type">int</span> a2, <span class="hljs-type">unsigned</span> __int16 n1003)</span><br>&#123;<br>  HWND hDlg_1; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// edx</span><br>  __int64 length; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> n32_2; <span class="hljs-comment">// r8d</span><br>  __m128 si128; <span class="hljs-comment">// xmm2</span><br>  __int64 v8; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">unsigned</span> __int64 v9; <span class="hljs-comment">// rcx</span><br>  __m128 v10; <span class="hljs-comment">// xmm0</span><br>  __m128 v11; <span class="hljs-comment">// xmm1</span><br>  __m128 v12; <span class="hljs-comment">// xmm0</span><br>  __m128 v13; <span class="hljs-comment">// xmm1</span><br>  __int64 count; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">unsigned</span> __int16 *currentChar; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">int</span> currentEnc; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> judgeNumber; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">const</span> WCHAR *PrintText; <span class="hljs-comment">// r8</span><br>  _OWORD v20[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-1D8h] BYREF</span><br>  WCHAR flag[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-1B8h] BYREF</span><br>  _OWORD v22[<span class="hljs-number">12</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-1A8h] BYREF</span><br>  _WORD flag_xored[<span class="hljs-number">104</span>]; <span class="hljs-comment">// [rsp+F0h] [rbp-E8h] BYREF</span><br><br>  hDlg_1 = hDlg;<br>  v4 = a2 - <span class="hljs-number">272</span>;<br>  <span class="hljs-keyword">if</span> ( !v4 )<br>  &#123;<br>    PrintText = &amp;word_7FF6D7EA3368;<br>LABEL_22:<br>    SetDlgItemTextW(hDlg, <span class="hljs-number">1002</span>, PrintText);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1LL</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v4 != <span class="hljs-number">1</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( (n1003 - <span class="hljs-number">1</span>) &gt; <span class="hljs-number">1u</span> )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( n1003 == <span class="hljs-number">1003</span> )<br>    &#123;<br>      GetDlgItemTextW(hDlg, <span class="hljs-number">1001</span>, flag, <span class="hljs-number">100</span>);<br>      length = <span class="hljs-number">-1LL</span>;<br>      <span class="hljs-keyword">do</span><br>        ++length;<br>      <span class="hljs-keyword">while</span> ( flag[length] );<br>      n32_2 = <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">if</span> ( length &gt;= <span class="hljs-number">32</span> )<span class="hljs-comment">// flag长度大于32的情况（实际上不能是这种情况）</span><br>      &#123;<br>        si128 = _mm_load_si128(&amp;xmmword_7FF6D7EA33F0);<br>        v8 = <span class="hljs-number">0LL</span>;<br>        v9 = <span class="hljs-number">0LL</span>;<br>        <span class="hljs-keyword">do</span><br>        &#123;<br>          v10 = _mm_loadu_si128(&amp;flag[v9 / <span class="hljs-number">2</span>]);<br>          n32_2 += <span class="hljs-number">32</span>;<br>          v8 += <span class="hljs-number">32LL</span>;<br>          v11 = _mm_loadu_si128(&amp;v22[v9 / <span class="hljs-number">0x10</span>]);<br>          v9 += <span class="hljs-number">64LL</span>;<br>          v22[v9 / <span class="hljs-number">0x10</span> + <span class="hljs-number">8</span>] = _mm_xor_ps(v10, si128);<br>          v12 = _mm_loadu_si128(&amp;v20[v9 / <span class="hljs-number">0x10</span>]);<br>          v22[v9 / <span class="hljs-number">0x10</span> + <span class="hljs-number">9</span>] = _mm_xor_ps(v11, si128);<br>          v13 = _mm_loadu_si128(&amp;v20[v9 / <span class="hljs-number">0x10</span> + <span class="hljs-number">1</span>]);<br>          v22[v9 / <span class="hljs-number">0x10</span> + <span class="hljs-number">10</span>] = _mm_xor_ps(v12, si128);<br>          v22[v9 / <span class="hljs-number">0x10</span> + <span class="hljs-number">11</span>] = _mm_xor_ps(v13, si128);<br>        &#125;<br>        <span class="hljs-keyword">while</span> ( v8 &lt; (length - (length &amp; <span class="hljs-number">31</span>)) );<br>      &#125;<br>      count = n32_2;<span class="hljs-comment">// 上述情况应不成立，因此n32_2为0</span><br>      <span class="hljs-keyword">if</span> ( n32_2 &lt; length )<br>      &#123;<br>        <span class="hljs-keyword">do</span><br>        &#123;<br>          flag_xored[count] = flag[count] ^ <span class="hljs-number">0x2A</span>;<br>          ++count;<br>        &#125;<br>        <span class="hljs-keyword">while</span> ( count &lt; length );<br>      &#125;<br>      flag_xored[length] = <span class="hljs-number">0</span>;<br>      currentChar = flag_xored;<br>      <span class="hljs-keyword">do</span><br>      &#123;<br>        currentEnc = *(currentChar + &amp;enc - flag_xored);<span class="hljs-comment">// enc[currentChar-flag_xored]</span><br>        judgeNumber = *currentChar - currentEnc;<br>        <span class="hljs-keyword">if</span> ( judgeNumber )<br>          <span class="hljs-keyword">break</span>;<br>        ++currentChar;<br>      &#125;<br>      <span class="hljs-keyword">while</span> ( currentEnc );<br>      <span class="hljs-keyword">if</span> ( judgeNumber || (PrintText = &amp;right, length != <span class="hljs-number">16</span>) )<span class="hljs-comment">// flag长度由此处得出</span><br>        PrintText = &amp;wrong;<br>      hDlg = hDlg_1;<br>      <span class="hljs-keyword">goto</span> LABEL_22;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  &#125;<br>  EndDialog(hDlg, n1003);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>逻辑很明显，遍历flag，每个字符异或0x2A，然后和enc比较。解密脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">enc = [<br>    <span class="hljs-number">0x0047</span>, <span class="hljs-number">0x0045</span>, <span class="hljs-number">0x004F</span>, <span class="hljs-number">0x0049</span>, <span class="hljs-number">0x005E</span>, <span class="hljs-number">0x004C</span>, <span class="hljs-number">0x0051</span>, <span class="hljs-number">0x0062</span>, <span class="hljs-number">0x006A</span>, <span class="hljs-number">0x005C</span>, <span class="hljs-number">0x001E</span>, <span class="hljs-number">0x0075</span>, <span class="hljs-number">0x004C</span>, <span class="hljs-number">0x007F</span>, <span class="hljs-number">0x0044</span>, <span class="hljs-number">0x0057</span><br>]<br>flag = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(b ^ <span class="hljs-number">0x2A</span>) <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> enc)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="guess"><a href="#guess" class="headerlink" title="guess"></a>guess</h3><ul>
<li><p>附件程序是一个猜数字游戏，用IDA打开，通过字符串表的关键数据”You are right!\n”可以快速定位到main函数的位置</p>
<p><img src="/../images/image-20250907190954175-1760193218429-33.png" alt="关键数据"></p>
</li>
<li><p>main函数F5反编译不了，sp value报错，说明有花指令。把栈指针勾选上，会发现栈帧突变的位置：</p>
<p><img src="/../images/image-20250907191116300-1760193218429-36.png" alt="栈帧突变"></p>
<p>栈帧改变太多，明显不对，把sub rsp, rax给nop掉。然后可以发现函数末尾栈帧会有点问题：</p>
<p><img src="/../images/image-20250907191353142-1760193218429-37.png" alt="函数末尾栈帧"></p>
<p>把add rsp, 1428h也给nop掉，这样main函数基本上可以反编译了</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">//优化后的main函数</span><br><span class="hljs-comment">// bad sp value at call has been detected, the output may be wrong!</span><br><span class="hljs-function"><span class="hljs-type">int</span> __fastcall <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">bool</span> v3; <span class="hljs-comment">// dl</span><br>  std::ostream *v4; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v5; <span class="hljs-comment">// eax</span><br>  _QWORD *v6; <span class="hljs-comment">// rax</span><br>  std::ostream *v8; <span class="hljs-comment">// rax</span><br>  __int64 v9; <span class="hljs-comment">// rax</span><br>  __int64 v10; <span class="hljs-comment">// rbx</span><br>  std::ostream *v11; <span class="hljs-comment">// rax</span><br>  std::ostream *v12; <span class="hljs-comment">// rax</span><br>  std::ostream *v13; <span class="hljs-comment">// rax</span><br>  std::ostream *v14; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> n0x64; <span class="hljs-comment">// [rsp+2Ch] [rbp-54h]</span><br>  _BYTE v17[<span class="hljs-number">2512</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-50h] BYREF</span><br>  _BYTE v18[<span class="hljs-number">2512</span>]; <span class="hljs-comment">// [rsp+A00h] [rbp+980h] BYREF</span><br>  _BYTE v19[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+13D0h] [rbp+1350h] BYREF</span><br>  _BYTE v20[<span class="hljs-number">40</span>]; <span class="hljs-comment">// [rsp+13F0h] [rbp+1370h] BYREF</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> n0x64_1; <span class="hljs-comment">// [rsp+1418h] [rbp+1398h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+141Ch] [rbp+139Ch]</span><br><br>  _main(argc, argv, envp);<br>  std::ios_base::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0LL</span>, v3);<br>  std::ios::<span class="hljs-built_in">tie</span>((<span class="hljs-type">char</span> *)in + <span class="hljs-number">16</span>, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;Welcome to MoeCTF 2025!\n&quot;</span>);<br>  <span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;Let&#x27;s play a game!\n&quot;</span>);<br>  <span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;I have a secret number between 0 and 99, and you can guess it 10 times.\n&quot;</span>);<br>  v4 = (std::ostream *)<span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;If you successly guessed it, I will give you the flag!&quot;</span>);<br>  <span class="hljs-built_in">endl</span>(v4);<br>  <span class="hljs-built_in">random_device</span>((std::random_device *)v18);<br>  v5 = <span class="hljs-built_in">random_operator</span>(v18);<br>  <span class="hljs-built_in">mersenne_twister_engine</span>(v17, v5);<br>  std::random_device::~<span class="hljs-built_in">random_device</span>((std::random_device *)v18);<br>  n0x64_1 = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)<span class="hljs-built_in">mersenne_twister_engine_operator</span>(v17) % <span class="hljs-number">0x64</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">9</span>; ++i )<br>  &#123;<br>    <span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;Please input your number: &quot;</span>);<br>    std::ostream::<span class="hljs-built_in">flush</span>(out);<br>    v6 = (_QWORD *)<span class="hljs-built_in">cin</span>(in);<br>    <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int8)std::ios::<span class="hljs-keyword">operator</span>!((<span class="hljs-type">char</span> *)v6 + *(_QWORD *)(*v6 - <span class="hljs-number">24LL</span>)) || n0x64 &gt;= <span class="hljs-number">0x64</span> )<br>    &#123;<br>      v8 = (std::ostream *)<span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;Invalid input&quot;</span>);<br>      <span class="hljs-built_in">endl</span>(v8);<br>      std::ios::<span class="hljs-built_in">clear</span>((<span class="hljs-type">char</span> *)in + <span class="hljs-number">16</span>, <span class="hljs-number">0LL</span>);<br>      v9 = std::numeric_limits&lt;<span class="hljs-type">long</span> <span class="hljs-type">long</span>&gt;::<span class="hljs-built_in">max</span>();<br>      std::istream::<span class="hljs-built_in">ignore</span>(in, v9, <span class="hljs-number">10</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-keyword">if</span> ( n0x64_1 == n0x64 )<br>      &#123;<br>        <span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;You are right!\n&quot;</span>);<br>        v10 = <span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;The flag is moectf&#123;&quot;</span>);<br>        <span class="hljs-built_in">hex_to_binary</span>(v20, &amp;enc[abi:cxx11]);<br>        <span class="hljs-built_in">rc4_decrypt</span>(v19, v20, &amp;key[abi:cxx11]);<br>        v11 = (std::ostream *)std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;<span class="hljs-type">char</span>&gt;(v10, v19);<br>        v12 = (std::ostream *)<span class="hljs-built_in">cout</span>(v11, <span class="hljs-string">&quot;&#125;.&quot;</span>);<br>        <span class="hljs-built_in">endl</span>(v12);<br>        std::string::~<span class="hljs-built_in">string</span>(v19);<br>        std::string::~<span class="hljs-built_in">string</span>(v20);<br>        <span class="hljs-keyword">break</span>;<br>      &#125;<br>      v13 = (std::ostream *)<span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;That&#x27;s not right...&quot;</span>);<br>      <span class="hljs-built_in">endl</span>(v13);<br>    &#125;<br>  &#125;<br>  v14 = (std::ostream *)<span class="hljs-built_in">cout</span>(out, <span class="hljs-string">&quot;Thanks for your playing!&quot;</span>);<br>  <span class="hljs-built_in">endl</span>(v14);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>可以看出，main函数的逻辑是先获取一个数字输入，然后经过和随机数有关的各种操作来判断是否符合条件，符合条件就输出flag。既然可以直接输出flag，不妨就动调改变判断结果直接得到flag。找到和输出有关的判断逻辑的位置：</p>
<p><img src="/../images/image-20250907193423247-1760193218429-39.png" alt="跳转的关键逻辑"></p>
<p>动调程序步过此处后，改一下ZF即可让程序跳到”You are right!\n”处获得flag输出。好在本题没有给动调挖坑，可以直接得到flag：</p>
<p><img src="/../images/image-20250907193656681-1760193218429-40.png" alt="得到flag"></p>
</li>
</ul>
<h3 id="rusty-sudoku"><a href="#rusty-sudoku" class="headerlink" title="rusty_sudoku"></a>rusty_sudoku</h3><ul>
<li><p>rust语言的数独游戏。运行附件程序，提示逆向分析程序找到数独并求解。用IDA打开，结合AI辅助优化后main函数长这样：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">__int64 __fastcall <span class="hljs-title">rusty_sudoku::main</span><span class="hljs-params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="hljs-function"></span>&#123;<br>  __int128 *md5_ctx_prt; <span class="hljs-comment">// rdi</span><br>  __int64 temp; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">size_t</span> cupy_size; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">unsigned</span> __int8 *input_end; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">unsigned</span> __int8 *trimmed_length; <span class="hljs-comment">// rsi</span><br>  <span class="hljs-type">unsigned</span> __int8 *trimmed_start; <span class="hljs-comment">// r9</span><br>  <span class="hljs-type">unsigned</span> __int8 *input_ptr; <span class="hljs-comment">// r8</span><br>  <span class="hljs-type">char</span> is_whitespace; <span class="hljs-comment">// r11</span><br>  <span class="hljs-type">unsigned</span> __int8 *current_ptr; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">unsigned</span> __int8 *trimmed_count; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> codepoint; <span class="hljs-comment">// r11d</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> temp_val1; <span class="hljs-comment">// r14d</span><br>  <span class="hljs-type">int</span> temp_val2; <span class="hljs-comment">// ebp</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> high_byte; <span class="hljs-comment">// ebx</span><br>  __int64 alloc_result; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-type">char</span> is_whitespace2; <span class="hljs-comment">// bl</span><br>  <span class="hljs-type">unsigned</span> __int8 *end_ptr; <span class="hljs-comment">// r11</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> codepoint2; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">char</span> byte1; <span class="hljs-comment">// bl</span><br>  <span class="hljs-type">char</span> byte2; <span class="hljs-comment">// bp</span><br>  <span class="hljs-type">int</span> temp_val3; <span class="hljs-comment">// ebp</span><br>  <span class="hljs-type">int</span> temp_val4; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> high_byte2; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-type">size_t</span> actual_size; <span class="hljs-comment">// r15</span><br>  __int64 alloc_size; <span class="hljs-comment">// r14</span><br>  __int64 allocated_mem; <span class="hljs-comment">// rax</span><br>  __int64 expected_char; <span class="hljs-comment">// r9</span><br>  __int64 input_data; <span class="hljs-comment">// rdx</span><br>  __int64 index; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> user_char; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">int</span> v34; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> temp_val5; <span class="hljs-comment">// r8d</span><br>  __int64 result; <span class="hljs-comment">// rax</span><br>  __int64 user_index; <span class="hljs-comment">// rax</span><br>  __int64 sudoku_index; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">int</span> user_codepointer; <span class="hljs-comment">// r8d</span><br>  <span class="hljs-type">int</span> v40; <span class="hljs-comment">// r9d</span><br>  <span class="hljs-type">int</span> temp_val6; <span class="hljs-comment">// r11d</span><br>  <span class="hljs-type">int</span> temp_val7; <span class="hljs-comment">// r10d</span><br>  <span class="hljs-type">int</span> v43; <span class="hljs-comment">// r10d</span><br>  <span class="hljs-type">int</span> temp_val8; <span class="hljs-comment">// ebp</span><br>  <span class="hljs-type">int</span> temp_val9; <span class="hljs-comment">// r11d</span><br>  __int64 temp_arg1; <span class="hljs-comment">// rdx</span><br>  __int64 temp_arg2; <span class="hljs-comment">// rdx</span><br>  __int64 temp_arg3; <span class="hljs-comment">// rdx</span><br>  _BYTE buf[<span class="hljs-number">88</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-178h] BYREF</span><br>  __int128 fmt_arg1; <span class="hljs-comment">// [rsp+90h] [rbp-118h] BYREF</span><br>  __int128 fmt_arg2; <span class="hljs-comment">// [rsp+A0h] [rbp-108h]</span><br>  __int128 fmt_arg3; <span class="hljs-comment">// [rsp+B0h] [rbp-F8h]</span><br>  __int128 fmt_arg4; <span class="hljs-comment">// [rsp+C0h] [rbp-E8h]</span><br>  __int128 fmt_arg5; <span class="hljs-comment">// [rsp+D0h] [rbp-D8h]</span><br>  __int64 fmt_arg6; <span class="hljs-comment">// [rsp+E0h] [rbp-C8h]</span><br>  _OWORD stdin_handle[<span class="hljs-number">5</span>]; <span class="hljs-comment">// [rsp+F0h] [rbp-B8h] BYREF</span><br>  <span class="hljs-type">char</span> board_data; <span class="hljs-comment">// [rsp+140h] [rbp-68h]</span><br>  _BYTE md5_hash[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+150h] [rbp-58h] BYREF</span><br><br>  *buf = &amp;welcome;                              <span class="hljs-comment">// &quot;Welcome to MoeCTF 2025!\nPlease **find** my sudoku and fill it correctly.\nAnd then I will give you the flag.\nInput your answer in one line (without spaces).\nfor example, 854219763397865421261473985785126394649538172132947856926384517513792648478651239 represents:\n854|219|763\n397|865|421\n261|473|985\n-----------\n785|126|394\n649|538|172\n132|947|856\n-----------\n926|384|517\n513|792|648\n478|651|239\n\nYour answer:\n&quot;</span><br>  *&amp;buf[<span class="hljs-number">8</span>] = <span class="hljs-number">1LL</span>;<br>  *&amp;buf[<span class="hljs-number">16</span>] = <span class="hljs-number">8LL</span>;<br>  *&amp;buf[<span class="hljs-number">24</span>] = <span class="hljs-number">0LL</span>;<br>  std::io::stdio::_print(a1, a2, a3, buf);<br>  *buf = <span class="hljs-number">0LL</span>;<br>  *&amp;buf[<span class="hljs-number">8</span>] = <span class="hljs-number">1LL</span>;<br>  *&amp;buf[<span class="hljs-number">16</span>] = <span class="hljs-number">0LL</span>;<br>  *&amp;stdin_handle[<span class="hljs-number">0</span>] = std::io::stdio::<span class="hljs-built_in">stdin</span>();<br>  md5_ctx_prt = stdin_handle;<br>  <span class="hljs-keyword">if</span> ( (std::io::stdio::Stdin::<span class="hljs-built_in">read_line</span>(stdin_handle, a2, buf, stdin_handle) &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> )<br>  &#123;<br>    *&amp;fmt_arg1 = temp;<br>    core::result::<span class="hljs-built_in">unwrap_failed</span>(stdin_handle, a2, <span class="hljs-number">14</span>, <span class="hljs-string">&quot;Invalid input.src\\main.rs&quot;</span>, &amp;fmt_arg1, &amp;off_7FF6BF752050);<br>  &#125;<br>  cupy_size = *&amp;buf[<span class="hljs-number">8</span>];<br>  input_end = (*&amp;buf[<span class="hljs-number">8</span>] + *&amp;buf[<span class="hljs-number">16</span>]);<br>  <span class="hljs-keyword">if</span> ( *&amp;buf[<span class="hljs-number">16</span>] )<br>  &#123;<br>    trimmed_length = <span class="hljs-number">0LL</span>;<br>    trimmed_start = <span class="hljs-number">0LL</span>;<br>    input_ptr = *&amp;buf[<span class="hljs-number">8</span>];<br>    <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>    &#123;<br>      current_ptr = input_ptr;<br>      trimmed_count = trimmed_start;<br>      codepoint = *input_ptr;<br>      <span class="hljs-keyword">if</span> ( (codepoint &amp; <span class="hljs-number">0x80u</span>) != <span class="hljs-number">0</span> )<br>      &#123;<br>        v14 = codepoint &amp; <span class="hljs-number">0x1F</span>;<br>        temp_val1 = input_ptr[<span class="hljs-number">1</span>] &amp; <span class="hljs-number">0x3F</span>;<br>        <span class="hljs-keyword">if</span> ( codepoint &lt;= <span class="hljs-number">0xDFu</span> )<br>        &#123;<br>          input_ptr += <span class="hljs-number">2</span>;<br>          codepoint = temp_val1 | (v14 &lt;&lt; <span class="hljs-number">6</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          temp_val2 = (temp_val1 &lt;&lt; <span class="hljs-number">6</span>) | input_ptr[<span class="hljs-number">2</span>] &amp; <span class="hljs-number">0x3F</span>;<br>          <span class="hljs-keyword">if</span> ( codepoint &lt; <span class="hljs-number">0xF0u</span> )<br>          &#123;<br>            input_ptr += <span class="hljs-number">3</span>;<br>            codepoint = (v14 &lt;&lt; <span class="hljs-number">12</span>) | temp_val2;<br>          &#125;<br>          <span class="hljs-keyword">else</span><br>          &#123;<br>            input_ptr += <span class="hljs-number">4</span>;<br>            codepoint = ((codepoint &amp; <span class="hljs-number">7</span>) &lt;&lt; <span class="hljs-number">18</span>) | (temp_val2 &lt;&lt; <span class="hljs-number">6</span>) | current_ptr[<span class="hljs-number">3</span>] &amp; <span class="hljs-number">0x3F</span>;<br>          &#125;<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        ++input_ptr;<br>      &#125;<br>      trimmed_start = &amp;trimmed_count[input_ptr - current_ptr];<br>      <span class="hljs-keyword">if</span> ( codepoint - <span class="hljs-number">9</span> &gt;= <span class="hljs-number">5</span> &amp;&amp; codepoint != <span class="hljs-number">32</span> )<br>      &#123;<br>        <span class="hljs-keyword">if</span> ( codepoint &lt; <span class="hljs-number">0x80</span> )<br>          <span class="hljs-keyword">goto</span> LABEL_27;<br>        high_byte = codepoint &gt;&gt; <span class="hljs-number">8</span>;<br>        <span class="hljs-keyword">if</span> ( codepoint &gt;&gt; <span class="hljs-number">8</span> &gt; <span class="hljs-number">0x1F</span> )<br>        &#123;<br>          <span class="hljs-keyword">if</span> ( high_byte == <span class="hljs-number">32</span> )<br>          &#123;<br>            is_whitespace = *(core::unicode::unicode_data::white_space::WHITESPACE_MAP + codepoint) &gt;&gt; <span class="hljs-number">1</span>;<br>          &#125;<br>          <span class="hljs-keyword">else</span><br>          &#123;<br>            <span class="hljs-keyword">if</span> ( high_byte != <span class="hljs-number">48</span> )<br>              <span class="hljs-keyword">goto</span> LABEL_27;<br>            is_whitespace = codepoint == <span class="hljs-number">12288</span>;<br>          &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( high_byte )<br>        &#123;<br>          <span class="hljs-keyword">if</span> ( high_byte != <span class="hljs-number">22</span> )<br>            <span class="hljs-keyword">goto</span> LABEL_27;<br>          is_whitespace = codepoint == <span class="hljs-number">5760</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          is_whitespace = *(core::unicode::unicode_data::white_space::WHITESPACE_MAP + codepoint);<br>        &#125;<br>        <span class="hljs-keyword">if</span> ( (is_whitespace &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> )<br>          <span class="hljs-keyword">goto</span> LABEL_27;<br>      &#125;<br>      <span class="hljs-keyword">if</span> ( input_ptr == input_end )<br>      &#123;<br>        alloc_result = <span class="hljs-number">1LL</span>;<br>        <span class="hljs-keyword">goto</span> LABEL_58;<br>      &#125;<br>    &#125;<br>  &#125;<br>  trimmed_start = <span class="hljs-number">0LL</span>;<br>  input_ptr = *&amp;buf[<span class="hljs-number">8</span>];<br>  trimmed_count = <span class="hljs-number">0LL</span>;<br>LABEL_27:<br>  <span class="hljs-keyword">if</span> ( input_ptr == input_end )<br>    <span class="hljs-keyword">goto</span> LABEL_53;<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    end_ptr = input_end;<br>    codepoint2 = *(input_end - <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span> ( (codepoint2 &amp; <span class="hljs-number">0x80000000</span>) != <span class="hljs-number">0</span> )<br>    &#123;<br>      byte1 = *(input_end - <span class="hljs-number">2</span>);<br>      <span class="hljs-keyword">if</span> ( byte1 &gt;= <span class="hljs-number">-64</span> )<br>      &#123;<br>        input_end -= <span class="hljs-number">2</span>;<br>        temp_val4 = byte1 &amp; <span class="hljs-number">0x1F</span>;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        byte2 = *(input_end - <span class="hljs-number">3</span>);<br>        <span class="hljs-keyword">if</span> ( byte2 &gt;= <span class="hljs-number">-64</span> )<br>        &#123;<br>          input_end -= <span class="hljs-number">3</span>;<br>          temp_val3 = byte2 &amp; <span class="hljs-number">0xF</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          input_end -= <span class="hljs-number">4</span>;<br>          temp_val3 = ((*(end_ptr - <span class="hljs-number">4</span>) &amp; <span class="hljs-number">7</span>) &lt;&lt; <span class="hljs-number">6</span>) | byte2 &amp; <span class="hljs-number">0x3F</span>;<br>        &#125;<br>        temp_val4 = (temp_val3 &lt;&lt; <span class="hljs-number">6</span>) | byte1 &amp; <span class="hljs-number">0x3F</span>;<br>      &#125;<br>      codepoint2 = (temp_val4 &lt;&lt; <span class="hljs-number">6</span>) | codepoint2 &amp; <span class="hljs-number">0x3F</span>;<br>      <span class="hljs-keyword">if</span> ( codepoint2 - <span class="hljs-number">9</span> &lt; <span class="hljs-number">5</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_31;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      --input_end;<br>      <span class="hljs-keyword">if</span> ( codepoint2 - <span class="hljs-number">9</span> &lt; <span class="hljs-number">5</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_31;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( codepoint2 == <span class="hljs-number">32</span> )<br>      <span class="hljs-keyword">goto</span> LABEL_31;<br>    <span class="hljs-keyword">if</span> ( codepoint2 &lt; <span class="hljs-number">0x80</span> )<br>      <span class="hljs-keyword">break</span>;<br>    high_byte2 = codepoint2 &gt;&gt; <span class="hljs-number">8</span>;<br>    <span class="hljs-keyword">if</span> ( codepoint2 &gt;&gt; <span class="hljs-number">8</span> &lt;= <span class="hljs-number">0x1F</span> )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( high_byte2 )<br>      &#123;<br>        <span class="hljs-keyword">if</span> ( high_byte2 != <span class="hljs-number">22</span> )<br>          <span class="hljs-keyword">break</span>;<br>        is_whitespace2 = codepoint2 == <span class="hljs-number">5760</span>;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        is_whitespace2 = *(core::unicode::unicode_data::white_space::WHITESPACE_MAP + codepoint2);<br>      &#125;<br>      <span class="hljs-keyword">goto</span> LABEL_30;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( high_byte2 == <span class="hljs-number">32</span> )<br>    &#123;<br>      is_whitespace2 = *(core::unicode::unicode_data::white_space::WHITESPACE_MAP + codepoint2) &gt;&gt; <span class="hljs-number">1</span>;<br>      <span class="hljs-keyword">goto</span> LABEL_30;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( high_byte2 != <span class="hljs-number">48</span> )<br>      <span class="hljs-keyword">break</span>;<br>    is_whitespace2 = codepoint2 == <span class="hljs-number">12288</span>;<br>LABEL_30:<br>    <span class="hljs-keyword">if</span> ( (is_whitespace2 &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span> )<br>      <span class="hljs-keyword">break</span>;<br>LABEL_31:<br>    <span class="hljs-keyword">if</span> ( input_ptr == input_end )<br>      <span class="hljs-keyword">goto</span> LABEL_53;<br>  &#125;<br>  trimmed_start = &amp;end_ptr[trimmed_start - input_ptr];<br>LABEL_53:<br>  trimmed_length = (trimmed_start - trimmed_count);<br>  <span class="hljs-keyword">if</span> ( trimmed_start - trimmed_count &lt; <span class="hljs-number">0</span> )<br>  &#123;<br>    alloc_size = <span class="hljs-number">0LL</span>;<br>    <span class="hljs-keyword">goto</span> LABEL_110;<br>  &#125;<br>  cupy_size = &amp;trimmed_count[*&amp;buf[<span class="hljs-number">8</span>]];<br>  <span class="hljs-keyword">if</span> ( trimmed_start == trimmed_count )<br>  &#123;<br>    alloc_result = <span class="hljs-number">1LL</span>;<br>    trimmed_length = <span class="hljs-number">0LL</span>;<br>    <span class="hljs-keyword">goto</span> LABEL_58;<br>  &#125;<br>  actual_size = &amp;trimmed_count[*&amp;buf[<span class="hljs-number">8</span>]];<br>  <span class="hljs-built_in">RNvCs73fAdSrgOJL_7___rustc35___rust_no_alloc_shim_is_unstable_v2</span>(stdin_handle, trimmed_length);<br>  alloc_size = <span class="hljs-number">1LL</span>;<br>  allocated_mem = __rustc::__rust_alloc(stdin_handle, trimmed_length, <span class="hljs-number">1LL</span>, trimmed_length);<br>  <span class="hljs-keyword">if</span> ( !allocated_mem )<br>LABEL_110:<br>    alloc::raw_vec::<span class="hljs-built_in">handle_error</span>(stdin_handle, trimmed_length, trimmed_length, alloc_size, &amp;off_7FF6BF7521D8);<span class="hljs-comment">// &quot;/rustc/29483883eed69d5fb4db01964cdf2af4d86e9cb2\\library\\alloc\\src\\slice.rs&quot;</span><br>  alloc_result = allocated_mem;<br>  cupy_size = actual_size;<br>LABEL_58:<br>  <span class="hljs-built_in">memcpy</span>(stdin_handle, trimmed_length, cupy_size);<br>  input_data = *buf;<br>  <span class="hljs-keyword">if</span> ( *buf )<br>    __rustc::__rust_dealloc(stdin_handle, trimmed_length, *buf, *&amp;buf[<span class="hljs-number">8</span>], <span class="hljs-number">1LL</span>);<br>  <span class="hljs-keyword">if</span> ( trimmed_length == <span class="hljs-number">81</span> )<br>  &#123;<br>    index = <span class="hljs-number">0LL</span>;<br>    <span class="hljs-keyword">while</span> ( index != <span class="hljs-number">81</span> )<br>    &#123;<br>      user_char = *(alloc_result + index);<br>      <span class="hljs-keyword">if</span> ( (user_char &amp; <span class="hljs-number">0x80u</span>) == <span class="hljs-number">0</span> )<br>      &#123;<br>        ++index;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        v34 = user_char &amp; <span class="hljs-number">0x1F</span>;<br>        expected_char = *(alloc_result + index + <span class="hljs-number">1</span>) &amp; <span class="hljs-number">0x3F</span>;<br>        <span class="hljs-keyword">if</span> ( user_char &lt;= <span class="hljs-number">0xDFu</span> )<br>        &#123;<br>          index += <span class="hljs-number">2LL</span>;<br>          input_data = expected_char | (v34 &lt;&lt; <span class="hljs-number">6</span>);<br>          user_char = input_data;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          expected_char = (expected_char &lt;&lt; <span class="hljs-number">6</span>);<br>          temp_val5 = expected_char | *(alloc_result + index + <span class="hljs-number">2</span>) &amp; <span class="hljs-number">0x3F</span>;<br>          <span class="hljs-keyword">if</span> ( user_char &lt; <span class="hljs-number">0xF0u</span> )<br>          &#123;<br>            index += <span class="hljs-number">3LL</span>;<br>            input_data = (v34 &lt;&lt; <span class="hljs-number">12</span>);<br>            user_char = input_data | temp_val5;<br>          &#125;<br>          <span class="hljs-keyword">else</span><br>          &#123;<br>            input_data = (user_char &amp; <span class="hljs-number">7</span>) &lt;&lt; <span class="hljs-number">18</span>;<br>            user_char = input_data | (temp_val5 &lt;&lt; <span class="hljs-number">6</span>) | *(alloc_result + index + <span class="hljs-number">3</span>) &amp; <span class="hljs-number">0x3F</span>;<br>            <span class="hljs-keyword">if</span> ( user_char == <span class="hljs-number">1114112</span> )<br>              <span class="hljs-keyword">break</span>;<br>            index += <span class="hljs-number">4LL</span>;<br>          &#125;<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">if</span> ( (user_char - <span class="hljs-number">58</span>) &lt; <span class="hljs-number">0xFFFFFFF6</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_72;<br>    &#125;<br>    user_index = <span class="hljs-number">0LL</span>;<br>    sudoku_index = <span class="hljs-number">0LL</span>;<br>    <span class="hljs-keyword">while</span> ( user_index != <span class="hljs-number">81</span> )<br>    &#123;<br>      user_codepointer = *(alloc_result + user_index);<br>      <span class="hljs-keyword">if</span> ( (user_codepointer &amp; <span class="hljs-number">0x80u</span>) != <span class="hljs-number">0</span> )<br>      &#123;<br>        v40 = user_codepointer &amp; <span class="hljs-number">0x1F</span>;<br>        temp_val6 = *(alloc_result + user_index + <span class="hljs-number">1</span>) &amp; <span class="hljs-number">0x3F</span>;<br>        <span class="hljs-keyword">if</span> ( user_codepointer &lt;= <span class="hljs-number">0xDFu</span> )<br>        &#123;<br>          user_index += <span class="hljs-number">2LL</span>;<br>          expected_char = temp_val6 | (v40 &lt;&lt; <span class="hljs-number">6</span>);<br>          user_codepointer = expected_char;<br>          <span class="hljs-keyword">if</span> ( sudoku_index == <span class="hljs-number">81</span> )<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          temp_val7 = (temp_val6 &lt;&lt; <span class="hljs-number">6</span>) | *(alloc_result + user_index + <span class="hljs-number">2</span>) &amp; <span class="hljs-number">0x3F</span>;<br>          <span class="hljs-keyword">if</span> ( user_codepointer &lt; <span class="hljs-number">0xF0u</span> )<br>          &#123;<br>            user_index += <span class="hljs-number">3LL</span>;<br>            expected_char = (v40 &lt;&lt; <span class="hljs-number">12</span>);<br>            user_codepointer = expected_char | temp_val7;<br>            <span class="hljs-keyword">if</span> ( sudoku_index == <span class="hljs-number">81</span> )<br>              <span class="hljs-keyword">break</span>;<br>          &#125;<br>          <span class="hljs-keyword">else</span><br>          &#123;<br>            expected_char = (user_codepointer &amp; <span class="hljs-number">7</span>) &lt;&lt; <span class="hljs-number">18</span>;<br>            user_codepointer = expected_char | (temp_val7 &lt;&lt; <span class="hljs-number">6</span>) | *(alloc_result + user_index + <span class="hljs-number">3</span>) &amp; <span class="hljs-number">0x3F</span>;<br>            <span class="hljs-keyword">if</span> ( user_codepointer == <span class="hljs-number">1114112</span> )<br>              <span class="hljs-keyword">break</span>;<br>            user_index += <span class="hljs-number">4LL</span>;<br>            <span class="hljs-keyword">if</span> ( sudoku_index == <span class="hljs-number">81</span> )<br>              <span class="hljs-keyword">break</span>;<br>          &#125;<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        ++user_index;<br>        <span class="hljs-keyword">if</span> ( sudoku_index == <span class="hljs-number">81</span> )<br>          <span class="hljs-keyword">break</span>;<br>      &#125;<br>      expected_char = sudoku[sudoku_index];<br>      <span class="hljs-keyword">if</span> ( (expected_char &amp; <span class="hljs-number">0x80u</span>) != <span class="hljs-number">0LL</span> )<br>      &#123;<br>        v43 = expected_char &amp; <span class="hljs-number">0x1F</span>;<br>        temp_val8 = sudoku[sudoku_index + <span class="hljs-number">1</span>] &amp; <span class="hljs-number">0x3F</span>;<br>        <span class="hljs-keyword">if</span> ( expected_char &lt;= <span class="hljs-number">0xDFu</span> )<br>        &#123;<br>          sudoku_index += <span class="hljs-number">2LL</span>;<br>          expected_char = temp_val8 | (v43 &lt;&lt; <span class="hljs-number">6</span>);<br>          <span class="hljs-keyword">if</span> ( user_codepointer == <span class="hljs-number">1114112</span> )<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          temp_val9 = (temp_val8 &lt;&lt; <span class="hljs-number">6</span>) | sudoku[sudoku_index + <span class="hljs-number">2</span>] &amp; <span class="hljs-number">0x3F</span>;<br>          <span class="hljs-keyword">if</span> ( expected_char &lt; <span class="hljs-number">0xF0u</span> )<br>          &#123;<br>            sudoku_index += <span class="hljs-number">3LL</span>;<br>            expected_char = (v43 &lt;&lt; <span class="hljs-number">12</span>) | temp_val9;<br>            <span class="hljs-keyword">if</span> ( user_codepointer == <span class="hljs-number">1114112</span> )<br>              <span class="hljs-keyword">break</span>;<br>          &#125;<br>          <span class="hljs-keyword">else</span><br>          &#123;<br>            expected_char = ((expected_char &amp; <span class="hljs-number">7</span>) &lt;&lt; <span class="hljs-number">18</span>) | (temp_val9 &lt;&lt; <span class="hljs-number">6</span>) | sudoku[sudoku_index + <span class="hljs-number">3</span>] &amp; <span class="hljs-number">0x3Fu</span>;<br>            <span class="hljs-keyword">if</span> ( expected_char == <span class="hljs-number">1114112</span> )<br>              <span class="hljs-keyword">break</span>;<br>            sudoku_index += <span class="hljs-number">4LL</span>;<br>            <span class="hljs-keyword">if</span> ( user_codepointer == <span class="hljs-number">1114112</span> )<br>              <span class="hljs-keyword">break</span>;<br>          &#125;<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        ++sudoku_index;<br>        <span class="hljs-keyword">if</span> ( user_codepointer == <span class="hljs-number">1114112</span> )<br>          <span class="hljs-keyword">break</span>;<br>      &#125;<br>      <span class="hljs-keyword">if</span> ( expected_char != <span class="hljs-number">46</span> &amp;&amp; user_codepointer != expected_char )<br>      &#123;<br>        *&amp;stdin_handle[<span class="hljs-number">0</span>] = aYouShouldNotCh;<br>        *(&amp;stdin_handle[<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>) = <span class="hljs-number">32LL</span>;<br>        *&amp;fmt_arg1 = stdin_handle;<br>        *(&amp;fmt_arg1 + <span class="hljs-number">1</span>) = &lt;&amp;T_as_core::fmt::Display&gt;::fmt;<br>        *buf = &amp;unk_7FF6BF<span class="hljs-number">7524E0</span>;<br>        *&amp;buf[<span class="hljs-number">8</span>] = <span class="hljs-number">2LL</span>;<br>        *&amp;buf[<span class="hljs-number">32</span>] = <span class="hljs-number">0LL</span>;<br>        *&amp;buf[<span class="hljs-number">16</span>] = &amp;fmt_arg1;<br>        *&amp;buf[<span class="hljs-number">24</span>] = <span class="hljs-number">1LL</span>;<br>        result = std::io::stdio::_print(stdin_handle, <span class="hljs-number">81LL</span>, sudoku_index, buf);<br>        <span class="hljs-keyword">goto</span> LABEL_73;<br>      &#125;<br>    &#125;<br>    sudoku::board::sudoku::Sudoku::<span class="hljs-built_in">from_str_line</span>(stdin_handle, <span class="hljs-number">81LL</span>, alloc_result, buf, <span class="hljs-number">81LL</span>, expected_char);<br>    <span class="hljs-keyword">if</span> ( buf[<span class="hljs-number">0</span>] == <span class="hljs-number">1</span> )<br>    &#123;<br>      *&amp;fmt_arg1 = *&amp;buf[<span class="hljs-number">4</span>];<br>      core::result::<span class="hljs-built_in">unwrap_failed</span>(<br>        stdin_handle,<br>        <span class="hljs-number">81</span>,<br>        <span class="hljs-number">43</span>,<br>        <span class="hljs-string">&quot;called `Result::unwrap()` on an `Err` value&quot;</span>,<br>        &amp;fmt_arg1,<br>        &amp;unk_7FF6BF752070);<br>    &#125;<br>    board_data = buf[<span class="hljs-number">81</span>];<br>    stdin_handle[<span class="hljs-number">4</span>] = *&amp;buf[<span class="hljs-number">65</span>];<br>    stdin_handle[<span class="hljs-number">3</span>] = *&amp;buf[<span class="hljs-number">49</span>];<br>    stdin_handle[<span class="hljs-number">2</span>] = *&amp;buf[<span class="hljs-number">33</span>];<br>    stdin_handle[<span class="hljs-number">1</span>] = *&amp;buf[<span class="hljs-number">17</span>];<br>    stdin_handle[<span class="hljs-number">0</span>] = *&amp;buf[<span class="hljs-number">1</span>];<br>    <span class="hljs-keyword">if</span> ( sudoku::board::sudoku::Sudoku::<span class="hljs-built_in">is_solved</span>(stdin_handle, <span class="hljs-number">81LL</span>, temp_arg1, stdin_handle) )<br>    &#123;<br>      *buf = &amp;off_7FF6BF752490;                 <span class="hljs-comment">// &quot;Congratulation!\n&quot;</span><br>      *&amp;buf[<span class="hljs-number">8</span>] = <span class="hljs-number">1LL</span>;<br>      *&amp;buf[<span class="hljs-number">16</span>] = <span class="hljs-number">8LL</span>;<br>      *&amp;buf[<span class="hljs-number">24</span>] = <span class="hljs-number">0LL</span>;<br>      std::io::stdio::_print(stdin_handle, <span class="hljs-number">81LL</span>, temp_arg2, buf);<br>      fmt_arg4 = <span class="hljs-number">0LL</span>;<br>      fmt_arg3 = <span class="hljs-number">0LL</span>;<br>      fmt_arg2 = <span class="hljs-number">0LL</span>;<br>      fmt_arg1 = <span class="hljs-number">0LL</span>;<br>      fmt_arg6 = <span class="hljs-number">0LL</span>;<br>      fmt_arg5 = ::fmt_arg5;<br>      md5_ctx_prt = &amp;fmt_arg1;<br>      md5::<span class="hljs-built_in">consume</span>(&amp;fmt_arg1, <span class="hljs-number">81LL</span>, alloc_result, &amp;fmt_arg1, <span class="hljs-number">81LL</span>);<br>      *&amp;buf[<span class="hljs-number">80</span>] = fmt_arg6;<br>      *&amp;buf[<span class="hljs-number">64</span>] = fmt_arg5;<br>      *&amp;buf[<span class="hljs-number">48</span>] = fmt_arg4;<br>      *&amp;buf[<span class="hljs-number">32</span>] = fmt_arg3;<br>      *&amp;buf[<span class="hljs-number">16</span>] = fmt_arg2;<br>      *buf = fmt_arg1;<br>      md5::Context::<span class="hljs-built_in">finalize</span>(&amp;fmt_arg1, <span class="hljs-number">81LL</span>, buf, md5_hash);<br>      *&amp;fmt_arg1 = md5_hash;<br>      *(&amp;fmt_arg1 + <span class="hljs-number">1</span>) = &lt;md5::Digest_as_core::fmt::LowerHex&gt;::fmt;<br>      *buf = &amp;YourFlagIs;                       <span class="hljs-comment">// &quot;Your flag is moectf&#123;&quot;</span><br>      *&amp;buf[<span class="hljs-number">8</span>] = <span class="hljs-number">2LL</span>;<br>      *&amp;buf[<span class="hljs-number">32</span>] = <span class="hljs-number">0LL</span>;<br>      *&amp;buf[<span class="hljs-number">16</span>] = &amp;fmt_arg1;<br>      *&amp;buf[<span class="hljs-number">24</span>] = <span class="hljs-number">1LL</span>;<br>      result = std::io::stdio::_print(&amp;fmt_arg1, <span class="hljs-number">81LL</span>, temp_arg3, buf);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      *buf = &amp;TryAgain;                         <span class="hljs-comment">// &quot;try again~\n&quot;</span><br>      *&amp;buf[<span class="hljs-number">8</span>] = <span class="hljs-number">1LL</span>;<br>      *&amp;buf[<span class="hljs-number">16</span>] = <span class="hljs-number">8LL</span>;<br>      *&amp;buf[<span class="hljs-number">24</span>] = <span class="hljs-number">0LL</span>;<br>      result = std::io::stdio::_print(stdin_handle, <span class="hljs-number">81LL</span>, temp_arg2, buf);<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>LABEL_72:<br>    *buf = &amp;Invalid;                            <span class="hljs-comment">// &quot;Invalid Solution.\n&quot;</span><br>    *&amp;buf[<span class="hljs-number">8</span>] = <span class="hljs-number">1LL</span>;<br>    *&amp;buf[<span class="hljs-number">16</span>] = <span class="hljs-number">8LL</span>;<br>    *&amp;buf[<span class="hljs-number">24</span>] = <span class="hljs-number">0LL</span>;<br>    result = std::io::stdio::_print(stdin_handle, trimmed_length, input_data, buf);<br>  &#125;<br>LABEL_73:<br>  <span class="hljs-keyword">if</span> ( trimmed_length )<br>    <span class="hljs-keyword">return</span> __rustc::__rust_dealloc(md5_ctx_prt, trimmed_length, trimmed_length, alloc_result, <span class="hljs-number">1LL</span>);<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>rust逆向的伪代码不好分析，但是作为数独游戏，只需要找到数独就可以了，可以shift+F12在字符串表窗口找到可疑的数据：</p>
<p><img src="/../images/image-20250910112618179-1760193218429-38.png" alt="可疑的数据"></p>
</li>
<li><p>结合伪代码，可以分析出程序接受用户输入的已求解的数独后会进行检验，若数独正确且求解成功，会输出flag，flag是md5加密后的数独。所以直接利用程序得到flag即可。网上找一个数独求解工具求解：<a target="_blank" rel="noopener" href="https://sudoku.vc/zh-CN/sudoku-solver">数独求解器 - 免费在线数独方案解题工具</a>（建议不要直接把数独复制给AI求解，因为AI会乱改数据，笔者卡在求解这一步好久😅）</p>
<p><img src="/../images/image-20250910112549164-1760193218429-42.png" alt="求解数独"></p>
</li>
<li><p>IDA动态调试（直接运行程序输入正确数独貌似会闪退），把解出来的数独按提示的顺序输入，就可以得到flag：</p>
<p><img src="/../images/image-20250910112516212-1760193218429-41.png" alt="得到flag"></p>
</li>
</ul>
<h2 id="week4"><a href="#week4" class="headerlink" title="week4"></a>week4</h2><h3 id="ezandroid"><a href="#ezandroid" class="headerlink" title="ezandroid"></a>ezandroid</h3><ul>
<li><p>附件apk用JEB打开，发现逻辑主要是将输入的文本base64加密后进行比较</p>
<p><img src="/../images/image-20250907203522833-1760193218429-43.png" alt="函数逻辑"></p>
</li>
<li><p>cyberchef一把梭</p>
<p><img src="/../images/image-20250907203551932-1760193218429-44.png" alt="cyberchef一把梭"></p>
</li>
</ul>
<h3 id="ezandroid-pro"><a href="#ezandroid-pro" class="headerlink" title="ezandroid.pro"></a>ezandroid.pro</h3><ul>
<li><p>附件apk用JEB打开，可以发现使用了一个从native层ezandroidpro库载入的函数check，由check判断输入是否正确</p>
<p><img src="/../images/image-20250907212718438-1760193218429-45.png" alt="JEB反编译结果"></p>
</li>
<li><p>把apk解压，在IDA中打开lib&#x2F;armeabi-v7a&#x2F;libezandroidpro.so，在Exports界面找到Java_com_example_ezandroidpro_MainActivity_check函数，即apk载入的check函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">bool</span> __fastcall <span class="hljs-title">Java_com_example_ezandroidpro_MainActivity_check</span><span class="hljs-params">(<span class="hljs-type">int</span> JENV, <span class="hljs-type">int</span> a2, <span class="hljs-type">int</span> a3)</span></span><br><span class="hljs-function"></span>&#123;<br>  _BOOL4 ret; <span class="hljs-comment">// r5</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *flag; <span class="hljs-comment">// r0</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *src; <span class="hljs-comment">// r4</span><br>  <span class="hljs-type">size_t</span> length; <span class="hljs-comment">// r0</span><br>  <span class="hljs-type">size_t</span> n; <span class="hljs-comment">// r5</span><br>  <span class="hljs-type">char</span> *dest; <span class="hljs-comment">// r9</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v11; <span class="hljs-comment">// r10</span><br>  <span class="hljs-type">char</span> *str; <span class="hljs-comment">// r4</span><br>  <span class="hljs-type">int</span> n96; <span class="hljs-comment">// r2</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// r0</span><br>  <span class="hljs-type">unsigned</span> __int8 *v15; <span class="hljs-comment">// r2</span><br>  <span class="hljs-type">int</span> v16; <span class="hljs-comment">// r1</span><br>  <span class="hljs-type">char</span> *_str; <span class="hljs-comment">// r3</span><br>  <span class="hljs-type">void</span> *s1_1; <span class="hljs-comment">// r6</span><br>  <span class="hljs-type">unsigned</span> __int8 v20; <span class="hljs-comment">// [sp+4h] [bp-44h] BYREF</span><br>  _BYTE v21[<span class="hljs-number">7</span>]; <span class="hljs-comment">// [sp+5h] [bp-43h] BYREF</span><br>  <span class="hljs-type">void</span> *s1; <span class="hljs-comment">// [sp+Ch] [bp-3Ch]</span><br>  _DWORD v23[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [sp+10h] [bp-38h] BYREF</span><br>  <span class="hljs-type">void</span> *key; <span class="hljs-comment">// [sp+18h] [bp-30h]</span><br>  _DWORD v25[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [sp+1Ch] [bp-2Ch] BYREF</span><br>  <span class="hljs-type">void</span> *dest_1; <span class="hljs-comment">// [sp+24h] [bp-24h]</span><br><br>  ret = <span class="hljs-number">0</span>;<br>  flag = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)(*(<span class="hljs-built_in">int</span> (__fastcall **)(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>, _DWORD))(*(_DWORD *)JENV + <span class="hljs-number">676</span>))(JENV, a3, <span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">if</span> ( !flag )<br>    <span class="hljs-keyword">return</span> ret;<br>  src = flag;<br>  length = <span class="hljs-built_in">strlen</span>(flag);<br>  <span class="hljs-keyword">if</span> ( length &gt;= <span class="hljs-number">0xFFFFFFF0</span> )<br>    std::__basic_string_common&lt;<span class="hljs-literal">true</span>&gt;::__throw_length_error(v25);<br>  n = length;<br>  <span class="hljs-keyword">if</span> ( length &gt;= <span class="hljs-number">0xB</span> )<br>  &#123;<br>    v11 = (length + <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFFFFFFF0</span>;<br>    dest = (<span class="hljs-type">char</span> *)<span class="hljs-keyword">operator</span> <span class="hljs-built_in">new</span>(v11);<br>    v25[<span class="hljs-number">1</span>] = n;<br>    dest_1 = dest;<br>    v25[<span class="hljs-number">0</span>] = v11 + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">goto</span> LABEL_7;<br>  &#125;<br>  <span class="hljs-built_in">LOBYTE</span>(v25[<span class="hljs-number">0</span>]) = <span class="hljs-number">2</span> * length;<br>  dest = (<span class="hljs-type">char</span> *)v25 + <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> ( length )<br>LABEL_7:<br>    <span class="hljs-built_in">j_memcpy</span>(dest, src, n);<br>  dest[n] = <span class="hljs-number">0</span>;<br>  (*(<span class="hljs-built_in">void</span> (__fastcall **)(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *))(*(_DWORD *)JENV + <span class="hljs-number">680</span>))(JENV, a3, src);<br>  key = (<span class="hljs-type">void</span> *)<span class="hljs-keyword">operator</span> <span class="hljs-built_in">new</span>(<span class="hljs-number">0x20u</span>);<br>  <span class="hljs-built_in">strcpy</span>((<span class="hljs-type">char</span> *)key, <span class="hljs-string">&quot;moectf2025!!!!!!&quot;</span>);<br>  v23[<span class="hljs-number">1</span>] = <span class="hljs-number">16</span>;<br>  v23[<span class="hljs-number">0</span>] = <span class="hljs-number">33</span>;<br>  str = (<span class="hljs-type">char</span> *)<span class="hljs-keyword">operator</span> <span class="hljs-built_in">new</span>(<span class="hljs-number">0x70u</span>);<br>  <span class="hljs-built_in">strcpy</span>(str, <span class="hljs-string">&quot;4EEB1EEF2914D79BFA8C5006332097ED2EF06C4A59CAE31C827A08D45CC649C0B971BF2EFBCB160E531A646DF7A6AC0B&quot;</span>);<br>  <span class="hljs-built_in">sm4Encrypt</span>((<span class="hljs-type">int</span>)&amp;v20, (<span class="hljs-type">int</span>)v25, (<span class="hljs-type">int</span>)v23);<br>  n96 = *(_DWORD *)&amp;v21[<span class="hljs-number">3</span>];<br>  v14 = v20 &amp; <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> ( !v14 )<br>    n96 = v20 &gt;&gt; <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> ( n96 == <span class="hljs-number">96</span> )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( v14 )<br>    &#123;<br>      s1_1 = s1;<br>      ret = <span class="hljs-built_in">memcmp</span>(s1, str, <span class="hljs-number">0x60u</span>) == <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">goto</span> LABEL_20;<br>    &#125;<br>    v15 = v21;<br>    v16 = v20 &gt;&gt; <span class="hljs-number">1</span>;<br>    _str = str;<br>    <span class="hljs-keyword">do</span><br>    &#123;<br>      ret = *v15 == (<span class="hljs-type">unsigned</span> __int8)*_str;<br>      <span class="hljs-keyword">if</span> ( *v15 != (<span class="hljs-type">unsigned</span> __int8)*_str )<br>        <span class="hljs-keyword">break</span>;<br>      ++_str;<br>      ++v15;<br>      --v16;<br>    &#125;<br>    <span class="hljs-keyword">while</span> ( v16 );<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    ret = <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v14 )<br>  &#123;<br>    s1_1 = s1;<br>LABEL_20:<br>    <span class="hljs-function"><span class="hljs-keyword">operator</span> <span class="hljs-title">delete</span><span class="hljs-params">(s1_1)</span></span>;<br>  &#125;<br>  <span class="hljs-function"><span class="hljs-keyword">operator</span> <span class="hljs-title">delete</span><span class="hljs-params">(str)</span></span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">LOBYTE</span>(v23[<span class="hljs-number">0</span>]) &lt;&lt; <span class="hljs-number">31</span> )<br>    <span class="hljs-function"><span class="hljs-keyword">operator</span> <span class="hljs-title">delete</span><span class="hljs-params">(key)</span></span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">LOBYTE</span>(v25[<span class="hljs-number">0</span>]) &lt;&lt; <span class="hljs-number">31</span> )<br>    <span class="hljs-function"><span class="hljs-keyword">operator</span> <span class="hljs-title">delete</span><span class="hljs-params">(dest_1)</span></span>;<br>  <span class="hljs-keyword">return</span> ret;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>可以看到，check函数使用了sm4加密，密钥可能是“moectf2025!!!!!!”，还需要知道加密模式。借助AI分析具体加密函数知道采用ECB加密模式，cyberchef一把梭：</p>
<p><img src="/../images/image-20250907220527950-1760193218429-47.png" alt="cyberchef一把梭"></p>
</li>
</ul>
<h3 id="A-simple-program"><a href="#A-simple-program" class="headerlink" title="A simple program"></a>A simple program</h3><ul>
<li><p>附件程序main函数反编译出来大概是这样：</p>
<p><img src="/../images/image-20250909145857318-1760193218429-48.png" alt="main函数"></p>
<p>但是Str2这个像模像样的flag是假的，提交会显示错误。结合题目提示，flag应该藏在其他地方。</p>
</li>
<li><p>IDA看不出有什么套路在里面，但是在X32Dbg，strncmp是可以点进去的（在IDA中，strncmp是粉色的导入函数，点击函数没有详细内容），点进去会发现，里面还有一个strncmp</p>
<p><img src="/../images/image-20250909150500077-1760193218429-49.png" alt="strncmp:别有洞天"></p>
<p>加上注释：</p>
<p><img src="/../images/image-20250909195444724-1760193218429-46.png" alt="加上注释"></p>
</li>
<li><p>所以真正的检验逻辑在strncmp里，程序从chall.4D31A4取出真正的密文，然后把输入的flag进行异或处理再比较。在转储中跟随4D31A4可以获得密文：</p>
<p><img src="/../images/image-20250909195828121-1760193218429-50.png" alt="转储中的密文"></p>
</li>
<li><p>解密脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">enc=[<span class="hljs-number">0x4E</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x5E</span>]<br>flag=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> enc:<br>    flag+=<span class="hljs-built_in">chr</span>(i^<span class="hljs-number">0x23</span>)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="week5"><a href="#week5" class="headerlink" title="week5"></a>week5</h2><h3 id="2048-master-re"><a href="#2048-master-re" class="headerlink" title="2048_master_re"></a>2048_master_re</h3><ul>
<li><p>附件程序是一个2048小游戏，通过方向键来操作数字整体移动。根据游戏窗口可以推测这也是一个GUI程序。</p>
<p><img src="/../images/image-20250927191149395-1760193218429-51.png" alt="游戏窗口"></p>
</li>
<li><p>用IDA打开附件程序，shift+F12可以在字符串窗口看见一些蛛丝马迹（因为是MFC GUI程序，也可以直接找WinMain函数，然后再从中找出和flag检验有关的逻辑）：</p>
<p><img src="/../images/image-20250927191413499-1760193218429-52.png" alt="字符串窗口"></p>
</li>
<li><p>跟踪flag.txt可以发现一个疑似的关键函数：</p>
<p><img src="/../images/image-20250927191650957-1760193218429-54.png" alt="疑似关键逻辑的函数"></p>
<p>通过粗略分析可以推测程序从flag.txt里读取数据，然后进行检验。但是此处没有直接的和flag相关的提示，跟踪到上级函数看看。选中函数名按X查找交叉引用，跳转到上一级函数：</p>
<p><img src="/../images/image-20250927192543291-1760193218429-53.png" alt="出题人的提示"></p>
<p>出题人根据可疑函数的返回值设置了提示，看来flag检验逻辑在此没错了。回到可疑函数，可以看到函数后半部分是对Block的检验，所以推测sub_401A81是一个加密函数。跟踪进去可以找到一个魔改xxtea函数和一个疑似数据格式转换的函数。这是优化后的样子：</p>
<p><img src="/../images/image-20250927194329834-1760193218429-55.png" alt="sub_401A81"></p>
<p>到这里大概掌握了一些信息了。但还是要完整分析一下程序的整体逻辑，继续找上级函数，回溯到WinMain函数。下面是沿着正向调用逻辑的分析：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> __stdcall <span class="hljs-title">WinMain</span><span class="hljs-params">(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, <span class="hljs-type">int</span> nShowCmd)</span></span><br><span class="hljs-function"></span>&#123;<br>  MSG Msg; <span class="hljs-comment">// [rsp+60h] [rbp-90h] BYREF</span><br>  WNDCLASSEXA v6; <span class="hljs-comment">// [rsp+90h] [rbp-60h] BYREF</span><br><br>  <span class="hljs-built_in">memset</span>(&amp;v6, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(v6));<br>  v<span class="hljs-number">6.</span>cbSize = <span class="hljs-number">80</span>;<br>  v<span class="hljs-number">6.l</span>pfnWndProc = check_2048;                  <span class="hljs-comment">// 游戏的检验逻辑</span><br>  v<span class="hljs-number">6.</span>hInstance = hInstance;<br>  v<span class="hljs-number">6.</span>hCursor = <span class="hljs-built_in">LoadCursorA</span>(<span class="hljs-number">0LL</span>, <span class="hljs-number">0x7F00</span>);<br>  v<span class="hljs-number">6.</span>hbrBackground = <span class="hljs-number">5</span>;<br>  v<span class="hljs-number">6.l</span>pszClassName = <span class="hljs-string">&quot;WindowClass&quot;</span>;<br>  v<span class="hljs-number">6.</span>hIcon = <span class="hljs-built_in">LoadIconA</span>(<span class="hljs-number">0LL</span>, <span class="hljs-number">0x7F00</span>);<br>  v<span class="hljs-number">6.</span>hIconSm = <span class="hljs-built_in">LoadIconA</span>(<span class="hljs-number">0LL</span>, <span class="hljs-number">0x7F00</span>);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">RegisterClassExA</span>(&amp;v6) )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">CreateWindowExA</span>(<br>           <span class="hljs-number">0x200u</span>,<br>           <span class="hljs-string">&quot;WindowClass&quot;</span>,<br>           <span class="hljs-string">&quot;2048&quot;</span>,<br>           <span class="hljs-number">0x10CF0000u</span>,<br>           <span class="hljs-number">0x80000000</span>,<br>           <span class="hljs-number">0x80000000</span>,<br>           <span class="hljs-number">640</span>,<br>           <span class="hljs-number">480</span>,<br>           <span class="hljs-number">0LL</span>,<br>           <span class="hljs-number">0LL</span>,<br>           hInstance,<br>           <span class="hljs-number">0LL</span>) )<br>    &#123;<br>      <span class="hljs-keyword">while</span> ( <span class="hljs-built_in">GetMessageA</span>(&amp;Msg, <span class="hljs-number">0LL</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) &gt; <span class="hljs-number">0</span> )<br>      &#123;<br>        <span class="hljs-built_in">TranslateMessage</span>(&amp;Msg);<br>        <span class="hljs-built_in">DispatchMessageA</span>(&amp;Msg);<br>      &#125;<br>      <span class="hljs-keyword">return</span> Msg.wParam;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-built_in">MessageBoxA</span>(<span class="hljs-number">0LL</span>, <span class="hljs-string">&quot;Window Creation Failed!&quot;</span>, <span class="hljs-string">&quot;Error!&quot;</span>, <span class="hljs-number">0x30u</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">MessageBoxA</span>(<span class="hljs-number">0LL</span>, <span class="hljs-string">&quot;Window Registration Failed!&quot;</span>, <span class="hljs-string">&quot;Error!&quot;</span>, <span class="hljs-number">0x30u</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//游戏检验函数</span><br><span class="hljs-function">LRESULT __fastcall <span class="hljs-title">check_2048</span><span class="hljs-params">(HWND hWnd, UINT n20, WPARAM wParam, LPARAM lParam)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v4; <span class="hljs-comment">// eax</span><br>  tagPAINTSTRUCT Paint; <span class="hljs-comment">// [rsp+50h] [rbp-30h] BYREF</span><br>  <span class="hljs-keyword">struct</span> <span class="hljs-title class_">tagRECT</span> Rect; <span class="hljs-comment">// [rsp+230h] [rbp+1B0h] BYREF</span><br>  HGDIOBJ h; <span class="hljs-comment">// [rsp+248h] [rbp+1C8h]</span><br>  HDC hdcSrc; <span class="hljs-comment">// [rsp+250h] [rbp+1D0h]</span><br>  HDC hdc; <span class="hljs-comment">// [rsp+258h] [rbp+1D8h]</span><br>  LONG dwNewLong; <span class="hljs-comment">// [rsp+264h] [rbp+1E4h]</span><br>  HMENU SystemMenu; <span class="hljs-comment">// [rsp+268h] [rbp+1E8h]</span><br>  <span class="hljs-type">int</span> i2; <span class="hljs-comment">// [rsp+274h] [rbp+1F4h]</span><br>  <span class="hljs-type">int</span> i1; <span class="hljs-comment">// [rsp+278h] [rbp+1F8h]</span><br>  <span class="hljs-type">int</span> nn; <span class="hljs-comment">// [rsp+27Ch] [rbp+1FCh]</span><br>  <span class="hljs-type">int</span> mm; <span class="hljs-comment">// [rsp+280h] [rbp+200h]</span><br>  <span class="hljs-type">int</span> kk; <span class="hljs-comment">// [rsp+284h] [rbp+204h]</span><br>  <span class="hljs-type">int</span> v18; <span class="hljs-comment">// [rsp+288h] [rbp+208h]</span><br>  <span class="hljs-type">int</span> jj; <span class="hljs-comment">// [rsp+28Ch] [rbp+20Ch]</span><br>  <span class="hljs-type">int</span> i14; <span class="hljs-comment">// [rsp+290h] [rbp+210h]</span><br>  <span class="hljs-type">int</span> i13; <span class="hljs-comment">// [rsp+294h] [rbp+214h]</span><br>  <span class="hljs-type">int</span> i12; <span class="hljs-comment">// [rsp+298h] [rbp+218h]</span><br>  <span class="hljs-type">int</span> i11; <span class="hljs-comment">// [rsp+29Ch] [rbp+21Ch]</span><br>  <span class="hljs-type">int</span> i10; <span class="hljs-comment">// [rsp+2A0h] [rbp+220h]</span><br>  <span class="hljs-type">int</span> v25; <span class="hljs-comment">// [rsp+2A4h] [rbp+224h]</span><br>  <span class="hljs-type">int</span> i9; <span class="hljs-comment">// [rsp+2A8h] [rbp+228h]</span><br>  <span class="hljs-type">int</span> i8; <span class="hljs-comment">// [rsp+2ACh] [rbp+22Ch]</span><br>  <span class="hljs-type">int</span> i7; <span class="hljs-comment">// [rsp+2B0h] [rbp+230h]</span><br>  <span class="hljs-type">int</span> i6; <span class="hljs-comment">// [rsp+2B4h] [rbp+234h]</span><br>  <span class="hljs-type">int</span> i5; <span class="hljs-comment">// [rsp+2B8h] [rbp+238h]</span><br>  <span class="hljs-type">int</span> i4; <span class="hljs-comment">// [rsp+2BCh] [rbp+23Ch]</span><br>  <span class="hljs-type">int</span> v32; <span class="hljs-comment">// [rsp+2C0h] [rbp+240h]</span><br>  <span class="hljs-type">int</span> i3; <span class="hljs-comment">// [rsp+2C4h] [rbp+244h]</span><br>  <span class="hljs-type">int</span> ii; <span class="hljs-comment">// [rsp+2C8h] [rbp+248h]</span><br>  <span class="hljs-type">int</span> n; <span class="hljs-comment">// [rsp+2CCh] [rbp+24Ch]</span><br>  <span class="hljs-type">int</span> m; <span class="hljs-comment">// [rsp+2D0h] [rbp+250h]</span><br>  <span class="hljs-type">int</span> k; <span class="hljs-comment">// [rsp+2D4h] [rbp+254h]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+2D8h] [rbp+258h]</span><br>  <span class="hljs-type">int</span> v39; <span class="hljs-comment">// [rsp+2DCh] [rbp+25Ch]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+2E0h] [rbp+260h]</span><br>  <span class="hljs-type">char</span> v41; <span class="hljs-comment">// [rsp+2E7h] [rbp+267h]</span><br>  <span class="hljs-type">int</span> i16; <span class="hljs-comment">// [rsp+2E8h] [rbp+268h]</span><br>  <span class="hljs-type">int</span> i15; <span class="hljs-comment">// [rsp+2ECh] [rbp+26Ch]</span><br><br>  <span class="hljs-keyword">if</span> ( n20 == <span class="hljs-number">15</span> )                              <span class="hljs-comment">// 下面开始是一大串的检验操作</span><br>  &#123;<br>    hdc = <span class="hljs-built_in">BeginPaint</span>(hWnd, &amp;Paint);<br>    hdcSrc = <span class="hljs-built_in">CreateCompatibleDC</span>(hdc);<br>    <span class="hljs-built_in">GetClientRect</span>(hWnd, &amp;Rect);<br>    h = <span class="hljs-built_in">CreateCompatibleBitmap</span>(hdc, Rect.right, Rect.bottom);<br>    <span class="hljs-built_in">SelectObject</span>(hdcSrc, h);<br>    <span class="hljs-built_in">sub_4022AF</span>(hdcSrc);<br>    <span class="hljs-built_in">BitBlt</span>(hdc, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, Rect.right, Rect.bottom, hdcSrc, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0xCC0020u</span>);<br>    <span class="hljs-built_in">DeleteObject</span>(h);<br>    <span class="hljs-built_in">DeleteDC</span>(hdcSrc);<br>    <span class="hljs-built_in">EndPaint</span>(hWnd, &amp;Paint);<br>  &#125;<br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( n20 &gt; <span class="hljs-number">0xF</span> )<br>  &#123;<br>	<span class="hljs-comment">//...此处省略</span><br>  &#125;<br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( n20 == <span class="hljs-number">1</span> )<br>  &#123;<br>    SystemMenu = <span class="hljs-built_in">GetSystemMenu</span>(hWnd, <span class="hljs-number">0</span>);<br>    dwNewLong = <span class="hljs-built_in">GetWindowLongA</span>(hWnd, <span class="hljs-number">-16</span>) &amp; <span class="hljs-number">0xFFF8FFFF</span>;<br>    <span class="hljs-built_in">SetWindowLongA</span>(hWnd, <span class="hljs-number">-16</span>, dwNewLong);<br>    <span class="hljs-built_in">SetWindowPos</span>(hWnd, <span class="hljs-number">0LL</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3u</span>);<br>    <span class="hljs-built_in">ShowWindow</span>(hWnd, <span class="hljs-number">1</span>);<br>    v4 = <span class="hljs-built_in">time64</span>(<span class="hljs-number">0LL</span>);<br>    <span class="hljs-built_in">srand</span>(v4);<br>    hThread = <span class="hljs-built_in">CreateThread</span>(<span class="hljs-number">0LL</span>, <span class="hljs-number">0LL</span>, StartAddress, <span class="hljs-number">0LL</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0LL</span>);<br>    <span class="hljs-built_in">CreateThread</span>(<span class="hljs-number">0LL</span>, <span class="hljs-number">0LL</span>, check_flag, <span class="hljs-number">0LL</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0LL</span>);<span class="hljs-comment">// 这里创建了线程，而flag的检验函数就在这个线程里</span><br>    <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">sub_401DBF</span>(<span class="hljs-string">&quot;layout.dat&quot;</span>) )<br>    &#123;<br>      <span class="hljs-built_in">sub_4645D0</span>(&amp;Paint, <span class="hljs-string">&quot;layout.dat&quot;</span>, <span class="hljs-number">8</span>);<br>      <span class="hljs-keyword">for</span> ( i15 = <span class="hljs-number">1</span>; i15 &lt;= <span class="hljs-number">4</span>; ++i15 )<br>      &#123;<br>        <span class="hljs-keyword">for</span> ( i16 = <span class="hljs-number">1</span>; i16 &lt;= <span class="hljs-number">4</span>; ++i16 )<br>          <span class="hljs-built_in">sub_453880</span>(&amp;Paint, &amp;dword_4B6040[<span class="hljs-number">5</span> * i15 + i16]);<br>      &#125;<br>      <span class="hljs-built_in">sub_453880</span>(&amp;Paint, &amp;dword_4B60A4);<br>      <span class="hljs-built_in">sub_464580</span>(&amp;Paint);<br>      <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">MessageBoxA</span>(<span class="hljs-number">0LL</span>, <span class="hljs-string">&quot;Continue?&quot;</span>, <span class="hljs-string">&quot;E=hv&quot;</span>, <span class="hljs-number">4u</span>) == <span class="hljs-number">7</span> )<br>      &#123;<br>        <span class="hljs-built_in">memset</span>(dword_4B6040, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(dword_4B6040));<br>        <span class="hljs-built_in">check</span>();<br>        <span class="hljs-built_in">check</span>();<br>        <span class="hljs-built_in">InvalidateRect</span>(hWnd, <span class="hljs-number">0LL</span>, <span class="hljs-number">1</span>);<br>        dword_4B60A4 = <span class="hljs-number">0</span>;<br>      &#125;<br>      <span class="hljs-built_in">sub_464C70</span>(&amp;Paint);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-built_in">check</span>();<br>      <span class="hljs-built_in">check</span>();<br>      dword_4B60A4 = <span class="hljs-number">0</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-keyword">if</span> ( n20 != <span class="hljs-number">2</span> )<br>      <span class="hljs-keyword">return</span> <span class="hljs-built_in">DefWindowProcA</span>(hWnd, n20, wParam, lParam);<br>    <span class="hljs-built_in">TerminateThread</span>(hThread, <span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">PostQuitMessage</span>(<span class="hljs-number">0</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br><br><span class="hljs-comment">//flag的检验函数</span><br><span class="hljs-function">__int64 __fastcall <span class="hljs-title">check_flag</span><span class="hljs-params">(LPVOID lpThreadParameter)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">sub_401DBF</span>(<span class="hljs-string">&quot;flag.txt&quot;</span>) )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">get_check_flag</span>() )                       <span class="hljs-comment">// 获取并检验flag</span><br>  &#123;<br>    <span class="hljs-built_in">MessageBoxA</span>(<br>      hWnd,<br>      <span class="hljs-string">&quot;It seems you&#x27;ve uncovered some clues, but they&#x27;re not enough to unlock the deepest secrets.&quot;</span>,<br>      <span class="hljs-string">&quot;sandtea&quot;</span>,<br>      <span class="hljs-number">0x30u</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1LL</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">MessageBoxA</span>(hWnd, <span class="hljs-string">&quot;You have found the final secret of 2048! - sandtea&quot;</span>, <span class="hljs-string">&quot;Congratulations&quot;</span>, <span class="hljs-number">0x40u</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//获取并检验flag的函数</span><br><span class="hljs-function">__int64 <span class="hljs-title">get_check_flag</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">size_t</span> length; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> flag[<span class="hljs-number">136</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-D0h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 block_num; <span class="hljs-comment">// [rsp+A8h] [rbp-48h] BYREF</span><br>  <span class="hljs-type">char</span> key[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+B0h] [rbp-40h] BYREF</span><br>  <span class="hljs-type">void</span> *Block; <span class="hljs-comment">// [rsp+D0h] [rbp-20h]</span><br>  FILE *FILE; <span class="hljs-comment">// [rsp+D8h] [rbp-18h]</span><br>  <span class="hljs-type">unsigned</span> __int64 i; <span class="hljs-comment">// [rsp+E0h] [rbp-10h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [rsp+ECh] [rbp-4h]</span><br><br>  FILE = <span class="hljs-built_in">fopen</span>(<span class="hljs-string">&quot;flag.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>);<br>  <span class="hljs-built_in">file_read</span>(FILE, <span class="hljs-string">&quot;%100s&quot;</span>, flag);<br>  <span class="hljs-built_in">fclose</span>(FILE);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(flag) != <span class="hljs-number">37</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1LL</span>;<br>  <span class="hljs-built_in">strcpy</span>(key, <span class="hljs-string">&quot;2048master2048ma&quot;</span>);<br>  length = <span class="hljs-built_in">strlen</span>(flag);<br>  Block = <span class="hljs-built_in">encrypt</span>(flag, length, key, &amp;block_num);<br>  <span class="hljs-keyword">if</span> ( Block )<br>  &#123;<br>    v8 = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0LL</span>; i &lt; block_num; ++i )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( *(Block + i) != byte_495280[i] )<br>        v8 = <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-built_in">free</span>(Block);<br>    <span class="hljs-keyword">return</span> v8;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">sub_428D00</span>(<span class="hljs-string">&quot;Encryption failed\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1LL</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//加密函数</span><br><span class="hljs-function">__int64 __fastcall <span class="hljs-title">encrypt</span><span class="hljs-params">(__int64 flag, <span class="hljs-type">unsigned</span> __int64 length, _QWORD *key, __int64 block_num)</span></span><br><span class="hljs-function"></span>&#123;<br>  __int64 v5; <span class="hljs-comment">// rdx</span><br>  _QWORD Key[<span class="hljs-number">3</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-30h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 word_num; <span class="hljs-comment">// [rsp+38h] [rbp-18h] BYREF</span><br>  _WORD *block; <span class="hljs-comment">// [rsp+40h] [rbp-10h]</span><br>  <span class="hljs-type">void</span> *mem; <span class="hljs-comment">// [rsp+48h] [rbp-8h]</span><br><br>  mem = <span class="hljs-built_in">new_mem</span>(flag, length, &amp;word_num);       <span class="hljs-comment">// 根据传入的flag申请了一块内存，word_num是申请的word个数</span><br>  <span class="hljs-keyword">if</span> ( !mem )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  v5 = key[<span class="hljs-number">1</span>];                                  <span class="hljs-comment">// 这是传入的密钥</span><br>  Key[<span class="hljs-number">0</span>] = *key;<br>  Key[<span class="hljs-number">1</span>] = v5;<br>  <span class="hljs-built_in">modifiedXXTea</span>(mem, word_num, Key);            <span class="hljs-comment">// xxtea加密</span><br>  block = <span class="hljs-built_in">make_blocks</span>(mem, word_num, block_num);<span class="hljs-comment">// 对加密后的数据进行一些转换，以便后续和给定的数据进行校验</span><br>  <span class="hljs-built_in">free</span>(mem);<br>  <span class="hljs-keyword">return</span> block;<br>&#125;<br><br><span class="hljs-comment">//申请内存的函数</span><br><span class="hljs-function">_DWORD *__fastcall <span class="hljs-title">new_mem</span><span class="hljs-params">(__int64 flag, <span class="hljs-type">unsigned</span> __int64 length, <span class="hljs-type">unsigned</span> __int64 *word_num)</span></span><br><span class="hljs-function"></span>&#123;<br>  _DWORD *mem; <span class="hljs-comment">// [rsp+28h] [rbp-18h]</span><br>  <span class="hljs-type">unsigned</span> __int64 Word_num; <span class="hljs-comment">// [rsp+30h] [rbp-10h]</span><br>  <span class="hljs-type">unsigned</span> __int64 i; <span class="hljs-comment">// [rsp+38h] [rbp-8h]</span><br><br>  Word_num = (length + <span class="hljs-number">3</span>) &gt;&gt; <span class="hljs-number">2</span>;                 <span class="hljs-comment">// 10</span><br>  mem = <span class="hljs-built_in">calloc</span>(Word_num, <span class="hljs-number">4uLL</span>);                 <span class="hljs-comment">// 10*4字节的内存空间</span><br>  <span class="hljs-keyword">if</span> ( !mem )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0LL</span>; i &lt; length; ++i )<br>    mem[i &gt;&gt; <span class="hljs-number">2</span>] |= *(flag + i) &lt;&lt; (<span class="hljs-number">8</span> * (i &amp; <span class="hljs-number">3</span>));<br><br>  *word_num = Word_num;<br>  <span class="hljs-keyword">return</span> mem;<br>&#125;<br><br><span class="hljs-comment">//魔改xxtea函数</span><br><span class="hljs-function"><span class="hljs-type">bool</span> __fastcall <span class="hljs-title">modifiedXXTea</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *block, <span class="hljs-type">int</span> word_num, __int64 key)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *p1; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *last_one1; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">bool</span> result; <span class="hljs-comment">// al</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *v6; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// [rsp+8h] [rbp-18h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [rsp+8h] [rbp-18h]</span><br>  <span class="hljs-type">int</span> round; <span class="hljs-comment">// [rsp+Ch] [rbp-14h]</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [rsp+Ch] [rbp-14h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+10h] [rbp-10h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+10h] [rbp-10h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> delta; <span class="hljs-comment">// [rsp+14h] [rbp-Ch]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> delta1; <span class="hljs-comment">// [rsp+14h] [rbp-Ch]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> last_one; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v16; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v17; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> p2; <span class="hljs-comment">// [rsp+1Ch] [rbp-4h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v19; <span class="hljs-comment">// [rsp+1Ch] [rbp-4h]</span><br>  <span class="hljs-type">int</span> v20; <span class="hljs-comment">// [rsp+38h] [rbp+18h]</span><br><br>  <span class="hljs-keyword">if</span> ( word_num &lt;= <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( word_num &lt; <span class="hljs-number">-1</span> )<br>    &#123;<br>      v20 = -word_num;<br>      v10 = <span class="hljs-number">52</span> / -word_num + <span class="hljs-number">6</span>;<br>      delta1 = <span class="hljs-number">0x3E9779B9</span> * v10;<br>      v19 = *block;<br>      <span class="hljs-keyword">do</span><br>      &#123;<br>        v8 = (delta1 &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br>        <span class="hljs-keyword">for</span> ( i = v20 - <span class="hljs-number">1</span>; i; --i )<br>        &#123;<br>          v16 = block[i - <span class="hljs-number">1</span>];<br>          v6 = &amp;block[i];<br>          *v6 -= (((<span class="hljs-number">4</span> * v19) ^ (v16 &gt;&gt; <span class="hljs-number">5</span>)) + ((v19 &gt;&gt; <span class="hljs-number">3</span>) ^ (<span class="hljs-number">16</span> * v16))) ^ ((v19 ^ delta1)<br>                                                                         + (v16 ^ *(<span class="hljs-number">4LL</span> * (v8 ^ i &amp; <span class="hljs-number">3</span>) + key)));<br>          v19 = *v6;<br>        &#125;<br>        v17 = block[v20 - <span class="hljs-number">1</span>];<br>        *block -= (((<span class="hljs-number">4</span> * v19) ^ (v17 &gt;&gt; <span class="hljs-number">5</span>)) + ((v19 &gt;&gt; <span class="hljs-number">3</span>) ^ (<span class="hljs-number">16</span> * v17))) ^ ((v19 ^ delta1) + (v17 ^ *(<span class="hljs-number">4LL</span> * v8 + key)));<br>        v19 = *block;<br>        delta1 -= <span class="hljs-number">0x3E9779B9</span>;<br>        result = --v10 != <span class="hljs-number">0</span>;<br>      &#125;<br>      <span class="hljs-keyword">while</span> ( v10 );<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    round = <span class="hljs-number">52</span> / word_num + <span class="hljs-number">6</span>;<br>    delta = <span class="hljs-number">0</span>;<br>    last_one = block[word_num - <span class="hljs-number">1</span>];<br>    <span class="hljs-keyword">do</span><br>    &#123;<br>      delta += <span class="hljs-number">0x3E9779B9</span>;<br>      v7 = (delta &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br>      <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; word_num - <span class="hljs-number">1</span> &gt; j; ++j )<br>      &#123;<br>        p2 = block[j + <span class="hljs-number">1</span>];<br>        p1 = &amp;block[j];<br>        *p1 += (((<span class="hljs-number">4</span> * p2) ^ (last_one &gt;&gt; <span class="hljs-number">5</span>)) + ((p2 &gt;&gt; <span class="hljs-number">3</span>) ^ (<span class="hljs-number">16</span> * last_one))) ^ ((p2 ^ delta)<br>                                                                               + (last_one ^ *(<span class="hljs-number">4LL</span> * (v7 ^ j &amp; <span class="hljs-number">3</span>) + key)));<br>        last_one = *p1;<br>      &#125;<br>      last_one1 = &amp;block[word_num - <span class="hljs-number">1</span>];<br>      *last_one1 += (((<span class="hljs-number">4</span> * *block) ^ (last_one &gt;&gt; <span class="hljs-number">5</span>)) + ((*block &gt;&gt; <span class="hljs-number">3</span>) ^ (<span class="hljs-number">16</span> * last_one))) ^ ((*block ^ delta)<br>                                                                                            + (last_one ^ *(<span class="hljs-number">4LL</span> * (v7 ^ j &amp; <span class="hljs-number">3</span>) + key)));<br>      last_one = *last_one1;<br>      result = --round != <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">while</span> ( round );<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-comment">//数据格式转换函数</span><br><span class="hljs-function">_WORD *__fastcall <span class="hljs-title">make_blocks</span><span class="hljs-params">(__int64 mem, <span class="hljs-type">unsigned</span> __int64 num_word, <span class="hljs-type">size_t</span> *block_num)</span></span><br><span class="hljs-function"></span>&#123;<br>  _WORD *block; <span class="hljs-comment">// [rsp+20h] [rbp-10h]</span><br>  <span class="hljs-type">unsigned</span> __int64 i; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br><br>  *block_num = <span class="hljs-number">4</span> * num_word; <br>  block = <span class="hljs-built_in">malloc</span>(*block_num);<br>  <span class="hljs-keyword">if</span> ( !block )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0LL</span>; i &lt; num_word; ++i )<br>  &#123;<br>    block[<span class="hljs-number">2</span> * i] = *(<span class="hljs-number">4</span> * i + mem);<br>    <span class="hljs-built_in">LOBYTE</span>(block[<span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>]) = <span class="hljs-built_in">BYTE2</span>(*(<span class="hljs-number">4</span> * i + mem));<br>    <span class="hljs-built_in">HIBYTE</span>(block[<span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>]) = <span class="hljs-built_in">HIBYTE</span>(*(<span class="hljs-number">4</span> * i + mem));<br>  &#125;<br>  <span class="hljs-keyword">return</span> block;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>所以要解出flag，就需要逆向这个xxtea加密。把这个任务交给AI，可以得到解密脚本：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><br><span class="hljs-comment">// 加密数据（make_blocks的输出）</span><br><span class="hljs-type">uint8_t</span> encrypted_data[<span class="hljs-number">40</span>] = &#123;<br>    <span class="hljs-number">0x35</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0xCC</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0xFF</span>,<br>    <span class="hljs-number">0x9F</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0xAE</span>,<br>    <span class="hljs-number">0xD7</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0xD9</span>,<br>    <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0x63</span><br>&#125;;<br><br><span class="hljs-comment">// 密钥</span><br><span class="hljs-type">char</span> key[<span class="hljs-number">17</span>] = <span class="hljs-string">&quot;2048master2048ma&quot;</span>;<br><br><span class="hljs-comment">// 逆make_blocks：将_WORD数组转换回DWORD数组</span><br><span class="hljs-type">uint32_t</span>* <span class="hljs-title function_">unmake_blocks</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span>* blocks, <span class="hljs-type">size_t</span> block_bytes, <span class="hljs-type">size_t</span>* num_dwords)</span> &#123;<br>    *num_dwords = block_bytes / <span class="hljs-number">4</span>;<br>    <span class="hljs-type">uint32_t</span>* dwords = (<span class="hljs-type">uint32_t</span>*)<span class="hljs-built_in">malloc</span>(*num_dwords * <span class="hljs-number">4</span>);<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; *num_dwords; i++) &#123;<br>        <span class="hljs-comment">// 将两个WORD合并为一个DWORD</span><br>        <span class="hljs-type">uint16_t</span> low_word = *(<span class="hljs-type">uint16_t</span>*)&amp;blocks[<span class="hljs-number">4</span> * i];<br>        <span class="hljs-type">uint16_t</span> high_word = *(<span class="hljs-type">uint16_t</span>*)&amp;blocks[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>];<br>        dwords[i] = (high_word &lt;&lt; <span class="hljs-number">16</span>) | low_word;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> dwords;<br>&#125;<br><br><span class="hljs-comment">// 逆modifiedXXTea解密</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">decrypt_tea</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span>* data, <span class="hljs-type">int</span> num_dwords, <span class="hljs-type">uint32_t</span>* tea_key)</span> &#123;<br>    <span class="hljs-keyword">if</span> (num_dwords &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;<br><br>    <span class="hljs-type">int</span> rounds = <span class="hljs-number">52</span> / num_dwords + <span class="hljs-number">6</span>;<br>    <span class="hljs-type">uint32_t</span> delta = <span class="hljs-number">0x3E9779B9</span> * rounds; <span class="hljs-comment">// 1050114489</span><br><br>    <span class="hljs-type">uint32_t</span> sum = delta;<br>    <span class="hljs-type">uint32_t</span> y = data[<span class="hljs-number">0</span>];<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; rounds; i++) &#123;<br>        <span class="hljs-type">uint32_t</span> e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = num_dwords - <span class="hljs-number">1</span>; j &gt; <span class="hljs-number">0</span>; j--) &#123;<br>            <span class="hljs-type">uint32_t</span> z = data[j - <span class="hljs-number">1</span>];<br>            data[j] -= (((z &gt;&gt; <span class="hljs-number">5</span>) ^ (y &lt;&lt; <span class="hljs-number">2</span>)) + ((y &gt;&gt; <span class="hljs-number">3</span>) ^ (z &lt;&lt; <span class="hljs-number">4</span>))) ^ ((sum ^ y) + (tea_key[(j ^ e) &amp; <span class="hljs-number">3</span>] ^ z));<br>            y = data[j];<br>        &#125;<br><br>        <span class="hljs-type">uint32_t</span> z = data[num_dwords - <span class="hljs-number">1</span>];<br>        data[<span class="hljs-number">0</span>] -= (((z &gt;&gt; <span class="hljs-number">5</span>) ^ (y &lt;&lt; <span class="hljs-number">2</span>)) + ((y &gt;&gt; <span class="hljs-number">3</span>) ^ (z &lt;&lt; <span class="hljs-number">4</span>))) ^ ((sum ^ y) + (tea_key[e] ^ z));<br>        y = data[<span class="hljs-number">0</span>];<br><br>        sum -= <span class="hljs-number">0x3E9779B9</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 从DWORD数组提取字符串</span><br><span class="hljs-type">char</span>* <span class="hljs-title function_">extract_string</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span>* dwords, <span class="hljs-type">size_t</span> num_dwords, <span class="hljs-type">size_t</span> original_len)</span> &#123;<br>    <span class="hljs-type">char</span>* str =(<span class="hljs-type">char</span>*) <span class="hljs-built_in">malloc</span>(original_len + <span class="hljs-number">1</span>);<br>    <span class="hljs-built_in">memset</span>(str, <span class="hljs-number">0</span>, original_len + <span class="hljs-number">1</span>);<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; original_len; i++) &#123;<br>        <span class="hljs-type">uint32_t</span> dword = dwords[i &gt;&gt; <span class="hljs-number">2</span>];<br>        str[i] = (dword &gt;&gt; (<span class="hljs-number">8</span> * (i &amp; <span class="hljs-number">3</span>))) &amp; <span class="hljs-number">0xFF</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> str;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 步骤1: 逆make_blocks</span><br>    <span class="hljs-type">size_t</span> num_dwords;<br>    <span class="hljs-type">uint32_t</span>* tea_encrypted = unmake_blocks(encrypted_data, <span class="hljs-number">40</span>, &amp;num_dwords);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;After unmake_blocks (%zu DWORDs):\n&quot;</span>, num_dwords);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; num_dwords; i++) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;0x%08X &quot;</span>, tea_encrypted[i]);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n\n&quot;</span>);<br><br>    <span class="hljs-comment">// 步骤2: 准备TEA密钥（将字符串转换为4个32位整数）</span><br>    <span class="hljs-type">uint32_t</span> tea_key[<span class="hljs-number">4</span>];<br>    <span class="hljs-built_in">memcpy</span>(tea_key, key, <span class="hljs-number">16</span>);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;TEA Key:\n&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;0x%08X &quot;</span>, tea_key[i]);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n\n&quot;</span>);<br><br>    <span class="hljs-comment">// 步骤3: 逆modifiedXXTea解密</span><br>    decrypt_tea(tea_encrypted, num_dwords, tea_key);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;After TEA decryption:\n&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; num_dwords; i++) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;0x%08X &quot;</span>, tea_encrypted[i]);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n\n&quot;</span>);<br><br>    <span class="hljs-comment">// 步骤4: 提取flag字符串（原始长度37字节）</span><br>    <span class="hljs-type">char</span>* flag = extract_string(tea_encrypted, num_dwords, <span class="hljs-number">37</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Decrypted flag: %s\n&quot;</span>, flag);<br><br>    <span class="hljs-comment">// 清理</span><br>    <span class="hljs-built_in">free</span>(tea_encrypted);<br>    <span class="hljs-built_in">free</span>(flag);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>Moectf2025ReverseWriteUp</p><p><a href="https://sydzi.github.io/2025/10/12/Moectf2025ReverseWriteUp/">https://sydzi.github.io/2025/10/12/Moectf2025ReverseWriteUp/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>SydzI</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2025-10-12</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2025-10-29</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/CTF/">CTF</a><a class="link-muted mr-2" rel="tag" href="/tags/WriteUp/">WriteUp</a><a class="link-muted mr-2" rel="tag" href="/tags/Reverse/">Reverse</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=68b654c479868da1c7122aa1&amp;product=inline-share-buttons" defer></script><nav class="post-navigation mt-4 mb-2 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2025/10/19/0xGame2025Week2ReverseWriteUp/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">0xGame2025Week2WriteUp</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2025/10/10/0xGame2025Week1ReverseWriteUp/"><span class="level-item">0xGame2025Week1WriteUp</span><i class="level-item fas fa-chevron-right"></i></a></div></nav></article></div><!--!--><div class="card" id="comments"><div class="card-content"><h3 class="title is-5">评论</h3><script src="https://utteranc.es/client.js" repo="sydzi/sydzi.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script></div></div></div><div class="column column-left is-4-tablet is-3-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.jpg" alt="SydzI"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">SydzI</p><p class="is-size-6 is-block">Action over inaction</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Nanjing, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives/"><p class="title">34</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories/"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags/"><p class="title">7</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/SydzI" target="_blank" rel="me noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/SydzI"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#week1"><span class="level-left"><span class="level-item">1</span><span class="level-item">week1</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#upx"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">upx</span></span></a></li><li><a class="level is-mobile" href="#maze"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">maze</span></span></a></li><li><a class="level is-mobile" href="#flower"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">flower</span></span></a></li><li><a class="level is-mobile" href="#tea"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">tea</span></span></a></li><li><a class="level is-mobile" href="#ez3"><span class="level-left"><span class="level-item">1.5</span><span class="level-item">ez3</span></span></a></li><li><a class="level is-mobile" href="#逆向工程入门指北"><span class="level-left"><span class="level-item">1.6</span><span class="level-item">逆向工程入门指北</span></span></a></li></ul></li><li><a class="level is-mobile" href="#week2"><span class="level-left"><span class="level-item">2</span><span class="level-item">week2</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#base"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">base</span></span></a></li><li><a class="level is-mobile" href="#speed"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">speed</span></span></a></li><li><a class="level is-mobile" href="#ezpy"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">ezpy</span></span></a></li><li><a class="level is-mobile" href="#catch"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">catch</span></span></a></li><li><a class="level is-mobile" href="#upx-revenge"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">upx_revenge</span></span></a></li><li><a class="level is-mobile" href="#Two-cups-of-tea"><span class="level-left"><span class="level-item">2.6</span><span class="level-item">Two cups of tea</span></span></a></li></ul></li><li><a class="level is-mobile" href="#week3"><span class="level-left"><span class="level-item">3</span><span class="level-item">week3</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#have-fun"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">have_fun</span></span></a></li><li><a class="level is-mobile" href="#guess"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">guess</span></span></a></li><li><a class="level is-mobile" href="#rusty-sudoku"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">rusty_sudoku</span></span></a></li></ul></li><li><a class="level is-mobile" href="#week4"><span class="level-left"><span class="level-item">4</span><span class="level-item">week4</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#ezandroid"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">ezandroid</span></span></a></li><li><a class="level is-mobile" href="#ezandroid-pro"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">ezandroid.pro</span></span></a></li><li><a class="level is-mobile" href="#A-simple-program"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">A simple program</span></span></a></li></ul></li><li><a class="level is-mobile" href="#week5"><span class="level-left"><span class="level-item">5</span><span class="level-item">week5</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#2048-master-re"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">2048_master_re</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">SydzI&#039;s Blog</a><p class="is-size-7"><span>&copy; 2026 SydzI</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            },
            services: {
                firebase: {"enable":true,"collection":"articles","apiKey":"AIzaSyCL4X3DgCuPZ09mSUIYiIzwCrbKdVcf_jY","projectId":"sydzi-s-blog-counter"}
            }
        };</script><script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/js/pjax.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><script data-pjax src="/js/firebase_counter.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"css":false});</script></body></html>